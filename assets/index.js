var mn=Object.defineProperty;var yn=(t,e,i)=>e in t?mn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var w=(t,e,i)=>yn(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();const Rt=/iPad/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,oi=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),ti=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),se=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&navigator.maxTouchPoints>1,xe=!ti&&!Rt;var tt=(t=>(t.AUTO="auto",t.HIGH="high",t.MEDIUM="medium",t.LOW="low",t))(tt||{});let it="auto",Z="high",ut,oe=!1,Me=!1,$t=null;const pn=60;let ai=0;function ri(t){Me=t,console.log(`Race mode set to: ${t?"ACTIVE":"INACTIVE"}`)}function Ee(){return it==="auto"?Z:it}function wn(){const t={isPrivate:!1,isIpadSafariPrivate:!1,isIOSPrivate:!1};if(Rt&&oi)try{window.localStorage.setItem("ipad_private_test","test"),window.localStorage.removeItem("ipad_private_test"),console.log("iPad Safari NOT in private mode")}catch{return console.log("iPad Safari private mode detected"),t.isPrivate=!0,t.isIpadSafariPrivate=!0,t}if(se)try{localStorage.setItem("ios_private_test","test"),localStorage.removeItem("ios_private_test"),console.log("iOS NOT in private mode")}catch{return console.log("iOS private mode detected"),t.isPrivate=!0,t.isIOSPrivate=!0,t}try{localStorage.setItem("private_test","private_test"),localStorage.removeItem("private_test")}catch{return console.log("Private browsing detected via localStorage exception"),t.isPrivate=!0,t}if(oi||se||Rt){const e=window.indexedDB;if(e)try{const s=e.open("test");s.onerror=()=>{console.log("Safari private mode detected via indexedDB"),t.isPrivate=!0}}catch(s){console.log("Error testing indexedDB:",s)}const i="private_test_"+Math.random(),n="test_value_"+Date.now();try{localStorage.setItem(i,n);const s=localStorage.getItem(i);localStorage.removeItem(i),s!==n&&(console.log("Private browsing detected (non-persistent storage)"),t.isPrivate=!0)}catch{}}return navigator.storage&&navigator.storage.estimate&&navigator.storage.estimate().then(e=>{e.quota&&e.quota<1e7&&(console.log("Private browsing detected via storage quota:",e.quota),ut==="high"&&Z==="high"&&(Z="medium",gt()))}).catch(e=>console.log("Storage quota check error:",e)),t}function vn(){const t=wn();return t.isIpadSafariPrivate?(console.log("iPad Safari private mode detected immediately - forcing LOW tier"),"low"):t.isIOSPrivate?(console.log("iOS private mode detected immediately - forcing LOW tier"),"low"):(se||Rt)&&t.isPrivate?(console.log("iOS/iPad device in private mode - forcing LOW performance tier"),"low"):navigator.hardwareConcurrency>4||navigator.gpu!==void 0||Rt&&navigator.hardwareConcurrency>3&&!t.isPrivate?t.isPrivate?"medium":"high":navigator.hardwareConcurrency>=2?"medium":"low"}function bn(t){if(!Me||Ee()!=="low")return!0;const e=1e3/pn;return t-ai>=e?(ai=t,!0):!1}function gt(){if($t){let t;it==="auto"?t=`auto (${An(Z)})`:t=it,ti?$t.textContent=`GFX: ${t}`:$t.innerHTML=`<u>G</u>FX: ${t}`}}function An(t){switch(t){case"high":return"H";case"medium":return"M";case"low":return"L";default:return t}}function Sn(t){$t=t,gt()}function In(){switch(it="auto",ut){case"high":Z="high";break;case"medium":Z="medium";break;case"low":Z="low";break}console.log(`Detected hardware: Cores: ${navigator.hardwareConcurrency}, Memory: ${navigator.deviceMemory||"unknown"} GB, GPU: ${navigator.gpu?"yes":"no"}`),console.log(`Performance tier detected: ${ut}`),console.log(`AUTO mode initialized with effective setting: ${Z}`),gt()}function kn(){console.log("Initializing graphics with performance detection..."),ut=vn(),console.log(`Detected performance tier: ${ut}`),ut==="high"&&xn(),In(),Rn(),oe=!1,console.log("Performance mode set to:",it)}function xn(){console.log("Running initial performance benchmark...");const t=document.createElement("canvas");t.width=400,t.height=400;const e=t.getContext("2d");if(!e)return;const i=performance.now();for(let r=0;r<50;r++){e.clearRect(0,0,400,400),e.save();const l=e.createRadialGradient(200,200,10,200,200,200);l.addColorStop(0,"white"),l.addColorStop(1,"black"),e.fillStyle=l,e.fillRect(0,0,400,400);for(let m=0;m<20;m++)e.fillStyle=`rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.5)`,e.beginPath(),e.arc(Math.random()*400,Math.random()*400,Math.random()*50+10,0,Math.PI*2),e.fill();const h=e.getImageData(0,0,400,400),d=h.data;for(let m=0;m<d.length;m+=16)d[m]=d[m]*.9,d[m+1]=d[m+1]*.9,d[m+2]=d[m+2]*.9;e.putImageData(h,0,0),e.restore()}const s=performance.now()-i;console.log(`Initial benchmark completed in ${s.toFixed(2)}ms`);const a=250;s>a?(console.log(`Initial benchmark indicates potential performance issues (${s.toFixed(2)}ms > ${a}ms)`),console.log("Setting performance tier to MEDIUM as a precaution"),ut="medium"):(console.log(`Initial benchmark indicates good performance (${s.toFixed(2)}ms < ${a}ms)`),console.log("Keeping performance tier as HIGH"))}function Hi(){oe||it!=="auto"||(console.log("Scheduling performance check..."),setTimeout(()=>{console.log("Starting performance check for AUTO mode..."),oe=!0,ut==="high"?En():ut==="medium"?Pn():Cn()},3e3))}function Mn(){oe=!1}function En(){console.log("Running performance check for HIGH tier device...");let t=0,e=0,i=0;const n=20,s=50,a=120;let r=performance.now();function l(d){const m=d-r;if(r=d,t>0&&(console.log(`Frame ${t} duration: ${m.toFixed(2)}ms`),m>a?(i++,e++,console.log(`SEVERE lag detected: ${m.toFixed(2)}ms`)):m>s&&(e++,console.log(`Moderate lag detected: ${m.toFixed(2)}ms`)),t>=n)){i>=5?(console.log(`SEVERE performance issues detected (${i}/${n} very slow frames)`),Z="low",gt()):e>=5?(console.log(`Moderate performance issues detected (${e}/${n} slow frames)`),Z="medium",gt(),setTimeout(()=>{h()},2e3)):console.log(`Performance acceptable (${e}/${n} slow frames)`);return}t++,requestAnimationFrame(l)}function h(){console.log("Performing follow-up performance check...");let d=0,m=0;const p=10;function f(y){const v=y-r;if(r=y,d>0&&(console.log(`Additional frame ${d} duration: ${v.toFixed(2)}ms`),v>s&&m++,d>=p)){m>=3&&(console.log(`Continued performance issues in MEDIUM mode (${m}/${p} slow frames)`),Z="low",gt());return}d++,requestAnimationFrame(f)}r=performance.now(),requestAnimationFrame(f)}requestAnimationFrame(l)}function Pn(){console.log("Running performance check for MEDIUM tier device...");const t=performance.now(),e=150;setTimeout(()=>{const n=performance.now()-t;console.log(`Medium tier check: Frame time = ${n.toFixed(2)}ms`),n>e?(console.log("Significant performance issues on medium-tier device"),Z="low",gt()):console.log("Medium-tier device performance is acceptable")},300)}function Cn(){console.log("Running performance check for LOW tier device..."),Z="low",gt(),console.log("Set to LOW performance mode for low-tier device")}function Bi(){const t=["auto","high","medium","low"],i=(t.indexOf(it)+1)%t.length;it=t[i],it==="auto"&&Me&&(oe=!1,Hi()),gt(),$t&&$t.blur(),console.log("Performance mode toggled to:",it)}function Rn(){ti||document.addEventListener("keydown",t=>{(t.code==="KeyG"||t.code==="F1")&&Bi()})}function ei(){return Me}const E={top:"10px",zIndex:"10",size:"40px",color:"rgba(255, 255, 255, 0.4)",background:"black",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",fontSize:"24px",lineHeight:"0"},u=document.querySelector("canvas"),o=u.getContext("2d",{willReadFrequently:!0});let dt=null,ee=null,ie;const pe="startButton",Tn=(t,e,i)=>{if(dt=document.createElement("canvas"),dt.width=t,dt.height=e,ee=dt.getContext("2d"),ee){ee.fillStyle=`rgba(0, 0, 0, ${1-i})`;for(let n=0;n<e;n+=2)ee.fillRect(0,n,t,1)}},Fn=()=>{const t=u.width,e=u.height;ie=o.createRadialGradient(t/2,e/2,0,t/2,e/2,t/2),ie.addColorStop(0,"rgba(255, 255, 255, 0.3)"),ie.addColorStop(1,"rgba(0, 0, 0, 0.5)")},ct=(t=!0)=>{const e=u.width,i=u.height;let n;const s=Ee();ei()?n=s:n=s===tt.LOW?tt.MEDIUM:s;const a=t?.7:.8;let r=a,l=t?10:0;switch(n){case tt.LOW:{o.fillStyle="rgba(0, 0, 0, 0.2)",o.fillRect(0,0,e,i),o.globalAlpha=.05,o.fillStyle="#000";for(let p=0;p<i;p+=2)o.fillRect(0,p,e,1);o.globalAlpha=1;return}case tt.MEDIUM:r=a*.7,l=0;break;case tt.HIGH:}const h=o.getImageData(0,0,e,i),d=h.data,m=t&&l>0?new Float32Array(e*i):null;if(t&&m&&l>0)for(let p=0;p<m.length;p++)m[p]=(Math.random()-.5)*l;if(t&&m&&l>0)for(let p=0;p<i;p++){const f=p*e;for(let y=0;y<e;y++){const v=(f+y)*4,S=m[f+y];d[v]+=S,d[v+1]+=S,d[v+2]+=S}}o.putImageData(h,0,0),n!==tt.LOW&&((!dt||dt.width!==e||dt.height!==i)&&Tn(e,i,r),ee&&dt&&(o.globalAlpha=r,o.drawImage(dt,0,0),o.globalAlpha=1))},kt=()=>{(ei()?Ee():tt.HIGH)!==tt.LOW&&(ie||Fn(),o.fillStyle=ie,o.fillRect(0,0,u.width,u.height))},Ni=()=>{if((ei()?Ee():tt.HIGH)===tt.LOW){o.globalAlpha=.5,o.fillStyle="rgba(0, 0, 0, 0.5)",o.fillRect(0,0,u.width,u.height),o.globalAlpha=1;return}const e=o.getImageData(0,0,u.width,u.height),i=e.data;for(let n=0;n<i.length;n+=4){const s=i[n],a=i[n+1],r=i[n+2],l=s*.3+a*.59+r*.11;i[n]=i[n+1]=i[n+2]=l*.7}o.putImageData(e,0,0)},On=()=>{const t=document.createElement("canvas");t.width=4,t.height=4;const e=t.getContext("2d");if(!e)return;function i(s,a,r,l,h){e&&(e.strokeStyle=h,e.beginPath(),e.moveTo(s,a),e.lineTo(r,l),e.stroke())}const n="#00000010";e.fillStyle=n,e.fillRect(0,0,t.width,t.height);for(let s=0;s<=t.width;s+=4)i(s,0,s,t.height,n),i(0,s,t.width,s,n);return e.createPattern(t,"repeat")},Dn=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(!e)return;const i=e.getImageData(0,0,t.width,t.height),n=i.data,s=4;for(let a=0;a<t.height;a+=s)for(let r=0;r<t.width;r+=s){const l=Math.random()*64,h=Math.floor(Math.random()*24);for(let d=0;d<s;d++)for(let m=0;m<s;m++){const p=((a+d)*t.width+(r+m))*4;n[p]=Math.min(255,Math.max(0,n[p]+l)),n[p+1]=Math.min(255,Math.max(0,n[p+1]+l)),n[p+2]=Math.min(255,Math.max(0,n[p+2]+l)),n[p+3]=h}}return e.putImageData(i,0,0),e.createPattern(t,"repeat")};function _n(t){const e=document.createElement("button");return e.id="fullscreenButton",e.style.position="absolute",e.style.top=E.top,e.style.right="10px",e.style.zIndex=E.zIndex,e.textContent="⛶",e.style.fontFamily="Impact",e.style.width=E.size,e.style.height=E.size,e.style.color=E.color,e.style.background=E.background,e.style.border=E.border,e.style.borderRadius=E.borderRadius,e.style.fontSize=E.fontSize,e.style.lineHeight=E.lineHeight,e.style.display=t?"none":"block",e}function Wn(){const t=document.createElement("button");return t.id="restartButton",t.style.position="absolute",t.style.top=E.top,t.style.right="60px",t.style.zIndex=E.zIndex,t.textContent="↺",t.style.fontFamily="Impact",t.style.width=E.size,t.style.height=E.size,t.style.color=E.color,t.style.background=E.background,t.style.border=E.border,t.style.borderRadius=E.borderRadius,t.style.fontSize=E.fontSize,t.style.lineHeight=E.lineHeight,t.style.display="none",t}function Ln(){const t=document.createElement("button");return t.id=pe,t.style.position="absolute",t.style.background="transparent",t.style.border="none",t.style.fontSize="2vw",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.zIndex=E.zIndex,t.style.color=E.color,t.style.display="none",t.style.padding="20vw 0 0 0",t.style.fontFamily="Courier New",t.style.zIndex=E.zIndex,t.textContent="Tap the screen to continue█",t}const Hn=()=>{const t=document.createElement("button");return xe?(t.style.top="10px",t.style.left="10px",t.style.height=E.size,t.style.fontSize=E.fontSize,t.style.background=E.background,t.style.border=E.border,t.style.borderRadius=E.borderRadius):(t.style.top="60px",t.style.right="10px",t.style.height=`${parseInt(E.size)/2}px`,t.style.padding="20px 0",t.style.fontSize=`${parseInt(E.fontSize)/2}px`,t.style.background="rgba(0, 0, 0, 0.2)",t.style.border="none"),t.style.position="absolute",t.style.minWidth="90px",t.style.fontFamily="Impact",t.style.height=E.size,t.style.color=E.color,t.style.lineHeight=E.lineHeight,t.style.zIndex=E.zIndex,t.addEventListener("click",e=>{e.preventDefault(),Bi(),t.blur()}),Sn(t),t};var W=(t=>(t[t.Tiny=16]="Tiny",t[t.Xs=20]="Xs",t[t.Small=24]="Small",t[t.Normal=32]="Normal",t[t.Large=48]="Large",t[t.Xl=64]="Xl",t[t.Huge=80]="Huge",t))(W||{});const li=t=>{const e=u.width/1e3;return Math.floor(t*e)},H=(t,e,i,n=1,s=0,a=!0,r=0,l)=>{o.save();const h=li(e),d=li(16);o.globalAlpha=n>0?n:0,o.fillStyle="white",o.font=h+"px "+i;const m=o.measureText(l??t).width,p=s*d,f=r*d;o.fillText(t,(u.width-m)/2+f,(a?u.height/2:0)+p),o.restore()},Bn=[1,,82,.01,.08,.2,,2.6,,,,,,.1,,,,.61,.02,,-1686],Nn=[2,,12,,,.008,,1.2,23,-7,,,.05,.4,,,.15,.82,.03,.28],Gn=[1,,85,.08,.1,.01,1,4,,-11,1,.07,,.1,101,,.05,.68,.4,.12,1],zn=[.01,,523.2511,.1,3,3,4,0,,,2250,,.04,,10,.01,,.82,1,,30],Xn=[2,,185,,,,3,1.6,-7,,,,,,,.2,.19,.1,,.38,985],$n=[1.5,,688,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.03,.11,-818],Yn=[1.5,,1376,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.8,.11,-818],Vn={songData:[{i:[0,0,180,0,0,0,180,0,0,160,158,158,158,0,0,0,0,51,2,1,2,54,239,1,32,88,1,157,2],p:[1,2],c:[{n:[111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137],f:[]},{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:1},Un={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[4,1,2,3,2,1,2,3],c:[{n:[134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134,137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]},{n:[137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137,134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]}]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[27,1,27,2,27,1,27,2],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,1,1,1,1,1,1,2],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[],c:[]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,,,,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:7,numChannels:8},Kn={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[],c:[]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[25,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,3,26,26,26],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,135],f:[]}]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[5,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,5,,5],c:[{n:[129],f:[]},{n:[134,,,,,,,,,,,,,,,,137],f:[]},{n:[137,,,,,,,,,,,,,,,,134],f:[]},{n:[141],f:[]},{n:[113],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,1,,,,1,,,,1,,,,1,,,,1,,,,1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,1,1,1],c:[{n:[,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1,,,,1,,,,1,,,,1,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:23,numChannels:8},wt=(t,...e)=>jn(t,Qn(t,...e)),U=44100,qn=new(window.AudioContext||window.webkitAudioContext),Oe=qn,jn=(t,...e)=>{let i=Oe.createBuffer(e.length,e[0].length,U),n=Oe.createBufferSource();return e.forEach((s,a)=>i.getChannelData(a).set(s)),n.buffer=i,n.connect(Oe.destination),n.start(),n},Qn=(t,e=.1,i=.05,n=220,s=0,a=0,r=.1,l=0,h=1,d=0,m=0,p=0,f=0,y=0,v=0,S=0,T=0,k=0,C=1,x=0,B=0,I=0)=>{let O=Math.PI*2,L=gn=>gn<0?-1:1,G=d*=500*O/U/U,F=n*=(1+i*2*Math.random()-i)*O/U,Y=[],z=0,St=0,_=0,J=1,st=0,q=0,N=0,$,j,Tt=2,It=O*Math.abs(I)*2/U,Kt=Math.cos(It),qt=Math.sin(It)/2/Tt,Ft=1+qt,Re=-2*Kt/Ft,jt=(1-qt)/Ft,le=(1+L(I)*Kt)/2/Ft,Te=-(L(I)+Kt)/Ft,Fe=le,Qt=0,Ot=0,Zt=0,si=0;for(s=s*U+9,x*=U,a*=U,r*=U,k*=U,m*=500*O/U**3,S*=O/U,p*=O/U,f*=U,y=y*U|0,e*=t<0?0:t,j=s+x+a+r+k|0;_<j;Y[_++]=N*(t<0?0:t))++q%(T*100|0)||(N=l?l>1?l>2?l>3?Math.sin(z**3):Math.max(Math.min(Math.tan(z),1),-1):1-(2*z/O%2+2)%2:1-4*Math.abs(Math.round(z/O)-z/O):Math.sin(z),N=(y?1-B+B*Math.sin(O*_/y):1)*L(N)*Math.abs(N)**h*(_<s?_/s:_<s+x?1-(_-s)/x*(1-C):_<s+x+a?C:_<j-k?(j-_-k)/r*C:0),N=k?N/2+(k>_?0:(_<j-k?1:(j-_)/k)*Y[_-k|0]/2/e):N,I&&(N=si=Fe*Qt+Te*(Qt=Ot)+le*(Ot=N)-jt*Zt-Re*(Zt=si))),$=(n+=d+=m)*Math.cos(S*St++),z+=$+$*v*Math.sin(_**5),J&&++J>f&&(n+=p,F+=p,J=0),y&&!(++st%y)&&(n=F,d=G,J=J||1);return Y};function Zn(){var t=function(f){return Math.sin(f*6.283184)},e=function(f){return 2*(f%1)-1},i=function(f){return f%1<.5?1:-1},n=function(f){var y=f%1*4;return y<2?y-1:3-y},s=function(f){return .003959503758*2**((f-128)/12)},a=function(f,y,v){var S=r[f.i[0]],T=f.i[1],k=f.i[3]/32,C=r[f.i[4]],x=f.i[5],B=f.i[8]/32,I=f.i[9],O=f.i[10]*f.i[10]*4,L=f.i[11]*f.i[11]*4,G=f.i[12]*f.i[12]*4,F=1/G,Y=-f.i[13]/16,z=f.i[14],St=v*2**(2-f.i[15]),_=new Int32Array(O+L+G),J=0,st=0,q,N,$,j,Tt,It;for(q=0,N=0;q<O+L+G;q++,N++)N>=0&&(z=z>>8|(z&255)<<4,N-=St,Tt=s(y+(z&15)+f.i[2]-128),It=s(y+(z&15)+f.i[6]-128)*(1+8e-4*f.i[7])),$=1,q<O?$=q/O:q>=O+L&&($=(q-O-L)*F,$=(1-$)*3**(Y*$)),J+=Tt*$**k,j=S(J)*T,st+=It*$**B,j+=C(st)*x,I&&(j+=(2*Math.random()-1)*I),_[q]=80*j*$|0;return _},r=[t,i,e,n],l,h,d,m,p;this.init=function(f){l=f,h=f.endPattern,d=0,m=f.rowLen*f.patternLen*(h+1)*2,p=new Int32Array(m)},this.generate=function(){var f,y,v,S,T,k,C,x,B,I,O,L,G=new Int32Array(m),F=l.songData[d],Y=l.rowLen,z=l.patternLen,St=0,_=0,J,st,q=!1,N=[];for(v=0;v<=h;++v)for(C=F.p[v],S=0;S<z;++S){var $=C?F.c[C-1].f[S]:0;$&&(F.i[$-1]=F.c[C-1].f[S+z]||0,$<17&&(N=[]));var j=r[F.i[16]],Tt=F.i[17]/512,It=2**(F.i[18]-9)/Y,Kt=F.i[19],qt=F.i[20],Ft=F.i[21]*43.23529*3.141592/44100,Re=1-F.i[22]/255,jt=F.i[23]*1e-5,le=F.i[24]/32,Te=F.i[25]/512,Fe=6.283184*2**(F.i[26]-9)/Y,Qt=F.i[27]/255,Ot=F.i[28]*Y&-2;for(O=(v*z+S)*Y,T=0;T<4;++T)if(k=C?F.c[C-1].n[S+T*z]:0,k){N[k]||(N[k]=a(F,k,Y));var Zt=N[k];for(y=0,f=O*2;y<Zt.length;y++,f+=2)G[f]+=Zt[y]}for(y=0;y<Y;y++)x=(O+y)*2,I=G[x],I||q?(L=Ft,Kt&&(L*=j(It*x)*Tt+.5),L=1.5*Math.sin(L),St+=L*_,J=Re*(I-_)-St,_+=L*J,I=qt==3?_:qt==1?J:St,jt&&(I*=jt,I=I<1?I>-1?t(I*.25):-1:1,I/=jt),I*=le,q=I*I>1e-5,B=Math.sin(Fe*x)*Te+.5,st=I*(1-B),I*=B):st=0,x>=Ot&&(st+=G[x-Ot+1]*Qt,I+=G[x-Ot]*Qt),G[x]=st|0,G[x+1]=I|0,p[x]+=st|0,p[x+1]+=I|0}return d++,d/l.numChannels},this.createAudioBuffer=function(f){for(var y=f.createBuffer(2,m/2,44100),v=0;v<2;v++)for(var S=y.getChannelData(v),T=v;T<m;T+=2)S[T>>1]=p[T]/65536;return y},this.createWave=function(){var f=44,y=f+m*2-8,v=y-36,S=new Uint8Array(f+m*2);S.set([82,73,70,70,y&255,y>>8&255,y>>16&255,y>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,v&255,v>>8&255,v>>16&255,v>>24&255]);for(var T=0,k=f;T<m;++T){var C=p[T];C=C<-32767?-32767:C>32767?32767:C,S[k++]=C&255,S[k++]=C>>8&255}return S},this.getData=function(f,y){for(var v=2*Math.floor(f*44100),S=new Array(y),T=0;T<2*y;T+=1){var k=v+T;S[T]=f>0&&k<p.length?p[k]/32768:0}return S}}const we="start",$e="race",Gi="bounce",zi="hit",Xi="teleport",ii="keyboard",$i="finished",Yi="gameover",Vi="restart",Ye="count",Ui="go",K=document.createElement("audio"),Lt=document.createElement("audio"),ve=document.createElement("audio");let rt,ge=!1;const Jn=async()=>{if(console.log("Attempting to unlock audio systems..."),ge)return!0;if(xe&&!Rt)return console.log("Skipping audio unlock on desktop browser"),ge=!0,!0;console.log("Running audio unlock for mobile/iPad device");try{K.volume=.1,await K.play().catch(t=>console.log("First unlock attempt:",t)),K.pause(),K.currentTime=0,console.log("HTML Audio unlocked successfully")}catch(t){console.warn("HTML Audio unlock attempt failed:",t)}try{rt=wt.getAudioContext(),rt&&rt.state!=="running"&&await rt.resume(),console.log("Web Audio API context state:",rt==null?void 0:rt.state)}catch(t){console.warn("Web Audio API context resume failed:",t)}return ge=!0,!0},ts=()=>{if(xe&&!Rt){console.log("Skipping audio unlock setup on desktop browser"),ge=!0;return}console.log("Setting up audio unlock for mobile/iPad device");const t=document.createElement("audio");t.setAttribute("src","data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//tUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABGwD///////////////////////////////////////////8AAAA8TEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAARvMPHBz//////////////////////////////////////////////////////////////////8AAAA"),t.setAttribute("playsinline","playsinline"),t.volume=.1;const e=async()=>{console.log("Attempting to unlock audio systems from event handler");try{t.play().catch(i=>console.log("Silent audio error:",i))}catch(i){console.log("Silent audio exception:",i)}try{await Jn()}catch(i){console.log("sfx unlockAudio error:",i)}document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0)};document.addEventListener("touchstart",e,{once:!0,capture:!0}),document.addEventListener("touchend",e,{once:!0,capture:!0}),document.addEventListener("click",e,{once:!0,capture:!0})},De=(t,e,i)=>new Promise(n=>{var s=new Zn;s.init(e);var a=!1;setInterval(function(){if(!a&&(a=s.generate()>=1,a)){var r=s.createWave();t.src=URL.createObjectURL(new Blob([r],{type:"audio/wav"})),t.loop=i,n()}},0)}),es=()=>(ts(),Promise.all([De(K,Un,!0),De(Lt,Kn,!0),De(ve,Vn,!1)])),is=(t,e=0)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null);var i=t.volume;i>e?t._fadeInterval=setInterval(function(){i=Math.max(e,parseFloat(i)-.1).toFixed(1),t.volume=i,i<=e&&(e===0&&t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=null)},100):e===0&&!t.paused&&(t.pause(),t.volume=0)},be=(t,e=1)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null);let i=Promise.resolve();t.paused&&(t.volume=se?.1:0,t.setAttribute("playsinline","playsinline"),i=t.play()),i.then(()=>{var n=parseFloat(t.volume);n<e?(t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeInterval=setInterval(function(){n=Math.min(e,parseFloat(n)+.1).toFixed(1),t.volume=n,parseFloat(n)>=e&&(t.volume=e,clearInterval(t._fadeInterval),t._fadeInterval=null)},100)):t.volume=e}).catch(n=>{console.warn("FadeIn play() failed:",n),t.paused&&(t.volume=1,t.play().catch(s=>console.error("Second play attempt failed:",s))),t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null)})},ci=(t,e)=>{t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeOutInTimeout&&clearTimeout(t._fadeOutInTimeout),e._fadeInterval&&clearInterval(e._fadeInterval),e._fadeOutInTimeout&&clearTimeout(e._fadeOutInTimeout),t._fadeInterval=null,t._fadeOutInTimeout=null,e._fadeInterval=null,e._fadeOutInTimeout=null;var i=t.volume;i>0?t._fadeInterval=setInterval(function(){i=Math.max(0,parseFloat(i)-.1).toFixed(1),t.volume=i,i<=.1&&(t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=null,t._fadeOutInTimeout=setTimeout(()=>{be(e,1),t._fadeOutInTimeout=null},500))},100):(t.pause(),t.volume=0,t._fadeOutInTimeout=setTimeout(()=>{be(e,1),t._fadeOutInTimeout=null},500))},nt=async(t,e)=>{if(e!==0){if(!xe&&rt&&rt.state!=="running")try{await rt.resume()}catch(i){console.warn("AudioContext resume failed in playTune:",i)}switch(t){case $e:{Lt.currentTime=0,ci(K,Lt);break}case $i:{wt(.04,...zn),K.currentTime=0,ci(Lt,K);break}case Yi:{ve.volume=1,ve.play().catch(i=>{console.warn("Failed to play gameoverFx:",i)}),is(Lt);break}case Vi:{K.currentTime=0,be(K);break}case we:{(K.paused||K.volume<1)&&(K.currentTime=0,be(K));break}case Gi:{wt(e,...Bn);break}case zi:{wt(e,...Xn);break}case ii:{wt(.5,...Nn);break}case Xi:{wt(e,...Gn);break}case Ye:{wt(.5,...$n);break}case Ui:{wt(.5,...Yn);break}}}},ns=t=>{const e=[];e.push(K,Lt,ve),e.forEach(i=>{i._fadeInterval&&(clearInterval(i._fadeInterval),i._fadeInterval=null),i._fadeOutInTimeout&&(clearTimeout(i._fadeOutInTimeout),i._fadeOutInTimeout=null),i.pause(),i.currentTime=0})},Ki=()=>({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1});let Vt=Ki();const ss=t=>{t.code in Vt&&(Vt[t.code]=!0)},os=t=>{t.code in Vt&&(Vt[t.code]=!1)},as=()=>{window.addEventListener("keydown",ss),window.addEventListener("keyup",os),window.addEventListener("blur",()=>{Vt=Ki()})},rs=t=>new Promise(e=>setTimeout(e,t)),ls=t=>new Promise(e=>{const i=n=>{n.code==="Enter"&&(nt(ii),t&&nt(t),window.removeEventListener("keydown",i),e())};window.addEventListener("keydown",i)}),cs=()=>Vt;function hs(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Ae(t,e){const i=e.x<=t.x+t.width&&t.x<=e.x+e.width,n=e.y<=t.y+t.height&&t.y<=e.y+e.height;return i&&n}function ds(t,e){return t.x<=e.x&&e.x<t.x+t.width&&t.y<=e.y&&e.y<t.y+t.height}function fs(t,e){const i=t.x<=e.x&&e.x+e.width<=t.x+t.width,n=t.y<=e.y&&e.y+e.height<=t.y+t.height;return i&&n}function _e(t){return-(Math.cos(Math.PI*t)-1)/2}function ot(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}function We(t){return t*t}function us(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}class gs{constructor(e,i){w(this,"x",0);w(this,"y",0);w(this,"zoom",1);w(this,"visibleAreaHeight");w(this,"yAdjust",0);w(this,"target",null);w(this,"transition",null);this.level=e,this.view=i}getViewArea(){const e=this.view.width/this.zoom,i=this.view.height/this.zoom;return{x:this.x-e/2,y:this.y-i/2,width:e,height:i}}follow(e){this.target=e}setTransition(e){const i=this.view.height/this.zoom;this.transition={...e,endY:e.endY+i*this.yAdjust},this.target=null}update(e){if(this.visibleAreaHeight!=null&&(this.zoom=this.view.height/this.visibleAreaHeight),this.transition!=null){const{startY:i,endY:n,startTime:s,duration:a}=this.transition;if(e<s+a){const l=(e-this.transition.startTime)/this.transition.duration;this.y=i+us(l)*(n-i)}else this.transition=null}else this.target&&this.followFrame(this.target)}followFrame(e){const i=this.view.width/this.zoom,n=this.view.height/this.zoom;if(i<this.level.width){let s=e.x+e.width;s-i/2<this.level.x?s=this.level.x+i/2:s+i/2>this.level.x+this.level.width&&(s=this.level.x+this.level.width-i/2),this.x=s}else this.x=0;this.y=e.y+n*this.yAdjust}}const Q={x:0,y:0};function me(t){return t.x===0&&t.y===0}function ms(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function ys(t,e){return Math.abs(t.x-e.x)}function ps(t,e){return Math.abs(t.y-e.y)}function Ut(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function ft(t,e){return{x:t.x+e.x,y:t.y+e.y}}function qi(t,e){return{x:t.x-e.x,y:t.y-e.y}}function lt(t,e){return{x:t.x*e,y:t.y*e}}function ws(t,e){return{x:t.x/e,y:t.y/e}}function mt(t){return ws(t,Ut(t))}function ae(t,e){return t.x*e.x+t.y*e.y}const Ht=.5,vs=.01,bs=5e-4,hi=6e-4,As=3;function Ss(t,e,i){if(me(e)){const y=Ut(t.velocity),v=hi*i,S=y>v?y-v:0;return S>0?lt(mt(t.velocity),S):Q}const n=ae(t.velocity,e),s={x:-e.y,y:e.x},a=ae(t.velocity,s);let r=bs*i;n>vs*i&&(r=0);const l=hi*i,h=Math.abs(a)>l?-l:0,d=Math.sign(a)*h,m=lt(e,r),p=lt(s,d);return ft(t.velocity,ft(m,p))}function Is(t,e){const i=t.width/2,n=t.height/2,s=e.width/2,a=e.height/3.5,r={x:t.x+t.width/2,y:t.y+t.height/2},l=ft(r,t.velocity),h={x:e.x+e.width/2,y:e.y+e.height/2};if(ys(l,h)<i+s&&ps(l,h)<n+a){const d=mt(qi(h,r)),m=ae(t.velocity,d),p=lt(d,-Math.abs(m)*As);let f=ft(t.velocity,p);return Ut(f)>Ht&&(f=lt(mt(f),Ht)),t.velocity=f,!0}return!1}function ks(t,e){const i=t.width*.4,n=e.width*.4,s={x:t.x+t.width/2,y:t.y+t.height/2},a={x:e.x+e.width/2,y:e.y+e.height/2},r=ft(s,t.velocity),l=ft(a,e.velocity);if(ms(r,l)<i+n){const h=mt(qi(a,s)),d=lt(h,-1),m=ae(t.velocity,h),p=ae(e.velocity,d),f=lt(h,Math.abs(m)),y=lt(d,Math.abs(p));let v=ft(t.velocity,y);Ut(v)>Ht&&(v=lt(mt(v),Ht)),t.velocity=v;let S=ft(e.velocity,f);return Ut(S)>Ht&&(S=lt(mt(S),Ht)),e.velocity=S,!0}return!1}const bt=(t=1)=>Math.random()*t,xs=(t,e)=>Math.random()*(e-t)+t,Xt=class Xt{constructor(e){w(this,"x");w(this,"y");w(this,"width",Xt.WIDTH);w(this,"height",Xt.HEIGHT);w(this,"velocity",Q);this.x=e.x,this.y=e.y}draw(e,i){o.save(),o.translate(this.x,this.y);const n=o.createLinearGradient(0,0,this.width,this.height);n.addColorStop(0,"rgb(255, 110, 110)"),n.addColorStop(1,"rgb(255, 60, 60)"),o.beginPath(),o.fillStyle="rgba(0, 0, 0, 0.1)",o.ellipse(this.width/2,this.height/1.5,this.width/2,this.height,0,0,2*Math.PI),o.fill(),o.fillStyle=n,o.beginPath(),o.ellipse(this.width/2,this.height/2,this.width/2,this.height/2,0,0,2*Math.PI),o.fill(),o.fillStyle=n,o.fillRect(0,-this.height*2,this.width,this.height*2.5);const s=o.createLinearGradient(0,0,this.width,this.height);s.addColorStop(0,"rgb(255, 140, 140)"),s.addColorStop(1,"rgb(255, 80, 80)"),o.fillStyle=s,o.beginPath(),o.ellipse(this.width/2,-this.height*2,this.width/2,this.height/2,0,0,2*Math.PI),o.fill(),o.strokeStyle="rgb(200, 70, 70)",o.lineWidth=this.width/100,o.stroke(),o.restore()}};w(Xt,"WIDTH",10),w(Xt,"HEIGHT",4);let M=Xt;const b=16,g=10,ji=b,Yt=9,vt=g*Yt,Le=g*7,Ms=g*5,di=g*3,A=-90/2,fi=vt/2;var c=(t=>(t[t.FullWidth=0]="FullWidth",t[t.Basic=1]="Basic",t[t.BasicSlope=2]="BasicSlope",t[t.BasicSteepSlope=3]="BasicSteepSlope",t[t.Narrow=4]="Narrow",t[t.VeryNarrow=5]="VeryNarrow",t[t.DualPassage=6]="DualPassage",t[t.DualPassageExt=7]="DualPassageExt",t[t.TriplePassage=8]="TriplePassage",t[t.RightPassage=9]="RightPassage",t[t.SlopeEmptySlope=10]="SlopeEmptySlope",t[t.SlopeEmptyPassage=11]="SlopeEmptyPassage",t[t.PassageEmptySlope=12]="PassageEmptySlope",t[t.SlopeObstacleSlope=13]="SlopeObstacleSlope",t[t.FullWidthWithObstaclesOnRight=14]="FullWidthWithObstaclesOnRight",t[t.FullWidthWithObstaclesOnRight2=15]="FullWidthWithObstaclesOnRight2",t[t.FullWidthWithMoreObstacles=16]="FullWidthWithMoreObstacles",t[t.FullWidthWithObstacles=17]="FullWidthWithObstacles",t[t.Chasm=18]="Chasm",t[t.Raft=19]="Raft",t[t.TwoRafts=20]="TwoRafts",t[t.Checkpoint=21]="Checkpoint",t[t.Finish=22]="Finish",t))(c||{}),ht=(t=>(t[t.Normal=0]="Normal",t[t.CheckPoint=1]="CheckPoint",t[t.Finish=2]="Finish",t[t.Raft=3]="Raft",t))(ht||{}),D=(t=>(t[t.Empty=0]="Empty",t[t.Free=1]="Free",t[t.Obstacle=2]="Obstacle",t[t.Raft=3]="Raft",t))(D||{});function Qi(t,e,i){return{type:0,row:t,col:e,x:A+e*g,y:i,width:g,height:b}}function Ve(t){return"yDirection"in t}function Se(t){return"force"in t}class Es{constructor(e,i,n,s,a){w(this,"row");w(this,"y");w(this,"type");w(this,"surfaces");w(this,"objects");w(this,"width");w(this,"height");w(this,"minX");w(this,"maxX");w(this,"blocks",new Array(Yt));this.row=e,this.y=i,this.type=n,this.surfaces=s,this.objects=a,this.minX=Math.min(...this.surfaces.map(r=>r.x)),this.maxX=Math.max(...this.surfaces.map(r=>r.x+r.width)),this.width=this.maxX-this.minX,this.height=b;for(let r=0;r<Yt;r++)this.blocks[r]={type:this.getBlockType(r),row:e,col:r,x:A+r*g,y:this.y,width:g,height:b}}get color(){switch(this.type){case 1:return"rgb(50, 80, 50)";case 2:return"rgb(0, 200, 0)";case 3:return"rgb(50,60,120)";default:return"rgb(80, 50, 80)"}}getBlock(e){return e<0||Yt<=e?Qi(this.row,e,this.y):this.blocks[e]}isFree(e,i){const n=g*.1,s=A+e*g,a=i??this.y,r={x:s+n,y:a+n,width:g-2*n,height:ji-2*n};return this.surfaces.some(l=>fs(l,r))&&!this.objects.some(l=>Ae(l,r))}getBlockType(e){const i=g*.1,n=A+e*g+i,s=g-2*i;return this.surfaces.some(l=>Ve(l)&&l.x<=n&&n+s<=l.x+l.width)?3:this.objects.some(l=>l.x<=n&&n+s<=l.x+l.width)?2:this.isFree(e)?1:0}}function Ps(t,e){const i=t.map((n,s)=>Cs(n,s,e));return Rs(i),i}function Cs(t,e,i){const n=i-b*(e+1),s=n+b/2;let a=0,r=[],l=[];switch(t){case 0:r=[{x:A,y:n,width:vt,height:b}];break;case 1:r=[{x:A+g*1,y:n,width:Le,height:b}];break;case 2:{r=[{force:.3,x:A+g*1,y:n,width:Le,height:b}];break}case 3:{r=[{force:.5,x:A+g*1,y:n,width:Le,height:b}];break}case 4:r=[{x:A+g*2,y:n,width:Ms,height:b}];break;case 5:r=[{x:A+g*3,y:n,width:di,height:b}];break;case 6:r=[{x:A+g,y:n,width:g*2,height:b},{x:fi-g*3,y:n,width:g*2,height:b}];break;case 7:r=[{x:A+g,y:n,width:g*2,height:b},{x:A+g*4,y:n,width:g*5,height:b}];break;case 8:r=[{x:A+g*1,y:n,width:g*2,height:b},{x:A+g*4,y:n,width:g*2,height:b},{x:A+g*7,y:n,width:g*2,height:b}];break;case 9:{r=[{x:A+g*6,y:n,width:g*2,height:b}];break}case 10:{const h={force:.3,x:A+g*1,y:n,width:g*2,height:b},d={force:.3,x:A+g*6,y:n,width:g*2,height:b};r=[h,d];break}case 11:{const h={force:.3,x:A+g*1,y:n,width:g*2,height:b},d={x:A+g*6,y:n,width:g*2,height:b};r=[h,d];break}case 12:{const h={x:A+g*1,y:n,width:g*2,height:b},d={force:.3,x:A+g*6,y:n,width:g*2,height:b};r=[h,d];break}case 13:{const h={force:.3,x:A+g*1,y:n,width:g*2,height:b},d={force:.3,x:A+g*6,y:n,width:g*2,height:b};r=[h,{x:A+g*3,y:n,width:g*3,height:b},d],l=[new M({x:A+g*4,y:s-M.HEIGHT/2})];break}case 14:{r=[{x:-90/2,y:n,width:vt,height:b}],l=[new M({x:A+g*4,y:s-M.HEIGHT/2}),new M({x:A+g*6,y:s-M.HEIGHT/2}),new M({x:A+g*8,y:s-M.HEIGHT/2})];break}case 15:{r=[{x:-90/2,y:n,width:vt,height:b}],l=[new M({x:A+g*3,y:s-M.HEIGHT/2}),new M({x:A+g*5,y:s-M.HEIGHT/2}),new M({x:A+g*7,y:s-M.HEIGHT/2})];break}case 16:r=[{x:-90/2,y:n,width:vt,height:b}],l=[new M({x:A+g*0,y:s-M.HEIGHT/2}),new M({x:A+g*2,y:s-M.HEIGHT/2}),new M({x:A+g*4,y:s-M.HEIGHT/2}),new M({x:A+g*6,y:s-M.HEIGHT/2}),new M({x:A+g*8,y:s-M.HEIGHT/2})];break;case 17:r=[{x:-90/2,y:n,width:vt,height:b}],l=[new M({x:A+g,y:s-M.HEIGHT/2}),new M({x:A+g*3,y:s-M.HEIGHT/2}),new M({x:A+g*5,y:s-M.HEIGHT/2}),new M({x:A+g*7,y:s-M.HEIGHT/2})];break;case 18:break;case 19:{a=3,r=[{yDirection:-1,dockStartTime:0,x:A+g*3,y:n,width:di,height:b}];break}case 20:{a=3;const h={yDirection:-1,dockStartTime:0,x:A+g*1,y:n-bt()*b,width:g*2,height:b},d={yDirection:-1,dockStartTime:0,x:fi-g*3,y:n-bt()*b,width:g*2,height:b};r=[h,d];break}case 21:a=1,r=[{x:-90/2,y:n,width:vt,height:b}];break;case 22:a=2,r=[{x:-90/2,y:n,width:vt,height:b}];break}return new Es(e,n,a,r,l)}function Rs(t){for(let e=1;e<t.length;e++){const i=t[e-1],n=t[e];for(let s=0;s<Yt;s++)i.blocks[s].type===3&&n.blocks[s].type===0&&(n.blocks[s].type=3)}}const Pe=-1,ui=1,Ts={x:0,y:Pe},Fs={x:-1,y:0},Os={x:1,y:0},Ds=mt({x:-1,y:Pe}),_s=mt({x:1,y:Pe}),Ws=3,He=1e3;class Ls{constructor(e,i){w(this,"host");w(this,"track");w(this,"horizontalMargin",0);w(this,"lastSlowdownTime",-1e3);w(this,"target",null);this.host=e,this.track=i}reset(){this.target=null}getMovement(e){const i=this.getCurrentBlock(),n=this.track.getBlock(i.row+1,i.col),s=this.goByRaft(i,n,e);return s||((this.target==null||this.hasReached(this.target))&&(this.target=this.findNextTarget(i)),this.goRoundObstacles(i,n,e)||this.moveOnTrack(i,n,e))}goByRaft(e,i,n){if(e.type!==D.Raft&&i.type===D.Raft&&(this.host.y>e.y+1.5*this.host.height||this.track.isFree(e.row+1,e.col)))return{x:0,y:this.moveAhead(e,i,n)};if(i.type===D.Raft&&this.host.y<=e.y+1.5*this.host.height&&!this.track.isFree(e.row+1,e.col))return Q;if(e.type===D.Raft&&!this.track.isFree(e.row+1,e.col)){let s=0;return this.host.x<e.x+this.host.width?s=1:e.x+e.width-2*this.host.width<this.host.x&&(s=-1),{x:s,y:0}}return e.type===D.Raft&&this.track.isFree(e.row,e.col)&&this.track.isFree(e.row+1,e.col)?Ts:null}goRoundObstacles(e,i,n){if(this.target==null)return Q;if(e.type===D.Obstacle){if(e.y+e.height/2<this.host.y+this.host.height/2)return this.target.col<e.col?Ds:_s}else{if(this.target.col<e.col&&this.track.getBlock(e.row,e.col-1).type===D.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===D.Empty?Fs:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,n)}:{x:-1,y:this.moveAhead(e,i,n)};if(e.col<this.target.col&&this.track.getBlock(e.row,e.col+1).type===D.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===D.Empty?Os:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,n)}:{x:1,y:this.moveAhead(e,i,n)}}return null}moveOnTrack(e,i,n){if(this.target==null)return Q;let s=0;i.type===D.Empty&&this.host.y+this.host.height/2<e.y?s=ui:s=this.moveAhead(e,i,n),s<0&&i.type===D.Empty&&this.host.y+this.host.height/2<e.y+e.height/2&&(s=0);let a=0;const r=this.host.x<this.target.x+this.horizontalMargin,l=this.target.x+this.target.width-this.horizontalMargin<=this.host.x+this.host.width;return r&&this.track.getBlock(e.row,e.col+1).type===D.Free?a=1:l&&this.track.getBlock(e.row,e.col-1).type===D.Free&&(a=-1),{x:a,y:s}}moveAhead(e,i,n){return i.type!==D.Free&&this.host.velocity.y<-.25*1.5?(He<n-this.lastSlowdownTime&&(this.lastSlowdownTime=n),ui):this.host.velocity.y<-.25*3.5&&!this.isClearAhead(e)?(He<n-this.lastSlowdownTime&&(this.lastSlowdownTime=n),0):He<n-this.lastSlowdownTime?Pe:0}getCurrentBlock(){const e=hs(this.host);let i=this.track.getBlockAt(e);return(i.type===D.Empty||i.type===D.Raft)&&i.y+i.height-this.host.height<e.y&&(i=this.track.getBlock(i.row-1,i.col)),i.type===D.Empty&&(i.x+i.width-this.host.width<e.x?i=this.track.getBlock(i.row,i.col+1):e.x<i.x+this.host.width&&(i=this.track.getBlock(i.row,i.col-1))),i}hasReached(e){return this.host.y+this.host.height<e.y+e.height}findNextTarget(e){const i=this.findNearestBlock(e.row+1,e.col);if(i==null||i.col!==e.col)return i;const n=this.findNearestBlock(i.row+1,i.col);if(n==null)return i;if(n.col<i.col){const s=this.track.getBlock(i.row,i.col-1);if(s.type===D.Free)return s}if(i.col<n.col){const s=this.track.getBlock(i.row,i.col+1);if(s.type===D.Free)return s}return i}isClearAhead(e){for(let i=e.row+1;i<=e.row+Ws;i++)if(this.track.getBlock(i,e.col).type!==D.Free)return!1;return!0}findNearestBlock(e,i){for(let n=0;n<Yt-1;n++){const s=(bt()<.5?-1:1)*n,a=i+s,r=this.track.getBlock(e,a);if(r.type===D.Free||r.type===D.Raft)return this.horizontalMargin=bt(.2)*g,this.track.getBlock(e,a)}return null}}const at=(t,e)=>2*Math.abs(e/t-Math.floor(e/t+.5));var yt=(t=>(t[t.Stand=0]="Stand",t[t.Walk=1]="Walk",t[t.Fall=2]="Fall",t[t.Celebrate=3]="Celebrate",t))(yt||{}),V=(t=>(t[t.Right=0]="Right",t[t.Forward=1]="Forward",t[t.Backward=2]="Backward",t[t.ForwardRight=3]="ForwardRight",t[t.BackwardRight=4]="BackwardRight",t))(V||{});const Hs="rgb(200,150,150)",Bs="rgb(230,230,230)",Ns="rgb(30,0,0)",Gs="rgb(170,120,120)",Jt="rgb(140,140,140)",Be="rgb(120,120,120)",te="rgb(140,140,220)",Ne="rgb(120,120,200)",zs="rgba(0, 0, 0, 0.2";function re(t,e,i,n,s,a,r,l,h){let d=0,m=0,p=0,f=0,y=0,v=0;const S=a===3||a===4,T=a===0;switch(r){case 1:d=T?600:S?400:300,v=_e(at(d/2,s/2))*.02*n,m=y=-Math.PI/6+ot(at(d,s))*(Math.PI/3),p=f=-Math.PI/6+ot(at(d,s+d/2))*(Math.PI/3);break;case 3:{d=1500,v=_e(at(d/2,s/2))*.15*n;const I=at(d,s);m=ot(I)*Math.PI*(1/8),p=-ot(I)*Math.PI*(3/8),y=Math.PI*(1/8)-ot(I)*Math.PI*(9/8),f=Math.PI*(1/8)-ot(I)*Math.PI*(10/8);break}case 2:d=3200,v=_e(at(d/2,s))*.02*n,m=-Math.PI*(3/8)+ot(at(d,s))*(Math.PI*(3/4)),p=-Math.PI*(3/8)+ot(at(d,s+d/2))*(Math.PI*(3/4)),f=-Math.PI*(8/8)+ot(at(d,s+d/2))*(Math.PI/4),y=-Math.PI*(8/8)+ot(at(d,s))*(Math.PI/4);break}t.save(),Xs(t,.5*i,n,i*.4-v/2),t.translate(0,-v);const k=.3*n,C=.25*n,x=.2*i,B=.1*i;switch(t.fillStyle=e,t.lineWidth=x,t.lineJoin="round",t.lineCap="round",e==="eliminated"&&(t.globalAlpha=.7),a){case 0:{const I=.5*i,O=.4*n,L=.5*i,G=.7*n;yi(t,Ne,I,O,B,k,f),pi(t,Be,L,G,x,C,m),pi(t,Jt,L,G,x,C,p),ce(a,t,i,n,e,l,h),he(a,t,i,n,e,l,h),yi(t,te,I,O,B,k,y)}break;case 1:case 2:{_t(t,Jt,.35*i,.7*n,x,C,-1,m,0),_t(t,Jt,.7*i,.7*n,x,C,1,p,0),ce(a,t,i,n,e,l,h),Dt(t,te,.25*i,.35*n,B,k,-1,f),Dt(t,te,.75*i,.35*n,B,k,1,y),he(a,t,i,n,e,l,h);break}case 3:{_t(t,Be,.35*i,.7*n,x,C,-1,m,p/4),_t(t,Jt,.65*i,.7*n,x,C,1,p,p/4),Dt(t,Ne,.25*i,.35*n,B,k,-1,y,y/2),ce(a,t,i,n,e,l,h),he(a,t,i,n,e,l,h),Dt(t,te,.75*i,.35*n,B,k,1,f,y/2);break}case 4:{_t(t,Be,.65*i,.7*n,x,C,1,p,p/4),_t(t,Jt,.35*i,.7*n,x,C,-1,m,p/4),Dt(t,Ne,.75*i,.35*n,B,k,1,y,y/2),ce(a,t,i,n,e,l,h),he(a,t,i,n,e,l,h),Dt(t,te,.25*i,.35*n,B,k,-1,f,y/2);break}}t.restore()}function Xs(t,e,i,n){t.save(),t.fillStyle=zs,t.translate(e,i),t.beginPath(),t.arc(0,0,Math.max(0,n),0,2*Math.PI),t.fill(),t.restore()}const Bt={};function pt(t,e,i){const n=gi(t),s=gi(e),a=Math.round((1-i)*n.r+i*s.r),r=Math.round((1-i)*n.g+i*s.g),l=Math.round((1-i)*n.b+i*s.b);return`rgb(${a}, ${r}, ${l})`}function gi(t){if(t==="eliminated")return{r:128,g:128,b:128};const e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t);return e?{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}:{r:0,g:0,b:0}}const $s=navigator.userAgent.toLowerCase().includes("firefox");function Zi(t,e,i,n,s,a){const r=`${i}-${e}-${n}-${s}`;if(a||!Bt[r]){const l=t.createRadialGradient(n,s,s/8,n,s,n);if(i==="TORSO"?(l.addColorStop(0,pt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.2,pt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.5,pt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(1,pt(e,"rgb(0, 0, 0)",.3))):i==="HEAD"&&(l.addColorStop(0,pt(e,"rgb(0, 0, 0)",.3)),l.addColorStop(.5,pt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(.8,pt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(1,pt(e,"rgb(255, 255, 255)",.1))),$s){if(a)return mi(t,l,n*2,s*2);Bt[r]=mi(t,l,n*2,s*4)}else{if(a)return l;Bt[r]=l}}return Bt[r]}function Ys(){for(const t in Bt)delete Bt[t]}function mi(t,e,i,n){const s=document.createElement("canvas");s.width=i,s.height=n;const a=s.getContext("2d");if(a)return a.fillStyle=e,a.fillRect(0,0,i,n),t.createPattern(s,"no-repeat")}function Ji(t,e,i,n,s,a){e&&(t.save(),t.translate(i,n),t.scale(s/80,a/80),t.fillStyle=e,t.fill(),t.restore())}function ce(t,e,i,n,s,a,r=!1){const l=.2*i,h=t===0?.5*i:.45*i,d=.25*n,m=t===0?.28*i:.5*(i-h),p=.06*n;e.beginPath(),e.roundRect(m,p,h,d,l);const f=Zi(e,s,"HEAD",h,d,r);e.fillStyle=f||"black",e.fill(),Ji(e,a,m,p,h,d),Vs(e,t,i,h,d,l)}function he(t,e,i,n,s,a,r=!1){const l=.4*n,h=.2*i,d=t===0?.5*i:.6*i,m=t===1||t===2?.2*i:.5*(i-d),p=.3*n;e.beginPath(),e.roundRect(m,p,d,l,h);const f=Zi(e,s,"TORSO",d,l,r);e.fillStyle=f||"black",e.fill(),Ji(e,a,m,p,d,l)}function yi(t,e,i,n,s,a,r){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(r),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-a/4,a/2,0,a),t.stroke(),t.restore()}function pi(t,e,i,n,s,a,r){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(r),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-a/8,a/2,0,a),t.stroke(),t.restore()}function Dt(t,e,i,n,s,a,r,l,h=0){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(-r*.07*Math.PI),t.rotate(h),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(r*a/4,a/2,0,a),t.stroke(),t.restore()}function _t(t,e,i,n,s,a,r,l,h){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(h),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(r*a/8,a/2,0,a),t.stroke(),t.restore()}function Vs(t,e,i,n,s,a){if(e!==2&&e!==4)return;const r=.15*i,l=.6*a,h=n-r,d=s-r*1.75,m=s-d,p=e===2?(i-h)/2:(i-h)/2+(n-h)/2;t.save(),t.translate(p,m),t.shadowColor="rgba(0, 0, 0, 0.5)",t.fillStyle=Hs,t.shadowOffsetY=-d/10;const f=0,y=0;t.beginPath(),t.roundRect(f,y,h,d,l),t.fill(),t.closePath(),t.shadowOffsetY=0;const v=.06*h,S=h/4,T=d/3,k=f+S,C=f+h-S,x=y+T;t.fillStyle=Bs,t.beginPath(),t.arc(k,x,v,0,Math.PI*2),t.arc(C,x,v,0,Math.PI*2),t.fill(),t.closePath();const B=.025*h,I=.01*h,O=.01*d;t.fillStyle=Ns,t.beginPath(),t.arc(k+I,x+O,B,0,Math.PI*2),t.arc(C+I,x+O,B,0,Math.PI*2),t.fill(),t.closePath();const L=.15*h,G=.2*d,F=f+(h-L)/1.75,Y=y+(d-G)/1.5;t.fillStyle=Gs,t.beginPath(),t.moveTo(F,Y),t.lineTo(F+L/2,Y+G),t.lineTo(F-L/2,Y+G),t.closePath(),t.fill(),t.restore()}let Ue=1;const tn=(t,e)=>{const i=t/e;let n=window.innerWidth,s=window.innerHeight;n/s>i?n=s*i:s=n/i,n>t&&(n=t,s=t/i),s>e&&(s=e,n=e*i),u.width=n,u.height=s;const a=window.innerWidth/n,r=window.innerHeight/s,l=Math.min(a,r);Ue=l,u.style.position="absolute",u.style.left=`${(window.innerWidth-n*l)/2}px`,u.style.top=`${(window.innerHeight-s*l)/2}px`,u.style.transform=`scale(${l})`,u.style.transformOrigin="top left"},en=(t,e)=>{const i=u.getBoundingClientRect();t.x=(e.clientX-i.left)/Ue,t.y=(e.clientY-i.top)/Ue},nn=4;let Ke=0;const sn=[...Array(nn)].map(()=>({x:0,y:0})),At="ontouchstart"in window,Us=()=>{At&&(window.oncontextmenu=t=>{t.preventDefault()},u.ontouchstart=t=>{t.preventDefault(),Ge(t)},u.ontouchmove=t=>{t.preventDefault(),Ge(t)},u.ontouchend=t=>{t.preventDefault(),Ge(t)})},Ge=t=>{Ke=Math.min(t.touches.length,nn);for(let e=0;e<Ke;e++)en(sn[e],t.touches[e])},on=(t,e)=>new Promise(i=>{const n=s=>{s.preventDefault();const a=s.changedTouches[0];if(!a)return;nt(ii),en({x:0,y:0},a);{if(u.removeEventListener("touchstart",n),e!==void 0)try{console.log(`Playing sound ID: ${e}`),nt(e)}catch(l){console.error("Error playing sound:",l)}i()}};u.addEventListener("touchstart",n,{passive:!1})}),Ks=(t,e)=>on(e,t),de=t=>{for(let e=0;e<Ke;e++)if(ds(t,sn[e]))return!0;return!1};let qs=0;const Et={symbol:"◁",x:0,y:0,width:0,height:0},Nt={symbol:"▷",x:0,y:0,width:0,height:0},Gt={symbol:"△",x:0,y:0,width:0,height:0},zt={symbol:"▽",x:0,y:0,width:0,height:0},qe={movement:{x:0,y:0}},js=()=>{const t=cs(),e=t.ArrowLeft||t.KeyA||de(Et),i=t.ArrowRight||t.KeyD||de(Nt),n=t.ArrowUp||t.KeyW||de(Gt),s=t.ArrowDown||t.KeyS||de(zt),a=e?-1:i?1:0,r=n?-1:s?1:0;a===0&&r===0?qe.movement=Q:qe.movement=mt({x:a,y:r})},Qs=()=>{as(),Us(),wi(),window.addEventListener("resize",wi,!1)},wi=()=>{const t=u.width*.01,e=u.height*.02,i=u.width*.1,n=u.height*.6,s=u.height-n*.65-2*e,a=i,r=n/3;Et.x=t,Et.y=s+r+e,Et.width=i,Et.height=n/3,Nt.x=i+2*t,Nt.y=s+r+e,Nt.width=i,Nt.height=n/3,Gt.x=u.width-a-t,Gt.y=s,Gt.width=a,Gt.height=r,zt.x=u.width-a-t,zt.y=s+r+e,zt.width=a,zt.height=r},Wt=async t=>{await(At?t?Ks(t):on():ls(t))},ne=(t="continue",e=7.7)=>{const i=(At?"Tap the screen to ":"Press ENTER to ")+t;H(i+(qs++%60===0?"":"█"),W.Small,"Courier New",1,e,!0,0,i)},an=()=>{if(!At)return;o.save();const t=Et.width/2;o.font=t+"px Impact",o.fillStyle="rgba(200, 200, 200, 0.2)",fe(Et,t),fe(Nt,t),fe(Gt,t),fe(zt,t),o.restore()},fe=(t,e)=>{o.strokeStyle="rgba(255, 255, 255, 0.2)",o.lineWidth=2,o.strokeRect(t.x,t.y,t.width,t.height),o.fillStyle="rgba(255, 255, 255, 0.4)",o.fillText(t.symbol,t.x+t.width/2-e/2,t.y+t.height/2+e*.45,e)},Zs=()=>qe;function Js(t,e){t.translate(e/2,0),t.scale(-1,1),t.translate(-e/2,0)}const Ie=500,vi=1e3,rn=["rgb(255, 255, 0)","rgb(255, 0, 0)","rgb(0, 128, 0)","rgb(0, 0, 255)","rgb(255, 165, 0)","rgb(255, 99, 71)","rgb(255, 192, 203)","rgb(106, 90, 205)","rgb(238, 130, 238)","rgb(30, 144, 255)","rgb(0, 255, 255)","rgb(255, 0, 255)","rgb(144, 238, 144)","rgb(211, 211, 211)","rgb(64, 224, 208)","rgb(0, 191, 255)","rgb(173, 216, 230)","rgb(240, 128, 128)","rgb(0, 255, 127)","rgb(255, 0, 255)","rgb(220, 20, 60)","rgb(230, 230, 250)","rgb(255, 127, 80)","rgb(0, 128, 128)","rgb(75, 0, 130)","rgb(250, 128, 114)","rgb(127, 255, 0)","rgb(218, 165, 32)","rgb(255, 182, 193)","rgb(210, 105, 30)","rgb(205, 92, 92)","rgb(128, 128, 0)","rgb(255, 69, 0)","rgb(135, 206, 235)","rgb(72, 209, 204)","rgb(160, 82, 45)","rgb(0, 255, 0)","rgb(0, 0, 128)","rgb(245, 222, 179)","rgb(70, 130, 180)","rgb(255, 255, 255)"],ni=rn[0],je={width:2,height:2};class ze{constructor(e,i,n=1+Math.random()*.6,s=1+Math.random()*.4){w(this,"ai");w(this,"rank",0);w(this,"finished",!1);w(this,"eliminated",!1);w(this,"timeOffset",bt(2e3));w(this,"direction",Q);w(this,"latestDirection",{x:0,y:-1});w(this,"color");w(this,"x",0);w(this,"y",0);w(this,"width");w(this,"height");w(this,"velocity",Q);w(this,"fallStartTime");w(this,"dropStartTime");w(this,"latestCheckpointIndex",0);this.ai=e===0||!i?null:new Ls(this,i),this.color=rn[e],this.width=je.width*n,this.height=je.height*s}get doesNotCollide(){return this.finished||this.eliminated||this.fallStartTime!=null}isVisible(e){return!(this.fallStartTime!=null&&Ie<e-this.fallStartTime)}setDirection(e){this.direction=e,me(e)||(this.latestDirection=e)}getMovement(e){return this.ai?this.ai.getMovement(e):Zs().movement}move(){this.eliminated||this.finished?(this.direction=Q,this.velocity=Q):(this.x+=this.velocity.x,this.y+=this.velocity.y)}stop(){this.y+=this.velocity.y*8}drop(e,i){var n;this.x=i.x,this.y=i.y,this.direction=Q,this.latestDirection={x:0,y:-1},this.velocity=Q,this.fallStartTime=void 0,this.dropStartTime=e,(n=this.ai)==null||n.reset()}draw(e,i,n){const s=this.latestDirection.y!==0?this.latestDirection.x===0?this.latestDirection.y<0?V.Forward:V.Backward:this.latestDirection.y>0?V.BackwardRight:V.ForwardRight:V.Right;o.save();const a=this.height*3,r=a-this.height;if(o.translate(this.x,this.y-r),this.latestDirection.x<0&&Js(o,this.width),this.fallStartTime!=null){const h=Math.max(1-We((e-this.fallStartTime)/Ie),0);o.translate(this.width/2,a/2),o.scale(h,h),o.translate(-this.width/2,-a/2),o.globalAlpha=We(h)}else this.dropStartTime&&e-this.dropStartTime<vi&&(o.globalAlpha=We((e-this.dropStartTime)/vi));const l=me(this.direction)&&this.fallStartTime==null?0:e+this.timeOffset;re(o,this.eliminated?"eliminated":this.color,this.width,a,l,this.finished?e%3600<1800?V.Backward:V.BackwardRight:s,this.getAnimation(),n),o.restore()}getAnimation(){return this.fallStartTime!=null?yt.Fall:me(this.direction)?yt.Stand:yt.Walk}}const to=.005,bi=2e3;class eo{constructor(e,i){w(this,"elements");w(this,"startY");w(this,"checkpoints");w(this,"specialElements");w(this,"finishY");w(this,"elementCount");w(this,"width");w(this,"height");this.elements=Ps(e,i),this.elementCount=this.elements.length,this.specialElements=this.elements.filter(a=>a.surfaces.some(r=>Se(r)||Ve(r))),this.startY=i,this.finishY=this.startY-(this.elements.length-1)*b;const n=Math.min(...this.elements.map(a=>a.minX)),s=Math.max(...this.elements.map(a=>a.maxX));this.width=s-n,this.height=this.elements.length*b,this.checkpoints=this.elements.filter((a,r)=>a.type===ht.CheckPoint||r===0).map(a=>({y:a.y+a.height,element:a}))}update(e,i,n){for(let s=0;s<this.specialElements.length;s++){const a=this.specialElements[s];for(let r=0;r<a.surfaces.length;r++){const l=a.surfaces[r];if(Se(l))for(let h=0;h<n.length;h++){const d=n[h];l.y<=d.y&&d.y+d.height<l.y+l.height&&l.x<=d.x&&d.x+d.width<=l.x+l.width&&(d.velocity=ft(d.velocity,{x:0,y:-.002*l.force*i}))}if(Ve(l)){const h=l,d=a.y,m=a.y-b;h.yDirection===-1&&h.y<=m?(h.yDirection=0,h.dockStartTime=e):h.y<=m&&e-h.dockStartTime>bi?h.yDirection=1:h.yDirection===1&&d<=h.y?(h.yDirection=0,h.dockStartTime=e):d<=h.y&&e-h.dockStartTime>bi&&(h.yDirection=-1);const p=h.yDirection*to*i;h.y+=p;for(let f=0;f<n.length;f++){const y=n[f];Ae(h,y)&&(y.y+=p)}}}}}get(e){return this.elements[e]}isFree(e,i){if(e<0||this.elements.length<=e)return!1;const n=this.elements[e];return n.surfaces.length===0?this.elements[Math.max(e-1,0)].isFree(i,n.y):n.isFree(i)}getBlock(e,i){return e<0||this.elements.length<=e?Qi(e,i,this.startY-e*b):this.elements[e].getBlock(i)}getBlockAt(e){const i=Math.floor(Math.max(this.startY-e.y,0)/b),n=Math.min(i,this.elements.length-1),s=Math.floor((e.x-A)/g);return this.getBlock(n,s)}getCheckpoint(e){return this.checkpoints[e].element}findLatestCheckpoint(e){for(let i=this.checkpoints.length-1;i>=0;i--){const n=this.checkpoints[i];if(e<n.y-n.element.height*.15)return i}return 0}getBetween(e,i){const n=Math.ceil(Math.max(this.startY-e,0)/b),s=Math.floor(Math.max(this.startY-i,0)/b);return{minI:Math.max(s-1,0),maxI:Math.min(n,this.elements.length)-1}}isOnPlatform(e,i){const{minI:n,maxI:s}=e;for(let a=s;a>=n;a--){const l=this.get(a).surfaces;for(let h=0;h<l.length;h++){const d=l[h];if(Ae(i,d))return!0}}return!1}}const io=70,Ai=400,Si=5,Ii=40,no=3*ji,ki=1e3;var Qe=(t=>(t[t.RUNNING=0]="RUNNING",t[t.GAME_OVER=1]="GAME_OVER",t[t.FINISHED=2]="FINISHED",t))(Qe||{});function so(t){for(let e=t.length-1;e>=0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}class xi{constructor(e,i,n,s,a){w(this,"camera",new gs(this,u));w(this,"platePattern");w(this,"track");w(this,"characters",[]);w(this,"charactersCount",40);w(this,"player",new ze(0,void 0,0,0));w(this,"x");w(this,"y");w(this,"width");w(this,"height");w(this,"state",0);this.platePattern=a,this.track=new eo(e,Ai),this.x=0-this.track.width/2-Si,this.y=Ai-this.track.height-Ii,this.width=this.track.width+2*Si,this.height=this.track.height+2*Ii;const r=this.track.get(0),l=15,h=r.width/l,d=je.height*1.9,m=h*.3;this.player=new ze(0,this.track,i,n),this.characters.push(this.player);for(let f=1;f<(s?s.length:this.charactersCount);f++){if(s&&s[f].eliminated)continue;const y=new ze(f,this.track);this.characters.push(y)}const p=[this.player,...this.characters];so(p);for(let f=0;f<p.length;f++){const y=p[f],v=Math.floor(f/l),S=f%l,T={x:r.minX+m+S*h,y:r.y+v*d};y.x=T.x,y.y=T.y}this.camera.follow(this.player),this.camera.visibleAreaHeight=io,this.camera.yAdjust=-.25,this.camera.update(0)}update(e,i){this.camera.update(e),this.track.update(e,i,this.characters),this.calculateMovement(e,i),this.checkCollisions();for(let n=0;n<this.characters.length;n++)this.characters[n].move();this.updateCharacterRanks(),this.checkGameState()}playWithVolumeByDistance(e,i){const n=Math.abs(i-this.player.y);nt(e,Math.max(0,Math.min(1,1-n/no)))}calculateMovement(e,i){for(let n=0;n<this.characters.length;n++){const s=this.characters[n],a=this.track.getBetween(s.y,s.y+s.height);let r=Q;s.fallStartTime!=null?e-s.fallStartTime>Ie+ki&&this.dropToLatestCheckpoint(e,s):s.fallStartTime==null&&!this.track.isOnPlatform(a,s)?(s.fallStartTime=e,s===this.player&&setTimeout(()=>{const l=this.track.getCheckpoint(this.player.latestCheckpointIndex),h=l.y+l.height/2;this.camera.setTransition({startY:this.player.y,endY:h,startTime:e,duration:ki+500})},Ie)):(r=s.getMovement(e),s.setDirection(r),s.velocity=Ss(s,r,i))}}checkCollisions(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e];if(!i.doesNotCollide)for(let n=e+1;n<this.characters.length;n++){const s=this.characters[n];s.doesNotCollide||ks(i,s)&&(!i.ai||Ut(i.velocity)>.3)&&this.playWithVolumeByDistance(zi,i.y)}}for(let e=0;e<this.characters.length;e++){const i=this.characters[e],n=this.track.getBetween(i.y,i.y+i.height),{minI:s,maxI:a}=n;for(let r=s;r<=a;r++){const l=this.track.get(r);for(let h=0;h<l.objects.length;h++){const d=l.objects[h];Is(i,d)&&this.playWithVolumeByDistance(Gi,d.y)}}}}renderText(e,i,n,s){const a=o.measureText(e),r=i+(s-a.width)/2;o.fillText(e,r,n)}updateCharacterRanks(){const e=this.characters.filter(s=>s.finished),i=this.characters.filter(s=>!s.finished);e.sort((s,a)=>s.rank-a.rank),i.sort((s,a)=>s.y+s.height/2-(a.y+a.height/2)),[...e,...i].forEach((s,a)=>{s.rank=a+1})}checkGameState(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e],n=this.track.findLatestCheckpoint(i.y),s=this.track.getBetween(i.y,i.y+i.height);if(!(i.fallStartTime!=null||!this.track.isOnPlatform(s,i))){if(n>i.latestCheckpointIndex&&(i.latestCheckpointIndex=n,i.rank===13)){i.eliminated=!0,i.stop(),i.ai||(this.state=1);continue}if(i.y+i.height<this.track.finishY&&(i.rank===13?(i.eliminated=!0,i.stop(),i.ai||(this.state=1)):(i.finished=!0,i.stop()),!i.ai||i.rank==this.characters.length-13)){let a=this.characters.filter(r=>r.eliminated).length;for(let r=0;r<this.characters.length;r++)if(this.characters[r].rank>this.characters.length-13)if(a<13)this.characters[r].eliminated||(this.characters[r].eliminated=!0,a++);else break;this.characters[0].eliminated?this.state=1:this.state=2}}}}dropToLatestCheckpoint(e,i){const n=this.track.getCheckpoint(i.latestCheckpointIndex),s={x:xs(n.minX+g,n.maxX-g),y:n.y+n.height/2,width:i.width,height:i.height};if(!this.characters.some(a=>Ae(a,s))){if(i.rank===13){i.eliminated=!0,i.stop(),i.ai||(this.state=1);return}i.drop(e,s),this.playWithVolumeByDistance(Xi,i.y),i===this.player&&this.camera.follow(i)}}drawCross(e,i,n,s="red"){o.strokeStyle=s,o.lineWidth=n/4,o.beginPath(),o.moveTo(e-n/2,i-n/2),o.lineTo(e+n/2,i+n/2),o.moveTo(e+n/2,i-n/2),o.lineTo(e-n/2,i+n/2),o.stroke()}draw(e,i){o.save(),o.translate(u.width/2,u.height/2),o.scale(this.camera.zoom,this.camera.zoom),o.translate(-this.camera.x,-this.camera.y);const n=[...this.characters];this.drawTrack(n),this.drawObjects(e,i,n),o.restore(),this.drawGradient(),this.state===0&&(o.save(),o.translate(u.width/2,u.height/2),o.scale(this.camera.zoom,this.camera.zoom),o.translate(-this.camera.x,-this.camera.y),this.drawStatusOfCharacters(e),this.drawTopStatusTexts(),o.restore())}drawTrack(e){o.save();const i=this.camera.getViewArea(),{minI:n,maxI:s}=this.track.getBetween(i.y,i.y+i.height);for(let a=s;a>=n;a--){const r=this.track.get(a),l=r.surfaces;o.fillStyle=r.color,o.shadowColor=r.color.replace("rgb(","rgba(").replace(")",",0.3)"),o.shadowOffsetY=r.height*(r.type===ht.Raft?2:6),r.type===ht.Raft&&(o.globalAlpha=.5);for(let h=0;h<l.length;h++){const d=l[h];this.drawSurface(r,d)}o.globalAlpha=1,e.push(...r.objects)}o.restore()}drawSurface(e,i){if(o.strokeStyle="rgba(255,255,255,0.4)",o.lineWidth=.1,e.type!==ht.Raft&&o.strokeRect(i.x,i.y+.1,i.width,i.height),o.save(),Se(i)){const n=i.force;o.fillStyle=`rgba(${220+n*50}, ${80+n*50}, ${60+n*50}, ${1-n})`}if(o.fillRect(i.x,i.y,i.width,i.height),o.restore(),e.type===ht.Raft)o.strokeRect(i.x,i.y,i.width,i.height);else if(Se(i)){o.shadowOffsetY=0,o.font="9px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="rgba(255, 255, 255, 0.1)";const n=e.width/(e.width/10);for(let s=1;s<=i.width/9-1;s++)o.fillText("⇪",i.x+s*n,i.y+i.height/2)}else if(e.type===ht.CheckPoint||e.type===ht.Finish){o.fillStyle="rgba(255, 255, 255, 0.2)",o.fillRect(i.x,i.y+i.height-4,i.width,4),o.shadowOffsetY=0,o.font="9px Arial",o.textAlign="center",o.textBaseline="middle",o.fillStyle="rgba(255, 255, 255, 0.1)";const n=e.width/10;for(let s=1;s<=i.width/9-1;s++)o.fillText(e.type===ht.Finish?"✪":"✓",i.x+s*n,i.y+i.height/2.4)}this.platePattern&&(o.fillStyle=this.platePattern,o.fillRect(i.x,i.y,i.width,i.height),o.fillStyle=e.color)}drawObjects(e,i,n){n.sort((s,a)=>s.y+s.height/2-(a.y+a.height/2));for(let s=0;s<n.length;s++)n[s].draw(e,i)}drawGradient(){const e=o.createRadialGradient(u.width/2,u.height/2,0,u.width/2,u.height/2,u.width/1.5);e.addColorStop(1,"rgba(0, 0, 0, 0)"),e.addColorStop(.8,"rgba(0, 0, 0, 0)"),e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),o.fillStyle=e,o.fillRect(0,0,u.width,u.height);const i=o.createLinearGradient(0,0,0,u.height);i.addColorStop(0,"rgba(0, 0, 0, 1)"),i.addColorStop(.2,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),o.fillStyle=i,o.fillRect(0,0,u.width,u.height)}drawStatusOfCharacters(e){this.characters.forEach(i=>{if(i.isVisible(e)){const n=`${i.rank}`;o.fillStyle=i.rank===13?"red":i.eliminated?"crimson":i.rank>this.characters.length-13?"orange":i.rank===1?"lightgreen":i.ai?"white":"yellow",o.font=i.ai?i.eliminated||i.rank===13?"1.2px Sans-serif":"1px Sans-serif":"1.4px Sans-serif",i.ai||(o.save(),o.font="4.0px Sans-serif",this.renderText("▲",i.x,i.y-i.height*3.25,i.width),o.restore()),i.eliminated&&this.drawCross(i.x-.25,i.y-i.height*2.7,1),this.renderText(i.eliminated?"13":n,i.x,i.y-i.height*2.5,i.width)}})}drawTopStatusTexts(){const e=this.characters.filter(n=>n.eliminated).length.toString(),i=this.characters.filter(n=>n.finished).length.toString();o.font="4px Impact",o.fillStyle=this.player.rank===13?"red":this.player.eliminated?"crimson":this.player.rank>this.characters.length-13?"orange":this.player.rank===1?"lightgreen":"yellow",o.fillText("▲ "+this.player.rank+" / "+this.characters.length,-42,this.camera.y-30),o.fillStyle="green",o.fillText("✪ "+i+" / "+(this.characters.length-13)+" QUALIFIED",-15,this.camera.y-30),o.fillStyle="red",this.drawCross(28,this.camera.y-31.5,3),o.fillText(e+" / 13",32,this.camera.y-30)}}const Mi=[c.FullWidthWithObstacles,c.FullWidth,c.FullWidth,c.FullWidth],Ei=[c.Basic,c.SlopeEmptyPassage,c.SlopeEmptyPassage,c.DualPassage,c.Basic,c.RightPassage,c.RightPassage,c.Basic,c.Basic,c.Raft,c.Chasm,c.FullWidth],oo=[c.BasicSteepSlope,c.BasicSlope,c.FullWidthWithObstacles,c.FullWidthWithMoreObstacles,c.FullWidthWithObstacles,c.DualPassage,c.DualPassage,c.DualPassage,c.FullWidth];function ao(){const t=bt(1);return[c.Checkpoint,...t<.5?Mi:Ei,c.Checkpoint,...t<.5?Ei:Mi,c.Checkpoint,...oo,c.Finish]}const Pi=[c.FullWidth,c.BasicSteepSlope,c.BasicSlope,c.BasicSlope,c.Basic,c.Basic,c.Basic,c.Narrow,c.VeryNarrow,c.VeryNarrow,c.Basic,c.FullWidthWithObstacles,c.SlopeObstacleSlope,c.PassageEmptySlope,c.PassageEmptySlope,c.DualPassage,c.DualPassage,c.FullWidth,c.FullWidthWithObstaclesOnRight,c.FullWidthWithObstaclesOnRight2,c.FullWidthWithObstaclesOnRight,c.FullWidth,c.Raft,c.Chasm],Ci=[c.FullWidth,c.VeryNarrow,c.FullWidth,c.BasicSteepSlope,c.BasicSlope,c.BasicSlope,c.Basic,c.Basic,c.Basic,c.Basic,c.TwoRafts,c.Chasm];function ro(){const t=bt(1);return[c.Checkpoint,...t<.5?Pi:Ci,c.Checkpoint,...t<.5?Ci:Pi,c.Finish]}const Ri=[c.FullWidth,c.Basic,c.Narrow,c.VeryNarrow,c.Basic,c.SlopeEmptySlope,c.SlopeEmptySlope,c.SlopeEmptySlope,c.DualPassage,c.DualPassage,c.Basic,c.FullWidthWithObstacles,c.VeryNarrow,c.Basic],Ti=[c.FullWidth,c.SlopeEmptySlope,c.PassageEmptySlope,c.PassageEmptySlope,c.DualPassage,c.SlopeEmptyPassage,c.DualPassageExt,c.TriplePassage,c.TriplePassage,c.TriplePassage,c.FullWidth],Fi=[c.FullWidthWithObstacles,c.FullWidthWithMoreObstacles,c.FullWidth,c.TwoRafts,c.Chasm,c.Basic,c.FullWidth],Oi=[c.BasicSteepSlope,c.BasicSlope,c.BasicSlope,c.Basic,c.Basic,c.Basic,c.DualPassage,c.DualPassageExt,c.TriplePassage,c.TriplePassage,c.DualPassageExt,c.PassageEmptySlope,c.PassageEmptySlope,c.Basic,c.Basic,c.Narrow,c.VeryNarrow,c.FullWidth,c.RightPassage,c.FullWidth,c.TwoRafts,c.Chasm];function lo(){const t=bt(1);return[c.Checkpoint,...t<.5?Ri:Ti,c.Checkpoint,...t<.5?Ti:Ri,c.Checkpoint,...t<.5?Fi:Oi,c.Checkpoint,...t<.5?Oi:Fi,c.Finish]}const co="2025-05-24";async function ho(){let t=!1;const e=document.getElementById("ios-fullscreen-video");if(e&&e.webkitDisplayingFullscreen&&(t=!0),t)try{return e&&typeof e.webkitExitFullscreen=="function"&&e.webkitExitFullscreen(),e&&(e.pause(),e.currentTime=0),document.exitFullscreen&&await document.exitFullscreen(),!0}catch(n){return console.warn("iOS fullscreen exit failed:",n),!1}const i=document.getElementById("ios-fullscreen-video")||document.createElement("video");i.id||(i.id="ios-fullscreen-video",i.playsInline=!0,i.setAttribute("playsinline","playsinline"),i.muted=!0,i.setAttribute("muted","muted"),i.autoplay=!1,i.loop=!0,i.style.width="1px",i.style.height="1px",i.style.position="absolute",i.style.opacity="0.01",i.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAAAAG1wNDJtcDQxaXNvbWlzbzIAAAACbWV0YQAAAAAAAAAoaGRscgAAAAxBVkMgQ29kaW5nAAAAQ2NvbHJzAAAAG3VpbnQCAAAAGFFSRwKCPQAAAEAAAAJNAAAAAP9tZGF0AAAAEgEH//4PMkXKj////jA9FbmQ=",document.body.appendChild(i));try{if(await i.play(),await new Promise(s=>setTimeout(s,100)),typeof i.webkitEnterFullscreen=="function")return i.webkitEnterFullscreen(),console.log("Requested iOS fullscreen mode"),!0}catch(n){console.warn("iOS fullscreen attempt failed:",n)}return!1}async function Di(){if(se&&await ho())return;const t=document.documentElement;if(document.fullscreenElement)try{await document.exitFullscreen(),console.log("Exited fullscreen mode")}catch(e){e instanceof Error&&console.error(`Error exiting fullscreen: ${e.message} (${e.name})`);return}else try{t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.mozRequestFullScreen?await t.mozRequestFullScreen():t.msRequestFullscreen&&await t.msRequestFullscreen(),console.log("Entered fullscreen mode")}catch(e){console.warn("Standard fullscreen failed, falling back to canvas positioning",e instanceof Error?e.message:e);const i=document.querySelector("canvas");i&&(i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.zIndex="1000");return}}const fo="Director's cut ("+co+")",Ze=1e3/60,uo=Ze*5;let Je=performance.now(),Mt=0,Pt=1+Math.random()*.6,Ct=1+Math.random()*.3,ue=1,R,X=0,Ce=0,ln=0;const go=5e3;let P=0,cn=0;const ke=On(),_i=Dn();let xt=0;const et=async t=>{Ce=t,ri(t===6||t===5);const e=document.getElementById("restartButton");e&&(e.style.display=t!==1?"block":"none");const i=document.getElementById("fullscreenButton");switch(i&&(i.style.display=t!==1||!At?"block":"none"),X=1280*2,t){case 2:await rs(0),await Wt(),et(3);break;case 3:await Wt($e),et(4);break;case 4:et(5);break;case 5:if(xt=0,Mt>1&&R&&!R.player.eliminated){const n=Mt===3?lo():ro();R=new xi(n,Pt,Ct,R.characters,_i)}else R=new xi(ao(),Pt,Ct,void 0,_i);P=X,cn=ln,Hi();break;case 7:P=1,nt(Yi),Pt=1+Math.random()*.6,Ct=1+Math.random()*.3,await Wt(Vi),Mt=1,et(2);break;case 8:ri(!1),Mn(),P=1,nt($i),R&&R.characters.length>14?(await Wt($e),Mt++,et(5)):(await Wt(we),Mt=1,Ys(),et(2));break;case 6:an();break;case 1:ns();break}},hn=t=>{requestAnimationFrame(hn);const e=t-Je;if(e>=Ze){const i=Math.min(e,uo);Je=t-e%Ze,mo(t,i),bn(t)&&po(t,i)}},mo=(t,e)=>{switch(Ce){case 6:{js(),R==null||R.update(t,e),(R==null?void 0:R.state)===Qe.GAME_OVER?et(7):(R==null?void 0:R.state)===Qe.FINISHED&&et(8);break}case 5:{xt===2&&P<X/4?(nt(Ui),xt++):(xt===1&&P<X/2||xt===0&&P<X)&&(nt(Ye),xt++);break}}};let ye=0;const Wi="LOADING...",yo=()=>{const t=ye<10?Wi.substring(0,ye):"LOADING...";H(t+(ye++%60===0?"":"█"),W.Small,"Courier New",1,7.7,!0,0,Wi)},po=(t,e)=>{switch(ln=t,o.save(),o.fillStyle="rgb(0, 0, 20)",o.fillRect(0,0,u.width,u.height),R==null||R.draw(t,e),o.restore(),o.save(),Ce){case 0:{yo(),ye++,Ni(),ct(!1);break}case 1:{if(wo(!0),At){const i=document.getElementById(pe);i&&i.style.display==="none"&&(i.style.display="block")}else ne("start");break}case 2:{Xe(t++,!1,0),kt(),ct(!0);break}case 3:{Xe(t++,!0,ue=ue+.01),kt(),ct(!0);break}case 4:{Xe(t++,!0,ue=ue+.01);const i=u.width/2,n=u.height/2;o.beginPath(),o.arc(i,n,P,0,Math.PI*2),o.fillStyle="#802010",o.fill(),P<X&&(P+=e),kt(),ct(!0);break}case 5:{const i=u.width/2,n=u.height/2;P<=0?et(6):(P>0&&(o.beginPath(),o.arc(i,n,P,0,Math.PI*2),o.fillStyle=P<X/4?"#105000":P<X/2?"#CCCC40":"#802010",o.fill()),P<X/4?H("▲ GO! ▲",W.Xl,"Impact",P/X*4):P<X/2?H("Set...",W.Xl,"Impact",1):H("Ready...",W.Xl,"Impact",1),P>0&&(P=(1-(t-cn)/go)*X)),kt(),ct(!0);break}case 7:{const i=u.width/2,n=u.height/2;o.beginPath(),o.arc(i,n,P,0,Math.PI*2),o.fillStyle="#802010",o.fill(),H("❌ ELIMINATED!",W.Large,"Impact",1,-4.5),(R==null?void 0:R.player.rank)===13?H("Don't be the 13TH GUY",W.Small,"Sans-serif"):(H("Don't be one of the last 13TH GUYs",W.Small,"Sans-serif"),H("The final rank is "+(R==null?void 0:R.player.rank)+".",W.Normal,"Impact",1,3.1)),P>=X&&ne("continue",9),P<X&&(o.save(),o.globalAlpha=.7,o.translate(u.width/8,P*2-u.height),re(o,"eliminated",u.height/6*Pt,u.height/2*Ct,t,V.Backward,yt.Fall,ke),o.globalAlpha=0,o.restore()),P<X&&(P+=e),kt(),ct(!0);break}case 8:{const i=u.width/2,n=u.height/2;o.beginPath(),o.arc(i,n,P,0,Math.PI*2),o.fillStyle="#105000",o.fill(),P>=X/4&&(R&&R.characters.length>14?(H("✪ QUALIFIED!",W.Large,"Impact",1,-5),H("☻",W.Huge,"Impact"),H("Ready for next round "+(Mt+1)+" / 3",W.Normal,"Sans-serif",1,3.8)):(H("GAME FINISHED!",W.Large,"Impact",1,-5),H("☻",W.Huge,"Impact"),H("Congratulations to the winner!",W.Normal,"Impact",1,3.8)),P>=X&&ne(),o.save(),o.translate(P<u.width/6?P:u.width/6,u.height/3),re(o,ni,u.height/6*Pt,u.height/2*Ct,t,P<u.width/6?V.Right:R&&R.characters.length<=14||t%3600>1800?V.Backward:V.BackwardRight,R&&R.characters.length>14?yt.Walk:yt.Celebrate,ke),o.restore()),P<X&&(P+=e),kt(),ct(!0);break}default:{const i=document.getElementById(pe);i&&i.style.display!=="none"&&(i.style.display="none"),ct(!1),an();break}}o.restore()},dn=()=>{H(fo,W.Tiny,"Impact",.5,2.3,!1),H("Don't be the",W.Small,"Impact",1,-1.8,!0,-.9),H("❌ 13TH GUY",W.Xl,"Impact",1,1.8)},Xe=(t,e,i)=>{o.save(),o.fillStyle="rgb(20, 20, 50)",o.rect(0,0,u.width,u.height),o.fill(),o.save(),o.translate(u.width/8+i,u.height/3),re(o,ni,(e?u.height/6/i:u.height/6)*Pt,(e?u.height/2/i:u.height/2)*Ct,t,e?V.Forward:t%3600<1800?V.BackwardRight:V.Backward,yt.Walk,ke,e),o.restore(),e?(H("Avoid being the 13th or among the last 13",W.Small,"Sans-serif",1,-1.2),H("or you will be eventually ❌ eliminated!",W.Small,"Sans-serif",1,1.3),H("MOVE WITH",W.Xs,"Sans-serif",.8,-7.5),H("▲ / W - ▼ / S - ◄ / A - ► / D",W.Xs,"Sans-serif",.8,-5.6),Ce===3&&ne("start the race!")):(dn(),ne()),o.restore()},wo=t=>{o.save(),o.fillStyle="rgb(20, 20, 50)",o.rect(0,0,u.width,u.height),o.fill(),o.save(),o.translate(u.width/8,u.height/3),re(o,ni,u.height/6*Pt,u.height/2*Ct,0,V.Backward,yt.Stand,ke),o.restore(),dn(),o.filter="",Ni(),kt(),ct(t)};async function Li(){const t=document.getElementById(pe);t&&(t.style.display="none");const e=Hn();document.body.appendChild(e),Mt=1,et(2)}const vo=async()=>{u.tabIndex=0,u.style.outline="none",kn(),Qs(),Je=performance.now(),window.requestAnimationFrame(hn);const t=_n(At),e=Wn(),i=Ln();document.body.appendChild(e),document.body.appendChild(t),document.body.appendChild(i),t.addEventListener("click",n=>{n.stopPropagation(),Di(),u.focus()}),e.addEventListener("click",n=>{n.stopPropagation(),window.location.reload()}),await es(),et(1),At?i.addEventListener("click",async n=>{n.stopPropagation(),i.style.display="none",nt(we),await new Promise(s=>setTimeout(s,100)),await Di(),u.focus(),await Li()},{passive:!1,once:!0}):(await Wt(we),await Li())},fn=1280,un=720;window.addEventListener("resize",()=>tn(fn,un),!1);tn(fn,un);vo();
