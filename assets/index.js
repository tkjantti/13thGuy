var Vi=Object.defineProperty;var Ki=(t,e,i)=>e in t?Vi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var y=(t,e,i)=>Ki(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(a){if(a.ep)return;a.ep=!0;const n=i(a);fetch(a.href,n)}})();const g=document.querySelector("canvas"),r=g.getContext("2d",{willReadFrequently:!0});let rt=null,Vt=null;const zi=(t,e,i)=>{if(rt=document.createElement("canvas"),rt.width=t,rt.height=e,Vt=rt.getContext("2d"),Vt){Vt.fillStyle=`rgba(0, 0, 0, ${1-i})`;for(let s=0;s<e;s+=2)Vt.fillRect(0,s,t,1)}},at=(t=!0)=>{const e=g.width,i=g.height,s=r.getImageData(0,0,e,i),a=s.data,n=t?.7:.8,o=t?10:0,h=t?new Float32Array(e*i):null;if(t&&h)for(let c=0;c<h.length;c++)h[c]=(Math.random()-.5)*o;if(t&&h)for(let c=0;c<i;c++){const d=c*e;for(let w=0;w<e;w++){const p=(d+w)*4,f=h[d+w];a[p]+=f,a[p+1]+=f,a[p+2]+=f}}r.putImageData(s,0,0),(!rt||rt.width!==e||rt.height!==i)&&zi(e,i,n),Vt&&rt&&(r.globalAlpha=n,r.drawImage(rt,0,0),r.globalAlpha=1)};let zt;const Ui=()=>{const t=g.width,e=g.height;zt=r.createRadialGradient(t/2,e/2,0,t/2,e/2,t/2),zt.addColorStop(0,"rgba(255, 255, 255, 0.3)"),zt.addColorStop(1,"rgba(0, 0, 0, 0.5)")},mt=()=>{zt||Ui(),r.fillStyle=zt,r.fillRect(0,0,g.width,g.height)},gi=()=>{const t=r.getImageData(0,0,g.width,g.height),e=t.data;for(let i=0;i<e.length;i+=4){const s=e[i],a=e[i+1],n=e[i+2],o=s*.3+a*.59+n*.11;e[i]=e[i+1]=e[i+2]=o*.7}r.putImageData(t,0,0)},$i=()=>{const t=document.createElement("canvas");t.width=4,t.height=4;const e=t.getContext("2d");if(!e)return;function i(a,n,o,h,c){e&&(e.strokeStyle=c,e.beginPath(),e.moveTo(a,n),e.lineTo(o,h),e.stroke())}const s="#00000010";e.fillStyle=s,e.fillRect(0,0,t.width,t.height);for(let a=0;a<=t.width;a+=4)i(a,0,a,t.height,s),i(0,a,t.width,a,s);return e.createPattern(t,"repeat")},ji=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(!e)return;const i=e.getImageData(0,0,t.width,t.height),s=i.data,a=4;for(let n=0;n<t.height;n+=a)for(let o=0;o<t.width;o+=a){const h=Math.random()*64,c=Math.floor(Math.random()*24);for(let d=0;d<a;d++)for(let w=0;w<a;w++){const p=((n+d)*t.width+(o+w))*4;s[p]=Math.min(255,Math.max(0,s[p]+h)),s[p+1]=Math.min(255,Math.max(0,s[p+1]+h)),s[p+2]=Math.min(255,Math.max(0,s[p+2]+h)),s[p+3]=c}}return e.putImageData(i,0,0),e.createPattern(t,"repeat")};var D=(t=>(t[t.Tiny=16]="Tiny",t[t.Xs=20]="Xs",t[t.Small=24]="Small",t[t.Normal=32]="Normal",t[t.Large=48]="Large",t[t.Xl=64]="Xl",t[t.Huge=80]="Huge",t))(D||{});const Ne=t=>{const e=g.width/1e3;return Math.floor(t*e)},H=(t,e,i,s=1,a=0,n=!0,o=0,h)=>{r.save();const c=Ne(e),d=Ne(16);r.globalAlpha=s>0?s:0,r.fillStyle="white",r.font=c+"px "+i;const w=r.measureText(h??t).width,p=a*d,f=o*d;r.fillText(t,(g.width-w)/2+f,(n?g.height/2:0)+p),r.restore()},ui=()=>({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1});let Wt=ui();const qi=t=>{t.code in Wt&&(Wt[t.code]=!0)},Qi=t=>{t.code in Wt&&(Wt[t.code]=!1)},Zi=()=>{window.addEventListener("keydown",qi),window.addEventListener("keyup",Qi),window.addEventListener("blur",()=>{Wt=ui()})},yi=t=>new Promise(e=>setTimeout(e,t)),Ji=()=>new Promise(t=>{const e=i=>{i.code==="Enter"&&(window.removeEventListener("keydown",e),t())};window.addEventListener("keydown",e)}),ts=()=>Wt;function es(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function ae(t,e){const i=e.x<=t.x+t.width&&t.x<=e.x+e.width,s=e.y<=t.y+t.height&&t.y<=e.y+e.height;return i&&s}function is(t,e){return t.x<=e.x&&e.x<t.x+t.width&&t.y<=e.y&&e.y<t.y+t.height}function ss(t,e){const i=t.x<=e.x&&e.x+e.width<=t.x+t.width,s=t.y<=e.y&&e.y+e.height<=t.y+t.height;return i&&s}function ue(t){return-(Math.cos(Math.PI*t)-1)/2}function Z(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}function ye(t){return t*t}function as(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}class ns{constructor(e,i){y(this,"x",0);y(this,"y",0);y(this,"zoom",1);y(this,"visibleAreaHeight");y(this,"yAdjust",0);y(this,"target",null);y(this,"transition",null);this.level=e,this.view=i}getViewArea(){const e=this.view.width/this.zoom,i=this.view.height/this.zoom;return{x:this.x-e/2,y:this.y-i/2,width:e,height:i}}follow(e){this.target=e}setTransition(e){const i=this.view.height/this.zoom;this.transition={...e,endY:e.endY+i*this.yAdjust},this.target=null}update(e){if(this.visibleAreaHeight!=null&&(this.zoom=this.view.height/this.visibleAreaHeight),this.transition!=null){const{startY:i,endY:s,startTime:a,duration:n}=this.transition;if(e<a+n){const h=(e-this.transition.startTime)/this.transition.duration;this.y=i+as(h)*(s-i)}else this.transition=null}else this.target&&this.followFrame(this.target)}followFrame(e){const i=this.view.width/this.zoom,s=this.view.height/this.zoom;if(i<this.level.width){let a=e.x+e.width;a-i/2<this.level.x?a=this.level.x+i/2:a+i/2>this.level.x+this.level.width&&(a=this.level.x+this.level.width-i/2),this.x=a}else this.x=0;this.y=e.y+s*this.yAdjust}}const j={x:0,y:0};function ie(t){return t.x===0&&t.y===0}function rs(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function os(t,e){return Math.abs(t.x-e.x)}function hs(t,e){return Math.abs(t.y-e.y)}function Ht(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function ot(t,e){return{x:t.x+e.x,y:t.y+e.y}}function mi(t,e){return{x:t.x-e.x,y:t.y-e.y}}function et(t,e){return{x:t.x*e,y:t.y*e}}function ls(t,e){return{x:t.x/e,y:t.y/e}}function ht(t){return ls(t,Ht(t))}function jt(t,e){return t.x*e.x+t.y*e.y}const Rt=.5,cs=.01,fs=5e-4,Be=6e-4,ds=3;function gs(t,e,i){if(ie(e)){const m=Ht(t.velocity),S=Be*i,k=m>S?m-S:0;return k>0?et(ht(t.velocity),k):j}const s=jt(t.velocity,e),a={x:-e.y,y:e.x},n=jt(t.velocity,a);let o=fs*i;s>cs*i&&(o=0);const h=Be*i,c=Math.abs(n)>h?-h:0,d=Math.sign(n)*c,w=et(e,o),p=et(a,d);return ot(t.velocity,ot(w,p))}function us(t,e){const i=t.width/2,s=t.height/2,a=e.width/2,n=e.height/3.5,o={x:t.x+t.width/2,y:t.y+t.height/2},h=ot(o,t.velocity),c={x:e.x+e.width/2,y:e.y+e.height/2};if(os(h,c)<i+a&&hs(h,c)<s+n){const d=ht(mi(c,o)),w=jt(t.velocity,d),p=et(d,-Math.abs(w)*ds);let f=ot(t.velocity,p);return Ht(f)>Rt&&(f=et(ht(f),Rt)),t.velocity=f,!0}return!1}function ys(t,e){const i=t.width*.4,s=e.width*.4,a={x:t.x+t.width/2,y:t.y+t.height/2},n={x:e.x+e.width/2,y:e.y+e.height/2},o=ot(a,t.velocity),h=ot(n,e.velocity);if(rs(o,h)<i+s){const c=ht(mi(n,a)),d=et(c,-1),w=jt(t.velocity,c),p=jt(e.velocity,d),f=et(c,Math.abs(w)),m=et(d,Math.abs(p));let S=ot(t.velocity,m);Ht(S)>Rt&&(S=et(ht(S),Rt)),t.velocity=S;let k=ot(e.velocity,f);return Ht(k)>Rt&&(k=et(ht(k),Rt)),e.velocity=k,!0}return!1}const dt=(t=1)=>Math.random()*t,ms=(t,e)=>Math.random()*(e-t)+t,Ft=class Ft{constructor(e){y(this,"x");y(this,"y");y(this,"width",Ft.WIDTH);y(this,"height",Ft.HEIGHT);y(this,"velocity",j);this.x=e.x,this.y=e.y}draw(e,i){r.save(),r.translate(this.x,this.y);const s=r.createLinearGradient(0,0,this.width,this.height);s.addColorStop(0,"rgb(255, 110, 110)"),s.addColorStop(1,"rgb(255, 60, 60)"),r.beginPath(),r.fillStyle="rgba(0, 0, 0, 0.1)",r.ellipse(this.width/2,this.height/1.5,this.width/2,this.height,0,0,2*Math.PI),r.fill(),r.fillStyle=s,r.beginPath(),r.ellipse(this.width/2,this.height/2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.fillStyle=s,r.fillRect(0,-this.height*2,this.width,this.height*2.5);const a=r.createLinearGradient(0,0,this.width,this.height);a.addColorStop(0,"rgb(255, 140, 140)"),a.addColorStop(1,"rgb(255, 80, 80)"),r.fillStyle=a,r.beginPath(),r.ellipse(this.width/2,-this.height*2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.strokeStyle="rgb(200, 70, 70)",r.lineWidth=this.width/100,r.stroke(),r.restore()}};y(Ft,"WIDTH",10),y(Ft,"HEIGHT",4);let x=Ft;const b=16,u=10,pi=b,Tt=9,ft=u*Tt,me=u*7,ps=u*5,_e=u*3,v=-90/2,Ge=ft/2;var l=(t=>(t[t.FullWidth=0]="FullWidth",t[t.Basic=1]="Basic",t[t.BasicSlope=2]="BasicSlope",t[t.BasicSteepSlope=3]="BasicSteepSlope",t[t.Narrow=4]="Narrow",t[t.VeryNarrow=5]="VeryNarrow",t[t.DualPassage=6]="DualPassage",t[t.DualPassageExt=7]="DualPassageExt",t[t.TriplePassage=8]="TriplePassage",t[t.RightPassage=9]="RightPassage",t[t.SlopeEmptySlope=10]="SlopeEmptySlope",t[t.SlopeEmptyPassage=11]="SlopeEmptyPassage",t[t.PassageEmptySlope=12]="PassageEmptySlope",t[t.SlopeObstacleSlope=13]="SlopeObstacleSlope",t[t.FullWidthWithObstaclesOnRight=14]="FullWidthWithObstaclesOnRight",t[t.FullWidthWithObstaclesOnRight2=15]="FullWidthWithObstaclesOnRight2",t[t.FullWidthWithMoreObstacles=16]="FullWidthWithMoreObstacles",t[t.FullWidthWithObstacles=17]="FullWidthWithObstacles",t[t.Chasm=18]="Chasm",t[t.Raft=19]="Raft",t[t.TwoRafts=20]="TwoRafts",t[t.Checkpoint=21]="Checkpoint",t[t.Finish=22]="Finish",t))(l||{}),nt=(t=>(t[t.Normal=0]="Normal",t[t.CheckPoint=1]="CheckPoint",t[t.Finish=2]="Finish",t[t.Raft=3]="Raft",t))(nt||{}),F=(t=>(t[t.Empty=0]="Empty",t[t.Free=1]="Free",t[t.Obstacle=2]="Obstacle",t[t.Raft=3]="Raft",t))(F||{});function wi(t,e,i){return{type:0,row:t,col:e,x:v+e*u,y:i,width:u,height:b}}function Ce(t){return"yDirection"in t}function ne(t){return"force"in t}class ws{constructor(e,i,s,a,n){y(this,"row");y(this,"y");y(this,"type");y(this,"surfaces");y(this,"objects");y(this,"width");y(this,"height");y(this,"minX");y(this,"maxX");y(this,"blocks",new Array(Tt));this.row=e,this.y=i,this.type=s,this.surfaces=a,this.objects=n,this.minX=Math.min(...this.surfaces.map(o=>o.x)),this.maxX=Math.max(...this.surfaces.map(o=>o.x+o.width)),this.width=this.maxX-this.minX,this.height=b;for(let o=0;o<Tt;o++)this.blocks[o]={type:this.getBlockType(o),row:e,col:o,x:v+o*u,y:this.y,width:u,height:b}}get color(){switch(this.type){case 1:return"rgb(50, 80, 50)";case 2:return"rgb(0, 200, 0)";case 3:return"rgb(50,60,120)";default:return"rgb(80, 50, 80)"}}getBlock(e){return e<0||Tt<=e?wi(this.row,e,this.y):this.blocks[e]}isFree(e,i){const s=u*.1,a=v+e*u,n=i??this.y,o={x:a+s,y:n+s,width:u-2*s,height:pi-2*s};return this.surfaces.some(h=>ss(h,o))&&!this.objects.some(h=>ae(h,o))}getBlockType(e){const i=u*.1,s=v+e*u+i,a=u-2*i;return this.surfaces.some(h=>Ce(h)&&h.x<=s&&s+a<=h.x+h.width)?3:this.objects.some(h=>h.x<=s&&s+a<=h.x+h.width)?2:this.isFree(e)?1:0}}function bs(t,e){const i=t.map((s,a)=>vs(s,a,e));return Ss(i),i}function vs(t,e,i){const s=i-b*(e+1),a=s+b/2;let n=0,o=[],h=[];switch(t){case 0:o=[{x:v,y:s,width:ft,height:b}];break;case 1:o=[{x:v+u*1,y:s,width:me,height:b}];break;case 2:{o=[{force:.3,x:v+u*1,y:s,width:me,height:b}];break}case 3:{o=[{force:.5,x:v+u*1,y:s,width:me,height:b}];break}case 4:o=[{x:v+u*2,y:s,width:ps,height:b}];break;case 5:o=[{x:v+u*3,y:s,width:_e,height:b}];break;case 6:o=[{x:v+u,y:s,width:u*2,height:b},{x:Ge-u*3,y:s,width:u*2,height:b}];break;case 7:o=[{x:v+u,y:s,width:u*2,height:b},{x:v+u*4,y:s,width:u*5,height:b}];break;case 8:o=[{x:v+u*1,y:s,width:u*2,height:b},{x:v+u*4,y:s,width:u*2,height:b},{x:v+u*7,y:s,width:u*2,height:b}];break;case 9:{o=[{x:v+u*6,y:s,width:u*2,height:b}];break}case 10:{const c={force:.3,x:v+u*1,y:s,width:u*2,height:b},d={force:.3,x:v+u*6,y:s,width:u*2,height:b};o=[c,d];break}case 11:{const c={force:.3,x:v+u*1,y:s,width:u*2,height:b},d={x:v+u*6,y:s,width:u*2,height:b};o=[c,d];break}case 12:{const c={x:v+u*1,y:s,width:u*2,height:b},d={force:.3,x:v+u*6,y:s,width:u*2,height:b};o=[c,d];break}case 13:{const c={force:.3,x:v+u*1,y:s,width:u*2,height:b},d={force:.3,x:v+u*6,y:s,width:u*2,height:b};o=[c,{x:v+u*3,y:s,width:u*3,height:b},d],h=[new x({x:v+u*4,y:a-x.HEIGHT/2})];break}case 14:{o=[{x:-90/2,y:s,width:ft,height:b}],h=[new x({x:v+u*4,y:a-x.HEIGHT/2}),new x({x:v+u*6,y:a-x.HEIGHT/2}),new x({x:v+u*8,y:a-x.HEIGHT/2})];break}case 15:{o=[{x:-90/2,y:s,width:ft,height:b}],h=[new x({x:v+u*3,y:a-x.HEIGHT/2}),new x({x:v+u*5,y:a-x.HEIGHT/2}),new x({x:v+u*7,y:a-x.HEIGHT/2})];break}case 16:o=[{x:-90/2,y:s,width:ft,height:b}],h=[new x({x:v+u*0,y:a-x.HEIGHT/2}),new x({x:v+u*2,y:a-x.HEIGHT/2}),new x({x:v+u*4,y:a-x.HEIGHT/2}),new x({x:v+u*6,y:a-x.HEIGHT/2}),new x({x:v+u*8,y:a-x.HEIGHT/2})];break;case 17:o=[{x:-90/2,y:s,width:ft,height:b}],h=[new x({x:v+u,y:a-x.HEIGHT/2}),new x({x:v+u*3,y:a-x.HEIGHT/2}),new x({x:v+u*5,y:a-x.HEIGHT/2}),new x({x:v+u*7,y:a-x.HEIGHT/2})];break;case 18:break;case 19:{n=3,o=[{yDirection:-1,dockStartTime:0,x:v+u*3,y:s,width:_e,height:b}];break}case 20:{n=3;const c={yDirection:-1,dockStartTime:0,x:v+u*1,y:s-dt()*b,width:u*2,height:b},d={yDirection:-1,dockStartTime:0,x:Ge-u*3,y:s-dt()*b,width:u*2,height:b};o=[c,d];break}case 21:n=1,o=[{x:-90/2,y:s,width:ft,height:b}];break;case 22:n=2,o=[{x:-90/2,y:s,width:ft,height:b}];break}return new ws(e,s,n,o,h)}function Ss(t){for(let e=1;e<t.length;e++){const i=t[e-1],s=t[e];for(let a=0;a<Tt;a++)i.blocks[a].type===3&&s.blocks[a].type===0&&(s.blocks[a].type=3)}}const he=-1,Xe=1,ks={x:0,y:he},Is={x:-1,y:0},Ms={x:1,y:0},Cs=ht({x:-1,y:he}),xs=ht({x:1,y:he}),Rs=3,pe=1e3;class Es{constructor(e,i){y(this,"host");y(this,"track");y(this,"horizontalMargin",0);y(this,"lastSlowdownTime",-1e3);y(this,"target",null);this.host=e,this.track=i}reset(){this.target=null}getMovement(e){const i=this.getCurrentBlock(),s=this.track.getBlock(i.row+1,i.col),a=this.goByRaft(i,s,e);return a||((this.target==null||this.hasReached(this.target))&&(this.target=this.findNextTarget(i)),this.goRoundObstacles(i,s,e)||this.moveOnTrack(i,s,e))}goByRaft(e,i,s){if(e.type!==F.Raft&&i.type===F.Raft&&(this.host.y>e.y+1.5*this.host.height||this.track.isFree(e.row+1,e.col)))return{x:0,y:this.moveAhead(e,i,s)};if(i.type===F.Raft&&this.host.y<=e.y+1.5*this.host.height&&!this.track.isFree(e.row+1,e.col))return j;if(e.type===F.Raft&&!this.track.isFree(e.row+1,e.col)){let a=0;return this.host.x<e.x+this.host.width?a=1:e.x+e.width-2*this.host.width<this.host.x&&(a=-1),{x:a,y:0}}return e.type===F.Raft&&this.track.isFree(e.row,e.col)&&this.track.isFree(e.row+1,e.col)?ks:null}goRoundObstacles(e,i,s){if(this.target==null)return j;if(e.type===F.Obstacle){if(e.y+e.height/2<this.host.y+this.host.height/2)return this.target.col<e.col?Cs:xs}else{if(this.target.col<e.col&&this.track.getBlock(e.row,e.col-1).type===F.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===F.Empty?Is:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:-1,y:this.moveAhead(e,i,s)};if(e.col<this.target.col&&this.track.getBlock(e.row,e.col+1).type===F.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===F.Empty?Ms:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:1,y:this.moveAhead(e,i,s)}}return null}moveOnTrack(e,i,s){if(this.target==null)return j;let a=0;i.type===F.Empty&&this.host.y+this.host.height/2<e.y?a=Xe:a=this.moveAhead(e,i,s),a<0&&i.type===F.Empty&&this.host.y+this.host.height/2<e.y+e.height/2&&(a=0);let n=0;const o=this.host.x<this.target.x+this.horizontalMargin,h=this.target.x+this.target.width-this.horizontalMargin<=this.host.x+this.host.width;return o&&this.track.getBlock(e.row,e.col+1).type===F.Free?n=1:h&&this.track.getBlock(e.row,e.col-1).type===F.Free&&(n=-1),{x:n,y:a}}moveAhead(e,i,s){return i.type!==F.Free&&this.host.velocity.y<-.25*1.5?(pe<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),Xe):this.host.velocity.y<-.25*3.5&&!this.isClearAhead(e)?(pe<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),0):pe<s-this.lastSlowdownTime?he:0}getCurrentBlock(){const e=es(this.host);let i=this.track.getBlockAt(e);return(i.type===F.Empty||i.type===F.Raft)&&i.y+i.height-this.host.height<e.y&&(i=this.track.getBlock(i.row-1,i.col)),i.type===F.Empty&&(i.x+i.width-this.host.width<e.x?i=this.track.getBlock(i.row,i.col+1):e.x<i.x+this.host.width&&(i=this.track.getBlock(i.row,i.col-1))),i}hasReached(e){return this.host.y+this.host.height<e.y+e.height}findNextTarget(e){const i=this.findNearestBlock(e.row+1,e.col);if(i==null||i.col!==e.col)return i;const s=this.findNearestBlock(i.row+1,i.col);if(s==null)return i;if(s.col<i.col){const a=this.track.getBlock(i.row,i.col-1);if(a.type===F.Free)return a}if(i.col<s.col){const a=this.track.getBlock(i.row,i.col+1);if(a.type===F.Free)return a}return i}isClearAhead(e){for(let i=e.row+1;i<=e.row+Rs;i++)if(this.track.getBlock(i,e.col).type!==F.Free)return!1;return!0}findNearestBlock(e,i){for(let s=0;s<Tt-1;s++){const a=(dt()<.5?-1:1)*s,n=i+a,o=this.track.getBlock(e,n);if(o.type===F.Free||o.type===F.Raft)return this.horizontalMargin=dt(.2)*u,this.track.getBlock(e,n)}return null}}const J=(t,e)=>2*Math.abs(e/t-Math.floor(e/t+.5));var lt=(t=>(t[t.Stand=0]="Stand",t[t.Walk=1]="Walk",t[t.Fall=2]="Fall",t[t.Celebrate=3]="Celebrate",t))(lt||{}),K=(t=>(t[t.Right=0]="Right",t[t.Forward=1]="Forward",t[t.Backward=2]="Backward",t[t.ForwardRight=3]="ForwardRight",t[t.BackwardRight=4]="BackwardRight",t))(K||{});const Ps="rgb(200,150,150)",As="rgb(230,230,230)",Os="rgb(30,0,0)",Fs="rgb(170,120,120)",Xt="rgb(140,140,140)",we="rgb(120,120,120)",Yt="rgb(140,140,220)",be="rgb(120,120,200)",Ts="rgba(0, 0, 0, 0.2";function qt(t,e,i,s,a,n,o,h,c){let d=0,w=0,p=0,f=0,m=0,S=0;const k=n===3||n===4,P=n===0;switch(o){case 1:d=P?600:k?400:300,S=ue(J(d/2,a/2))*.02*s,w=m=-Math.PI/6+Z(J(d,a))*(Math.PI/3),p=f=-Math.PI/6+Z(J(d,a+d/2))*(Math.PI/3);break;case 3:{d=1500,S=ue(J(d/2,a/2))*.15*s;const I=J(d,a);w=Z(I)*Math.PI*(1/8),p=-Z(I)*Math.PI*(3/8),m=Math.PI*(1/8)-Z(I)*Math.PI*(9/8),f=Math.PI*(1/8)-Z(I)*Math.PI*(10/8);break}case 2:d=3200,S=ue(J(d/2,a))*.02*s,w=-Math.PI*(3/8)+Z(J(d,a))*(Math.PI*(3/4)),p=-Math.PI*(3/8)+Z(J(d,a+d/2))*(Math.PI*(3/4)),f=-Math.PI*(8/8)+Z(J(d,a+d/2))*(Math.PI/4),m=-Math.PI*(8/8)+Z(J(d,a))*(Math.PI/4);break}t.save(),Ds(t,.5*i,s,i*.4-S/2),t.translate(0,-S);const M=.3*s,E=.25*s,C=.2*i,L=.1*i;switch(t.fillStyle=e,t.lineWidth=C,t.lineJoin="round",t.lineCap="round",e==="eliminated"&&(t.globalAlpha=.7),n){case 0:{const I=.5*i,O=.4*s,W=.5*i,B=.7*s;Ke(t,be,I,O,L,M,f),ze(t,we,W,B,C,E,w),ze(t,Xt,W,B,C,E,p),Zt(n,t,i,s,e,h,c),Jt(n,t,i,s,e,h,c),Ke(t,Yt,I,O,L,M,m)}break;case 1:case 2:{Ct(t,Xt,.35*i,.7*s,C,E,-1,w,0),Ct(t,Xt,.7*i,.7*s,C,E,1,p,0),Zt(n,t,i,s,e,h,c),Mt(t,Yt,.25*i,.35*s,L,M,-1,f),Mt(t,Yt,.75*i,.35*s,L,M,1,m),Jt(n,t,i,s,e,h,c);break}case 3:{Ct(t,we,.35*i,.7*s,C,E,-1,w,p/4),Ct(t,Xt,.65*i,.7*s,C,E,1,p,p/4),Mt(t,be,.25*i,.35*s,L,M,-1,m,m/2),Zt(n,t,i,s,e,h,c),Jt(n,t,i,s,e,h,c),Mt(t,Yt,.75*i,.35*s,L,M,1,f,m/2);break}case 4:{Ct(t,we,.65*i,.7*s,C,E,1,p,p/4),Ct(t,Xt,.35*i,.7*s,C,E,-1,w,p/4),Mt(t,be,.75*i,.35*s,L,M,1,m,m/2),Zt(n,t,i,s,e,h,c),Jt(n,t,i,s,e,h,c),Mt(t,Yt,.25*i,.35*s,L,M,-1,f,m/2);break}}t.restore()}function Ds(t,e,i,s){t.save(),t.fillStyle=Ts,t.translate(e,i),t.beginPath(),t.arc(0,0,Math.max(0,s),0,2*Math.PI),t.fill(),t.restore()}const Et={};function ct(t,e,i){const s=Ye(t),a=Ye(e),n=Math.round((1-i)*s.r+i*a.r),o=Math.round((1-i)*s.g+i*a.g),h=Math.round((1-i)*s.b+i*a.b);return`rgb(${n}, ${o}, ${h})`}function Ye(t){if(t==="eliminated")return{r:128,g:128,b:128};const e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t);return e?{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}:{r:0,g:0,b:0}}const Ws=navigator.userAgent.toLowerCase().includes("firefox");function bi(t,e,i,s,a,n){const o=`${i}-${e}-${s}-${a}`;if(n||!Et[o]){const h=t.createRadialGradient(s,a,a/8,s,a,s);if(i==="TORSO"?(h.addColorStop(0,ct(e,"rgb(255, 255, 255)",.1)),h.addColorStop(.2,ct(e,"rgb(255, 255, 255)",.1)),h.addColorStop(.5,ct(e,"rgb(0, 0, 0)",.1)),h.addColorStop(1,ct(e,"rgb(0, 0, 0)",.3))):i==="HEAD"&&(h.addColorStop(0,ct(e,"rgb(0, 0, 0)",.3)),h.addColorStop(.5,ct(e,"rgb(0, 0, 0)",.1)),h.addColorStop(.8,ct(e,"rgb(255, 255, 255)",.1)),h.addColorStop(1,ct(e,"rgb(255, 255, 255)",.1))),Ws){if(n)return Ve(t,h,s*2,a*2);Et[o]=Ve(t,h,s*2,a*4)}else{if(n)return h;Et[o]=h}}return Et[o]}function Hs(){for(const t in Et)delete Et[t]}function Ve(t,e,i,s){const a=document.createElement("canvas");a.width=i,a.height=s;const n=a.getContext("2d");if(n)return n.fillStyle=e,n.fillRect(0,0,i,s),t.createPattern(a,"no-repeat")}function vi(t,e,i,s,a,n){e&&(t.save(),t.translate(i,s),t.scale(a/80,n/80),t.fillStyle=e,t.fill(),t.restore())}function Zt(t,e,i,s,a,n,o=!1){const h=.2*i,c=t===0?.5*i:.45*i,d=.25*s,w=t===0?.28*i:.5*(i-c),p=.06*s;e.beginPath(),e.roundRect(w,p,c,d,h);const f=bi(e,a,"HEAD",c,d,o);e.fillStyle=f||"black",e.fill(),vi(e,n,w,p,c,d),Ls(e,t,i,c,d,h)}function Jt(t,e,i,s,a,n,o=!1){const h=.4*s,c=.2*i,d=t===0?.5*i:.6*i,w=t===1||t===2?.2*i:.5*(i-d),p=.3*s;e.beginPath(),e.roundRect(w,p,d,h,c);const f=bi(e,a,"TORSO",d,h,o);e.fillStyle=f||"black",e.fill(),vi(e,n,w,p,d,h)}function Ke(t,e,i,s,a,n,o){t.save(),t.strokeStyle=e,t.lineWidth=a,t.translate(i,s),t.rotate(o),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-n/4,n/2,0,n),t.stroke(),t.restore()}function ze(t,e,i,s,a,n,o){t.save(),t.strokeStyle=e,t.lineWidth=a,t.translate(i,s),t.rotate(o),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-n/8,n/2,0,n),t.stroke(),t.restore()}function Mt(t,e,i,s,a,n,o,h,c=0){t.save(),t.strokeStyle=e,t.lineWidth=a,t.translate(i,s),t.rotate(-o*.07*Math.PI),t.rotate(c),t.scale(1,Math.cos(h+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(o*n/4,n/2,0,n),t.stroke(),t.restore()}function Ct(t,e,i,s,a,n,o,h,c){t.save(),t.strokeStyle=e,t.lineWidth=a,t.translate(i,s),t.rotate(c),t.scale(1,Math.cos(h+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(o*n/8,n/2,0,n),t.stroke(),t.restore()}function Ls(t,e,i,s,a,n){if(e!==2&&e!==4)return;const o=.15*i,h=.6*n,c=s-o,d=a-o*1.75,w=a-d,p=e===2?(i-c)/2:(i-c)/2+(s-c)/2;t.save(),t.translate(p,w),t.shadowColor="rgba(0, 0, 0, 0.5)",t.fillStyle=Ps,t.shadowOffsetY=-d/10;const f=0,m=0;t.beginPath(),t.roundRect(f,m,c,d,h),t.fill(),t.closePath(),t.shadowOffsetY=0;const S=.06*c,k=c/4,P=d/3,M=f+k,E=f+c-k,C=m+P;t.fillStyle=As,t.beginPath(),t.arc(M,C,S,0,Math.PI*2),t.arc(E,C,S,0,Math.PI*2),t.fill(),t.closePath();const L=.025*c,I=.01*c,O=.01*d;t.fillStyle=Os,t.beginPath(),t.arc(M+I,C+O,L,0,Math.PI*2),t.arc(E+I,C+O,L,0,Math.PI*2),t.fill(),t.closePath();const W=.15*c,B=.2*d,A=f+(c-W)/1.75,Y=m+(d-B)/1.5;t.fillStyle=Fs,t.beginPath(),t.moveTo(A,Y),t.lineTo(A+W/2,Y+B),t.lineTo(A-W/2,Y+B),t.closePath(),t.fill(),t.restore()}const Ns=[1,,82,.01,.08,.2,,2.6,,,,,,.1,,,,.61,.02,,-1686],Bs=[2,,12,,,.008,,1.2,23,-7,,,.05,.4,,,.15,.82,.03,.28],_s=[1,,85,.08,.1,.01,1,4,,-11,1,.07,,.1,101,,.05,.68,.4,.12,1],Gs=[.01,,523.2511,.1,3,3,4,0,,,2250,,.04,,10,.01,,.82,1,,30],Xs=[2,,185,,,,3,1.6,-7,,,,,,,.2,.19,.1,,.38,985],Ys=[1.5,,688,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.03,.11,-818],Vs=[1.5,,1376,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.8,.11,-818],Ks={songData:[{i:[0,0,180,0,0,0,180,0,0,160,158,158,158,0,0,0,0,51,2,1,2,54,239,1,32,88,1,157,2],p:[1,2],c:[{n:[111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137],f:[]},{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:1},zs={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[4,1,2,3,2,1,2,3],c:[{n:[134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134,137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]},{n:[137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137,134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]}]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[27,1,27,2,27,1,27,2],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,1,1,1,1,1,1,2],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[],c:[]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,,,,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:7,numChannels:8},Us={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[],c:[]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[25,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,3,26,26,26],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,135],f:[]}]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[5,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,5,,5],c:[{n:[129],f:[]},{n:[134,,,,,,,,,,,,,,,,137],f:[]},{n:[137,,,,,,,,,,,,,,,,134],f:[]},{n:[141],f:[]},{n:[113],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,1,,,,1,,,,1,,,,1,,,,1,,,,1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,1,1,1],c:[{n:[,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1,,,,1,,,,1,,,,1,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:23,numChannels:8},yt=(t,...e)=>js(t,qs(t,...e)),z=44100,$s=new(window.AudioContext||window.webkitAudioContext),ve=$s,js=(t,...e)=>{let i=ve.createBuffer(e.length,e[0].length,z),s=ve.createBufferSource();return e.forEach((a,n)=>i.getChannelData(n).set(a)),s.buffer=i,s.connect(ve.destination),s.start(),s},qs=(t,e=.1,i=.05,s=220,a=0,n=0,o=.1,h=0,c=1,d=0,w=0,p=0,f=0,m=0,S=0,k=0,P=0,M=0,E=1,C=0,L=0,I=0)=>{let O=Math.PI*2,W=Yi=>Yi<0?-1:1,B=d*=500*O/z/z,A=s*=(1+i*2*Math.random()-i)*O/z,Y=[],_=0,gt=0,T=0,q=1,Q=0,U=0,N=0,X,$,St=2,ut=O*Math.abs(I)*2/z,Lt=Math.cos(ut),Nt=Math.sin(ut)/2/St,kt=1+Nt,fe=-2*Lt/kt,Bt=(1-Nt)/kt,Qt=(1+W(I)*Lt)/2/kt,de=-(W(I)+Lt)/kt,ge=Qt,_t=0,It=0,Gt=0,Le=0;for(a=a*z+9,C*=z,n*=z,o*=z,M*=z,w*=500*O/z**3,k*=O/z,p*=O/z,f*=z,m=m*z|0,e*=t<0?0:t,$=a+C+n+o+M|0;T<$;Y[T++]=N*(t<0?0:t))++U%(P*100|0)||(N=h?h>1?h>2?h>3?Math.sin(_**3):Math.max(Math.min(Math.tan(_),1),-1):1-(2*_/O%2+2)%2:1-4*Math.abs(Math.round(_/O)-_/O):Math.sin(_),N=(m?1-L+L*Math.sin(O*T/m):1)*W(N)*Math.abs(N)**c*(T<a?T/a:T<a+C?1-(T-a)/C*(1-E):T<a+C+n?E:T<$-M?($-T-M)/o*E:0),N=M?N/2+(M>T?0:(T<$-M?1:($-T)/M)*Y[T-M|0]/2/e):N,I&&(N=Le=ge*_t+de*(_t=It)+Qt*(It=N)-Bt*Gt-fe*(Gt=Le))),X=(s+=d+=w)*Math.cos(k*gt++),_+=X+X*S*Math.sin(T**5),q&&++q>f&&(s+=p,A+=p,q=0),m&&!(++Q%m)&&(s=A,d=B,q=q||1);return Y};function Qs(){var t=function(f){return Math.sin(f*6.283184)},e=function(f){return 2*(f%1)-1},i=function(f){return f%1<.5?1:-1},s=function(f){var m=f%1*4;return m<2?m-1:3-m},a=function(f){return .003959503758*2**((f-128)/12)},n=function(f,m,S){var k=o[f.i[0]],P=f.i[1],M=f.i[3]/32,E=o[f.i[4]],C=f.i[5],L=f.i[8]/32,I=f.i[9],O=f.i[10]*f.i[10]*4,W=f.i[11]*f.i[11]*4,B=f.i[12]*f.i[12]*4,A=1/B,Y=-f.i[13]/16,_=f.i[14],gt=S*2**(2-f.i[15]),T=new Int32Array(O+W+B),q=0,Q=0,U,N,X,$,St,ut;for(U=0,N=0;U<O+W+B;U++,N++)N>=0&&(_=_>>8|(_&255)<<4,N-=gt,St=a(m+(_&15)+f.i[2]-128),ut=a(m+(_&15)+f.i[6]-128)*(1+8e-4*f.i[7])),X=1,U<O?X=U/O:U>=O+W&&(X=(U-O-W)*A,X=(1-X)*3**(Y*X)),q+=St*X**M,$=k(q)*P,Q+=ut*X**L,$+=E(Q)*C,I&&($+=(2*Math.random()-1)*I),T[U]=80*$*X|0;return T},o=[t,i,e,s],h,c,d,w,p;this.init=function(f){h=f,c=f.endPattern,d=0,w=f.rowLen*f.patternLen*(c+1)*2,p=new Int32Array(w)},this.generate=function(){var f,m,S,k,P,M,E,C,L,I,O,W,B=new Int32Array(w),A=h.songData[d],Y=h.rowLen,_=h.patternLen,gt=0,T=0,q,Q,U=!1,N=[];for(S=0;S<=c;++S)for(E=A.p[S],k=0;k<_;++k){var X=E?A.c[E-1].f[k]:0;X&&(A.i[X-1]=A.c[E-1].f[k+_]||0,X<17&&(N=[]));var $=o[A.i[16]],St=A.i[17]/512,ut=2**(A.i[18]-9)/Y,Lt=A.i[19],Nt=A.i[20],kt=A.i[21]*43.23529*3.141592/44100,fe=1-A.i[22]/255,Bt=A.i[23]*1e-5,Qt=A.i[24]/32,de=A.i[25]/512,ge=6.283184*2**(A.i[26]-9)/Y,_t=A.i[27]/255,It=A.i[28]*Y&-2;for(O=(S*_+k)*Y,P=0;P<4;++P)if(M=E?A.c[E-1].n[k+P*_]:0,M){N[M]||(N[M]=n(A,M,Y));var Gt=N[M];for(m=0,f=O*2;m<Gt.length;m++,f+=2)B[f]+=Gt[m]}for(m=0;m<Y;m++)C=(O+m)*2,I=B[C],I||U?(W=kt,Lt&&(W*=$(ut*C)*St+.5),W=1.5*Math.sin(W),gt+=W*T,q=fe*(I-T)-gt,T+=W*q,I=Nt==3?T:Nt==1?q:gt,Bt&&(I*=Bt,I=I<1?I>-1?t(I*.25):-1:1,I/=Bt),I*=Qt,U=I*I>1e-5,L=Math.sin(ge*C)*de+.5,Q=I*(1-L),I*=L):Q=0,C>=It&&(Q+=B[C-It+1]*_t,I+=B[C-It]*_t),B[C]=Q|0,B[C+1]=I|0,p[C]+=Q|0,p[C+1]+=I|0}return d++,d/h.numChannels},this.createAudioBuffer=function(f){for(var m=f.createBuffer(2,w/2,44100),S=0;S<2;S++)for(var k=m.getChannelData(S),P=S;P<w;P+=2)k[P>>1]=p[P]/65536;return m},this.createWave=function(){var f=44,m=f+w*2-8,S=m-36,k=new Uint8Array(f+w*2);k.set([82,73,70,70,m&255,m>>8&255,m>>16&255,m>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,S&255,S>>8&255,S>>16&255,S>>24&255]);for(var P=0,M=f;P<w;++P){var E=p[P];E=E<-32767?-32767:E>32767?32767:E,k[M++]=E&255,k[M++]=E>>8&255}return k},this.getData=function(f,m){for(var S=2*Math.floor(f*44100),k=new Array(m),P=0;P<2*m;P+=1){var M=S+P;k[P]=f>0&&M<p.length?p[M]/32768:0}return k}}const Si="start",ki="race",Ii="bounce",Mi="hit",Ci="teleport",xi="keyboard",Ri="finished",Ei="gameover",Pi="restart",xe="count",Ai="go",tt=document.createElement("audio"),xt=document.createElement("audio"),Re=document.createElement("audio"),Se=(t,e,i)=>new Promise(s=>{var a=new Qs;a.init(e);var n=!1;setInterval(function(){if(!n&&(n=a.generate()>=1,n)){var o=a.createWave();t.src=URL.createObjectURL(new Blob([o],{type:"audio/wav"})),t.loop=i,s()}},0)}),Zs=()=>Promise.all([Se(tt,zs,!0),Se(xt,Us,!0),Se(Re,Ks,!1)]),Js=(t,e=0)=>{var i=t.volume;if(t.volume>e)var s=setInterval(function(){i=(parseFloat(i)-.1).toFixed(1),i>e?t.volume=i:(t.volume=e,e===0&&t.pause(),clearInterval(s))},100)},Ee=(t,e=1)=>{setTimeout(()=>{t.play();var i=t.volume;if(t.volume<e)var s=setInterval(function(){i=(parseFloat(i)+.1).toFixed(1),i<e?t.volume=i:(t.volume=e,clearInterval(s))},100)},200)},Ue=(t,e)=>{var i=t.volume,s=setInterval(function(){i=(parseFloat(i)-.1).toFixed(1),i>0?t.volume=i:(t.volume=0,t.pause(),clearInterval(s),setTimeout(()=>{Ee(e,1)},500))},100)},it=(t,e)=>{if(e!==0)switch(t){case ki:{xt.currentTime=0,Ue(tt,xt);break}case Ri:{yt(.04,...Gs),tt.currentTime=0,Ue(xt,tt);break}case Ei:{Re.volume=1,Re.play(),Js(xt);break}case Pi:{tt.currentTime=0,Ee(tt);break}case Si:{tt.volume=0,tt.currentTime=0,xt.currentTime=0;var i=tt.play();i!==void 0&&i.then(()=>{}).catch(s=>{console.log("No for autoplay!"+s)}),Ee(tt);break}case Ii:{yt(e,...Ns);break}case Mi:{yt(e,...Xs);break}case xi:{yt(.5,...Bs);break}case Ci:{yt(e,..._s);break}case xe:{yt(.5,...Ys);break}case Ai:{yt(.5,...Vs);break}}};let Pe=1;const Oi=(t,e)=>{const i=t/e;let s=window.innerWidth,a=window.innerHeight;s/a>i?s=a*i:a=s/i,s>t&&(s=t,a=t/i),a>e&&(a=e,s=e*i),g.width=s,g.height=a;const n=window.innerWidth/s,o=window.innerHeight/a,h=Math.min(n,o);Pe=h,g.style.position="absolute",g.style.left=`${(window.innerWidth-s*h)/2}px`,g.style.top=`${(window.innerHeight-a*h)/2}px`,g.style.transform=`scale(${h})`,g.style.transformOrigin="top left"},Fi=(t,e)=>{const i=g.getBoundingClientRect();t.x=(e.clientX-i.left)/Pe,t.y=(e.clientY-i.top)/Pe},Ti=4;let Ae=0;const Di=[...Array(Ti)].map(()=>({x:0,y:0})),le="ontouchstart"in window,ta=()=>{le&&(window.oncontextmenu=t=>{t.preventDefault()},g.ontouchstart=t=>{t.preventDefault(),ke(t)},g.ontouchmove=t=>{t.preventDefault(),ke(t)},g.ontouchend=t=>{t.preventDefault(),ke(t)})},ke=t=>{Ae=Math.min(t.touches.length,Ti);for(let e=0;e<Ae;e++)Fi(Di[e],t.touches[e])},ea=t=>new Promise(e=>{const i=s=>{const a=s.touches[0];Fi({x:0,y:0},a),window.removeEventListener("touchstart",i),e()};window.addEventListener("touchstart",i)}),te=t=>{for(let e=0;e<Ae;e++)if(is(t,Di[e]))return!0;return!1};let ia=0;const wt={symbol:"◀",x:0,y:0,width:0,height:0},Pt={symbol:"▶",x:0,y:0,width:0,height:0},At={symbol:"▲",x:0,y:0,width:0,height:0},Ot={symbol:"▼",x:0,y:0,width:0,height:0},Oe={movement:{x:0,y:0}},sa=()=>{const t=ts(),e=t.ArrowLeft||t.KeyA||te(wt),i=t.ArrowRight||t.KeyD||te(Pt),s=t.ArrowUp||t.KeyW||te(At),a=t.ArrowDown||t.KeyS||te(Ot),n=e?-1:i?1:0,o=s?-1:a?1:0;n===0&&o===0?Oe.movement=j:Oe.movement=ht({x:n,y:o})},aa=()=>{Zi(),ta(),$e(),window.addEventListener("resize",$e,!1)},$e=()=>{const t=g.width*.01,e=g.height*.02,i=g.width*.1,s=g.height*.6,a=g.height-s*.65-2*e,n=i,o=s/3;wt.x=t,wt.y=a+o+e,wt.width=i,wt.height=s/3,Pt.x=i+2*t,Pt.y=a+o+e,Pt.width=i,Pt.height=s/3,At.x=g.width-n-t,At.y=a,At.width=n,At.height=o,Ot.x=g.width-n-t,Ot.y=a+o+e,Ot.width=n,Ot.height=o},Dt=async()=>{await(le?ea():Ji()),it(xi)},Ut=(t="continue",e=7.7)=>{const i=(le?"Tap the screen to ":"Press ENTER to ")+t;H(i+(ia++%60===0?"":"█"),D.Small,"Courier New",1,e,!0,0,i)},Wi=()=>{if(!le)return;r.save();const t=wt.width/2;r.font=t+"px Impact",r.fillStyle="rgba(200, 200, 200, 0.2)",ee(wt,t),ee(Pt,t),ee(At,t),ee(Ot,t),r.restore()},ee=(t,e)=>{r.strokeStyle="rgba(200, 200, 200, 0.2)",r.lineWidth=2,r.strokeRect(t.x,t.y,t.width,t.height),r.fillText(t.symbol,t.x+t.width/2-e/2,t.y+t.height/2+e*.25,e)},na=()=>Oe;function ra(t,e){t.translate(e/2,0),t.scale(-1,1),t.translate(-e/2,0)}const re=500,je=1e3,Hi=["rgb(255, 255, 0)","rgb(255, 0, 0)","rgb(0, 128, 0)","rgb(0, 0, 255)","rgb(255, 165, 0)","rgb(255, 99, 71)","rgb(255, 192, 203)","rgb(106, 90, 205)","rgb(238, 130, 238)","rgb(30, 144, 255)","rgb(0, 255, 255)","rgb(255, 0, 255)","rgb(144, 238, 144)","rgb(211, 211, 211)","rgb(64, 224, 208)","rgb(0, 191, 255)","rgb(173, 216, 230)","rgb(240, 128, 128)","rgb(0, 255, 127)","rgb(255, 0, 255)","rgb(220, 20, 60)","rgb(230, 230, 250)","rgb(255, 127, 80)","rgb(0, 128, 128)","rgb(75, 0, 130)","rgb(250, 128, 114)","rgb(127, 255, 0)","rgb(218, 165, 32)","rgb(255, 182, 193)","rgb(210, 105, 30)","rgb(205, 92, 92)","rgb(128, 128, 0)","rgb(255, 69, 0)","rgb(135, 206, 235)","rgb(72, 209, 204)","rgb(160, 82, 45)","rgb(0, 255, 0)","rgb(0, 0, 128)","rgb(245, 222, 179)","rgb(70, 130, 180)","rgb(255, 255, 255)"],He=Hi[0],Fe={width:2,height:2};class Ie{constructor(e,i,s=1+Math.random()*.6,a=1+Math.random()*.4){y(this,"ai");y(this,"rank",0);y(this,"finished",!1);y(this,"eliminated",!1);y(this,"timeOffset",dt(2e3));y(this,"direction",j);y(this,"latestDirection",{x:0,y:-1});y(this,"color");y(this,"x",0);y(this,"y",0);y(this,"width");y(this,"height");y(this,"velocity",j);y(this,"fallStartTime");y(this,"dropStartTime");y(this,"latestCheckpointIndex",0);this.ai=e===0||!i?null:new Es(this,i),this.color=Hi[e],this.width=Fe.width*s,this.height=Fe.height*a}get doesNotCollide(){return this.finished||this.eliminated||this.fallStartTime!=null}isVisible(e){return!(this.fallStartTime!=null&&re<e-this.fallStartTime)}setDirection(e){this.direction=e,ie(e)||(this.latestDirection=e)}getMovement(e){return this.ai?this.ai.getMovement(e):na().movement}move(){this.eliminated||this.finished?(this.direction=j,this.velocity=j):(this.x+=this.velocity.x,this.y+=this.velocity.y)}stop(){this.y+=this.velocity.y*8}drop(e,i){var s;this.x=i.x,this.y=i.y,this.direction=j,this.latestDirection={x:0,y:-1},this.velocity=j,this.fallStartTime=void 0,this.dropStartTime=e,(s=this.ai)==null||s.reset()}draw(e,i,s){const a=this.latestDirection.y!==0?this.latestDirection.x===0?this.latestDirection.y<0?K.Forward:K.Backward:this.latestDirection.y>0?K.BackwardRight:K.ForwardRight:K.Right;r.save();const n=this.height*3,o=n-this.height;if(r.translate(this.x,this.y-o),this.latestDirection.x<0&&ra(r,this.width),this.fallStartTime!=null){const c=Math.max(1-ye((e-this.fallStartTime)/re),0);r.translate(this.width/2,n/2),r.scale(c,c),r.translate(-this.width/2,-n/2),r.globalAlpha=ye(c)}else this.dropStartTime&&e-this.dropStartTime<je&&(r.globalAlpha=ye((e-this.dropStartTime)/je));const h=ie(this.direction)&&this.fallStartTime==null?0:e+this.timeOffset;qt(r,this.eliminated?"eliminated":this.color,this.width,n,h,this.finished?e%3600<1800?K.Backward:K.BackwardRight:a,this.getAnimation(),s),r.restore()}getAnimation(){return this.fallStartTime!=null?lt.Fall:ie(this.direction)?lt.Stand:lt.Walk}}const oa=.005,qe=2e3;class ha{constructor(e,i){y(this,"elements");y(this,"startY");y(this,"checkpoints");y(this,"specialElements");y(this,"finishY");y(this,"elementCount");y(this,"width");y(this,"height");this.elements=bs(e,i),this.elementCount=this.elements.length,this.specialElements=this.elements.filter(n=>n.surfaces.some(o=>ne(o)||Ce(o))),this.startY=i,this.finishY=this.startY-(this.elements.length-1)*b;const s=Math.min(...this.elements.map(n=>n.minX)),a=Math.max(...this.elements.map(n=>n.maxX));this.width=a-s,this.height=this.elements.length*b,this.checkpoints=this.elements.filter((n,o)=>n.type===nt.CheckPoint||o===0).map(n=>({y:n.y+n.height,element:n}))}update(e,i,s){for(let a=0;a<this.specialElements.length;a++){const n=this.specialElements[a];for(let o=0;o<n.surfaces.length;o++){const h=n.surfaces[o];if(ne(h))for(let c=0;c<s.length;c++){const d=s[c];h.y<=d.y&&d.y+d.height<h.y+h.height&&h.x<=d.x&&d.x+d.width<=h.x+h.width&&(d.velocity=ot(d.velocity,{x:0,y:-.002*h.force*i}))}if(Ce(h)){const c=h,d=n.y,w=n.y-b;c.yDirection===-1&&c.y<=w?(c.yDirection=0,c.dockStartTime=e):c.y<=w&&e-c.dockStartTime>qe?c.yDirection=1:c.yDirection===1&&d<=c.y?(c.yDirection=0,c.dockStartTime=e):d<=c.y&&e-c.dockStartTime>qe&&(c.yDirection=-1);const p=c.yDirection*oa*i;c.y+=p;for(let f=0;f<s.length;f++){const m=s[f];ae(c,m)&&(m.y+=p)}}}}}get(e){return this.elements[e]}isFree(e,i){if(e<0||this.elements.length<=e)return!1;const s=this.elements[e];return s.surfaces.length===0?this.elements[Math.max(e-1,0)].isFree(i,s.y):s.isFree(i)}getBlock(e,i){return e<0||this.elements.length<=e?wi(e,i,this.startY-e*b):this.elements[e].getBlock(i)}getBlockAt(e){const i=Math.floor(Math.max(this.startY-e.y,0)/b),s=Math.min(i,this.elements.length-1),a=Math.floor((e.x-v)/u);return this.getBlock(s,a)}getCheckpoint(e){return this.checkpoints[e].element}findLatestCheckpoint(e){for(let i=this.checkpoints.length-1;i>=0;i--){const s=this.checkpoints[i];if(e<s.y-s.element.height*.15)return i}return 0}getBetween(e,i){const s=Math.ceil(Math.max(this.startY-e,0)/b),a=Math.floor(Math.max(this.startY-i,0)/b);return{minI:Math.max(a-1,0),maxI:Math.min(s,this.elements.length)-1}}isOnPlatform(e,i){const{minI:s,maxI:a}=e;for(let n=a;n>=s;n--){const h=this.get(n).surfaces;for(let c=0;c<h.length;c++){const d=h[c];if(ae(i,d))return!0}}return!1}}const la=70,Qe=400,Ze=5,Je=40,ca=3*pi,ti=1e3;var Te=(t=>(t[t.RUNNING=0]="RUNNING",t[t.GAME_OVER=1]="GAME_OVER",t[t.FINISHED=2]="FINISHED",t))(Te||{});function fa(t){for(let e=t.length-1;e>=0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}class ei{constructor(e,i,s,a,n){y(this,"camera",new ns(this,g));y(this,"platePattern");y(this,"track");y(this,"characters",[]);y(this,"charactersCount",40);y(this,"player",new Ie(0,void 0,0,0));y(this,"x");y(this,"y");y(this,"width");y(this,"height");y(this,"state",0);this.platePattern=n,this.track=new ha(e,Qe),this.x=0-this.track.width/2-Ze,this.y=Qe-this.track.height-Je,this.width=this.track.width+2*Ze,this.height=this.track.height+2*Je;const o=this.track.get(0),h=15,c=o.width/h,d=Fe.height*1.9,w=c*.3;this.player=new Ie(0,this.track,i,s),this.characters.push(this.player);for(let f=1;f<(a?a.length:this.charactersCount);f++){if(a&&a[f].eliminated)continue;const m=new Ie(f,this.track);this.characters.push(m)}const p=[this.player,...this.characters];fa(p);for(let f=0;f<p.length;f++){const m=p[f],S=Math.floor(f/h),k=f%h,P={x:o.minX+w+k*c,y:o.y+S*d};m.x=P.x,m.y=P.y}this.camera.follow(this.player),this.camera.visibleAreaHeight=la,this.camera.yAdjust=-.25,this.camera.update(0)}update(e,i){this.camera.update(e),this.track.update(e,i,this.characters),this.calculateMovement(e,i),this.checkCollisions();for(let s=0;s<this.characters.length;s++)this.characters[s].move();this.updateCharacterRanks(),this.checkGameState()}playWithVolumeByDistance(e,i){const s=Math.abs(i-this.player.y);it(e,Math.max(0,Math.min(1,1-s/ca)))}calculateMovement(e,i){for(let s=0;s<this.characters.length;s++){const a=this.characters[s],n=this.track.getBetween(a.y,a.y+a.height);let o=j;a.fallStartTime!=null?e-a.fallStartTime>re+ti&&this.dropToLatestCheckpoint(e,a):a.fallStartTime==null&&!this.track.isOnPlatform(n,a)?(a.fallStartTime=e,a===this.player&&setTimeout(()=>{const h=this.track.getCheckpoint(this.player.latestCheckpointIndex),c=h.y+h.height/2;this.camera.setTransition({startY:this.player.y,endY:c,startTime:e,duration:ti+500})},re)):(o=a.getMovement(e),a.setDirection(o),a.velocity=gs(a,o,i))}}checkCollisions(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e];if(!i.doesNotCollide)for(let s=e+1;s<this.characters.length;s++){const a=this.characters[s];a.doesNotCollide||ys(i,a)&&(!i.ai||Ht(i.velocity)>.3)&&this.playWithVolumeByDistance(Mi,i.y)}}for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.getBetween(i.y,i.y+i.height),{minI:a,maxI:n}=s;for(let o=a;o<=n;o++){const h=this.track.get(o);for(let c=0;c<h.objects.length;c++){const d=h.objects[c];us(i,d)&&this.playWithVolumeByDistance(Ii,d.y)}}}}renderText(e,i,s,a){const n=r.measureText(e),o=i+(a-n.width)/2;r.fillText(e,o,s)}updateCharacterRanks(){const e=this.characters.filter(a=>a.finished),i=this.characters.filter(a=>!a.finished);e.sort((a,n)=>a.rank-n.rank),i.sort((a,n)=>a.y+a.height/2-(n.y+n.height/2)),[...e,...i].forEach((a,n)=>{a.rank=n+1})}checkGameState(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.findLatestCheckpoint(i.y),a=this.track.getBetween(i.y,i.y+i.height);if(!(i.fallStartTime!=null||!this.track.isOnPlatform(a,i))){if(s>i.latestCheckpointIndex&&(i.latestCheckpointIndex=s,i.rank===13)){i.eliminated=!0,i.stop(),i.ai||(this.state=1);continue}if(i.y+i.height<this.track.finishY&&(i.rank===13?(i.eliminated=!0,i.stop(),i.ai||(this.state=1)):(i.finished=!0,i.stop()),!i.ai||i.rank==this.characters.length-13)){let n=this.characters.filter(o=>o.eliminated).length;for(let o=0;o<this.characters.length;o++)if(this.characters[o].rank>this.characters.length-13)if(n<13)this.characters[o].eliminated||(this.characters[o].eliminated=!0,n++);else break;this.characters[0].eliminated?this.state=1:this.state=2}}}}dropToLatestCheckpoint(e,i){const s=this.track.getCheckpoint(i.latestCheckpointIndex),a={x:ms(s.minX+u,s.maxX-u),y:s.y+s.height/2,width:i.width,height:i.height};if(!this.characters.some(n=>ae(n,a))){if(i.rank===13){i.eliminated=!0,i.stop(),i.ai||(this.state=1);return}i.drop(e,a),this.playWithVolumeByDistance(Ci,i.y),i===this.player&&this.camera.follow(i)}}drawCross(e,i,s,a="red"){r.strokeStyle=a,r.lineWidth=s/4,r.beginPath(),r.moveTo(e-s/2,i-s/2),r.lineTo(e+s/2,i+s/2),r.moveTo(e+s/2,i-s/2),r.lineTo(e-s/2,i+s/2),r.stroke()}draw(e,i){r.save(),r.translate(g.width/2,g.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y);const s=[...this.characters];this.drawTrack(s),this.drawObjects(e,i,s),r.restore(),this.drawGradient(),this.state===0&&(r.save(),r.translate(g.width/2,g.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y),this.drawStatusOfCharacters(e),this.drawTopStatusTexts(),r.restore())}drawTrack(e){r.save();const i=this.camera.getViewArea(),{minI:s,maxI:a}=this.track.getBetween(i.y,i.y+i.height);for(let n=a;n>=s;n--){const o=this.track.get(n),h=o.surfaces;r.fillStyle=o.color,r.shadowColor=o.color.replace("rgb(","rgba(").replace(")",",0.3)"),r.shadowOffsetY=o.height*(o.type===nt.Raft?2:6),o.type===nt.Raft&&(r.globalAlpha=.5);for(let c=0;c<h.length;c++){const d=h[c];this.drawSurface(o,d)}r.globalAlpha=1,e.push(...o.objects)}r.restore()}drawSurface(e,i){if(r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=.1,e.type!==nt.Raft&&r.strokeRect(i.x,i.y+.1,i.width,i.height),r.save(),ne(i)){const s=i.force;r.fillStyle=`rgba(${220+s*50}, ${80+s*50}, ${60+s*50}, ${1-s})`}if(r.fillRect(i.x,i.y,i.width,i.height),r.restore(),e.type===nt.Raft)r.strokeRect(i.x,i.y,i.width,i.height);else if(ne(i)){r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/(e.width/10);for(let a=1;a<=i.width/9-1;a++)r.fillText("⇪",i.x+a*s,i.y+i.height/2)}else if(e.type===nt.CheckPoint||e.type===nt.Finish){r.fillStyle="rgba(255, 255, 255, 0.2)",r.fillRect(i.x,i.y+i.height-4,i.width,4),r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/10;for(let a=1;a<=i.width/9-1;a++)r.fillText(e.type===nt.Finish?"✪":"☂",i.x+a*s,i.y+i.height/2.4)}this.platePattern&&(r.fillStyle=this.platePattern,r.fillRect(i.x,i.y,i.width,i.height),r.fillStyle=e.color)}drawObjects(e,i,s){s.sort((a,n)=>a.y+a.height/2-(n.y+n.height/2));for(let a=0;a<s.length;a++)s[a].draw(e,i)}drawGradient(){const e=r.createRadialGradient(g.width/2,g.height/2,0,g.width/2,g.height/2,g.width/1.5);e.addColorStop(1,"rgba(0, 0, 0, 0)"),e.addColorStop(.8,"rgba(0, 0, 0, 0)"),e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),r.fillStyle=e,r.fillRect(0,0,g.width,g.height);const i=r.createLinearGradient(0,0,0,g.height);i.addColorStop(0,"rgba(0, 0, 0, 1)"),i.addColorStop(.2,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),r.fillStyle=i,r.fillRect(0,0,g.width,g.height)}drawStatusOfCharacters(e){this.characters.forEach(i=>{if(i.isVisible(e)){const s=`${i.rank}`;r.fillStyle=i.rank===13?"red":i.eliminated?"crimson":i.rank>this.characters.length-13?"orange":i.rank===1?"lightgreen":i.ai?"white":"yellow",r.font=i.ai?i.eliminated||i.rank===13?"1.2px Sans-serif":"1px Sans-serif":"1.4px Sans-serif",i.ai||(r.save(),r.font="4.0px Sans-serif",this.renderText("▲",i.x,i.y-i.height*3.25,i.width),r.restore()),i.eliminated&&this.drawCross(i.x-.25,i.y-i.height*2.7,1),this.renderText(i.eliminated?"13":s,i.x,i.y-i.height*2.5,i.width)}})}drawTopStatusTexts(){const e=this.characters.filter(s=>s.eliminated).length.toString(),i=this.characters.filter(s=>s.finished).length.toString();r.font="4px Impact",r.fillStyle=this.player.rank===13?"red":this.player.eliminated?"crimson":this.player.rank>this.characters.length-13?"orange":this.player.rank===1?"lightgreen":"yellow",r.fillText("▲ "+this.player.rank+" / "+this.characters.length,-42,this.camera.y-30),r.fillStyle="green",r.fillText("✪ "+i+" / "+(this.characters.length-13)+" QUALIFIED",-15,this.camera.y-30),r.fillStyle="red",this.drawCross(28,this.camera.y-31.5,3),r.fillText(e+" / 13",32,this.camera.y-30)}}const ii=[l.FullWidthWithObstacles,l.FullWidth,l.FullWidth,l.FullWidth],si=[l.Basic,l.SlopeEmptyPassage,l.SlopeEmptyPassage,l.DualPassage,l.Basic,l.RightPassage,l.RightPassage,l.Basic,l.Basic,l.Raft,l.Chasm,l.FullWidth],da=[l.BasicSteepSlope,l.BasicSlope,l.FullWidthWithObstacles,l.FullWidthWithMoreObstacles,l.FullWidthWithObstacles,l.DualPassage,l.DualPassage,l.DualPassage,l.FullWidth];function ga(){const t=dt(1);return[l.Checkpoint,...t<.5?ii:si,l.Checkpoint,...t<.5?si:ii,l.Checkpoint,...da,l.Finish]}const ai=[l.FullWidth,l.BasicSteepSlope,l.BasicSlope,l.BasicSlope,l.Basic,l.Basic,l.Basic,l.Narrow,l.VeryNarrow,l.VeryNarrow,l.Basic,l.FullWidthWithObstacles,l.SlopeObstacleSlope,l.PassageEmptySlope,l.PassageEmptySlope,l.DualPassage,l.DualPassage,l.FullWidth,l.FullWidthWithObstaclesOnRight,l.FullWidthWithObstaclesOnRight2,l.FullWidthWithObstaclesOnRight,l.FullWidth,l.Raft,l.Chasm],ni=[l.FullWidth,l.VeryNarrow,l.FullWidth,l.BasicSteepSlope,l.BasicSlope,l.BasicSlope,l.Basic,l.Basic,l.Basic,l.Basic,l.TwoRafts,l.Chasm];function ua(){const t=dt(1);return[l.Checkpoint,...t<.5?ai:ni,l.Checkpoint,...t<.5?ni:ai,l.Finish]}const ri=[l.FullWidth,l.Basic,l.Narrow,l.VeryNarrow,l.Basic,l.SlopeEmptySlope,l.SlopeEmptySlope,l.SlopeEmptySlope,l.DualPassage,l.DualPassage,l.Basic,l.FullWidthWithObstacles,l.VeryNarrow,l.Basic],oi=[l.FullWidth,l.SlopeEmptySlope,l.PassageEmptySlope,l.PassageEmptySlope,l.DualPassage,l.SlopeEmptyPassage,l.DualPassageExt,l.TriplePassage,l.TriplePassage,l.TriplePassage,l.FullWidth],hi=[l.FullWidthWithObstacles,l.FullWidthWithMoreObstacles,l.FullWidth,l.TwoRafts,l.Chasm,l.Basic,l.FullWidth],li=[l.BasicSteepSlope,l.BasicSlope,l.BasicSlope,l.Basic,l.Basic,l.Basic,l.DualPassage,l.DualPassageExt,l.TriplePassage,l.TriplePassage,l.DualPassageExt,l.PassageEmptySlope,l.PassageEmptySlope,l.Basic,l.Basic,l.Narrow,l.VeryNarrow,l.FullWidth,l.RightPassage,l.FullWidth,l.TwoRafts,l.Chasm];function ya(){const t=dt(1);return[l.Checkpoint,...t<.5?ri:oi,l.Checkpoint,...t<.5?oi:ri,l.Checkpoint,...t<.5?hi:li,l.Checkpoint,...t<.5?li:hi,l.Finish]}const ma="2025-04-30",pa="Director's cut ("+ma+")",De=1e3/60,wa=De*5;let ci=0,$t=0,bt=1+Math.random()*.6,vt=1+Math.random()*.3,Kt=1,V,G=0,ce=0,Li=0;const ba=5e3;let R=0,Ni=0;const oe=$i(),fi=ji();let pt=0;const st=async t=>{switch(ce=t,G=1280*2,t){case 2:break;case 5:if(pt=0,$t>1&&!V.player.eliminated){const e=$t===3?ya():ua();V=new ei(e,bt,vt,V.characters,fi)}else V=new ei(ga(),bt,vt,void 0,fi);$t++,R=G,Ni=Li,it(ki);break;case 7:R=1,it(Ei),bt=1+Math.random()*.6,vt=1+Math.random()*.3,await Dt(),it(Pi),We();break;case 8:R=1,it(Ri),V.characters.length>14?(await yi(2500),await Dt(),st(5)):(await Dt(),Hs(),We());break;case 6:Wi();break}},Bi=t=>{requestAnimationFrame(Bi);const e=t-ci;if(e>=De){const i=Math.min(e,wa);ci=t-e%De,va(t,i),ka(t,i)}},va=(t,e)=>{switch(ce){case 6:{sa(),V.update(t,e),V.state===Te.GAME_OVER?st(7):V.state===Te.FINISHED&&st(8);break}case 5:{pt===2&&R<G/4?(it(Ai),pt++):(pt===1&&R<G/2||pt===0&&R<G)&&(it(xe),pt++);break}}};let se=0;const di="LOADING...",Sa=()=>{const t=se<10?di.substring(0,se):"LOADING...";H(t+(se++%60===0?"":"█"),D.Small,"Courier New",1,7.7,!0,0,di)},ka=(t,e)=>{switch(Li=t,r.save(),r.fillStyle="rgb(0, 0, 20)",r.fillRect(0,0,g.width,g.height),V==null||V.draw(t,e),r.restore(),r.save(),ce){case 0:{Sa(),se++,gi(),at(!1);break}case 1:{Ia(!0),Ut("start");break}case 2:{Me(t++,!1,0),mt(),at(!0);break}case 3:{Me(t++,!0,Kt=Kt+.01),mt(),at(!0);break}case 4:{Me(t++,!0,Kt=Kt+.01);const i=g.width/2,s=g.height/2;r.beginPath(),r.arc(i,s,R,0,Math.PI*2),r.fillStyle="#802010",r.fill(),R<G&&(R+=e),mt(),at(!0);break}case 5:{const i=g.width/2,s=g.height/2;R<=0?st(6):(R>0&&(r.beginPath(),r.arc(i,s,R,0,Math.PI*2),r.fillStyle=R<G/4?"#105000":R<G/2?"#CCCC40":"#802010",r.fill()),R<G/4?H("▲ GO! ▲",D.Xl,"Impact",R/G*4):R<G/2?H("Set...",D.Xl,"Impact",1):H("Ready...",D.Xl,"Impact",1),R>0&&(R=(1-(t-Ni)/ba)*G)),mt(),at(!0);break}case 7:{const i=g.width/2,s=g.height/2;r.beginPath(),r.arc(i,s,R,0,Math.PI*2),r.fillStyle="#802010",r.fill(),H("❌ ELIMINATED!",D.Large,"Impact",1,-4.5),V.player.rank===13?H("Don't be the 13TH GUY",D.Small,"Sans-serif"):(H("Don't be one of the last 13TH GUYs",D.Small,"Sans-serif"),H("The final rank is "+V.player.rank+".",D.Normal,"Impact",1,3.1)),R>=G&&Ut("continue",9),R<G&&(r.save(),r.globalAlpha=.7,r.translate(g.width/8,R*2-g.height),qt(r,"eliminated",g.height/6*bt,g.height/2*vt,t,K.Backward,lt.Fall,oe),r.globalAlpha=0,r.restore()),R<G&&(R+=e),mt(),at(!0);break}case 8:{const i=g.width/2,s=g.height/2;r.beginPath(),r.arc(i,s,R,0,Math.PI*2),r.fillStyle="#105000",r.fill(),R>=G/4&&(V.characters.length>14?(H("✪ QUALIFIED!",D.Large,"Impact",1,-5),H("☻",D.Huge,"Impact"),H("Ready for next round "+$t+" / 3",D.Normal,"Sans-serif",1,3.8)):(H("GAME FINISHED!",D.Large,"Impact",1,-5),H("☻",D.Huge,"Impact"),H("Congratulations to the winner!",D.Normal,"Impact",1,3.8)),R>=G&&Ut(),r.save(),r.translate(R<g.width/6?R:g.width/6,g.height/3),qt(r,He,g.height/6*bt,g.height/2*vt,t,R<g.width/6?K.Right:V.characters.length<=14||t%3600>1800?K.Backward:K.BackwardRight,V.characters.length>14?lt.Walk:lt.Celebrate,oe),r.restore()),R<G&&(R+=e),mt(),at(!0);break}default:{at(!1),Wi();break}}r.restore()},_i=()=>{H(pa,D.Tiny,"Impact",.5,2.3,!1),H("Don't be the",D.Small,"Impact",1,-1.8,!0,-.9),H("❌ 13TH GUY",D.Xl,"Impact",1,1.8)},Me=(t,e,i)=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,g.width,g.height),r.fill(),r.save(),r.translate(g.width/8+i,g.height/3),qt(r,He,(e?g.height/6/i:g.height/6)*bt,(e?g.height/2/i:g.height/2)*vt,t,e?K.Forward:t%3600<1800?K.BackwardRight:K.Backward,lt.Walk,oe,e),r.restore(),e?(H("Avoid being the 13th or among the last 13",D.Small,"Sans-serif",1,-1.2),H("or you will be eventually ❌ eliminated!",D.Small,"Sans-serif",1,1.3),H("MOVE WITH",D.Xs,"Sans-serif",.8,-7.5),H("▲ / W - ▼ / S - ◄ / A - ► / D",D.Xs,"Sans-serif",.8,-5.6),ce===3&&Ut("start the race!")):(_i(),Ut()),r.restore()},Ia=t=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,g.width,g.height),r.fill(),r.save(),r.translate(g.width/8,g.height/3),qt(r,He,g.height/6*bt,g.height/2*vt,0,K.Backward,lt.Stand,oe),r.restore(),_i(),r.filter="",gi(),mt(),at(t)},We=async()=>{$t=1,Kt=1,st(2),await Dt(),st(3),await Dt(),st(4),await yi(1e3),st(5)},Ma=async()=>{aa(),window.requestAnimationFrame(Bi),await Zs(),st(1),await Dt(),it(Si),st(2),We()},Gi=1280,Xi=720;window.addEventListener("resize",()=>Oi(Gi,Xi),!1);Oi(Gi,Xi);Ma();
