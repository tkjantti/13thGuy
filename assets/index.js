var on=Object.defineProperty;var an=(t,e,i)=>e in t?on(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var w=(t,e,i)=>an(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();var O=(t=>(t.HIGH="high",t.MEDIUM="medium",t.LOW="low",t))(O||{});let dt=null,Qt=null;const rn=(t,e,i)=>{if(dt=document.createElement("canvas"),dt.width=t,dt.height=e,Qt=dt.getContext("2d"),Qt){Qt.fillStyle=`rgba(0, 0, 0, ${1-i})`;for(let n=0;n<e;n+=2)Qt.fillRect(0,n,t,1)}},ln=(t,e,i,n=!0)=>{const s=t.width,o=t.height,a=n?.7:.8;let l=a,c=n?10:0;switch(i){case O.LOW:{e.fillStyle="rgba(0, 0, 0, 0.2)",e.fillRect(0,0,s,o),e.globalAlpha=.05,e.fillStyle="#000";for(let f=0;f<o;f+=2)e.fillRect(0,f,s,1);e.globalAlpha=1;return}case O.MEDIUM:l=a*.7,c=0;break;case O.HIGH:}const d=e.getImageData(0,0,s,o),g=d.data,y=n&&c>0?new Float32Array(s*o):null;if(n&&y&&c>0)for(let f=0;f<y.length;f++)y[f]=(Math.random()-.5)*c;if(n&&y&&c>0)for(let f=0;f<o;f++){const m=f*s;for(let v=0;v<s;v++){const A=(m+v)*4,I=y[m+v];g[A]+=I,g[A+1]+=I,g[A+2]+=I}}e.putImageData(d,0,0),(i===O.HIGH||i===O.MEDIUM)&&((!dt||dt.width!==s||dt.height!==o)&&rn(s,o,l),Qt&&dt&&(e.globalAlpha=l,e.drawImage(dt,0,0),e.globalAlpha=1))},Pt=/iPad/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,ti=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),Ve=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Jt=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&navigator.maxTouchPoints>1,Ke=!Ve&&!Pt;let nt="auto",J=O.HIGH,ut,te=!1,ve=!1,Gt=null;const cn=60;let ei=0;function ii(t){ve=t,console.log(`Race mode set to: ${t?"ACTIVE":"INACTIVE"}`)}function be(){return nt==="auto"?J:nt}function hn(){const t={isPrivate:!1,isIpadSafariPrivate:!1,isIOSPrivate:!1};if(Pt&&ti)try{window.localStorage.setItem("ipad_private_test","test"),window.localStorage.removeItem("ipad_private_test"),console.log("iPad Safari NOT in private mode")}catch{return console.log("iPad Safari private mode detected"),t.isPrivate=!0,t.isIpadSafariPrivate=!0,t}if(Jt)try{localStorage.setItem("ios_private_test","test"),localStorage.removeItem("ios_private_test"),console.log("iOS NOT in private mode")}catch{return console.log("iOS private mode detected"),t.isPrivate=!0,t.isIOSPrivate=!0,t}try{localStorage.setItem("private_test","private_test"),localStorage.removeItem("private_test")}catch{return console.log("Private browsing detected via localStorage exception"),t.isPrivate=!0,t}if(ti||Jt||Pt){const e=window.indexedDB;if(e)try{const s=e.open("test");s.onerror=()=>{console.log("Safari private mode detected via indexedDB"),t.isPrivate=!0}}catch(s){console.log("Error testing indexedDB:",s)}const i="private_test_"+Math.random(),n="test_value_"+Date.now();try{localStorage.setItem(i,n);const s=localStorage.getItem(i);localStorage.removeItem(i),s!==n&&(console.log("Private browsing detected (non-persistent storage)"),t.isPrivate=!0)}catch{}}return navigator.storage&&navigator.storage.estimate&&navigator.storage.estimate().then(e=>{e.quota&&e.quota<1e7&&(console.log("Private browsing detected via storage quota:",e.quota),ut==="high"&&J===O.HIGH&&(J=O.MEDIUM,gt()))}).catch(e=>console.log("Storage quota check error:",e)),t}function dn(){const t=hn();return t.isIpadSafariPrivate?(console.log("iPad Safari private mode detected immediately - forcing LOW tier"),"low"):t.isIOSPrivate?(console.log("iOS private mode detected immediately - forcing LOW tier"),"low"):(Jt||Pt)&&t.isPrivate?(console.log("iOS/iPad device in private mode - forcing LOW performance tier"),"low"):navigator.hardwareConcurrency>4||navigator.gpu!==void 0||Pt&&navigator.hardwareConcurrency>3&&!t.isPrivate?t.isPrivate?"medium":"high":navigator.hardwareConcurrency>=2?"medium":"low"}function fn(t){if(!ve||be()!==O.LOW)return!0;const e=1e3/cn;return t-ei>=e?(ei=t,!0):!1}function gt(){if(Gt){let t;nt==="auto"?t=`auto (${un(J)})`:t=nt,Ve?Gt.textContent=`GFX: ${t}`:Gt.innerHTML=`<u>G</u>FX: ${t}`}}function un(t){switch(t){case O.HIGH:return"H";case O.MEDIUM:return"M";case O.LOW:return"L";default:return t}}function gn(t){Gt=t,gt()}function mn(){switch(nt="auto",ut){case"high":J=O.HIGH;break;case"medium":J=O.MEDIUM;break;case"low":J=O.LOW;break}console.log(`Detected hardware: Cores: ${navigator.hardwareConcurrency}, Memory: ${navigator.deviceMemory||"unknown"} GB, GPU: ${navigator.gpu?"yes":"no"}`),console.log(`Performance tier detected: ${ut}`),console.log(`AUTO mode initialized with effective setting: ${J}`),gt()}function pn(){console.log("Initializing graphics with performance detection..."),ut=dn(),console.log(`Detected performance tier: ${ut}`),ut==="high"&&yn(),mn(),Sn(),te=!1,console.log("Performance mode set to:",nt)}function yn(){console.log("Running initial performance benchmark...");const t=document.createElement("canvas");t.width=400,t.height=400;const e=t.getContext("2d");if(!e)return;const i=performance.now();for(let a=0;a<50;a++){e.clearRect(0,0,400,400),e.save();const l=e.createRadialGradient(200,200,10,200,200,200);l.addColorStop(0,"white"),l.addColorStop(1,"black"),e.fillStyle=l,e.fillRect(0,0,400,400);for(let g=0;g<20;g++)e.fillStyle=`rgba(${Math.random()*255}, ${Math.random()*255}, ${Math.random()*255}, 0.5)`,e.beginPath(),e.arc(Math.random()*400,Math.random()*400,Math.random()*50+10,0,Math.PI*2),e.fill();const c=e.getImageData(0,0,400,400),d=c.data;for(let g=0;g<d.length;g+=16)d[g]=d[g]*.9,d[g+1]=d[g+1]*.9,d[g+2]=d[g+2]*.9;e.putImageData(c,0,0),e.restore()}const s=performance.now()-i;console.log(`Initial benchmark completed in ${s.toFixed(2)}ms`);const o=250;s>o?(console.log(`Initial benchmark indicates potential performance issues (${s.toFixed(2)}ms > ${o}ms)`),console.log("Setting performance tier to MEDIUM as a precaution"),ut="medium"):(console.log(`Initial benchmark indicates good performance (${s.toFixed(2)}ms < ${o}ms)`),console.log("Keeping performance tier as HIGH"))}function Fi(){te||nt!=="auto"||(console.log("Scheduling performance check..."),setTimeout(()=>{console.log("Starting performance check for AUTO mode..."),te=!0,ut==="high"?vn():ut==="medium"?bn():An()},3e3))}function wn(){te=!1}function vn(){console.log("Running performance check for HIGH tier device...");let t=0,e=0,i=0;const n=20,s=50,o=120;let a=performance.now();function l(d){const g=d-a;if(a=d,t>0&&(console.log(`Frame ${t} duration: ${g.toFixed(2)}ms`),g>o?(i++,e++,console.log(`SEVERE lag detected: ${g.toFixed(2)}ms`)):g>s&&(e++,console.log(`Moderate lag detected: ${g.toFixed(2)}ms`)),t>=n)){i>=5?(console.log(`SEVERE performance issues detected (${i}/${n} very slow frames)`),J=O.LOW,gt()):e>=5?(console.log(`Moderate performance issues detected (${e}/${n} slow frames)`),J=O.MEDIUM,gt(),setTimeout(()=>{c()},2e3)):console.log(`Performance acceptable (${e}/${n} slow frames)`);return}t++,requestAnimationFrame(l)}function c(){console.log("Performing follow-up performance check...");let d=0,g=0;const y=10;function f(m){const v=m-a;if(a=m,d>0&&(console.log(`Additional frame ${d} duration: ${v.toFixed(2)}ms`),v>s&&g++,d>=y)){g>=3&&(console.log(`Continued performance issues in MEDIUM mode (${g}/${y} slow frames)`),J=O.LOW,gt());return}d++,requestAnimationFrame(f)}a=performance.now(),requestAnimationFrame(f)}requestAnimationFrame(l)}function bn(){console.log("Running performance check for MEDIUM tier device...");const t=performance.now(),e=150;setTimeout(()=>{const n=performance.now()-t;console.log(`Medium tier check: Frame time = ${n.toFixed(2)}ms`),n>e?(console.log("Significant performance issues on medium-tier device"),J=O.LOW,gt()):console.log("Medium-tier device performance is acceptable")},300)}function An(){console.log("Running performance check for LOW tier device..."),J=O.LOW,gt(),console.log("Set to LOW performance mode for low-tier device")}function Di(){const t=["auto",O.HIGH,O.MEDIUM,O.LOW],i=(t.indexOf(nt)+1)%t.length;nt=t[i],nt==="auto"&&ve&&(te=!1,Fi()),gt(),Gt&&Gt.blur(),console.log("Performance mode toggled to:",nt)}function Sn(){Ve||document.addEventListener("keydown",t=>{(t.code==="KeyG"||t.code==="F1")&&Di()})}function qe(){return ve}let xe;const In=(t,e)=>{const i=t.width,n=t.height,s=e.createRadialGradient(i/2,n/2,0,i/2,n/2,i/2);return s.addColorStop(0,"rgba(255, 255, 255, 0.3)"),s.addColorStop(1,"rgba(0, 0, 0, 0.5)"),s},kn=(t,e)=>{xe||(xe=In(t,e)),e.fillStyle=xe,e.fillRect(0,0,t.width,t.height)},Mn=(t,e,i)=>{if(i===O.LOW){e.globalAlpha=.5,e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(0,0,t.width,t.height),e.globalAlpha=1;return}const n=e.getImageData(0,0,t.width,t.height),s=n.data;for(let o=0;o<s.length;o+=4){const a=s[o],l=s[o+1],c=s[o+2],d=a*.3+l*.59+c*.11;s[o]=s[o+1]=s[o+2]=d*.7}e.putImageData(n,0,0)},p=document.querySelector("canvas"),r=p.getContext("2d",{willReadFrequently:!0}),ct=(t=!0)=>{let e;const i=be();qe()?e=i:e=i===O.LOW?O.MEDIUM:i,ln(p,r,e,t)},kt=()=>{if((qe()?be():O.HIGH)!==O.LOW)return kn(p,r)},Li=()=>{const t=qe()?be():O.HIGH;Mn(p,r,t)},En=()=>{const t=document.createElement("canvas");t.width=4,t.height=4;const e=t.getContext("2d");if(!e)return;function i(s,o,a,l,c){e&&(e.strokeStyle=c,e.beginPath(),e.moveTo(s,o),e.lineTo(a,l),e.stroke())}const n="#00000010";e.fillStyle=n,e.fillRect(0,0,t.width,t.height);for(let s=0;s<=t.width;s+=4)i(s,0,s,t.height,n),i(0,s,t.width,s,n);return e.createPattern(t,"repeat")},xn=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(!e)return;const i=e.getImageData(0,0,t.width,t.height),n=i.data,s=4;for(let o=0;o<t.height;o+=s)for(let a=0;a<t.width;a+=s){const l=Math.random()*64,c=Math.floor(Math.random()*24);for(let d=0;d<s;d++)for(let g=0;g<s;g++){const y=((o+d)*t.width+(a+g))*4;n[y]=Math.min(255,Math.max(0,n[y]+l)),n[y+1]=Math.min(255,Math.max(0,n[y+1]+l)),n[y+2]=Math.min(255,Math.max(0,n[y+2]+l)),n[y+3]=c}}return e.putImageData(i,0,0),e.createPattern(t,"repeat")};var D=(t=>(t[t.Tiny=16]="Tiny",t[t.Xs=20]="Xs",t[t.Small=24]="Small",t[t.Normal=32]="Normal",t[t.Large=48]="Large",t[t.Xl=64]="Xl",t[t.Huge=80]="Huge",t))(D||{});const ni=t=>{const e=p.width/1e3;return Math.floor(t*e)},L=(t,e,i,n=1,s=0,o=!0,a=0,l,c="white")=>{r.save();const d=ni(e),g=ni(16);r.globalAlpha=Math.max(n,0),r.font=`${d}px ${i}`;const y=l??t,f=r.measureText(y),m=f.actualBoundingBoxAscent??d*.8,v=f.actualBoundingBoxDescent??d*.2,A=f.width,I=a*g,M=s*g,C=(p.width-A)/2+I,E=(o?p.height/2:0)+M;if(Array.isArray(c)&&c.length===2){const _=E-m,k=E+v,R=r.createLinearGradient(0,_,0,k);R.addColorStop(.2,c[0]),R.addColorStop(1,c[1]),r.fillStyle=R}else r.fillStyle=c;r.textBaseline="alphabetic",r.fillText(t,C,E),r.restore()},Cn=[1,,82,.01,.08,.2,,2.6,,,,,,.1,,,,.61,.02,,-1686],Pn=[2,,12,,,.008,,1.2,23,-7,,,.05,.4,,,.15,.82,.03,.28],Rn=[1,,85,.08,.1,.01,1,4,,-11,1,.07,,.1,101,,.05,.68,.4,.12,1],Tn=[.01,,523.2511,.1,3,3,4,0,,,2250,,.04,,10,.01,,.82,1,,30],On=[2,,185,,,,3,1.6,-7,,,,,,,.2,.19,.1,,.38,985],Fn=[1.5,,688,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.03,.11,-818],Dn=[1.5,,1376,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.8,.11,-818],Ln={songData:[{i:[0,0,180,0,0,0,180,0,0,160,158,158,158,0,0,0,0,51,2,1,2,54,239,1,32,88,1,157,2],p:[1,2],c:[{n:[111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137],f:[]},{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:1},Hn={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[4,1,2,3,2,1,2,3],c:[{n:[134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134,137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]},{n:[137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137,134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]}]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[27,1,27,2,27,1,27,2],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,1,1,1,1,1,1,2],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[],c:[]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,,,,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:7,numChannels:8},Wn={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[],c:[]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[25,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,3,26,26,26],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,135],f:[]}]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[5,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,5,,5],c:[{n:[129],f:[]},{n:[134,,,,,,,,,,,,,,,,137],f:[]},{n:[137,,,,,,,,,,,,,,,,134],f:[]},{n:[141],f:[]},{n:[113],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,1,,,,1,,,,1,,,,1,,,,1,,,,1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,1,1,1],c:[{n:[,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1,,,,1,,,,1,,,,1,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:23,numChannels:8},It=(t,...e)=>Bn(t,Gn(t,...e)),K=44100,_n=new(window.AudioContext||window.webkitAudioContext),Ce=_n,Bn=(t,...e)=>{let i=Ce.createBuffer(e.length,e[0].length,K),n=Ce.createBufferSource();return e.forEach((s,o)=>i.getChannelData(o).set(s)),n.buffer=i,n.connect(Ce.destination),n.start(),n},Gn=(t,e=.1,i=.05,n=220,s=0,o=0,a=.1,l=0,c=1,d=0,g=0,y=0,f=0,m=0,v=0,A=0,I=0,M=0,C=1,E=0,_=0,k=0)=>{let R=Math.PI*2,B=sn=>sn<0?-1:1,N=d*=500*R/K/K,F=n*=(1+i*2*Math.random()-i)*R/K,Y=[],$=0,At=0,W=0,tt=1,ot=0,j=0,G=0,U,Q,Rt=2,St=R*Math.abs(k)*2/K,Ut=Math.cos(St),Xt=Math.sin(St)/2/Rt,Tt=1+Xt,ke=-2*Ut/Tt,Yt=(1-Xt)/Tt,ne=(1+B(k)*Ut)/2/Tt,Me=-(B(k)+Ut)/Tt,Ee=ne,Vt=0,Ot=0,Kt=0,Je=0;for(s=s*K+9,E*=K,o*=K,a*=K,M*=K,g*=500*R/K**3,A*=R/K,y*=R/K,f*=K,m=m*K|0,e*=t<0?0:t,Q=s+E+o+a+M|0;W<Q;Y[W++]=G*(t<0?0:t))++j%(I*100|0)||(G=l?l>1?l>2?l>3?Math.sin($**3):Math.max(Math.min(Math.tan($),1),-1):1-(2*$/R%2+2)%2:1-4*Math.abs(Math.round($/R)-$/R):Math.sin($),G=(m?1-_+_*Math.sin(R*W/m):1)*B(G)*Math.abs(G)**c*(W<s?W/s:W<s+E?1-(W-s)/E*(1-C):W<s+E+o?C:W<Q-M?(Q-W-M)/a*C:0),G=M?G/2+(M>W?0:(W<Q-M?1:(Q-W)/M)*Y[W-M|0]/2/e):G,k&&(G=Je=Ee*Vt+Me*(Vt=Ot)+ne*(Ot=G)-Yt*Kt-ke*(Kt=Je))),U=(n+=d+=g)*Math.cos(A*At++),$+=U+U*v*Math.sin(W**5),tt&&++tt>f&&(n+=y,F+=y,tt=0),m&&!(++ot%m)&&(n=F,d=N,tt=tt||1);return Y};let ce=!1;const Nn=async t=>{if(console.log("Attempting to unlock audio systems..."),!ce){if(Ke&&!Pt){console.log("Skipping audio unlock on desktop browser"),ce=!0;return}console.log("Running audio unlock for mobile/iPad device");try{t.volume=.1,await t.play().catch(e=>console.log("First unlock attempt:",e)),t.pause(),t.currentTime=0,console.log("HTML Audio unlocked successfully")}catch(e){console.warn("HTML Audio unlock attempt failed:",e)}ce=!0}},$n=t=>{if(Ke&&!Pt){console.log("Skipping audio unlock setup on desktop browser"),ce=!0;return}console.log("Setting up audio unlock for mobile/iPad device");const e=document.createElement("audio");e.setAttribute("src","data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//tUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABGwD///////////////////////////////////////////8AAAA8TEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAARvMPHBz//////////////////////////////////////////////////////////////////8AAAA"),e.setAttribute("playsinline","playsinline"),e.volume=.1;const i=async()=>{console.log("Attempting to unlock audio systems from event handler");try{e.play().catch(n=>console.log("Silent audio error:",n))}catch(n){console.log("Silent audio exception:",n)}try{await Nn(t)}catch(n){console.log("sfx unlockAudio error:",n)}document.removeEventListener("touchstart",i,!0),document.removeEventListener("touchend",i,!0),document.removeEventListener("click",i,!0)};document.addEventListener("touchstart",i,{once:!0,capture:!0}),document.addEventListener("touchend",i,{once:!0,capture:!0}),document.addEventListener("click",i,{once:!0,capture:!0})};function zn(){var t=function(f){return Math.sin(f*6.283184)},e=function(f){return 2*(f%1)-1},i=function(f){return f%1<.5?1:-1},n=function(f){var m=f%1*4;return m<2?m-1:3-m},s=function(f){return .003959503758*2**((f-128)/12)},o=function(f,m,v){var A=a[f.i[0]],I=f.i[1],M=f.i[3]/32,C=a[f.i[4]],E=f.i[5],_=f.i[8]/32,k=f.i[9],R=f.i[10]*f.i[10]*4,B=f.i[11]*f.i[11]*4,N=f.i[12]*f.i[12]*4,F=1/N,Y=-f.i[13]/16,$=f.i[14],At=v*2**(2-f.i[15]),W=new Int32Array(R+B+N),tt=0,ot=0,j,G,U,Q,Rt,St;for(j=0,G=0;j<R+B+N;j++,G++)G>=0&&($=$>>8|($&255)<<4,G-=At,Rt=s(m+($&15)+f.i[2]-128),St=s(m+($&15)+f.i[6]-128)*(1+8e-4*f.i[7])),U=1,j<R?U=j/R:j>=R+B&&(U=(j-R-B)*F,U=(1-U)*3**(Y*U)),tt+=Rt*U**M,Q=A(tt)*I,ot+=St*U**_,Q+=C(ot)*E,k&&(Q+=(2*Math.random()-1)*k),W[j]=80*Q*U|0;return W},a=[t,i,e,n],l,c,d,g,y;this.init=function(f){l=f,c=f.endPattern,d=0,g=f.rowLen*f.patternLen*(c+1)*2,y=new Int32Array(g)},this.generate=function(){var f,m,v,A,I,M,C,E,_,k,R,B,N=new Int32Array(g),F=l.songData[d],Y=l.rowLen,$=l.patternLen,At=0,W=0,tt,ot,j=!1,G=[];for(v=0;v<=c;++v)for(C=F.p[v],A=0;A<$;++A){var U=C?F.c[C-1].f[A]:0;U&&(F.i[U-1]=F.c[C-1].f[A+$]||0,U<17&&(G=[]));var Q=a[F.i[16]],Rt=F.i[17]/512,St=2**(F.i[18]-9)/Y,Ut=F.i[19],Xt=F.i[20],Tt=F.i[21]*43.23529*3.141592/44100,ke=1-F.i[22]/255,Yt=F.i[23]*1e-5,ne=F.i[24]/32,Me=F.i[25]/512,Ee=6.283184*2**(F.i[26]-9)/Y,Vt=F.i[27]/255,Ot=F.i[28]*Y&-2;for(R=(v*$+A)*Y,I=0;I<4;++I)if(M=C?F.c[C-1].n[A+I*$]:0,M){G[M]||(G[M]=o(F,M,Y));var Kt=G[M];for(m=0,f=R*2;m<Kt.length;m++,f+=2)N[f]+=Kt[m]}for(m=0;m<Y;m++)E=(R+m)*2,k=N[E],k||j?(B=Tt,Ut&&(B*=Q(St*E)*Rt+.5),B=1.5*Math.sin(B),At+=B*W,tt=ke*(k-W)-At,W+=B*tt,k=Xt==3?W:Xt==1?tt:At,Yt&&(k*=Yt,k=k<1?k>-1?t(k*.25):-1:1,k/=Yt),k*=ne,j=k*k>1e-5,_=Math.sin(Ee*E)*Me+.5,ot=k*(1-_),k*=_):ot=0,E>=Ot&&(ot+=N[E-Ot+1]*Vt,k+=N[E-Ot]*Vt),N[E]=ot|0,N[E+1]=k|0,y[E]+=ot|0,y[E+1]+=k|0}return d++,d/l.numChannels},this.createAudioBuffer=function(f){for(var m=f.createBuffer(2,g/2,44100),v=0;v<2;v++)for(var A=m.getChannelData(v),I=v;I<g;I+=2)A[I>>1]=y[I]/65536;return m},this.createWave=function(){var f=44,m=f+g*2-8,v=m-36,A=new Uint8Array(f+g*2);A.set([82,73,70,70,m&255,m>>8&255,m>>16&255,m>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,v&255,v>>8&255,v>>16&255,v>>24&255]);for(var I=0,M=f;I<g;++I){var C=y[I];C=C<-32767?-32767:C>32767?32767:C,A[M++]=C&255,A[M++]=C>>8&255}return A},this.getData=function(f,m){for(var v=2*Math.floor(f*44100),A=new Array(m),I=0;I<2*m;I+=1){var M=v+I;A[I]=f>0&&M<y.length?y[M]/32768:0}return A}}const je=()=>document.createElement("audio"),Pe=(t,e,i)=>new Promise(n=>{const s=new zn;s.init(e);let o=!1;setInterval(function(){if(!o&&(o=s.generate()>=1,o)){const a=s.createWave();t.src=URL.createObjectURL(new Blob([a],{type:"audio/wav"})),t.loop=i,n()}},0)}),Re=t=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=void 0),t._fadeOutInTimeout&&(clearTimeout(t._fadeOutInTimeout),t._fadeOutInTimeout=void 0),t.pause(),t.currentTime=0},Qe=(t,e)=>parseFloat(t.toFixed(e)),Un=(t,e=0)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=void 0);let i=t.volume;i>e?t._fadeInterval=setInterval(function(){i=Qe(Math.max(e,i-.1),1),t.volume=i,i<=e&&(e===0&&t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=void 0)},100):e===0&&!t.paused&&(t.pause(),t.volume=0)},fe=(t,e=1)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=void 0);let i=Promise.resolve();t.paused&&(t.volume=Jt?.1:0,t.setAttribute("playsinline","playsinline"),i=t.play()),i.then(()=>{let n=t.volume;n<e?(t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeInterval=setInterval(function(){n=Qe(Math.min(e,n+.1),1),t.volume=n,n>=e&&(t.volume=e,clearInterval(t._fadeInterval),t._fadeInterval=void 0)},100)):t.volume=e}).catch(n=>{console.warn("FadeIn play() failed:",n),t.paused&&(t.volume=1,t.play().catch(s=>console.error("Second play attempt failed:",s))),t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=void 0)})},si=(t,e)=>{t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeOutInTimeout&&clearTimeout(t._fadeOutInTimeout),e._fadeInterval&&clearInterval(e._fadeInterval),e._fadeOutInTimeout&&clearTimeout(e._fadeOutInTimeout),t._fadeInterval=void 0,t._fadeOutInTimeout=void 0,e._fadeInterval=void 0,e._fadeOutInTimeout=void 0;let i=t.volume;i>0?t._fadeInterval=setInterval(function(){i=Qe(Math.max(0,i-.1),1),t.volume=i,i<=.1&&(t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=void 0,t._fadeOutInTimeout=setTimeout(()=>{fe(e,1),t._fadeOutInTimeout=void 0},500))},100):(t.pause(),t.volume=0,t._fadeOutInTimeout=setTimeout(()=>{fe(e,1),t._fadeOutInTimeout=void 0},500))};var X=(t=>(t.Start="start",t.Race="race",t.Bounce="bounce",t.Hit="hit",t.Teleport="teleport",t.Keyboard="keyboard",t.Finished="finished",t.GameOver="gameover",t.Restart="restart",t.Count="count",t.Go="go",t))(X||{});const et=je(),Ht=je(),ue=je(),Xn=()=>($n(et),Promise.all([Pe(et,Hn,!0),Pe(Ht,Wn,!0),Pe(ue,Ln,!1)])),st=async(t,e=1)=>{if(e!==0)switch(t){case"race":{Ht.currentTime=0,si(et,Ht);break}case"finished":{It(.04,...Tn),et.currentTime=0,si(Ht,et);break}case"gameover":{ue.volume=1,ue.play().catch(i=>{console.warn("Failed to play gameoverFx:",i)}),Un(Ht);break}case"restart":{et.currentTime=0,fe(et);break}case"start":{(et.paused||et.volume<1)&&(et.currentTime=0,fe(et));break}case"bounce":{It(e,...Cn);break}case"hit":{It(e,...On);break}case"keyboard":{It(.5,...Pn);break}case"teleport":{It(e,...Rn);break}case"count":{It(.5,...Fn);break}case"go":{It(.5,...Dn);break}}},Yn=()=>{Re(et),Re(Ht),Re(ue)},Hi=()=>({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1});let $t=Hi();const Vn=t=>{t.code in $t&&($t[t.code]=!0)},Kn=t=>{t.code in $t&&($t[t.code]=!1)},qn=()=>{window.addEventListener("keydown",Vn),window.addEventListener("keyup",Kn),window.addEventListener("blur",()=>{$t=Hi()})},jn=t=>new Promise(e=>setTimeout(e,t)),Qn=t=>new Promise(e=>{const i=n=>{n.code==="Enter"&&(st(X.Keyboard),t&&st(t),window.removeEventListener("keydown",i),e())};window.addEventListener("keydown",i)}),Zn=()=>$t;function Jn(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function ge(t,e){const i=e.x<=t.x+t.width&&t.x<=e.x+e.width,n=e.y<=t.y+t.height&&t.y<=e.y+e.height;return i&&n}function ts(t,e){const i=t.x<=e.x&&e.x+e.width<=t.x+t.width,n=t.y<=e.y&&e.y+e.height<=t.y+t.height;return i&&n}function Te(t){return-(Math.cos(Math.PI*t)-1)/2}function at(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}function Oe(t){return t*t}function es(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}class is{constructor(e,i){w(this,"x",0);w(this,"y",0);w(this,"zoom",1);w(this,"visibleAreaHeight");w(this,"yAdjust",0);w(this,"target",null);w(this,"transition",null);this.level=e,this.view=i}getViewArea(){const e=this.view.width/this.zoom,i=this.view.height/this.zoom;return{x:this.x-e/2,y:this.y-i/2,width:e,height:i}}follow(e){this.target=e}setTransition(e){const i=this.view.height/this.zoom;this.transition={...e,endY:e.endY+i*this.yAdjust},this.target=null}update(e){if(this.visibleAreaHeight!=null&&(this.zoom=this.view.height/this.visibleAreaHeight),this.transition!=null){const{startY:i,endY:n,startTime:s,duration:o}=this.transition;if(e<s+o){const l=(e-this.transition.startTime)/this.transition.duration;this.y=i+es(l)*(n-i)}else this.transition=null}else this.target&&this.followFrame(this.target)}followFrame(e){const i=this.view.width/this.zoom,n=this.view.height/this.zoom;if(i<this.level.width){let s=e.x+e.width;s-i/2<this.level.x?s=this.level.x+i/2:s+i/2>this.level.x+this.level.width&&(s=this.level.x+this.level.width-i/2),this.x=s}else this.x=0;this.y=e.y+n*this.yAdjust}}const Z={x:0,y:0};function he(t){return t.x===0&&t.y===0}function ns(t,e){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function ss(t,e){return Math.abs(t.x-e.x)}function os(t,e){return Math.abs(t.y-e.y)}function zt(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function ft(t,e){return{x:t.x+e.x,y:t.y+e.y}}function Wi(t,e){return{x:t.x-e.x,y:t.y-e.y}}function lt(t,e){return{x:t.x*e,y:t.y*e}}function as(t,e){return{x:t.x/e,y:t.y/e}}function mt(t){return as(t,zt(t))}function ee(t,e){return t.x*e.x+t.y*e.y}const Wt=.5,rs=.01,ls=5e-4,oi=6e-4,cs=3;function hs(t,e,i){if(he(e)){const m=zt(t.velocity),v=oi*i,A=m>v?m-v:0;return A>0?lt(mt(t.velocity),A):Z}const n=ee(t.velocity,e),s={x:-e.y,y:e.x},o=ee(t.velocity,s);let a=ls*i;n>rs*i&&(a=0);const l=oi*i,c=Math.abs(o)>l?-l:0,d=Math.sign(o)*c,g=lt(e,a),y=lt(s,d);return ft(t.velocity,ft(g,y))}function ds(t,e){const i=t.width/2,n=t.height/2,s=e.width/2,o=e.height/3.5,a={x:t.x+t.width/2,y:t.y+t.height/2},l=ft(a,t.velocity),c={x:e.x+e.width/2,y:e.y+e.height/2};if(ss(l,c)<i+s&&os(l,c)<n+o){const d=mt(Wi(c,a)),g=ee(t.velocity,d),y=lt(d,-Math.abs(g)*cs);let f=ft(t.velocity,y);return zt(f)>Wt&&(f=lt(mt(f),Wt)),t.velocity=f,!0}return!1}function fs(t,e){const i=t.width*.4,n=e.width*.4,s={x:t.x+t.width/2,y:t.y+t.height/2},o={x:e.x+e.width/2,y:e.y+e.height/2},a=ft(s,t.velocity),l=ft(o,e.velocity);if(ns(a,l)<i+n){const c=mt(Wi(o,s)),d=lt(c,-1),g=ee(t.velocity,c),y=ee(e.velocity,d),f=lt(c,Math.abs(g)),m=lt(d,Math.abs(y));let v=ft(t.velocity,m);zt(v)>Wt&&(v=lt(mt(v),Wt)),t.velocity=v;let A=ft(e.velocity,f);return zt(A)>Wt&&(A=lt(mt(A),Wt)),e.velocity=A,!0}return!1}const vt=(t=1)=>Math.random()*t,us=(t,e)=>Math.random()*(e-t)+t,Bt=class Bt{constructor(e){w(this,"x");w(this,"y");w(this,"width",Bt.WIDTH);w(this,"height",Bt.HEIGHT);w(this,"velocity",Z);this.x=e.x,this.y=e.y}draw(e,i){r.save(),r.translate(this.x,this.y);const n=r.createLinearGradient(0,0,this.width,this.height);n.addColorStop(0,"rgb(255, 110, 110)"),n.addColorStop(1,"rgb(255, 60, 60)"),r.beginPath(),r.fillStyle="rgba(0, 0, 0, 0.1)",r.ellipse(this.width/2,this.height/1.5,this.width/2,this.height,0,0,2*Math.PI),r.fill(),r.fillStyle=n,r.beginPath(),r.ellipse(this.width/2,this.height/2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.fillStyle=n,r.fillRect(0,-this.height*2,this.width,this.height*2.5);const s=r.createLinearGradient(0,0,this.width,this.height);s.addColorStop(0,"rgb(255, 140, 140)"),s.addColorStop(1,"rgb(255, 80, 80)"),r.fillStyle=s,r.beginPath(),r.ellipse(this.width/2,-this.height*2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.strokeStyle="rgb(200, 70, 70)",r.lineWidth=this.width/100,r.stroke(),r.restore()}};w(Bt,"WIDTH",10),w(Bt,"HEIGHT",4);let x=Bt;const b=16,u=10,_i=b,Nt=9,wt=u*Nt,Fe=u*7,gs=u*5,ai=u*3,S=-90/2,ri=wt/2;var h=(t=>(t[t.FullWidth=0]="FullWidth",t[t.Basic=1]="Basic",t[t.BasicSlope=2]="BasicSlope",t[t.BasicSteepSlope=3]="BasicSteepSlope",t[t.Narrow=4]="Narrow",t[t.VeryNarrow=5]="VeryNarrow",t[t.DualPassage=6]="DualPassage",t[t.DualPassageExt=7]="DualPassageExt",t[t.TriplePassage=8]="TriplePassage",t[t.RightPassage=9]="RightPassage",t[t.SlopeEmptySlope=10]="SlopeEmptySlope",t[t.SlopeEmptyPassage=11]="SlopeEmptyPassage",t[t.PassageEmptySlope=12]="PassageEmptySlope",t[t.SlopeObstacleSlope=13]="SlopeObstacleSlope",t[t.FullWidthWithObstaclesOnRight=14]="FullWidthWithObstaclesOnRight",t[t.FullWidthWithObstaclesOnRight2=15]="FullWidthWithObstaclesOnRight2",t[t.FullWidthWithMoreObstacles=16]="FullWidthWithMoreObstacles",t[t.FullWidthWithObstacles=17]="FullWidthWithObstacles",t[t.Chasm=18]="Chasm",t[t.Raft=19]="Raft",t[t.TwoRafts=20]="TwoRafts",t[t.Checkpoint=21]="Checkpoint",t[t.Finish=22]="Finish",t))(h||{}),ht=(t=>(t[t.Normal=0]="Normal",t[t.CheckPoint=1]="CheckPoint",t[t.Finish=2]="Finish",t[t.Raft=3]="Raft",t))(ht||{}),H=(t=>(t[t.Empty=0]="Empty",t[t.Free=1]="Free",t[t.Obstacle=2]="Obstacle",t[t.Raft=3]="Raft",t))(H||{});function Bi(t,e,i){return{type:0,row:t,col:e,x:S+e*u,y:i,width:u,height:b}}function Be(t){return"yDirection"in t}function me(t){return"force"in t}class ms{constructor(e,i,n,s,o){w(this,"row");w(this,"y");w(this,"type");w(this,"surfaces");w(this,"objects");w(this,"width");w(this,"height");w(this,"minX");w(this,"maxX");w(this,"blocks",new Array(Nt));this.row=e,this.y=i,this.type=n,this.surfaces=s,this.objects=o,this.minX=Math.min(...this.surfaces.map(a=>a.x)),this.maxX=Math.max(...this.surfaces.map(a=>a.x+a.width)),this.width=this.maxX-this.minX,this.height=b;for(let a=0;a<Nt;a++)this.blocks[a]={type:this.getBlockType(a),row:e,col:a,x:S+a*u,y:this.y,width:u,height:b}}get color(){switch(this.type){case 1:return"rgb(50, 80, 50)";case 2:return"rgb(0, 200, 0)";case 3:return"rgb(50,60,120)";default:return"rgb(80, 50, 80)"}}getBlock(e){return e<0||Nt<=e?Bi(this.row,e,this.y):this.blocks[e]}isFree(e,i){const n=u*.1,s=S+e*u,o=i??this.y,a={x:s+n,y:o+n,width:u-2*n,height:_i-2*n};return this.surfaces.some(l=>ts(l,a))&&!this.objects.some(l=>ge(l,a))}getBlockType(e){const i=u*.1,n=S+e*u+i,s=u-2*i;return this.surfaces.some(l=>Be(l)&&l.x<=n&&n+s<=l.x+l.width)?3:this.objects.some(l=>l.x<=n&&n+s<=l.x+l.width)?2:this.isFree(e)?1:0}}function ps(t,e){const i=t.map((n,s)=>ys(n,s,e));return ws(i),i}function ys(t,e,i){const n=i-b*(e+1),s=n+b/2;let o=0,a=[],l=[];switch(t){case 0:a=[{x:S,y:n,width:wt,height:b}];break;case 1:a=[{x:S+u*1,y:n,width:Fe,height:b}];break;case 2:{a=[{force:.3,x:S+u*1,y:n,width:Fe,height:b}];break}case 3:{a=[{force:.5,x:S+u*1,y:n,width:Fe,height:b}];break}case 4:a=[{x:S+u*2,y:n,width:gs,height:b}];break;case 5:a=[{x:S+u*3,y:n,width:ai,height:b}];break;case 6:a=[{x:S+u,y:n,width:u*2,height:b},{x:ri-u*3,y:n,width:u*2,height:b}];break;case 7:a=[{x:S+u,y:n,width:u*2,height:b},{x:S+u*4,y:n,width:u*5,height:b}];break;case 8:a=[{x:S+u*1,y:n,width:u*2,height:b},{x:S+u*4,y:n,width:u*2,height:b},{x:S+u*7,y:n,width:u*2,height:b}];break;case 9:{a=[{x:S+u*6,y:n,width:u*2,height:b}];break}case 10:{const c={force:.3,x:S+u*1,y:n,width:u*2,height:b},d={force:.3,x:S+u*6,y:n,width:u*2,height:b};a=[c,d];break}case 11:{const c={force:.3,x:S+u*1,y:n,width:u*2,height:b},d={x:S+u*6,y:n,width:u*2,height:b};a=[c,d];break}case 12:{const c={x:S+u*1,y:n,width:u*2,height:b},d={force:.3,x:S+u*6,y:n,width:u*2,height:b};a=[c,d];break}case 13:{const c={force:.3,x:S+u*1,y:n,width:u*2,height:b},d={force:.3,x:S+u*6,y:n,width:u*2,height:b};a=[c,{x:S+u*3,y:n,width:u*3,height:b},d],l=[new x({x:S+u*4,y:s-x.HEIGHT/2})];break}case 14:{a=[{x:-90/2,y:n,width:wt,height:b}],l=[new x({x:S+u*4,y:s-x.HEIGHT/2}),new x({x:S+u*6,y:s-x.HEIGHT/2}),new x({x:S+u*8,y:s-x.HEIGHT/2})];break}case 15:{a=[{x:-90/2,y:n,width:wt,height:b}],l=[new x({x:S+u*3,y:s-x.HEIGHT/2}),new x({x:S+u*5,y:s-x.HEIGHT/2}),new x({x:S+u*7,y:s-x.HEIGHT/2})];break}case 16:a=[{x:-90/2,y:n,width:wt,height:b}],l=[new x({x:S+u*0,y:s-x.HEIGHT/2}),new x({x:S+u*2,y:s-x.HEIGHT/2}),new x({x:S+u*4,y:s-x.HEIGHT/2}),new x({x:S+u*6,y:s-x.HEIGHT/2}),new x({x:S+u*8,y:s-x.HEIGHT/2})];break;case 17:a=[{x:-90/2,y:n,width:wt,height:b}],l=[new x({x:S+u,y:s-x.HEIGHT/2}),new x({x:S+u*3,y:s-x.HEIGHT/2}),new x({x:S+u*5,y:s-x.HEIGHT/2}),new x({x:S+u*7,y:s-x.HEIGHT/2})];break;case 18:break;case 19:{o=3,a=[{yDirection:-1,dockStartTime:0,x:S+u*3,y:n,width:ai,height:b}];break}case 20:{o=3;const c={yDirection:-1,dockStartTime:0,x:S+u*1,y:n-vt()*b,width:u*2,height:b},d={yDirection:-1,dockStartTime:0,x:ri-u*3,y:n-vt()*b,width:u*2,height:b};a=[c,d];break}case 21:o=1,a=[{x:-90/2,y:n,width:wt,height:b}];break;case 22:o=2,a=[{x:-90/2,y:n,width:wt,height:b}];break}return new ms(e,n,o,a,l)}function ws(t){for(let e=1;e<t.length;e++){const i=t[e-1],n=t[e];for(let s=0;s<Nt;s++)i.blocks[s].type===3&&n.blocks[s].type===0&&(n.blocks[s].type=3)}}const Ae=-1,li=1,vs={x:0,y:Ae},bs={x:-1,y:0},As={x:1,y:0},Ss=mt({x:-1,y:Ae}),Is=mt({x:1,y:Ae}),ks=3,De=1e3;class Ms{constructor(e,i){w(this,"host");w(this,"track");w(this,"horizontalMargin",0);w(this,"lastSlowdownTime",-1e3);w(this,"target",null);this.host=e,this.track=i}reset(){this.target=null}getMovement(e){const i=this.getCurrentBlock(),n=this.track.getBlock(i.row+1,i.col),s=this.goByRaft(i,n,e);return s||((this.target==null||this.hasReached(this.target))&&(this.target=this.findNextTarget(i)),this.goRoundObstacles(i,n,e)||this.moveOnTrack(i,n,e))}goByRaft(e,i,n){if(e.type!==H.Raft&&i.type===H.Raft&&(this.host.y>e.y+1.5*this.host.height||this.track.isFree(e.row+1,e.col)))return{x:0,y:this.moveAhead(e,i,n)};if(i.type===H.Raft&&this.host.y<=e.y+1.5*this.host.height&&!this.track.isFree(e.row+1,e.col))return Z;if(e.type===H.Raft&&!this.track.isFree(e.row+1,e.col)){let s=0;return this.host.x<e.x+this.host.width?s=1:e.x+e.width-2*this.host.width<this.host.x&&(s=-1),{x:s,y:0}}return e.type===H.Raft&&this.track.isFree(e.row,e.col)&&this.track.isFree(e.row+1,e.col)?vs:null}goRoundObstacles(e,i,n){if(this.target==null)return Z;if(e.type===H.Obstacle){if(e.y+e.height/2<this.host.y+this.host.height/2)return this.target.col<e.col?Ss:Is}else{if(this.target.col<e.col&&this.track.getBlock(e.row,e.col-1).type===H.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===H.Empty?bs:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,n)}:{x:-1,y:this.moveAhead(e,i,n)};if(e.col<this.target.col&&this.track.getBlock(e.row,e.col+1).type===H.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===H.Empty?As:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,n)}:{x:1,y:this.moveAhead(e,i,n)}}return null}moveOnTrack(e,i,n){if(this.target==null)return Z;let s=0;i.type===H.Empty&&this.host.y+this.host.height/2<e.y?s=li:s=this.moveAhead(e,i,n),s<0&&i.type===H.Empty&&this.host.y+this.host.height/2<e.y+e.height/2&&(s=0);let o=0;const a=this.host.x<this.target.x+this.horizontalMargin,l=this.target.x+this.target.width-this.horizontalMargin<=this.host.x+this.host.width;return a&&this.track.getBlock(e.row,e.col+1).type===H.Free?o=1:l&&this.track.getBlock(e.row,e.col-1).type===H.Free&&(o=-1),{x:o,y:s}}moveAhead(e,i,n){return i.type!==H.Free&&this.host.velocity.y<-.25*1.5?(De<n-this.lastSlowdownTime&&(this.lastSlowdownTime=n),li):this.host.velocity.y<-.25*3.5&&!this.isClearAhead(e)?(De<n-this.lastSlowdownTime&&(this.lastSlowdownTime=n),0):De<n-this.lastSlowdownTime?Ae:0}getCurrentBlock(){const e=Jn(this.host);let i=this.track.getBlockAt(e);return(i.type===H.Empty||i.type===H.Raft)&&i.y+i.height-this.host.height<e.y&&(i=this.track.getBlock(i.row-1,i.col)),i.type===H.Empty&&(i.x+i.width-this.host.width<e.x?i=this.track.getBlock(i.row,i.col+1):e.x<i.x+this.host.width&&(i=this.track.getBlock(i.row,i.col-1))),i}hasReached(e){return this.host.y+this.host.height<e.y+e.height}findNextTarget(e){const i=this.findNearestBlock(e.row+1,e.col);if(i==null||i.col!==e.col)return i;const n=this.findNearestBlock(i.row+1,i.col);if(n==null)return i;if(n.col<i.col){const s=this.track.getBlock(i.row,i.col-1);if(s.type===H.Free)return s}if(i.col<n.col){const s=this.track.getBlock(i.row,i.col+1);if(s.type===H.Free)return s}return i}isClearAhead(e){for(let i=e.row+1;i<=e.row+ks;i++)if(this.track.getBlock(i,e.col).type!==H.Free)return!1;return!0}findNearestBlock(e,i){for(let n=0;n<Nt-1;n++){const s=(vt()<.5?-1:1)*n,o=i+s,a=this.track.getBlock(e,o);if(a.type===H.Free||a.type===H.Raft)return this.horizontalMargin=vt(.2)*u,this.track.getBlock(e,o)}return null}}const rt=(t,e)=>2*Math.abs(e/t-Math.floor(e/t+.5));var pt=(t=>(t[t.Stand=0]="Stand",t[t.Walk=1]="Walk",t[t.Fall=2]="Fall",t[t.Celebrate=3]="Celebrate",t))(pt||{}),V=(t=>(t[t.Right=0]="Right",t[t.Forward=1]="Forward",t[t.Backward=2]="Backward",t[t.ForwardRight=3]="ForwardRight",t[t.BackwardRight=4]="BackwardRight",t))(V||{});const Es="rgb(200,150,150)",xs="rgb(230,230,230)",Cs="rgb(30,0,0)",Ps="rgb(170,120,120)",qt="rgb(140,140,140)",Le="rgb(120,120,120)",jt="rgb(140,140,220)",He="rgb(120,120,200)",Rs="rgba(0, 0, 0, 0.2";function ie(t,e,i,n,s,o,a,l,c){let d=0,g=0,y=0,f=0,m=0,v=0;const A=o===3||o===4,I=o===0;switch(a){case 1:d=I?600:A?400:300,v=Te(rt(d/2,s/2))*.02*n,g=m=-Math.PI/6+at(rt(d,s))*(Math.PI/3),y=f=-Math.PI/6+at(rt(d,s+d/2))*(Math.PI/3);break;case 3:{d=1500,v=Te(rt(d/2,s/2))*.15*n;const k=rt(d,s);g=at(k)*Math.PI*(1/8),y=-at(k)*Math.PI*(3/8),m=Math.PI*(1/8)-at(k)*Math.PI*(9/8),f=Math.PI*(1/8)-at(k)*Math.PI*(10/8);break}case 2:d=3200,v=Te(rt(d/2,s))*.02*n,g=-Math.PI*(3/8)+at(rt(d,s))*(Math.PI*(3/4)),y=-Math.PI*(3/8)+at(rt(d,s+d/2))*(Math.PI*(3/4)),f=-Math.PI*(8/8)+at(rt(d,s+d/2))*(Math.PI/4),m=-Math.PI*(8/8)+at(rt(d,s))*(Math.PI/4);break}t.save(),Ts(t,.5*i,n,i*.4-v/2),t.translate(0,-v);const M=.3*n,C=.25*n,E=.2*i,_=.1*i;switch(t.fillStyle=e,t.lineWidth=E,t.lineJoin="round",t.lineCap="round",e==="eliminated"&&(t.globalAlpha=.7),o){case 0:{const k=.5*i,R=.4*n,B=.5*i,N=.7*n;di(t,He,k,R,_,M,f),fi(t,Le,B,N,E,C,g),fi(t,qt,B,N,E,C,y),se(o,t,i,n,e,l,c),oe(o,t,i,n,e,l,c),di(t,jt,k,R,_,M,m)}break;case 1:case 2:{Dt(t,qt,.35*i,.7*n,E,C,-1,g,0),Dt(t,qt,.7*i,.7*n,E,C,1,y,0),se(o,t,i,n,e,l,c),Ft(t,jt,.25*i,.35*n,_,M,-1,f),Ft(t,jt,.75*i,.35*n,_,M,1,m),oe(o,t,i,n,e,l,c);break}case 3:{Dt(t,Le,.35*i,.7*n,E,C,-1,g,y/4),Dt(t,qt,.65*i,.7*n,E,C,1,y,y/4),Ft(t,He,.25*i,.35*n,_,M,-1,m,m/2),se(o,t,i,n,e,l,c),oe(o,t,i,n,e,l,c),Ft(t,jt,.75*i,.35*n,_,M,1,f,m/2);break}case 4:{Dt(t,Le,.65*i,.7*n,E,C,1,y,y/4),Dt(t,qt,.35*i,.7*n,E,C,-1,g,y/4),Ft(t,He,.75*i,.35*n,_,M,1,m,m/2),se(o,t,i,n,e,l,c),oe(o,t,i,n,e,l,c),Ft(t,jt,.25*i,.35*n,_,M,-1,f,m/2);break}}t.restore()}function Ts(t,e,i,n){t.save(),t.fillStyle=Rs,t.translate(e,i),t.beginPath(),t.arc(0,0,Math.max(0,n),0,2*Math.PI),t.fill(),t.restore()}const _t={};function yt(t,e,i){const n=ci(t),s=ci(e),o=Math.round((1-i)*n.r+i*s.r),a=Math.round((1-i)*n.g+i*s.g),l=Math.round((1-i)*n.b+i*s.b);return`rgb(${o}, ${a}, ${l})`}function ci(t){if(t==="eliminated")return{r:128,g:128,b:128};const e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t);return e?{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}:{r:0,g:0,b:0}}const Os=navigator.userAgent.toLowerCase().includes("firefox");function Gi(t,e,i,n,s,o){const a=`${i}-${e}-${n}-${s}`;if(o||!_t[a]){const l=t.createRadialGradient(n,s,s/8,n,s,n);if(i==="TORSO"?(l.addColorStop(0,yt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.2,yt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.5,yt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(1,yt(e,"rgb(0, 0, 0)",.3))):i==="HEAD"&&(l.addColorStop(0,yt(e,"rgb(0, 0, 0)",.3)),l.addColorStop(.5,yt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(.8,yt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(1,yt(e,"rgb(255, 255, 255)",.1))),Os){if(o)return hi(t,l,n*2,s*2);_t[a]=hi(t,l,n*2,s*4)}else{if(o)return l;_t[a]=l}}return _t[a]}function Fs(){for(const t in _t)delete _t[t]}function hi(t,e,i,n){const s=document.createElement("canvas");s.width=i,s.height=n;const o=s.getContext("2d");if(o)return o.fillStyle=e,o.fillRect(0,0,i,n),t.createPattern(s,"no-repeat")}function Ni(t,e,i,n,s,o){e&&(t.save(),t.translate(i,n),t.scale(s/80,o/80),t.fillStyle=e,t.fill(),t.restore())}function se(t,e,i,n,s,o,a=!1){const l=.2*i,c=t===0?.5*i:.45*i,d=.25*n,g=t===0?.28*i:.5*(i-c),y=.06*n;e.beginPath(),e.roundRect(g,y,c,d,l);const f=Gi(e,s,"HEAD",c,d,a);e.fillStyle=f||"black",e.fill(),Ni(e,o,g,y,c,d),Ds(e,t,i,c,d,l)}function oe(t,e,i,n,s,o,a=!1){const l=.4*n,c=.2*i,d=t===0?.5*i:.6*i,g=t===1||t===2?.2*i:.5*(i-d),y=.3*n;e.beginPath(),e.roundRect(g,y,d,l,c);const f=Gi(e,s,"TORSO",d,l,a);e.fillStyle=f||"black",e.fill(),Ni(e,o,g,y,d,l)}function di(t,e,i,n,s,o,a){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(a),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-o/4,o/2,0,o),t.stroke(),t.restore()}function fi(t,e,i,n,s,o,a){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(a),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-o/8,o/2,0,o),t.stroke(),t.restore()}function Ft(t,e,i,n,s,o,a,l,c=0){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(-a*.07*Math.PI),t.rotate(c),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(a*o/4,o/2,0,o),t.stroke(),t.restore()}function Dt(t,e,i,n,s,o,a,l,c){t.save(),t.strokeStyle=e,t.lineWidth=s,t.translate(i,n),t.rotate(c),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(a*o/8,o/2,0,o),t.stroke(),t.restore()}function Ds(t,e,i,n,s,o){if(e!==2&&e!==4)return;const a=.15*i,l=.6*o,c=n-a,d=s-a*1.75,g=s-d,y=e===2?(i-c)/2:(i-c)/2+(n-c)/2;t.save(),t.translate(y,g),t.shadowColor="rgba(0, 0, 0, 0.5)",t.fillStyle=Es,t.shadowOffsetY=-d/10;const f=0,m=0;t.beginPath(),t.roundRect(f,m,c,d,l),t.fill(),t.closePath(),t.shadowOffsetY=0;const v=.06*c,A=c/4,I=d/3,M=f+A,C=f+c-A,E=m+I;t.fillStyle=xs,t.beginPath(),t.arc(M,E,v,0,Math.PI*2),t.arc(C,E,v,0,Math.PI*2),t.fill(),t.closePath();const _=.025*c,k=.01*c,R=.01*d;t.fillStyle=Cs,t.beginPath(),t.arc(M+k,E+R,_,0,Math.PI*2),t.arc(C+k,E+R,_,0,Math.PI*2),t.fill(),t.closePath();const B=.15*c,N=.2*d,F=f+(c-B)/1.75,Y=m+(d-N)/1.5;t.fillStyle=Ps,t.beginPath(),t.moveTo(F,Y),t.lineTo(F+B/2,Y+N),t.lineTo(F-B/2,Y+N),t.closePath(),t.fill(),t.restore()}let Ge=1;const $i=(t,e)=>{const i=t/e;let n=window.innerWidth,s=window.innerHeight;n/s>i?n=s*i:s=n/i,n>t&&(n=t,s=t/i),s>e&&(s=e,n=e*i),p.width=n,p.height=s;const o=window.innerWidth/n,a=window.innerHeight/s,l=Math.min(o,a);Ge=l,p.style.position="absolute",p.style.left=`${(window.innerWidth-n*l)/2}px`,p.style.top=`${(window.innerHeight-s*l)/2}px`,p.style.transform=`scale(${l})`,p.style.transformOrigin="top left"},Ls=(t,e)=>{const i=p.getBoundingClientRect();t.x=(e.clientX-i.left)/Ge,t.y=(e.clientY-i.top)/Ge},bt="ontouchstart"in window,Hs=()=>{bt&&(window.oncontextmenu=t=>{t.preventDefault()})},ae=(t,e)=>{const i=s=>{s.preventDefault();const o=s.targetTouches[0];e(o!=null)},n=s=>{s.preventDefault(),e(!1)};t.addEventListener("touchstart",i),t.addEventListener("touchmove",i),t.addEventListener("touchend",n)},zi=(t,e)=>new Promise(i=>{const n=s=>{s.preventDefault();const o=s.changedTouches[0];if(!o)return;st(X.Keyboard),Ls({x:0,y:0},o);{if(p.removeEventListener("touchstart",n),e!==void 0)try{console.log(`Playing sound ID: ${e}`),st(e)}catch(l){console.error("Error playing sound:",l)}i()}};p.addEventListener("touchstart",n,{passive:!1})}),Ws=(t,e)=>zi(e,t),q={zIndex:"10",size:"40px",color:"rgba(255, 255, 255, 0.4)",background:"black",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",fontSize:"24px",lineHeight:"0"},Se=(t,e)=>{const i=document.createElement("button");return i.id=t,i.style.position="absolute",i.style.zIndex=q.zIndex,i.textContent=e,i.style.fontFamily="Impact",i.style.minWidth=q.size,i.style.minHeight=q.size,i.style.color=q.color,i.style.background=q.background,i.style.border=q.border,i.style.borderRadius=q.borderRadius,i.style.fontSize=q.fontSize,i.style.lineHeight=q.lineHeight,i.style.display="block",i},re=(t,e)=>{const i=Se(t,e);return i.style.background="rgba(50, 50, 50, 0.05)",i.style.display="none",i};let _s=0,Ne,Ui,Xi,Yi,Vi;const $e={movement:{x:0,y:0}},Bs=t=>{if(!Ne)return;const{left:e,right:i,up:n,down:s}=Ne,o=t?"block":"none";e.style.display=o,i.style.display=o,n.style.display=o,s.style.display=o},Gs=()=>{const t=Zn(),e=t.ArrowLeft||t.KeyA||Ui,i=t.ArrowRight||t.KeyD||Xi,n=t.ArrowUp||t.KeyW||Yi,s=t.ArrowDown||t.KeyS||Vi,o=e?-1:i?1:0,a=n?-1:s?1:0;o===0&&a===0?$e.movement=Z:$e.movement=mt({x:o,y:a})},Ns=()=>{qn(),Hs(),$s()},$s=()=>{if(!bt)return;const t={left:re("left","◁"),right:re("right","▷"),up:re("up","△"),down:re("down","▽")},{left:e,right:i,up:n,down:s}=t;document.body.appendChild(e),document.body.appendChild(i),document.body.appendChild(n),document.body.appendChild(s),ae(e,o=>Ui=o),ae(i,o=>Xi=o),ae(n,o=>Yi=o),ae(s,o=>Vi=o),window.addEventListener("resize",()=>ui(t),!1),ui(t),Ne=t},ui=t=>{const{left:e,right:i,up:n,down:s}=t,o=Math.max(window.innerWidth*.85,window.innerHeight*.9)*.1,a=o,l=o,c=a,d=o,g=a,y=o*.1,f=a*.1,m=Math.max(a*1.1,(window.innerHeight-p.height)/2-a*1.5),v=Math.max(a*.8,(window.innerHeight-p.height)/2-a*2-2*f),A=o*.2,I=o*.6;e.style.left=`${A}px`,e.style.bottom=`${m}px`,e.style.width=`${l}px`,e.style.height=`${c}px`,i.style.left=`${A+l+y}px`,i.style.bottom=`${m}px`,i.style.width=`${l}px`,i.style.height=`${c}px`,n.style.right=`${I}px`,n.style.bottom=`${v+g+f}px`,n.style.width=`${d}px`,n.style.height=`${g}px`,s.style.right=`${I}px`,s.style.bottom=`${v}px`,s.style.width=`${d}px`,s.style.height=`${g}px`},Lt=async t=>{await(bt?t?Ws(t):zi():Qn(t))},Zt=(t="continue",e=7.7)=>{const i=(bt?"Tap the screen to ":"Press ENTER to ")+t;L(i+(_s++%60===0?"":"█"),D.Small,"Courier New",1,e,!0,0,i)},zs=()=>$e;function Us(t,e){t.translate(e/2,0),t.scale(-1,1),t.translate(-e/2,0)}const pe=500,gi=1e3,Ki=["rgb(255, 255, 0)","rgb(255, 0, 0)","rgb(0, 128, 0)","rgb(0, 0, 255)","rgb(255, 165, 0)","rgb(255, 99, 71)","rgb(255, 192, 203)","rgb(106, 90, 205)","rgb(238, 130, 238)","rgb(30, 144, 255)","rgb(0, 255, 255)","rgb(255, 0, 255)","rgb(144, 238, 144)","rgb(211, 211, 211)","rgb(64, 224, 208)","rgb(0, 191, 255)","rgb(173, 216, 230)","rgb(240, 128, 128)","rgb(0, 255, 127)","rgb(255, 0, 255)","rgb(220, 20, 60)","rgb(230, 230, 250)","rgb(255, 127, 80)","rgb(0, 128, 128)","rgb(75, 0, 130)","rgb(250, 128, 114)","rgb(127, 255, 0)","rgb(218, 165, 32)","rgb(255, 182, 193)","rgb(210, 105, 30)","rgb(205, 92, 92)","rgb(128, 128, 0)","rgb(255, 69, 0)","rgb(135, 206, 235)","rgb(72, 209, 204)","rgb(160, 82, 45)","rgb(0, 255, 0)","rgb(0, 0, 128)","rgb(245, 222, 179)","rgb(70, 130, 180)","rgb(255, 255, 255)"],Ze=Ki[0],ze={width:2,height:2};class We{constructor(e,i,n=1+Math.random()*.6,s=1+Math.random()*.4){w(this,"ai");w(this,"rank",0);w(this,"finished",!1);w(this,"eliminated",!1);w(this,"timeOffset",vt(2e3));w(this,"direction",Z);w(this,"latestDirection",{x:0,y:-1});w(this,"color");w(this,"x",0);w(this,"y",0);w(this,"width");w(this,"height");w(this,"velocity",Z);w(this,"fallStartTime");w(this,"dropStartTime");w(this,"latestCheckpointIndex",0);this.ai=e===0||!i?null:new Ms(this,i),this.color=Ki[e],this.width=ze.width*n,this.height=ze.height*s}get doesNotCollide(){return this.finished||this.eliminated||this.fallStartTime!=null}isVisible(e){return!(this.fallStartTime!=null&&pe<e-this.fallStartTime)}setDirection(e){this.direction=e,he(e)||(this.latestDirection=e)}getMovement(e){return this.ai?this.ai.getMovement(e):zs().movement}move(){this.eliminated||this.finished?(this.direction=Z,this.velocity=Z):(this.x+=this.velocity.x,this.y+=this.velocity.y)}stop(){this.y+=this.velocity.y*8}drop(e,i){var n;this.x=i.x,this.y=i.y,this.direction=Z,this.latestDirection={x:0,y:-1},this.velocity=Z,this.fallStartTime=void 0,this.dropStartTime=e,(n=this.ai)==null||n.reset()}draw(e,i,n){const s=this.latestDirection.y!==0?this.latestDirection.x===0?this.latestDirection.y<0?V.Forward:V.Backward:this.latestDirection.y>0?V.BackwardRight:V.ForwardRight:V.Right;r.save();const o=this.height*3,a=o-this.height;if(r.translate(this.x,this.y-a),this.latestDirection.x<0&&Us(r,this.width),this.fallStartTime!=null){const c=Math.max(1-Oe((e-this.fallStartTime)/pe),0);r.translate(this.width/2,o/2),r.scale(c,c),r.translate(-this.width/2,-o/2),r.globalAlpha=Oe(c)}else this.dropStartTime&&e-this.dropStartTime<gi&&(r.globalAlpha=Oe((e-this.dropStartTime)/gi));const l=he(this.direction)&&this.fallStartTime==null?0:e+this.timeOffset;ie(r,this.eliminated?"eliminated":this.color,this.width,o,l,this.finished?e%3600<1800?V.Backward:V.BackwardRight:s,this.getAnimation(),n),r.restore()}getAnimation(){return this.fallStartTime!=null?pt.Fall:he(this.direction)?pt.Stand:pt.Walk}}const Xs=.005,mi=2e3;class Ys{constructor(e,i){w(this,"elements");w(this,"startY");w(this,"checkpoints");w(this,"specialElements");w(this,"finishY");w(this,"elementCount");w(this,"width");w(this,"height");this.elements=ps(e,i),this.elementCount=this.elements.length,this.specialElements=this.elements.filter(o=>o.surfaces.some(a=>me(a)||Be(a))),this.startY=i,this.finishY=this.startY-(this.elements.length-1)*b;const n=Math.min(...this.elements.map(o=>o.minX)),s=Math.max(...this.elements.map(o=>o.maxX));this.width=s-n,this.height=this.elements.length*b,this.checkpoints=this.elements.filter((o,a)=>o.type===ht.CheckPoint||a===0).map(o=>({y:o.y+o.height,element:o}))}update(e,i,n){for(let s=0;s<this.specialElements.length;s++){const o=this.specialElements[s];for(let a=0;a<o.surfaces.length;a++){const l=o.surfaces[a];if(me(l))for(let c=0;c<n.length;c++){const d=n[c];l.y<=d.y&&d.y+d.height<l.y+l.height&&l.x<=d.x&&d.x+d.width<=l.x+l.width&&(d.velocity=ft(d.velocity,{x:0,y:-.002*l.force*i}))}if(Be(l)){const c=l,d=o.y,g=o.y-b;c.yDirection===-1&&c.y<=g?(c.yDirection=0,c.dockStartTime=e):c.y<=g&&e-c.dockStartTime>mi?c.yDirection=1:c.yDirection===1&&d<=c.y?(c.yDirection=0,c.dockStartTime=e):d<=c.y&&e-c.dockStartTime>mi&&(c.yDirection=-1);const y=c.yDirection*Xs*i;c.y+=y;for(let f=0;f<n.length;f++){const m=n[f];ge(c,m)&&(m.y+=y)}}}}}get(e){return this.elements[e]}isFree(e,i){if(e<0||this.elements.length<=e)return!1;const n=this.elements[e];return n.surfaces.length===0?this.elements[Math.max(e-1,0)].isFree(i,n.y):n.isFree(i)}getBlock(e,i){return e<0||this.elements.length<=e?Bi(e,i,this.startY-e*b):this.elements[e].getBlock(i)}getBlockAt(e){const i=Math.floor(Math.max(this.startY-e.y,0)/b),n=Math.min(i,this.elements.length-1),s=Math.floor((e.x-S)/u);return this.getBlock(n,s)}getCheckpoint(e){return this.checkpoints[e].element}findLatestCheckpoint(e){for(let i=this.checkpoints.length-1;i>=0;i--){const n=this.checkpoints[i];if(e<n.y-n.element.height*.15)return i}return 0}getBetween(e,i){const n=Math.ceil(Math.max(this.startY-e,0)/b),s=Math.floor(Math.max(this.startY-i,0)/b);return{minI:Math.max(s-1,0),maxI:Math.min(n,this.elements.length)-1}}isOnPlatform(e,i){const{minI:n,maxI:s}=e;for(let o=s;o>=n;o--){const l=this.get(o).surfaces;for(let c=0;c<l.length;c++){const d=l[c];if(ge(i,d))return!0}}return!1}}const Vs=70,pi=400,yi=5,wi=40,Ks=3*_i,vi=1e3;var Ue=(t=>(t[t.RUNNING=0]="RUNNING",t[t.GAME_OVER=1]="GAME_OVER",t[t.FINISHED=2]="FINISHED",t))(Ue||{});function qs(t){for(let e=t.length-1;e>=0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}class bi{constructor(e,i,n,s,o){w(this,"camera",new is(this,p));w(this,"platePattern");w(this,"track");w(this,"characters",[]);w(this,"charactersCount",40);w(this,"player",new We(0,void 0,0,0));w(this,"x");w(this,"y");w(this,"width");w(this,"height");w(this,"state",0);this.platePattern=o,this.track=new Ys(e,pi),this.x=0-this.track.width/2-yi,this.y=pi-this.track.height-wi,this.width=this.track.width+2*yi,this.height=this.track.height+2*wi;const a=this.track.get(0),l=15,c=a.width/l,d=ze.height*1.9,g=c*.3;this.player=new We(0,this.track,i,n),this.characters.push(this.player);for(let f=1;f<(s?s.length:this.charactersCount);f++){if(s&&s[f].eliminated)continue;const m=new We(f,this.track);this.characters.push(m)}const y=[this.player,...this.characters];qs(y);for(let f=0;f<y.length;f++){const m=y[f],v=Math.floor(f/l),A=f%l,I={x:a.minX+g+A*c,y:a.y+v*d};m.x=I.x,m.y=I.y}this.camera.follow(this.player),this.camera.visibleAreaHeight=Vs,this.camera.yAdjust=-.25,this.camera.update(0)}update(e,i){this.camera.update(e),this.track.update(e,i,this.characters),this.calculateMovement(e,i),this.checkCollisions();for(let n=0;n<this.characters.length;n++)this.characters[n].move();this.updateCharacterRanks(),this.checkGameState()}playWithVolumeByDistance(e,i){const n=Math.abs(i-this.player.y);st(e,Math.max(0,Math.min(1,1-n/Ks)))}calculateMovement(e,i){for(let n=0;n<this.characters.length;n++){const s=this.characters[n],o=this.track.getBetween(s.y,s.y+s.height);let a=Z;s.fallStartTime!=null?e-s.fallStartTime>pe+vi&&this.dropToLatestCheckpoint(e,s):s.fallStartTime==null&&!this.track.isOnPlatform(o,s)?(s.fallStartTime=e,s===this.player&&setTimeout(()=>{const l=this.track.getCheckpoint(this.player.latestCheckpointIndex),c=l.y+l.height/2;this.camera.setTransition({startY:this.player.y,endY:c,startTime:e,duration:vi+500})},pe)):(a=s.getMovement(e),s.setDirection(a),s.velocity=hs(s,a,i))}}checkCollisions(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e];if(!i.doesNotCollide)for(let n=e+1;n<this.characters.length;n++){const s=this.characters[n];s.doesNotCollide||fs(i,s)&&(!i.ai||zt(i.velocity)>.3)&&this.playWithVolumeByDistance(X.Hit,i.y)}}for(let e=0;e<this.characters.length;e++){const i=this.characters[e],n=this.track.getBetween(i.y,i.y+i.height),{minI:s,maxI:o}=n;for(let a=s;a<=o;a++){const l=this.track.get(a);for(let c=0;c<l.objects.length;c++){const d=l.objects[c];ds(i,d)&&this.playWithVolumeByDistance(X.Bounce,d.y)}}}}renderText(e,i,n,s){const o=r.measureText(e),a=i+(s-o.width)/2;r.fillText(e,a,n)}updateCharacterRanks(){const e=this.characters.filter(s=>s.finished),i=this.characters.filter(s=>!s.finished);e.sort((s,o)=>s.rank-o.rank),i.sort((s,o)=>s.y+s.height/2-(o.y+o.height/2)),[...e,...i].forEach((s,o)=>{s.rank=o+1})}checkGameState(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e],n=this.track.findLatestCheckpoint(i.y),s=this.track.getBetween(i.y,i.y+i.height);if(!(i.fallStartTime!=null||!this.track.isOnPlatform(s,i))){if(n>i.latestCheckpointIndex&&(i.latestCheckpointIndex=n,i.rank===13)){i.eliminated=!0,i.stop(),i.ai||(this.state=1);continue}if(i.y+i.height<this.track.finishY&&(i.rank===13?(i.eliminated=!0,i.stop(),i.ai||(this.state=1)):(i.finished=!0,i.stop()),!i.ai||i.rank==this.characters.length-13)){let o=this.characters.filter(a=>a.eliminated).length;for(let a=0;a<this.characters.length;a++)if(this.characters[a].rank>this.characters.length-13)if(o<13)this.characters[a].eliminated||(this.characters[a].eliminated=!0,o++);else break;this.characters[0].eliminated?this.state=1:this.state=2}}}}dropToLatestCheckpoint(e,i){const n=this.track.getCheckpoint(i.latestCheckpointIndex),s={x:us(n.minX+u,n.maxX-u),y:n.y+n.height/2,width:i.width,height:i.height};if(!this.characters.some(o=>ge(o,s))){if(i.rank===13){i.eliminated=!0,i.stop(),i.ai||(this.state=1);return}i.drop(e,s),this.playWithVolumeByDistance(X.Teleport,i.y),i===this.player&&this.camera.follow(i)}}drawCross(e,i,n,s="red"){r.strokeStyle=s,r.lineWidth=n/4,r.beginPath(),r.moveTo(e-n/2,i-n/2),r.lineTo(e+n/2,i+n/2),r.moveTo(e+n/2,i-n/2),r.lineTo(e-n/2,i+n/2),r.stroke()}draw(e,i){r.save(),r.translate(p.width/2,p.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y);const n=[...this.characters];this.drawTrack(n),this.drawObjects(e,i,n),r.restore(),this.drawGradient(),this.state===0&&(r.save(),r.translate(p.width/2,p.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y),this.drawStatusOfCharacters(e),this.drawTopStatusTexts(),r.restore())}drawTrack(e){r.save();const i=this.camera.getViewArea(),{minI:n,maxI:s}=this.track.getBetween(i.y,i.y+i.height);for(let o=s;o>=n;o--){const a=this.track.get(o),l=a.surfaces;r.fillStyle=a.color,r.shadowColor=a.color.replace("rgb(","rgba(").replace(")",",0.3)"),r.shadowOffsetY=a.height*(a.type===ht.Raft?2:6),a.type===ht.Raft&&(r.globalAlpha=.5);for(let c=0;c<l.length;c++){const d=l[c];this.drawSurface(a,d)}r.globalAlpha=1,e.push(...a.objects)}r.restore()}drawSurface(e,i){if(r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=.1,e.type!==ht.Raft&&r.strokeRect(i.x,i.y+.1,i.width,i.height),r.save(),me(i)){const n=i.force;r.fillStyle=`rgba(${220+n*50}, ${80+n*50}, ${60+n*50}, ${1-n})`}if(r.fillRect(i.x,i.y,i.width,i.height),r.restore(),e.type===ht.Raft)r.strokeRect(i.x,i.y,i.width,i.height);else if(me(i)){r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const n=e.width/(e.width/10);for(let s=1;s<=i.width/9-1;s++)r.fillText("⇪",i.x+s*n,i.y+i.height/2)}else if(e.type===ht.CheckPoint||e.type===ht.Finish){r.fillStyle="rgba(255, 255, 255, 0.2)",r.fillRect(i.x,i.y+i.height-4,i.width,4),r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const n=e.width/10;for(let s=1;s<=i.width/9-1;s++)r.fillText(e.type===ht.Finish?"✪":"✓",i.x+s*n,i.y+i.height/2.4)}this.platePattern&&(r.fillStyle=this.platePattern,r.fillRect(i.x,i.y,i.width,i.height),r.fillStyle=e.color)}drawObjects(e,i,n){n.sort((s,o)=>s.y+s.height/2-(o.y+o.height/2));for(let s=0;s<n.length;s++)n[s].draw(e,i)}drawGradient(){const e=r.createRadialGradient(p.width/2,p.height/2,0,p.width/2,p.height/2,p.width/1.5);e.addColorStop(1,"rgba(0, 0, 0, 0)"),e.addColorStop(.8,"rgba(0, 0, 0, 0)"),e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),r.fillStyle=e,r.fillRect(0,0,p.width,p.height);const i=r.createLinearGradient(0,0,0,p.height);i.addColorStop(0,"rgba(0, 0, 0, 1)"),i.addColorStop(.2,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),r.fillStyle=i,r.fillRect(0,0,p.width,p.height)}drawStatusOfCharacters(e){this.characters.forEach(i=>{if(i.isVisible(e)){const n=`${i.rank}`;r.fillStyle=i.rank===13?"red":i.eliminated?"crimson":i.rank>this.characters.length-13?"orange":i.rank===1?"lightgreen":i.ai?"white":"yellow",r.font=i.ai?i.eliminated||i.rank===13?"1.2px Sans-serif":"1px Sans-serif":"1.4px Sans-serif",i.ai||(r.save(),r.font="4.0px Sans-serif",this.renderText("▲",i.x,i.y-i.height*3.25,i.width),r.restore()),i.eliminated&&this.drawCross(i.x-.25,i.y-i.height*2.7,1),this.renderText(i.eliminated?"13":n,i.x,i.y-i.height*2.5,i.width)}})}drawTopStatusTexts(){const e=this.characters.filter(n=>n.eliminated).length.toString(),i=this.characters.filter(n=>n.finished).length.toString();r.font="4px Impact",r.fillStyle=this.player.rank===13?"red":this.player.eliminated?"crimson":this.player.rank>this.characters.length-13?"orange":this.player.rank===1?"lightgreen":"yellow",r.fillText("▲ "+this.player.rank+" / "+this.characters.length,-42,this.camera.y-30),r.fillStyle="green",r.fillText("✪ "+i+" / "+(this.characters.length-13)+" QUALIFIED",-15,this.camera.y-30),r.fillStyle="red",this.drawCross(28,this.camera.y-31.5,3),r.fillText(e+" / 13",32,this.camera.y-30)}}const Ai=[h.FullWidthWithObstacles,h.FullWidth,h.FullWidth,h.FullWidth],Si=[h.Basic,h.SlopeEmptyPassage,h.SlopeEmptyPassage,h.DualPassage,h.Basic,h.RightPassage,h.RightPassage,h.Basic,h.Basic,h.Raft,h.Chasm,h.FullWidth],js=[h.BasicSteepSlope,h.BasicSlope,h.FullWidthWithObstacles,h.FullWidthWithMoreObstacles,h.FullWidthWithObstacles,h.DualPassage,h.DualPassage,h.DualPassage,h.FullWidth];function Qs(){const t=vt(1);return[h.Checkpoint,...t<.5?Ai:Si,h.Checkpoint,...t<.5?Si:Ai,h.Checkpoint,...js,h.Finish]}const Ii=[h.FullWidth,h.BasicSteepSlope,h.BasicSlope,h.BasicSlope,h.Basic,h.Basic,h.Basic,h.Narrow,h.VeryNarrow,h.VeryNarrow,h.Basic,h.FullWidthWithObstacles,h.SlopeObstacleSlope,h.PassageEmptySlope,h.PassageEmptySlope,h.DualPassage,h.DualPassage,h.FullWidth,h.FullWidthWithObstaclesOnRight,h.FullWidthWithObstaclesOnRight2,h.FullWidthWithObstaclesOnRight,h.FullWidth,h.Raft,h.Chasm],ki=[h.FullWidth,h.VeryNarrow,h.FullWidth,h.BasicSteepSlope,h.BasicSlope,h.BasicSlope,h.Basic,h.Basic,h.Basic,h.Basic,h.TwoRafts,h.Chasm];function Zs(){const t=vt(1);return[h.Checkpoint,...t<.5?Ii:ki,h.Checkpoint,...t<.5?ki:Ii,h.Finish]}const Mi=[h.FullWidth,h.Basic,h.Narrow,h.VeryNarrow,h.Basic,h.SlopeEmptySlope,h.SlopeEmptySlope,h.SlopeEmptySlope,h.DualPassage,h.DualPassage,h.Basic,h.FullWidthWithObstacles,h.VeryNarrow,h.Basic],Ei=[h.FullWidth,h.SlopeEmptySlope,h.PassageEmptySlope,h.PassageEmptySlope,h.DualPassage,h.SlopeEmptyPassage,h.DualPassageExt,h.TriplePassage,h.TriplePassage,h.TriplePassage,h.FullWidth],xi=[h.FullWidthWithObstacles,h.FullWidthWithMoreObstacles,h.FullWidth,h.TwoRafts,h.Chasm,h.Basic,h.FullWidth],Ci=[h.BasicSteepSlope,h.BasicSlope,h.BasicSlope,h.Basic,h.Basic,h.Basic,h.DualPassage,h.DualPassageExt,h.TriplePassage,h.TriplePassage,h.DualPassageExt,h.PassageEmptySlope,h.PassageEmptySlope,h.Basic,h.Basic,h.Narrow,h.VeryNarrow,h.FullWidth,h.RightPassage,h.FullWidth,h.TwoRafts,h.Chasm];function Js(){const t=vt(1);return[h.Checkpoint,...t<.5?Mi:Ei,h.Checkpoint,...t<.5?Ei:Mi,h.Checkpoint,...t<.5?xi:Ci,h.Checkpoint,...t<.5?Ci:xi,h.Finish]}const to="2025-08-12 23:42";async function eo(){let t=!1;const e=document.getElementById("ios-fullscreen-video");if(e&&e.webkitDisplayingFullscreen&&(t=!0),t)try{return e&&typeof e.webkitExitFullscreen=="function"&&e.webkitExitFullscreen(),e&&(e.pause(),e.currentTime=0),document.exitFullscreen&&await document.exitFullscreen(),!0}catch(n){return console.warn("iOS fullscreen exit failed:",n),!1}const i=document.getElementById("ios-fullscreen-video")||document.createElement("video");i.id||(i.id="ios-fullscreen-video",i.playsInline=!0,i.setAttribute("playsinline","playsinline"),i.muted=!0,i.setAttribute("muted","muted"),i.autoplay=!1,i.loop=!0,i.style.width="1px",i.style.height="1px",i.style.position="absolute",i.style.opacity="0.01",i.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAAAAG1wNDJtcDQxaXNvbWlzbzIAAAACbWV0YQAAAAAAAAAoaGRscgAAAAxBVkMgQ29kaW5nAAAAQ2NvbHJzAAAAG3VpbnQCAAAAGFFSRwKCPQAAAEAAAAJNAAAAAP9tZGF0AAAAEgEH//4PMkXKj////jA9FbmQ=",document.body.appendChild(i));try{if(await i.play(),await new Promise(s=>setTimeout(s,100)),typeof i.webkitEnterFullscreen=="function")return i.webkitEnterFullscreen(),console.log("Requested iOS fullscreen mode"),!0}catch(n){console.warn("iOS fullscreen attempt failed:",n)}return!1}async function Pi(){if(Jt&&await eo())return;const t=document.documentElement;if(document.fullscreenElement)try{await document.exitFullscreen()}catch(e){e instanceof Error&&console.error(`Error exiting fullscreen: ${e.message} (${e.name})`);return}else try{t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.mozRequestFullScreen?await t.mozRequestFullScreen():t.msRequestFullscreen&&await t.msRequestFullscreen()}catch(e){console.warn("Standard fullscreen failed, falling back to canvas positioning",e instanceof Error?e.message:e);const i=document.querySelector("canvas");i&&(i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.zIndex="1000");return}}const ye="startButton",qi="restartButton",ji="fullscreenButton";function io(t){const e=Se(ji,"⛶");return e.style.top="10px",e.style.right="10px",e.style.display=t?"none":"block",e}function no(){const t=Se(qi,"↺");return t.style.top="10px",t.style.right="60px",t.style.display="none",t}function so(){const t=document.createElement("button");return t.id=ye,t.style.position="absolute",t.style.background="transparent",t.style.border="none",t.style.fontSize="2vw",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.zIndex=q.zIndex,t.style.color=q.color,t.style.display="none",t.style.padding="20vw 0 0 0",t.style.fontFamily="Courier New",t.style.zIndex=q.zIndex,t.textContent="Tap the screen to continue█",t}const oo=()=>{const t=Se("performanceToggleButton","");return Ke?(t.style.top="10px",t.style.left="10px"):(t.style.top="60px",t.style.right="10px",t.style.height=`${parseInt(q.size)/2}px`,t.style.padding="20px 0",t.style.fontSize=`${parseInt(q.fontSize)/2}px`,t.style.background="rgba(0, 0, 0, 0.2)",t.style.border="none"),t.addEventListener("click",e=>{e.preventDefault(),Di(),t.blur()}),gn(t),t},ao=to,Xe=1e3/60,ro=Xe*5;let Ye=performance.now(),Et=0,xt=1+Math.random()*.6,Ct=1+Math.random()*.3,le=1,T,z=0,Ie=0,Qi=0;const lo=5e3;let P=0,Zi=0;const we=En(),Ri=xn();let Mt=0;const it=async t=>{Ie=t,ii(t===6||t===5);const e=document.getElementById(qi);e&&(e.style.display=t!==1?"block":"none");const i=document.getElementById(ji);switch(i&&(i.style.display=t!==1||!bt?"block":"none"),Bs(t===6),z=1280*2,t){case 2:await jn(0),await Lt(),it(3);break;case 3:await Lt(X.Race),it(4);break;case 4:it(5);break;case 5:if(Mt=0,Et>1&&T&&!T.player.eliminated){const n=Et===3?Js():Zs();T=new bi(n,xt,Ct,T.characters,Ri)}else T=new bi(Qs(),xt,Ct,void 0,Ri);P=z,Zi=Qi,Fi();break;case 7:P=1,st(X.GameOver),xt=1+Math.random()*.6,Ct=1+Math.random()*.3,await Lt(X.Restart),Et=1,it(2);break;case 8:ii(!1),wn(),P=1,st(X.Finished),T&&T.characters.length>14?(await Lt(X.Race),Et++,it(5)):(await Lt(X.Start),Et=1,Fs(),it(2));break;case 6:break;case 1:Yn();break}},Ji=t=>{requestAnimationFrame(Ji);const e=t-Ye;if(e>=Xe){const i=Math.min(e,ro);Ye=t-e%Xe,co(t,i),fn(t)&&fo(t,i)}},co=(t,e)=>{switch(Ie){case 6:{Gs(),T==null||T.update(t,e),(T==null?void 0:T.state)===Ue.GAME_OVER?it(7):(T==null?void 0:T.state)===Ue.FINISHED&&it(8);break}case 5:{Mt===2&&P<z/4?(st(X.Go),Mt++):(Mt===1&&P<z/2||Mt===0&&P<z)&&(st(X.Count),Mt++);break}}};let de=0;const Ti="LOADING...",ho=()=>{const t=de<10?Ti.substring(0,de):"LOADING...";L(t+(de++%60===0?"":"█"),D.Small,"Courier New",1,7.7,!0,0,Ti)},fo=(t,e)=>{switch(Qi=t,r.save(),r.fillStyle="rgb(0, 0, 20)",r.fillRect(0,0,p.width,p.height),T==null||T.draw(t,e),r.restore(),r.save(),Ie){case 0:{ho(),de++,Li(),ct(!1);break}case 1:{if(uo(!0),bt){const i=document.getElementById(ye);i&&i.style.display==="none"&&(i.style.display="block")}else Zt("start");break}case 2:{_e(t++,!1,0),kt(),ct(!0);break}case 3:{_e(t++,!0,le=le+.01),kt(),ct(!0);break}case 4:{_e(t++,!0,le=le+.01);const i=p.width/2,n=p.height/2;r.beginPath(),r.arc(i,n,P,0,Math.PI*2),r.fillStyle="#802010",r.fill(),P<z&&(P+=e),kt(),ct(!0);break}case 5:{const i=p.width/2,n=p.height/2;P<=0?it(6):(P>0&&(r.beginPath(),r.arc(i,n,P,0,Math.PI*2),r.fillStyle=P<z/4?"#105000":P<z/2?"#CCCC40":"#802010",r.fill()),P<z/4?L("▲ GO! ▲",D.Xl,"Impact",P/z*4):P<z/2?L("Set...",D.Xl,"Impact",1):L("Ready...",D.Xl,"Impact",1),P>0&&(P=(1-(t-Zi)/lo)*z)),kt(),ct(!0);break}case 7:{const i=p.width/2,n=p.height/2;r.beginPath(),r.arc(i,n,P,0,Math.PI*2),r.fillStyle="#802010",r.fill(),L("❌ ELIMINATED!",D.Large,"Impact",1,-4.5),(T==null?void 0:T.player.rank)===13?L("Don't be the 13TH GUY",D.Small,"Sans-serif"):(L("Don't be one of the last 13TH GUYs",D.Small,"Sans-serif"),L("The final rank is "+(T==null?void 0:T.player.rank)+".",D.Normal,"Impact",1,3.1)),P>=z&&Zt("continue",9),P<z&&(r.save(),r.globalAlpha=.7,r.translate(p.width/8,P*2-p.height),ie(r,"eliminated",p.height/6*xt,p.height/2*Ct,t,V.Backward,pt.Fall,we),r.globalAlpha=0,r.restore()),P<z&&(P+=e),kt(),ct(!0);break}case 8:{const i=p.width/2,n=p.height/2;r.beginPath(),r.arc(i,n,P,0,Math.PI*2),r.fillStyle="#105000",r.fill(),P>=z/4&&(T&&T.characters.length>14?(L("✪ QUALIFIED!",D.Large,"Impact",1,-5),L("☻",D.Huge,"Impact"),L("Ready for next round "+(Et+1)+" / 3",D.Normal,"Sans-serif",1,3.8)):(L("GAME FINISHED!",D.Large,"Impact",1,-5),L("☻",D.Huge,"Impact"),L("Congratulations to the winner!",D.Normal,"Impact",1,3.8)),P>=z&&Zt(),r.save(),r.translate(P<p.width/6?P:p.width/6,p.height/3),ie(r,Ze,p.height/6*xt,p.height/2*Ct,t,P<p.width/6?V.Right:T&&T.characters.length<=14||t%3600>1800?V.Backward:V.BackwardRight,T&&T.characters.length>14?pt.Walk:pt.Celebrate,we),r.restore()),P<z&&(P+=e),kt(),ct(!0);break}default:{const i=document.getElementById(ye);i&&i.style.display!=="none"&&(i.style.display="none"),ct(!1);break}}r.restore()},tn=()=>{L("FROST𖤓SUN",D.Small,"Impact",1,4,!1,0,"FROST𖤓SUN",["#ACD5F3","orange"]),L("presents",D.Tiny,"Impact",.5,5.25,!1),L("Don't be the",D.Small,"Impact",1,-1.8,!0,-.7),L("❌ 13TH GUY",D.Xl,"Impact",1,1.8),L("Director's cut",D.Small,"Impact",.5,3.8,!0,-.1),L(ao,D.Tiny,"Impact",.5,34,!1)},_e=(t,e,i)=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,p.width,p.height),r.fill(),r.save(),r.translate(p.width/8+i,p.height/3),ie(r,Ze,(e?p.height/6/i:p.height/6)*xt,(e?p.height/2/i:p.height/2)*Ct,t,e?V.Forward:t%3600<1800?V.BackwardRight:V.Backward,pt.Walk,we,e),r.restore(),e?(L("Avoid being the 13th or among the last 13",D.Small,"Sans-serif",1,-1.2),L("or you will be eventually ❌ eliminated!",D.Small,"Sans-serif",1,1.3),L("MOVE WITH",D.Xs,"Sans-serif",.8,-7.5),L("▲ / W - ▼ / S - ◄ / A - ► / D",D.Xs,"Sans-serif",.8,-5.6),Ie===3&&Zt("start the race!")):(tn(),Zt()),r.restore()},uo=t=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,p.width,p.height),r.fill(),r.save(),r.translate(p.width/8,p.height/3),ie(r,Ze,p.height/6*xt,p.height/2*Ct,0,V.Backward,pt.Stand,we),r.restore(),tn(),r.filter="",Li(),kt(),ct(t)};async function Oi(){const t=document.getElementById(ye);t&&(t.style.display="none");const e=oo();document.body.appendChild(e),Et=1,it(2)}const go=async()=>{p.tabIndex=0,p.style.outline="none",pn(),Ns(),Ye=performance.now(),window.requestAnimationFrame(Ji);const t=io(bt),e=no(),i=so();document.body.appendChild(e),document.body.appendChild(t),document.body.appendChild(i),t.addEventListener("click",n=>{n.stopPropagation(),Pi(),p.focus()}),e.addEventListener("click",n=>{n.stopPropagation(),window.location.reload()}),await Xn(),it(1),bt?i.addEventListener("click",async n=>{n.stopPropagation(),i.style.display="none",st(X.Start),await new Promise(s=>setTimeout(s,100)),await Pi(),p.focus(),await Oi()},{passive:!1,once:!0}):(await Lt(X.Start),await Oi())},en=1280,nn=720;window.addEventListener("resize",()=>$i(en,nn),!1);$i(en,nn);go();
