var ds=Object.defineProperty;var fs=(t,e,i)=>e in t?ds(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var p=(t,e,i)=>fs(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const At=/iPad/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,us=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),ke=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Rt=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&navigator.maxTouchPoints>1,ii=/Android/.test(navigator.userAgent),Ze=!ke&&!At,u=document.querySelector("canvas"),a=u.getContext("2d",{willReadFrequently:!0}),gs=60;let si=0,O=null,ne=!1,$t=!1;function ni(t){$t=t,console.log(`Race mode set to: ${t?"ACTIVE":"INACTIVE"}`)}let z="auto",tt="high";function xe(){return z==="auto"?tt:z}function ms(){if(At&&us)try{window.localStorage.setItem("test","test"),window.localStorage.removeItem("test")}catch{return!0}let t=!1;try{const s="test_private";localStorage.setItem(s,s),localStorage.removeItem(s)}catch{t=!0}const e=typeof navigator.hardwareConcurrency<"u"&&navigator.hardwareConcurrency<=2||typeof navigator.deviceMemory<"u"&&navigator.deviceMemory<2;return Rt&&t||e?(console.log("Limited resources or iOS private browsing - using LOW performance mode"),!0):(navigator.hardwareConcurrency<=4&&(!navigator.deviceMemory||navigator.deviceMemory<=4)&&!Rt&&!At&&(console.log("Older desktop detected - using MEDIUM performance mode"),z==="auto"?(tt="medium",wt()):ps("medium")),!1)}function ys(t){if(!$t||xe()!=="low")return!0;const e=1e3/gs;return t-si>=e?(si=t,!0):!1}function ps(t){console.log(`Setting graphics performance mode to: ${t}`),z=t,wt()}function wt(){if(O){let t;z==="auto"?t=`${z} (${tt})`:t=z,ke?O.textContent=`GFX: ${t}`:O.textContent=`[G] GFX: ${t}`}}function ws(){z="auto";const t=navigator.hardwareConcurrency<=4&&(!navigator.deviceMemory||navigator.deviceMemory<=4)&&!Rt&&!At;ms()?tt="low":t?tt="medium":tt="high",console.log(`AUTO mode initialized with effective setting: ${tt}`),wt()}function As(){console.log("Initializing graphics with performance detection..."),ws(),Ps(),ne=!1,console.log("Performance mode set to:",z)}function Wi(){if(ne||z!=="auto")return;console.log("Checking performance for AUTO mode..."),ne=!0;const t=!Rt&&!ii&&!At&&(navigator.hardwareConcurrency>4||navigator.gpu!==void 0),e=!Rt&&!ii&&!At,i=t?65:e?45:25,s=t?55:e?45:20,n=performance.now();setTimeout(()=>{const r=performance.now()-n;if(r>i&&tt==="high")if(e)console.log("Performance issues on desktop detected"),tt="medium",wt();else{tt="medium",wt();const l=performance.now();setTimeout(()=>{performance.now()-l>i&&(tt="low",wt())},300)}else r>s&&z==="high"&&!e&&(tt="medium",wt())},300)}function bs(){ne=!1}function _i(){const t=["auto","high","medium","low"],i=(t.indexOf(z)+1)%t.length;z=t[i],z==="auto"&&$t&&(ne=!1,Wi()),wt(),O&&O.blur(),console.log("Performance mode toggled to:",z)}let dt=null,ee=null;const vs=(t,e,i)=>{if(dt=document.createElement("canvas"),dt.width=t,dt.height=e,ee=dt.getContext("2d"),ee){ee.fillStyle=`rgba(0, 0, 0, ${1-i})`;for(let s=0;s<e;s+=2)ee.fillRect(0,s,t,1)}},ct=(t=!0)=>{const e=u.width,i=u.height;let s;const n=xe();$t?s=n:s=n==="low"?"medium":n;const o=t?.7:.8;let r=o,l=t?10:0;switch(s){case"low":{a.fillStyle="rgba(0, 0, 0, 0.2)",a.fillRect(0,0,e,i),a.globalAlpha=.05,a.fillStyle="#000";for(let y=0;y<i;y+=2)a.fillRect(0,y,e,1);a.globalAlpha=1;return}case"medium":r=o*.7,l=0;break}const h=a.getImageData(0,0,e,i),f=h.data,w=t&&l>0?new Float32Array(e*i):null;if(t&&w&&l>0)for(let y=0;y<w.length;y++)w[y]=(Math.random()-.5)*l;if(t&&w&&l>0)for(let y=0;y<i;y++){const d=y*e;for(let m=0;m<e;m++){const v=(d+m)*4,S=w[d+m];f[v]+=S,f[v+1]+=S,f[v+2]+=S}}a.putImageData(h,0,0),s!=="low"&&((!dt||dt.width!==e||dt.height!==i)&&vs(e,i,r),ee&&dt&&(a.globalAlpha=r,a.drawImage(dt,0,0),a.globalAlpha=1))};let ie;const Ss=()=>{const t=u.width,e=u.height;ie=a.createRadialGradient(t/2,e/2,0,t/2,e/2,t/2),ie.addColorStop(0,"rgba(255, 255, 255, 0.3)"),ie.addColorStop(1,"rgba(0, 0, 0, 0.5)")},kt=()=>{($t?xe():"high")!=="low"&&(ie||Ss(),a.fillStyle=ie,a.fillRect(0,0,u.width,u.height))},Li=()=>{if(($t?xe():"high")==="low"){a.globalAlpha=.5,a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(0,0,u.width,u.height),a.globalAlpha=1;return}const e=a.getImageData(0,0,u.width,u.height),i=e.data;for(let s=0;s<i.length;s+=4){const n=i[s],o=i[s+1],r=i[s+2],l=n*.3+o*.59+r*.11;i[s]=i[s+1]=i[s+2]=l*.7}a.putImageData(e,0,0)},Is=()=>{const t=document.createElement("canvas");t.width=4,t.height=4;const e=t.getContext("2d");if(!e)return;function i(n,o,r,l,h){e&&(e.strokeStyle=h,e.beginPath(),e.moveTo(n,o),e.lineTo(r,l),e.stroke())}const s="#00000010";e.fillStyle=s,e.fillRect(0,0,t.width,t.height);for(let n=0;n<=t.width;n+=4)i(n,0,n,t.height,s),i(0,n,t.width,n,s);return e.createPattern(t,"repeat")},ks=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(!e)return;const i=e.getImageData(0,0,t.width,t.height),s=i.data,n=4;for(let o=0;o<t.height;o+=n)for(let r=0;r<t.width;r+=n){const l=Math.random()*64,h=Math.floor(Math.random()*24);for(let f=0;f<n;f++)for(let w=0;w<n;w++){const y=((o+f)*t.width+(r+w))*4;s[y]=Math.min(255,Math.max(0,s[y]+l)),s[y+1]=Math.min(255,Math.max(0,s[y+1]+l)),s[y+2]=Math.min(255,Math.max(0,s[y+2]+l)),s[y+3]=h}}return e.putImageData(i,0,0),e.createPattern(t,"repeat")},ye="startButton",T={top:"10px",zIndex:"10",size:"40px",color:"rgba(255, 255, 255, 0.4)",background:"black",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",fontSize:"24px",lineHeight:"0"};function xs(t){const e=document.createElement("button");return e.id="fullscreenButton",e.style.position="absolute",e.style.top=T.top,e.style.right="10px",e.style.zIndex=T.zIndex,e.textContent="⛶",e.style.fontFamily="Impact",e.style.width=T.size,e.style.height=T.size,e.style.color=T.color,e.style.background=T.background,e.style.border=T.border,e.style.borderRadius=T.borderRadius,e.style.fontSize=T.fontSize,e.style.lineHeight=T.lineHeight,e.style.display=t?"none":"block",e}function Ms(){const t=document.createElement("button");return t.id="restartButton",t.style.position="absolute",t.style.top=T.top,t.style.right="60px",t.style.zIndex=T.zIndex,t.textContent="↺",t.style.fontFamily="Impact",t.style.width=T.size,t.style.height=T.size,t.style.color=T.color,t.style.background=T.background,t.style.border=T.border,t.style.borderRadius=T.borderRadius,t.style.fontSize=T.fontSize,t.style.lineHeight=T.lineHeight,t.style.display="none",t}function Es(){const t=document.createElement("button");return t.id=ye,t.style.position="absolute",t.style.background="transparent",t.style.border="none",t.style.fontSize="2vw",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.zIndex=T.zIndex,t.style.color=T.color,t.style.display="none",t}const Cs=()=>{if(O=document.createElement("button"),O){let t;z==="auto"?t=`${z} (${tt})`:t=z,ke?O.textContent=`GFX: ${t}`:O.textContent=`[G] GFX: ${t}`}return O.style.position="absolute",O.style.bottom="10px",O.style.right="10px",O.style.fontFamily="Impact",O.style.height=T.size,O.style.color=T.color,O.style.background=T.background,O.style.border=T.border,O.style.borderRadius=T.borderRadius,O.style.fontSize="1.5vw",O.style.lineHeight=T.lineHeight,O.style.zIndex=T.zIndex,O.addEventListener("click",t=>{t.preventDefault(),_i(),O==null||O.blur()}),O};function Ps(){ke||(document.addEventListener("keydown",t=>{(t.key==="g"||t.key==="G")&&_i()}),O&&(O.textContent=`[G] GFX: ${z}`))}var L=(t=>(t[t.Tiny=16]="Tiny",t[t.Xs=20]="Xs",t[t.Small=24]="Small",t[t.Normal=32]="Normal",t[t.Large=48]="Large",t[t.Xl=64]="Xl",t[t.Huge=80]="Huge",t))(L||{});const ai=t=>{const e=u.width/1e3;return Math.floor(t*e)},B=(t,e,i,s=1,n=0,o=!0,r=0,l)=>{a.save();const h=ai(e),f=ai(16);a.globalAlpha=s>0?s:0,a.fillStyle="white",a.font=h+"px "+i;const w=a.measureText(l??t).width,y=n*f,d=r*f;a.fillText(t,(u.width-w)/2+d,(o?u.height/2:0)+y),a.restore()},Rs=[1,,82,.01,.08,.2,,2.6,,,,,,.1,,,,.61,.02,,-1686],Ts=[2,,12,,,.008,,1.2,23,-7,,,.05,.4,,,.15,.82,.03,.28],Fs=[1,,85,.08,.1,.01,1,4,,-11,1,.07,,.1,101,,.05,.68,.4,.12,1],Os=[.01,,523.2511,.1,3,3,4,0,,,2250,,.04,,10,.01,,.82,1,,30],Ds=[2,,185,,,,3,1.6,-7,,,,,,,.2,.19,.1,,.38,985],Ws=[1.5,,688,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.03,.11,-818],_s=[1.5,,1376,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.8,.11,-818],Ls={songData:[{i:[0,0,180,0,0,0,180,0,0,160,158,158,158,0,0,0,0,51,2,1,2,54,239,1,32,88,1,157,2],p:[1,2],c:[{n:[111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137],f:[]},{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:1},Hs={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[4,1,2,3,2,1,2,3],c:[{n:[134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134,137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]},{n:[137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137,134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]}]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[27,1,27,2,27,1,27,2],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,1,1,1,1,1,1,2],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[],c:[]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,,,,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:7,numChannels:8},Bs={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[],c:[]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[25,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,3,26,26,26],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,135],f:[]}]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[5,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,5,,5],c:[{n:[129],f:[]},{n:[134,,,,,,,,,,,,,,,,137],f:[]},{n:[137,,,,,,,,,,,,,,,,134],f:[]},{n:[141],f:[]},{n:[113],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,1,,,,1,,,,1,,,,1,,,,1,,,,1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,1,1,1],c:[{n:[,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1,,,,1,,,,1,,,,1,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:23,numChannels:8},yt=(t,...e)=>Gs(t,Xs(t,...e)),q=44100,Ns=new(window.AudioContext||window.webkitAudioContext),Te=Ns,Gs=(t,...e)=>{let i=Te.createBuffer(e.length,e[0].length,q),s=Te.createBufferSource();return e.forEach((n,o)=>i.getChannelData(o).set(n)),s.buffer=i,s.connect(Te.destination),s.start(),s},Xs=(t,e=.1,i=.05,s=220,n=0,o=0,r=.1,l=0,h=1,f=0,w=0,y=0,d=0,m=0,v=0,S=0,R=0,k=0,C=1,x=0,N=0,I=0)=>{let D=Math.PI*2,H=hs=>hs<0?-1:1,X=f*=500*D/q/q,F=s*=(1+i*2*Math.random()-i)*D/q,$=[],Y=0,St=0,_=0,et=1,nt=0,Q=0,G=0,U,Z,Tt=2,It=D*Math.abs(I)*2/q,Kt=Math.cos(It),qt=Math.sin(It)/2/Tt,Ft=1+qt,Ce=-2*Kt/Ft,jt=(1-qt)/Ft,re=(1+H(I)*Kt)/2/Ft,Pe=-(H(I)+Kt)/Ft,Re=re,Qt=0,Ot=0,Zt=0,ei=0;for(n=n*q+9,x*=q,o*=q,r*=q,k*=q,w*=500*D/q**3,S*=D/q,y*=D/q,d*=q,m=m*q|0,e*=t<0?0:t,Z=n+x+o+r+k|0;_<Z;$[_++]=G*(t<0?0:t))++Q%(R*100|0)||(G=l?l>1?l>2?l>3?Math.sin(Y**3):Math.max(Math.min(Math.tan(Y),1),-1):1-(2*Y/D%2+2)%2:1-4*Math.abs(Math.round(Y/D)-Y/D):Math.sin(Y),G=(m?1-N+N*Math.sin(D*_/m):1)*H(G)*Math.abs(G)**h*(_<n?_/n:_<n+x?1-(_-n)/x*(1-C):_<n+x+o?C:_<Z-k?(Z-_-k)/r*C:0),G=k?G/2+(k>_?0:(_<Z-k?1:(Z-_)/k)*$[_-k|0]/2/e):G,I&&(G=ei=Re*Qt+Pe*(Qt=Ot)+re*(Ot=G)-jt*Zt-Ce*(Zt=ei))),U=(s+=f+=w)*Math.cos(S*St++),Y+=U+U*v*Math.sin(_**5),et&&++et>d&&(s+=y,F+=y,et=0),m&&!(++nt%m)&&(s=F,f=X,et=et||1);return $};function zs(){var t=function(d){return Math.sin(d*6.283184)},e=function(d){return 2*(d%1)-1},i=function(d){return d%1<.5?1:-1},s=function(d){var m=d%1*4;return m<2?m-1:3-m},n=function(d){return .003959503758*2**((d-128)/12)},o=function(d,m,v){var S=r[d.i[0]],R=d.i[1],k=d.i[3]/32,C=r[d.i[4]],x=d.i[5],N=d.i[8]/32,I=d.i[9],D=d.i[10]*d.i[10]*4,H=d.i[11]*d.i[11]*4,X=d.i[12]*d.i[12]*4,F=1/X,$=-d.i[13]/16,Y=d.i[14],St=v*2**(2-d.i[15]),_=new Int32Array(D+H+X),et=0,nt=0,Q,G,U,Z,Tt,It;for(Q=0,G=0;Q<D+H+X;Q++,G++)G>=0&&(Y=Y>>8|(Y&255)<<4,G-=St,Tt=n(m+(Y&15)+d.i[2]-128),It=n(m+(Y&15)+d.i[6]-128)*(1+8e-4*d.i[7])),U=1,Q<D?U=Q/D:Q>=D+H&&(U=(Q-D-H)*F,U=(1-U)*3**($*U)),et+=Tt*U**k,Z=S(et)*R,nt+=It*U**N,Z+=C(nt)*x,I&&(Z+=(2*Math.random()-1)*I),_[Q]=80*Z*U|0;return _},r=[t,i,e,s],l,h,f,w,y;this.init=function(d){l=d,h=d.endPattern,f=0,w=d.rowLen*d.patternLen*(h+1)*2,y=new Int32Array(w)},this.generate=function(){var d,m,v,S,R,k,C,x,N,I,D,H,X=new Int32Array(w),F=l.songData[f],$=l.rowLen,Y=l.patternLen,St=0,_=0,et,nt,Q=!1,G=[];for(v=0;v<=h;++v)for(C=F.p[v],S=0;S<Y;++S){var U=C?F.c[C-1].f[S]:0;U&&(F.i[U-1]=F.c[C-1].f[S+Y]||0,U<17&&(G=[]));var Z=r[F.i[16]],Tt=F.i[17]/512,It=2**(F.i[18]-9)/$,Kt=F.i[19],qt=F.i[20],Ft=F.i[21]*43.23529*3.141592/44100,Ce=1-F.i[22]/255,jt=F.i[23]*1e-5,re=F.i[24]/32,Pe=F.i[25]/512,Re=6.283184*2**(F.i[26]-9)/$,Qt=F.i[27]/255,Ot=F.i[28]*$&-2;for(D=(v*Y+S)*$,R=0;R<4;++R)if(k=C?F.c[C-1].n[S+R*Y]:0,k){G[k]||(G[k]=o(F,k,$));var Zt=G[k];for(m=0,d=D*2;m<Zt.length;m++,d+=2)X[d]+=Zt[m]}for(m=0;m<$;m++)x=(D+m)*2,I=X[x],I||Q?(H=Ft,Kt&&(H*=Z(It*x)*Tt+.5),H=1.5*Math.sin(H),St+=H*_,et=Ce*(I-_)-St,_+=H*et,I=qt==3?_:qt==1?et:St,jt&&(I*=jt,I=I<1?I>-1?t(I*.25):-1:1,I/=jt),I*=re,Q=I*I>1e-5,N=Math.sin(Re*x)*Pe+.5,nt=I*(1-N),I*=N):nt=0,x>=Ot&&(nt+=X[x-Ot+1]*Qt,I+=X[x-Ot]*Qt),X[x]=nt|0,X[x+1]=I|0,y[x]+=nt|0,y[x+1]+=I|0}return f++,f/l.numChannels},this.createAudioBuffer=function(d){for(var m=d.createBuffer(2,w/2,44100),v=0;v<2;v++)for(var S=m.getChannelData(v),R=v;R<w;R+=2)S[R>>1]=y[R]/65536;return m},this.createWave=function(){var d=44,m=d+w*2-8,v=m-36,S=new Uint8Array(d+w*2);S.set([82,73,70,70,m&255,m>>8&255,m>>16&255,m>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,v&255,v>>8&255,v>>16&255,v>>24&255]);for(var R=0,k=d;R<w;++R){var C=y[R];C=C<-32767?-32767:C>32767?32767:C,S[k++]=C&255,S[k++]=C>>8&255}return S},this.getData=function(d,m){for(var v=2*Math.floor(d*44100),S=new Array(m),R=0;R<2*m;R+=1){var k=v+R;S[R]=d>0&&k<y.length?y[k]/32768:0}return S}}const pe="start",Xe="race",Hi="bounce",Bi="hit",Ni="teleport",Je="keyboard",Gi="finished",Xi="gameover",zi="restart",ze="count",Yi="go",j=document.createElement("audio"),Lt=document.createElement("audio"),we=document.createElement("audio");let rt,ue=!1;const Ys=async()=>{if(console.log("Attempting to unlock audio systems..."),ue)return!0;if(Ze&&!At)return console.log("Skipping audio unlock on desktop browser"),ue=!0,!0;console.log("Running audio unlock for mobile/iPad device");try{j.volume=.1,await j.play().catch(t=>console.log("First unlock attempt:",t)),j.pause(),j.currentTime=0,console.log("HTML Audio unlocked successfully")}catch(t){console.warn("HTML Audio unlock attempt failed:",t)}try{rt=yt.getAudioContext(),rt&&rt.state!=="running"&&await rt.resume(),console.log("Web Audio API context state:",rt==null?void 0:rt.state)}catch(t){console.warn("Web Audio API context resume failed:",t)}return ue=!0,!0},Vs=()=>{if(Ze&&!At){console.log("Skipping audio unlock setup on desktop browser"),ue=!0;return}console.log("Setting up audio unlock for mobile/iPad device");const t=document.createElement("audio");t.setAttribute("src","data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//tUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABGwD///////////////////////////////////////////8AAAA8TEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAARvMPHBz//////////////////////////////////////////////////////////////////8AAAA"),t.setAttribute("playsinline","playsinline"),t.volume=.1;const e=async()=>{console.log("Attempting to unlock audio systems from event handler");try{t.play().catch(i=>console.log("Silent audio error:",i))}catch(i){console.log("Silent audio exception:",i)}try{await Ys()}catch(i){console.log("sfx unlockAudio error:",i)}document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0)};document.addEventListener("touchstart",e,{once:!0,capture:!0}),document.addEventListener("touchend",e,{once:!0,capture:!0}),document.addEventListener("click",e,{once:!0,capture:!0})},Fe=(t,e,i)=>new Promise(s=>{var n=new zs;n.init(e);var o=!1;setInterval(function(){if(!o&&(o=n.generate()>=1,o)){var r=n.createWave();t.src=URL.createObjectURL(new Blob([r],{type:"audio/wav"})),t.loop=i,s()}},0)}),Us=()=>(Vs(),Promise.all([Fe(j,Hs,!0),Fe(Lt,Bs,!0),Fe(we,Ls,!1)])),$s=(t,e=0)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null);var i=t.volume;i>e?t._fadeInterval=setInterval(function(){i=Math.max(e,parseFloat(i)-.1).toFixed(1),t.volume=i,i<=e&&(e===0&&t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=null)},100):e===0&&!t.paused&&(t.pause(),t.volume=0)},Ae=(t,e=1)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null);let i=Promise.resolve();t.paused&&(t.volume=Rt?.1:0,t.setAttribute("playsinline","playsinline"),i=t.play()),i.then(()=>{var s=parseFloat(t.volume);s<e?(t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeInterval=setInterval(function(){s=Math.min(e,parseFloat(s)+.1).toFixed(1),t.volume=s,parseFloat(s)>=e&&(t.volume=e,clearInterval(t._fadeInterval),t._fadeInterval=null)},100)):t.volume=e}).catch(s=>{console.warn("FadeIn play() failed:",s),t.paused&&(t.volume=1,t.play().catch(n=>console.error("Second play attempt failed:",n))),t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null)})},oi=(t,e)=>{t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeOutInTimeout&&clearTimeout(t._fadeOutInTimeout),e._fadeInterval&&clearInterval(e._fadeInterval),e._fadeOutInTimeout&&clearTimeout(e._fadeOutInTimeout),t._fadeInterval=null,t._fadeOutInTimeout=null,e._fadeInterval=null,e._fadeOutInTimeout=null;var i=t.volume;i>0?t._fadeInterval=setInterval(function(){i=Math.max(0,parseFloat(i)-.1).toFixed(1),t.volume=i,i<=.1&&(t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=null,t._fadeOutInTimeout=setTimeout(()=>{Ae(e,1),t._fadeOutInTimeout=null},500))},100):(t.pause(),t.volume=0,t._fadeOutInTimeout=setTimeout(()=>{Ae(e,1),t._fadeOutInTimeout=null},500))},st=async(t,e)=>{if(e!==0){if(!Ze&&rt&&rt.state!=="running")try{await rt.resume()}catch(i){console.warn("AudioContext resume failed in playTune:",i)}switch(t){case Xe:{Lt.currentTime=0,oi(j,Lt);break}case Gi:{yt(.04,...Os),j.currentTime=0,oi(Lt,j);break}case Xi:{we.volume=1,we.play(),$s(Lt);break}case zi:{j.currentTime=0,Ae(j);break}case pe:{(j.paused||j.volume!=1)&&(j.currentTime=0,Ae(j));break}case Hi:{yt(e,...Rs);break}case Bi:{yt(e,...Ds);break}case Je:{yt(.5,...Ts);break}case Ni:{yt(e,...Fs);break}case ze:{yt(.5,...Ws);break}case Yi:{yt(.5,..._s);break}}}},Ks=t=>{const e=[];e.push(j,Lt,we),e.forEach(i=>{i._fadeInterval&&(clearInterval(i._fadeInterval),i._fadeInterval=null),i._fadeOutInTimeout&&(clearTimeout(i._fadeOutInTimeout),i._fadeOutInTimeout=null),i.pause(),i.currentTime=0})},Vi=()=>({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1});let Vt=Vi();const qs=t=>{t.code in Vt&&(Vt[t.code]=!0)},js=t=>{t.code in Vt&&(Vt[t.code]=!1)},Qs=()=>{window.addEventListener("keydown",qs),window.addEventListener("keyup",js),window.addEventListener("blur",()=>{Vt=Vi()})},Zs=t=>new Promise(e=>setTimeout(e,t)),Js=t=>new Promise(e=>{const i=s=>{s.code==="Enter"&&(st(Je),t&&st(t),window.removeEventListener("keydown",i),e())};window.addEventListener("keydown",i)}),tn=()=>Vt;function en(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function be(t,e){const i=e.x<=t.x+t.width&&t.x<=e.x+e.width,s=e.y<=t.y+t.height&&t.y<=e.y+e.height;return i&&s}function sn(t,e){return t.x<=e.x&&e.x<t.x+t.width&&t.y<=e.y&&e.y<t.y+t.height}function nn(t,e){const i=t.x<=e.x&&e.x+e.width<=t.x+t.width,s=t.y<=e.y&&e.y+e.height<=t.y+t.height;return i&&s}function Oe(t){return-(Math.cos(Math.PI*t)-1)/2}function at(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}function De(t){return t*t}function an(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}class on{constructor(e,i){p(this,"x",0);p(this,"y",0);p(this,"zoom",1);p(this,"visibleAreaHeight");p(this,"yAdjust",0);p(this,"target",null);p(this,"transition",null);this.level=e,this.view=i}getViewArea(){const e=this.view.width/this.zoom,i=this.view.height/this.zoom;return{x:this.x-e/2,y:this.y-i/2,width:e,height:i}}follow(e){this.target=e}setTransition(e){const i=this.view.height/this.zoom;this.transition={...e,endY:e.endY+i*this.yAdjust},this.target=null}update(e){if(this.visibleAreaHeight!=null&&(this.zoom=this.view.height/this.visibleAreaHeight),this.transition!=null){const{startY:i,endY:s,startTime:n,duration:o}=this.transition;if(e<n+o){const l=(e-this.transition.startTime)/this.transition.duration;this.y=i+an(l)*(s-i)}else this.transition=null}else this.target&&this.followFrame(this.target)}followFrame(e){const i=this.view.width/this.zoom,s=this.view.height/this.zoom;if(i<this.level.width){let n=e.x+e.width;n-i/2<this.level.x?n=this.level.x+i/2:n+i/2>this.level.x+this.level.width&&(n=this.level.x+this.level.width-i/2),this.x=n}else this.x=0;this.y=e.y+s*this.yAdjust}}const J={x:0,y:0};function ge(t){return t.x===0&&t.y===0}function rn(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function ln(t,e){return Math.abs(t.x-e.x)}function cn(t,e){return Math.abs(t.y-e.y)}function Ut(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function ft(t,e){return{x:t.x+e.x,y:t.y+e.y}}function Ui(t,e){return{x:t.x-e.x,y:t.y-e.y}}function lt(t,e){return{x:t.x*e,y:t.y*e}}function hn(t,e){return{x:t.x/e,y:t.y/e}}function ut(t){return hn(t,Ut(t))}function ae(t,e){return t.x*e.x+t.y*e.y}const Ht=.5,dn=.01,fn=5e-4,ri=6e-4,un=3;function gn(t,e,i){if(ge(e)){const m=Ut(t.velocity),v=ri*i,S=m>v?m-v:0;return S>0?lt(ut(t.velocity),S):J}const s=ae(t.velocity,e),n={x:-e.y,y:e.x},o=ae(t.velocity,n);let r=fn*i;s>dn*i&&(r=0);const l=ri*i,h=Math.abs(o)>l?-l:0,f=Math.sign(o)*h,w=lt(e,r),y=lt(n,f);return ft(t.velocity,ft(w,y))}function mn(t,e){const i=t.width/2,s=t.height/2,n=e.width/2,o=e.height/3.5,r={x:t.x+t.width/2,y:t.y+t.height/2},l=ft(r,t.velocity),h={x:e.x+e.width/2,y:e.y+e.height/2};if(ln(l,h)<i+n&&cn(l,h)<s+o){const f=ut(Ui(h,r)),w=ae(t.velocity,f),y=lt(f,-Math.abs(w)*un);let d=ft(t.velocity,y);return Ut(d)>Ht&&(d=lt(ut(d),Ht)),t.velocity=d,!0}return!1}function yn(t,e){const i=t.width*.4,s=e.width*.4,n={x:t.x+t.width/2,y:t.y+t.height/2},o={x:e.x+e.width/2,y:e.y+e.height/2},r=ft(n,t.velocity),l=ft(o,e.velocity);if(rn(r,l)<i+s){const h=ut(Ui(o,n)),f=lt(h,-1),w=ae(t.velocity,h),y=ae(e.velocity,f),d=lt(h,Math.abs(w)),m=lt(f,Math.abs(y));let v=ft(t.velocity,m);Ut(v)>Ht&&(v=lt(ut(v),Ht)),t.velocity=v;let S=ft(e.velocity,d);return Ut(S)>Ht&&(S=lt(ut(S),Ht)),e.velocity=S,!0}return!1}const bt=(t=1)=>Math.random()*t,pn=(t,e)=>Math.random()*(e-t)+t,zt=class zt{constructor(e){p(this,"x");p(this,"y");p(this,"width",zt.WIDTH);p(this,"height",zt.HEIGHT);p(this,"velocity",J);this.x=e.x,this.y=e.y}draw(e,i){a.save(),a.translate(this.x,this.y);const s=a.createLinearGradient(0,0,this.width,this.height);s.addColorStop(0,"rgb(255, 110, 110)"),s.addColorStop(1,"rgb(255, 60, 60)"),a.beginPath(),a.fillStyle="rgba(0, 0, 0, 0.1)",a.ellipse(this.width/2,this.height/1.5,this.width/2,this.height,0,0,2*Math.PI),a.fill(),a.fillStyle=s,a.beginPath(),a.ellipse(this.width/2,this.height/2,this.width/2,this.height/2,0,0,2*Math.PI),a.fill(),a.fillStyle=s,a.fillRect(0,-this.height*2,this.width,this.height*2.5);const n=a.createLinearGradient(0,0,this.width,this.height);n.addColorStop(0,"rgb(255, 140, 140)"),n.addColorStop(1,"rgb(255, 80, 80)"),a.fillStyle=n,a.beginPath(),a.ellipse(this.width/2,-this.height*2,this.width/2,this.height/2,0,0,2*Math.PI),a.fill(),a.strokeStyle="rgb(200, 70, 70)",a.lineWidth=this.width/100,a.stroke(),a.restore()}};p(zt,"WIDTH",10),p(zt,"HEIGHT",4);let M=zt;const A=16,g=10,$i=A,Yt=9,pt=g*Yt,We=g*7,wn=g*5,li=g*3,b=-90/2,ci=pt/2;var c=(t=>(t[t.FullWidth=0]="FullWidth",t[t.Basic=1]="Basic",t[t.BasicSlope=2]="BasicSlope",t[t.BasicSteepSlope=3]="BasicSteepSlope",t[t.Narrow=4]="Narrow",t[t.VeryNarrow=5]="VeryNarrow",t[t.DualPassage=6]="DualPassage",t[t.DualPassageExt=7]="DualPassageExt",t[t.TriplePassage=8]="TriplePassage",t[t.RightPassage=9]="RightPassage",t[t.SlopeEmptySlope=10]="SlopeEmptySlope",t[t.SlopeEmptyPassage=11]="SlopeEmptyPassage",t[t.PassageEmptySlope=12]="PassageEmptySlope",t[t.SlopeObstacleSlope=13]="SlopeObstacleSlope",t[t.FullWidthWithObstaclesOnRight=14]="FullWidthWithObstaclesOnRight",t[t.FullWidthWithObstaclesOnRight2=15]="FullWidthWithObstaclesOnRight2",t[t.FullWidthWithMoreObstacles=16]="FullWidthWithMoreObstacles",t[t.FullWidthWithObstacles=17]="FullWidthWithObstacles",t[t.Chasm=18]="Chasm",t[t.Raft=19]="Raft",t[t.TwoRafts=20]="TwoRafts",t[t.Checkpoint=21]="Checkpoint",t[t.Finish=22]="Finish",t))(c||{}),ht=(t=>(t[t.Normal=0]="Normal",t[t.CheckPoint=1]="CheckPoint",t[t.Finish=2]="Finish",t[t.Raft=3]="Raft",t))(ht||{}),W=(t=>(t[t.Empty=0]="Empty",t[t.Free=1]="Free",t[t.Obstacle=2]="Obstacle",t[t.Raft=3]="Raft",t))(W||{});function Ki(t,e,i){return{type:0,row:t,col:e,x:b+e*g,y:i,width:g,height:A}}function Ye(t){return"yDirection"in t}function ve(t){return"force"in t}class An{constructor(e,i,s,n,o){p(this,"row");p(this,"y");p(this,"type");p(this,"surfaces");p(this,"objects");p(this,"width");p(this,"height");p(this,"minX");p(this,"maxX");p(this,"blocks",new Array(Yt));this.row=e,this.y=i,this.type=s,this.surfaces=n,this.objects=o,this.minX=Math.min(...this.surfaces.map(r=>r.x)),this.maxX=Math.max(...this.surfaces.map(r=>r.x+r.width)),this.width=this.maxX-this.minX,this.height=A;for(let r=0;r<Yt;r++)this.blocks[r]={type:this.getBlockType(r),row:e,col:r,x:b+r*g,y:this.y,width:g,height:A}}get color(){switch(this.type){case 1:return"rgb(50, 80, 50)";case 2:return"rgb(0, 200, 0)";case 3:return"rgb(50,60,120)";default:return"rgb(80, 50, 80)"}}getBlock(e){return e<0||Yt<=e?Ki(this.row,e,this.y):this.blocks[e]}isFree(e,i){const s=g*.1,n=b+e*g,o=i??this.y,r={x:n+s,y:o+s,width:g-2*s,height:$i-2*s};return this.surfaces.some(l=>nn(l,r))&&!this.objects.some(l=>be(l,r))}getBlockType(e){const i=g*.1,s=b+e*g+i,n=g-2*i;return this.surfaces.some(l=>Ye(l)&&l.x<=s&&s+n<=l.x+l.width)?3:this.objects.some(l=>l.x<=s&&s+n<=l.x+l.width)?2:this.isFree(e)?1:0}}function bn(t,e){const i=t.map((s,n)=>vn(s,n,e));return Sn(i),i}function vn(t,e,i){const s=i-A*(e+1),n=s+A/2;let o=0,r=[],l=[];switch(t){case 0:r=[{x:b,y:s,width:pt,height:A}];break;case 1:r=[{x:b+g*1,y:s,width:We,height:A}];break;case 2:{r=[{force:.3,x:b+g*1,y:s,width:We,height:A}];break}case 3:{r=[{force:.5,x:b+g*1,y:s,width:We,height:A}];break}case 4:r=[{x:b+g*2,y:s,width:wn,height:A}];break;case 5:r=[{x:b+g*3,y:s,width:li,height:A}];break;case 6:r=[{x:b+g,y:s,width:g*2,height:A},{x:ci-g*3,y:s,width:g*2,height:A}];break;case 7:r=[{x:b+g,y:s,width:g*2,height:A},{x:b+g*4,y:s,width:g*5,height:A}];break;case 8:r=[{x:b+g*1,y:s,width:g*2,height:A},{x:b+g*4,y:s,width:g*2,height:A},{x:b+g*7,y:s,width:g*2,height:A}];break;case 9:{r=[{x:b+g*6,y:s,width:g*2,height:A}];break}case 10:{const h={force:.3,x:b+g*1,y:s,width:g*2,height:A},f={force:.3,x:b+g*6,y:s,width:g*2,height:A};r=[h,f];break}case 11:{const h={force:.3,x:b+g*1,y:s,width:g*2,height:A},f={x:b+g*6,y:s,width:g*2,height:A};r=[h,f];break}case 12:{const h={x:b+g*1,y:s,width:g*2,height:A},f={force:.3,x:b+g*6,y:s,width:g*2,height:A};r=[h,f];break}case 13:{const h={force:.3,x:b+g*1,y:s,width:g*2,height:A},f={force:.3,x:b+g*6,y:s,width:g*2,height:A};r=[h,{x:b+g*3,y:s,width:g*3,height:A},f],l=[new M({x:b+g*4,y:n-M.HEIGHT/2})];break}case 14:{r=[{x:-90/2,y:s,width:pt,height:A}],l=[new M({x:b+g*4,y:n-M.HEIGHT/2}),new M({x:b+g*6,y:n-M.HEIGHT/2}),new M({x:b+g*8,y:n-M.HEIGHT/2})];break}case 15:{r=[{x:-90/2,y:s,width:pt,height:A}],l=[new M({x:b+g*3,y:n-M.HEIGHT/2}),new M({x:b+g*5,y:n-M.HEIGHT/2}),new M({x:b+g*7,y:n-M.HEIGHT/2})];break}case 16:r=[{x:-90/2,y:s,width:pt,height:A}],l=[new M({x:b+g*0,y:n-M.HEIGHT/2}),new M({x:b+g*2,y:n-M.HEIGHT/2}),new M({x:b+g*4,y:n-M.HEIGHT/2}),new M({x:b+g*6,y:n-M.HEIGHT/2}),new M({x:b+g*8,y:n-M.HEIGHT/2})];break;case 17:r=[{x:-90/2,y:s,width:pt,height:A}],l=[new M({x:b+g,y:n-M.HEIGHT/2}),new M({x:b+g*3,y:n-M.HEIGHT/2}),new M({x:b+g*5,y:n-M.HEIGHT/2}),new M({x:b+g*7,y:n-M.HEIGHT/2})];break;case 18:break;case 19:{o=3,r=[{yDirection:-1,dockStartTime:0,x:b+g*3,y:s,width:li,height:A}];break}case 20:{o=3;const h={yDirection:-1,dockStartTime:0,x:b+g*1,y:s-bt()*A,width:g*2,height:A},f={yDirection:-1,dockStartTime:0,x:ci-g*3,y:s-bt()*A,width:g*2,height:A};r=[h,f];break}case 21:o=1,r=[{x:-90/2,y:s,width:pt,height:A}];break;case 22:o=2,r=[{x:-90/2,y:s,width:pt,height:A}];break}return new An(e,s,o,r,l)}function Sn(t){for(let e=1;e<t.length;e++){const i=t[e-1],s=t[e];for(let n=0;n<Yt;n++)i.blocks[n].type===3&&s.blocks[n].type===0&&(s.blocks[n].type=3)}}const Me=-1,hi=1,In={x:0,y:Me},kn={x:-1,y:0},xn={x:1,y:0},Mn=ut({x:-1,y:Me}),En=ut({x:1,y:Me}),Cn=3,_e=1e3;class Pn{constructor(e,i){p(this,"host");p(this,"track");p(this,"horizontalMargin",0);p(this,"lastSlowdownTime",-1e3);p(this,"target",null);this.host=e,this.track=i}reset(){this.target=null}getMovement(e){const i=this.getCurrentBlock(),s=this.track.getBlock(i.row+1,i.col),n=this.goByRaft(i,s,e);return n||((this.target==null||this.hasReached(this.target))&&(this.target=this.findNextTarget(i)),this.goRoundObstacles(i,s,e)||this.moveOnTrack(i,s,e))}goByRaft(e,i,s){if(e.type!==W.Raft&&i.type===W.Raft&&(this.host.y>e.y+1.5*this.host.height||this.track.isFree(e.row+1,e.col)))return{x:0,y:this.moveAhead(e,i,s)};if(i.type===W.Raft&&this.host.y<=e.y+1.5*this.host.height&&!this.track.isFree(e.row+1,e.col))return J;if(e.type===W.Raft&&!this.track.isFree(e.row+1,e.col)){let n=0;return this.host.x<e.x+this.host.width?n=1:e.x+e.width-2*this.host.width<this.host.x&&(n=-1),{x:n,y:0}}return e.type===W.Raft&&this.track.isFree(e.row,e.col)&&this.track.isFree(e.row+1,e.col)?In:null}goRoundObstacles(e,i,s){if(this.target==null)return J;if(e.type===W.Obstacle){if(e.y+e.height/2<this.host.y+this.host.height/2)return this.target.col<e.col?Mn:En}else{if(this.target.col<e.col&&this.track.getBlock(e.row,e.col-1).type===W.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===W.Empty?kn:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:-1,y:this.moveAhead(e,i,s)};if(e.col<this.target.col&&this.track.getBlock(e.row,e.col+1).type===W.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===W.Empty?xn:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:1,y:this.moveAhead(e,i,s)}}return null}moveOnTrack(e,i,s){if(this.target==null)return J;let n=0;i.type===W.Empty&&this.host.y+this.host.height/2<e.y?n=hi:n=this.moveAhead(e,i,s),n<0&&i.type===W.Empty&&this.host.y+this.host.height/2<e.y+e.height/2&&(n=0);let o=0;const r=this.host.x<this.target.x+this.horizontalMargin,l=this.target.x+this.target.width-this.horizontalMargin<=this.host.x+this.host.width;return r&&this.track.getBlock(e.row,e.col+1).type===W.Free?o=1:l&&this.track.getBlock(e.row,e.col-1).type===W.Free&&(o=-1),{x:o,y:n}}moveAhead(e,i,s){return i.type!==W.Free&&this.host.velocity.y<-.25*1.5?(_e<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),hi):this.host.velocity.y<-.25*3.5&&!this.isClearAhead(e)?(_e<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),0):_e<s-this.lastSlowdownTime?Me:0}getCurrentBlock(){const e=en(this.host);let i=this.track.getBlockAt(e);return(i.type===W.Empty||i.type===W.Raft)&&i.y+i.height-this.host.height<e.y&&(i=this.track.getBlock(i.row-1,i.col)),i.type===W.Empty&&(i.x+i.width-this.host.width<e.x?i=this.track.getBlock(i.row,i.col+1):e.x<i.x+this.host.width&&(i=this.track.getBlock(i.row,i.col-1))),i}hasReached(e){return this.host.y+this.host.height<e.y+e.height}findNextTarget(e){const i=this.findNearestBlock(e.row+1,e.col);if(i==null||i.col!==e.col)return i;const s=this.findNearestBlock(i.row+1,i.col);if(s==null)return i;if(s.col<i.col){const n=this.track.getBlock(i.row,i.col-1);if(n.type===W.Free)return n}if(i.col<s.col){const n=this.track.getBlock(i.row,i.col+1);if(n.type===W.Free)return n}return i}isClearAhead(e){for(let i=e.row+1;i<=e.row+Cn;i++)if(this.track.getBlock(i,e.col).type!==W.Free)return!1;return!0}findNearestBlock(e,i){for(let s=0;s<Yt-1;s++){const n=(bt()<.5?-1:1)*s,o=i+n,r=this.track.getBlock(e,o);if(r.type===W.Free||r.type===W.Raft)return this.horizontalMargin=bt(.2)*g,this.track.getBlock(e,o)}return null}}const ot=(t,e)=>2*Math.abs(e/t-Math.floor(e/t+.5));var gt=(t=>(t[t.Stand=0]="Stand",t[t.Walk=1]="Walk",t[t.Fall=2]="Fall",t[t.Celebrate=3]="Celebrate",t))(gt||{}),K=(t=>(t[t.Right=0]="Right",t[t.Forward=1]="Forward",t[t.Backward=2]="Backward",t[t.ForwardRight=3]="ForwardRight",t[t.BackwardRight=4]="BackwardRight",t))(K||{});const Rn="rgb(200,150,150)",Tn="rgb(230,230,230)",Fn="rgb(30,0,0)",On="rgb(170,120,120)",Jt="rgb(140,140,140)",Le="rgb(120,120,120)",te="rgb(140,140,220)",He="rgb(120,120,200)",Dn="rgba(0, 0, 0, 0.2";function oe(t,e,i,s,n,o,r,l,h){let f=0,w=0,y=0,d=0,m=0,v=0;const S=o===3||o===4,R=o===0;switch(r){case 1:f=R?600:S?400:300,v=Oe(ot(f/2,n/2))*.02*s,w=m=-Math.PI/6+at(ot(f,n))*(Math.PI/3),y=d=-Math.PI/6+at(ot(f,n+f/2))*(Math.PI/3);break;case 3:{f=1500,v=Oe(ot(f/2,n/2))*.15*s;const I=ot(f,n);w=at(I)*Math.PI*(1/8),y=-at(I)*Math.PI*(3/8),m=Math.PI*(1/8)-at(I)*Math.PI*(9/8),d=Math.PI*(1/8)-at(I)*Math.PI*(10/8);break}case 2:f=3200,v=Oe(ot(f/2,n))*.02*s,w=-Math.PI*(3/8)+at(ot(f,n))*(Math.PI*(3/4)),y=-Math.PI*(3/8)+at(ot(f,n+f/2))*(Math.PI*(3/4)),d=-Math.PI*(8/8)+at(ot(f,n+f/2))*(Math.PI/4),m=-Math.PI*(8/8)+at(ot(f,n))*(Math.PI/4);break}t.save(),Wn(t,.5*i,s,i*.4-v/2),t.translate(0,-v);const k=.3*s,C=.25*s,x=.2*i,N=.1*i;switch(t.fillStyle=e,t.lineWidth=x,t.lineJoin="round",t.lineCap="round",e==="eliminated"&&(t.globalAlpha=.7),o){case 0:{const I=.5*i,D=.4*s,H=.5*i,X=.7*s;ui(t,He,I,D,N,k,d),gi(t,Le,H,X,x,C,w),gi(t,Jt,H,X,x,C,y),le(o,t,i,s,e,l,h),ce(o,t,i,s,e,l,h),ui(t,te,I,D,N,k,m)}break;case 1:case 2:{Wt(t,Jt,.35*i,.7*s,x,C,-1,w,0),Wt(t,Jt,.7*i,.7*s,x,C,1,y,0),le(o,t,i,s,e,l,h),Dt(t,te,.25*i,.35*s,N,k,-1,d),Dt(t,te,.75*i,.35*s,N,k,1,m),ce(o,t,i,s,e,l,h);break}case 3:{Wt(t,Le,.35*i,.7*s,x,C,-1,w,y/4),Wt(t,Jt,.65*i,.7*s,x,C,1,y,y/4),Dt(t,He,.25*i,.35*s,N,k,-1,m,m/2),le(o,t,i,s,e,l,h),ce(o,t,i,s,e,l,h),Dt(t,te,.75*i,.35*s,N,k,1,d,m/2);break}case 4:{Wt(t,Le,.65*i,.7*s,x,C,1,y,y/4),Wt(t,Jt,.35*i,.7*s,x,C,-1,w,y/4),Dt(t,He,.75*i,.35*s,N,k,1,m,m/2),le(o,t,i,s,e,l,h),ce(o,t,i,s,e,l,h),Dt(t,te,.25*i,.35*s,N,k,-1,d,m/2);break}}t.restore()}function Wn(t,e,i,s){t.save(),t.fillStyle=Dn,t.translate(e,i),t.beginPath(),t.arc(0,0,Math.max(0,s),0,2*Math.PI),t.fill(),t.restore()}const Bt={};function mt(t,e,i){const s=di(t),n=di(e),o=Math.round((1-i)*s.r+i*n.r),r=Math.round((1-i)*s.g+i*n.g),l=Math.round((1-i)*s.b+i*n.b);return`rgb(${o}, ${r}, ${l})`}function di(t){if(t==="eliminated")return{r:128,g:128,b:128};const e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t);return e?{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}:{r:0,g:0,b:0}}const _n=navigator.userAgent.toLowerCase().includes("firefox");function qi(t,e,i,s,n,o){const r=`${i}-${e}-${s}-${n}`;if(o||!Bt[r]){const l=t.createRadialGradient(s,n,n/8,s,n,s);if(i==="TORSO"?(l.addColorStop(0,mt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.2,mt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.5,mt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(1,mt(e,"rgb(0, 0, 0)",.3))):i==="HEAD"&&(l.addColorStop(0,mt(e,"rgb(0, 0, 0)",.3)),l.addColorStop(.5,mt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(.8,mt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(1,mt(e,"rgb(255, 255, 255)",.1))),_n){if(o)return fi(t,l,s*2,n*2);Bt[r]=fi(t,l,s*2,n*4)}else{if(o)return l;Bt[r]=l}}return Bt[r]}function Ln(){for(const t in Bt)delete Bt[t]}function fi(t,e,i,s){const n=document.createElement("canvas");n.width=i,n.height=s;const o=n.getContext("2d");if(o)return o.fillStyle=e,o.fillRect(0,0,i,s),t.createPattern(n,"no-repeat")}function ji(t,e,i,s,n,o){e&&(t.save(),t.translate(i,s),t.scale(n/80,o/80),t.fillStyle=e,t.fill(),t.restore())}function le(t,e,i,s,n,o,r=!1){const l=.2*i,h=t===0?.5*i:.45*i,f=.25*s,w=t===0?.28*i:.5*(i-h),y=.06*s;e.beginPath(),e.roundRect(w,y,h,f,l);const d=qi(e,n,"HEAD",h,f,r);e.fillStyle=d||"black",e.fill(),ji(e,o,w,y,h,f),Hn(e,t,i,h,f,l)}function ce(t,e,i,s,n,o,r=!1){const l=.4*s,h=.2*i,f=t===0?.5*i:.6*i,w=t===1||t===2?.2*i:.5*(i-f),y=.3*s;e.beginPath(),e.roundRect(w,y,f,l,h);const d=qi(e,n,"TORSO",f,l,r);e.fillStyle=d||"black",e.fill(),ji(e,o,w,y,f,l)}function ui(t,e,i,s,n,o,r){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(r),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-o/4,o/2,0,o),t.stroke(),t.restore()}function gi(t,e,i,s,n,o,r){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(r),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-o/8,o/2,0,o),t.stroke(),t.restore()}function Dt(t,e,i,s,n,o,r,l,h=0){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(-r*.07*Math.PI),t.rotate(h),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(r*o/4,o/2,0,o),t.stroke(),t.restore()}function Wt(t,e,i,s,n,o,r,l,h){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(h),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(r*o/8,o/2,0,o),t.stroke(),t.restore()}function Hn(t,e,i,s,n,o){if(e!==2&&e!==4)return;const r=.15*i,l=.6*o,h=s-r,f=n-r*1.75,w=n-f,y=e===2?(i-h)/2:(i-h)/2+(s-h)/2;t.save(),t.translate(y,w),t.shadowColor="rgba(0, 0, 0, 0.5)",t.fillStyle=Rn,t.shadowOffsetY=-f/10;const d=0,m=0;t.beginPath(),t.roundRect(d,m,h,f,l),t.fill(),t.closePath(),t.shadowOffsetY=0;const v=.06*h,S=h/4,R=f/3,k=d+S,C=d+h-S,x=m+R;t.fillStyle=Tn,t.beginPath(),t.arc(k,x,v,0,Math.PI*2),t.arc(C,x,v,0,Math.PI*2),t.fill(),t.closePath();const N=.025*h,I=.01*h,D=.01*f;t.fillStyle=Fn,t.beginPath(),t.arc(k+I,x+D,N,0,Math.PI*2),t.arc(C+I,x+D,N,0,Math.PI*2),t.fill(),t.closePath();const H=.15*h,X=.2*f,F=d+(h-H)/1.75,$=m+(f-X)/1.5;t.fillStyle=On,t.beginPath(),t.moveTo(F,$),t.lineTo(F+H/2,$+X),t.lineTo(F-H/2,$+X),t.closePath(),t.fill(),t.restore()}let Ve=1;const Qi=(t,e)=>{const i=t/e;let s=window.innerWidth,n=window.innerHeight;s/n>i?s=n*i:n=s/i,s>t&&(s=t,n=t/i),n>e&&(n=e,s=e*i),u.width=s,u.height=n;const o=window.innerWidth/s,r=window.innerHeight/n,l=Math.min(o,r);Ve=l,u.style.position="absolute",u.style.left=`${(window.innerWidth-s*l)/2}px`,u.style.top=`${(window.innerHeight-n*l)/2}px`,u.style.transform=`scale(${l})`,u.style.transformOrigin="top left"},Zi=(t,e)=>{const i=u.getBoundingClientRect();t.x=(e.clientX-i.left)/Ve,t.y=(e.clientY-i.top)/Ve},Ji=4;let Ue=0;const ts=[...Array(Ji)].map(()=>({x:0,y:0})),vt="ontouchstart"in window,Bn=()=>{vt&&(window.oncontextmenu=t=>{t.preventDefault()},u.ontouchstart=t=>{t.preventDefault(),Be(t)},u.ontouchmove=t=>{t.preventDefault(),Be(t)},u.ontouchend=t=>{t.preventDefault(),Be(t)})},Be=t=>{Ue=Math.min(t.touches.length,Ji);for(let e=0;e<Ue;e++)Zi(ts[e],t.touches[e])},es=(t,e)=>new Promise(i=>{const s=n=>{n.preventDefault();const o=n.changedTouches[0];if(!o)return;st(Je),Zi({x:0,y:0},o);{if(u.removeEventListener("touchstart",s),e!==void 0)try{console.log(`Playing sound ID: ${e}`),st(e)}catch(l){console.error("Error playing sound:",l)}i()}};u.addEventListener("touchstart",s,{passive:!1})}),Nn=(t,e)=>es(e,t),he=t=>{for(let e=0;e<Ue;e++)if(sn(t,ts[e]))return!0;return!1};let Gn=0;const Et={symbol:"◁",x:0,y:0,width:0,height:0},Nt={symbol:"▷",x:0,y:0,width:0,height:0},Gt={symbol:"△",x:0,y:0,width:0,height:0},Xt={symbol:"▽",x:0,y:0,width:0,height:0},$e={movement:{x:0,y:0}},Xn=()=>{const t=tn(),e=t.ArrowLeft||t.KeyA||he(Et),i=t.ArrowRight||t.KeyD||he(Nt),s=t.ArrowUp||t.KeyW||he(Gt),n=t.ArrowDown||t.KeyS||he(Xt),o=e?-1:i?1:0,r=s?-1:n?1:0;o===0&&r===0?$e.movement=J:$e.movement=ut({x:o,y:r})},zn=()=>{Qs(),Bn(),mi(),window.addEventListener("resize",mi,!1)},mi=()=>{const t=u.width*.01,e=u.height*.02,i=u.width*.1,s=u.height*.6,n=u.height-s*.65-2*e,o=i,r=s/3;Et.x=t,Et.y=n+r+e,Et.width=i,Et.height=s/3,Nt.x=i+2*t,Nt.y=n+r+e,Nt.width=i,Nt.height=s/3,Gt.x=u.width-o-t,Gt.y=n,Gt.width=o,Gt.height=r,Xt.x=u.width-o-t,Xt.y=n+r+e,Xt.width=o,Xt.height=r},_t=async t=>{await(vt?t?Nn(t):es():Js(t))},se=(t="continue",e=7.7)=>{const i=(vt?"Tap the screen to ":"Press ENTER to ")+t;B(i+(Gn++%60===0?"":"█"),L.Small,"Courier New",1,e,!0,0,i)},is=()=>{if(!vt)return;a.save();const t=Et.width/2;a.font=t+"px Impact",a.fillStyle="rgba(200, 200, 200, 0.2)",de(Et,t),de(Nt,t),de(Gt,t),de(Xt,t),a.restore()},de=(t,e)=>{a.strokeStyle="rgba(255, 255, 255, 0.2)",a.lineWidth=2,a.strokeRect(t.x,t.y,t.width,t.height),a.fillStyle="rgba(255, 255, 255, 0.4)",a.fillText(t.symbol,t.x+t.width/2-e/2,t.y+t.height/2+e*.45,e)},Yn=()=>$e;function Vn(t,e){t.translate(e/2,0),t.scale(-1,1),t.translate(-e/2,0)}const Se=500,yi=1e3,ss=["rgb(255, 255, 0)","rgb(255, 0, 0)","rgb(0, 128, 0)","rgb(0, 0, 255)","rgb(255, 165, 0)","rgb(255, 99, 71)","rgb(255, 192, 203)","rgb(106, 90, 205)","rgb(238, 130, 238)","rgb(30, 144, 255)","rgb(0, 255, 255)","rgb(255, 0, 255)","rgb(144, 238, 144)","rgb(211, 211, 211)","rgb(64, 224, 208)","rgb(0, 191, 255)","rgb(173, 216, 230)","rgb(240, 128, 128)","rgb(0, 255, 127)","rgb(255, 0, 255)","rgb(220, 20, 60)","rgb(230, 230, 250)","rgb(255, 127, 80)","rgb(0, 128, 128)","rgb(75, 0, 130)","rgb(250, 128, 114)","rgb(127, 255, 0)","rgb(218, 165, 32)","rgb(255, 182, 193)","rgb(210, 105, 30)","rgb(205, 92, 92)","rgb(128, 128, 0)","rgb(255, 69, 0)","rgb(135, 206, 235)","rgb(72, 209, 204)","rgb(160, 82, 45)","rgb(0, 255, 0)","rgb(0, 0, 128)","rgb(245, 222, 179)","rgb(70, 130, 180)","rgb(255, 255, 255)"],ti=ss[0],Ke={width:2,height:2};class Ne{constructor(e,i,s=1+Math.random()*.6,n=1+Math.random()*.4){p(this,"ai");p(this,"rank",0);p(this,"finished",!1);p(this,"eliminated",!1);p(this,"timeOffset",bt(2e3));p(this,"direction",J);p(this,"latestDirection",{x:0,y:-1});p(this,"color");p(this,"x",0);p(this,"y",0);p(this,"width");p(this,"height");p(this,"velocity",J);p(this,"fallStartTime");p(this,"dropStartTime");p(this,"latestCheckpointIndex",0);this.ai=e===0||!i?null:new Pn(this,i),this.color=ss[e],this.width=Ke.width*s,this.height=Ke.height*n}get doesNotCollide(){return this.finished||this.eliminated||this.fallStartTime!=null}isVisible(e){return!(this.fallStartTime!=null&&Se<e-this.fallStartTime)}setDirection(e){this.direction=e,ge(e)||(this.latestDirection=e)}getMovement(e){return this.ai?this.ai.getMovement(e):Yn().movement}move(){this.eliminated||this.finished?(this.direction=J,this.velocity=J):(this.x+=this.velocity.x,this.y+=this.velocity.y)}stop(){this.y+=this.velocity.y*8}drop(e,i){var s;this.x=i.x,this.y=i.y,this.direction=J,this.latestDirection={x:0,y:-1},this.velocity=J,this.fallStartTime=void 0,this.dropStartTime=e,(s=this.ai)==null||s.reset()}draw(e,i,s){const n=this.latestDirection.y!==0?this.latestDirection.x===0?this.latestDirection.y<0?K.Forward:K.Backward:this.latestDirection.y>0?K.BackwardRight:K.ForwardRight:K.Right;a.save();const o=this.height*3,r=o-this.height;if(a.translate(this.x,this.y-r),this.latestDirection.x<0&&Vn(a,this.width),this.fallStartTime!=null){const h=Math.max(1-De((e-this.fallStartTime)/Se),0);a.translate(this.width/2,o/2),a.scale(h,h),a.translate(-this.width/2,-o/2),a.globalAlpha=De(h)}else this.dropStartTime&&e-this.dropStartTime<yi&&(a.globalAlpha=De((e-this.dropStartTime)/yi));const l=ge(this.direction)&&this.fallStartTime==null?0:e+this.timeOffset;oe(a,this.eliminated?"eliminated":this.color,this.width,o,l,this.finished?e%3600<1800?K.Backward:K.BackwardRight:n,this.getAnimation(),s),a.restore()}getAnimation(){return this.fallStartTime!=null?gt.Fall:ge(this.direction)?gt.Stand:gt.Walk}}const Un=.005,pi=2e3;class $n{constructor(e,i){p(this,"elements");p(this,"startY");p(this,"checkpoints");p(this,"specialElements");p(this,"finishY");p(this,"elementCount");p(this,"width");p(this,"height");this.elements=bn(e,i),this.elementCount=this.elements.length,this.specialElements=this.elements.filter(o=>o.surfaces.some(r=>ve(r)||Ye(r))),this.startY=i,this.finishY=this.startY-(this.elements.length-1)*A;const s=Math.min(...this.elements.map(o=>o.minX)),n=Math.max(...this.elements.map(o=>o.maxX));this.width=n-s,this.height=this.elements.length*A,this.checkpoints=this.elements.filter((o,r)=>o.type===ht.CheckPoint||r===0).map(o=>({y:o.y+o.height,element:o}))}update(e,i,s){for(let n=0;n<this.specialElements.length;n++){const o=this.specialElements[n];for(let r=0;r<o.surfaces.length;r++){const l=o.surfaces[r];if(ve(l))for(let h=0;h<s.length;h++){const f=s[h];l.y<=f.y&&f.y+f.height<l.y+l.height&&l.x<=f.x&&f.x+f.width<=l.x+l.width&&(f.velocity=ft(f.velocity,{x:0,y:-.002*l.force*i}))}if(Ye(l)){const h=l,f=o.y,w=o.y-A;h.yDirection===-1&&h.y<=w?(h.yDirection=0,h.dockStartTime=e):h.y<=w&&e-h.dockStartTime>pi?h.yDirection=1:h.yDirection===1&&f<=h.y?(h.yDirection=0,h.dockStartTime=e):f<=h.y&&e-h.dockStartTime>pi&&(h.yDirection=-1);const y=h.yDirection*Un*i;h.y+=y;for(let d=0;d<s.length;d++){const m=s[d];be(h,m)&&(m.y+=y)}}}}}get(e){return this.elements[e]}isFree(e,i){if(e<0||this.elements.length<=e)return!1;const s=this.elements[e];return s.surfaces.length===0?this.elements[Math.max(e-1,0)].isFree(i,s.y):s.isFree(i)}getBlock(e,i){return e<0||this.elements.length<=e?Ki(e,i,this.startY-e*A):this.elements[e].getBlock(i)}getBlockAt(e){const i=Math.floor(Math.max(this.startY-e.y,0)/A),s=Math.min(i,this.elements.length-1),n=Math.floor((e.x-b)/g);return this.getBlock(s,n)}getCheckpoint(e){return this.checkpoints[e].element}findLatestCheckpoint(e){for(let i=this.checkpoints.length-1;i>=0;i--){const s=this.checkpoints[i];if(e<s.y-s.element.height*.15)return i}return 0}getBetween(e,i){const s=Math.ceil(Math.max(this.startY-e,0)/A),n=Math.floor(Math.max(this.startY-i,0)/A);return{minI:Math.max(n-1,0),maxI:Math.min(s,this.elements.length)-1}}isOnPlatform(e,i){const{minI:s,maxI:n}=e;for(let o=n;o>=s;o--){const l=this.get(o).surfaces;for(let h=0;h<l.length;h++){const f=l[h];if(be(i,f))return!0}}return!1}}const Kn=70,wi=400,Ai=5,bi=40,qn=3*$i,vi=1e3;var qe=(t=>(t[t.RUNNING=0]="RUNNING",t[t.GAME_OVER=1]="GAME_OVER",t[t.FINISHED=2]="FINISHED",t))(qe||{});function jn(t){for(let e=t.length-1;e>=0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}class Si{constructor(e,i,s,n,o){p(this,"camera",new on(this,u));p(this,"platePattern");p(this,"track");p(this,"characters",[]);p(this,"charactersCount",40);p(this,"player",new Ne(0,void 0,0,0));p(this,"x");p(this,"y");p(this,"width");p(this,"height");p(this,"state",0);this.platePattern=o,this.track=new $n(e,wi),this.x=0-this.track.width/2-Ai,this.y=wi-this.track.height-bi,this.width=this.track.width+2*Ai,this.height=this.track.height+2*bi;const r=this.track.get(0),l=15,h=r.width/l,f=Ke.height*1.9,w=h*.3;this.player=new Ne(0,this.track,i,s),this.characters.push(this.player);for(let d=1;d<(n?n.length:this.charactersCount);d++){if(n&&n[d].eliminated)continue;const m=new Ne(d,this.track);this.characters.push(m)}const y=[this.player,...this.characters];jn(y);for(let d=0;d<y.length;d++){const m=y[d],v=Math.floor(d/l),S=d%l,R={x:r.minX+w+S*h,y:r.y+v*f};m.x=R.x,m.y=R.y}this.camera.follow(this.player),this.camera.visibleAreaHeight=Kn,this.camera.yAdjust=-.25,this.camera.update(0)}update(e,i){this.camera.update(e),this.track.update(e,i,this.characters),this.calculateMovement(e,i),this.checkCollisions();for(let s=0;s<this.characters.length;s++)this.characters[s].move();this.updateCharacterRanks(),this.checkGameState()}playWithVolumeByDistance(e,i){const s=Math.abs(i-this.player.y);st(e,Math.max(0,Math.min(1,1-s/qn)))}calculateMovement(e,i){for(let s=0;s<this.characters.length;s++){const n=this.characters[s],o=this.track.getBetween(n.y,n.y+n.height);let r=J;n.fallStartTime!=null?e-n.fallStartTime>Se+vi&&this.dropToLatestCheckpoint(e,n):n.fallStartTime==null&&!this.track.isOnPlatform(o,n)?(n.fallStartTime=e,n===this.player&&setTimeout(()=>{const l=this.track.getCheckpoint(this.player.latestCheckpointIndex),h=l.y+l.height/2;this.camera.setTransition({startY:this.player.y,endY:h,startTime:e,duration:vi+500})},Se)):(r=n.getMovement(e),n.setDirection(r),n.velocity=gn(n,r,i))}}checkCollisions(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e];if(!i.doesNotCollide)for(let s=e+1;s<this.characters.length;s++){const n=this.characters[s];n.doesNotCollide||yn(i,n)&&(!i.ai||Ut(i.velocity)>.3)&&this.playWithVolumeByDistance(Bi,i.y)}}for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.getBetween(i.y,i.y+i.height),{minI:n,maxI:o}=s;for(let r=n;r<=o;r++){const l=this.track.get(r);for(let h=0;h<l.objects.length;h++){const f=l.objects[h];mn(i,f)&&this.playWithVolumeByDistance(Hi,f.y)}}}}renderText(e,i,s,n){const o=a.measureText(e),r=i+(n-o.width)/2;a.fillText(e,r,s)}updateCharacterRanks(){const e=this.characters.filter(n=>n.finished),i=this.characters.filter(n=>!n.finished);e.sort((n,o)=>n.rank-o.rank),i.sort((n,o)=>n.y+n.height/2-(o.y+o.height/2)),[...e,...i].forEach((n,o)=>{n.rank=o+1})}checkGameState(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.findLatestCheckpoint(i.y),n=this.track.getBetween(i.y,i.y+i.height);if(!(i.fallStartTime!=null||!this.track.isOnPlatform(n,i))){if(s>i.latestCheckpointIndex&&(i.latestCheckpointIndex=s,i.rank===13)){i.eliminated=!0,i.stop(),i.ai||(this.state=1);continue}if(i.y+i.height<this.track.finishY&&(i.rank===13?(i.eliminated=!0,i.stop(),i.ai||(this.state=1)):(i.finished=!0,i.stop()),!i.ai||i.rank==this.characters.length-13)){let o=this.characters.filter(r=>r.eliminated).length;for(let r=0;r<this.characters.length;r++)if(this.characters[r].rank>this.characters.length-13)if(o<13)this.characters[r].eliminated||(this.characters[r].eliminated=!0,o++);else break;this.characters[0].eliminated?this.state=1:this.state=2}}}}dropToLatestCheckpoint(e,i){const s=this.track.getCheckpoint(i.latestCheckpointIndex),n={x:pn(s.minX+g,s.maxX-g),y:s.y+s.height/2,width:i.width,height:i.height};if(!this.characters.some(o=>be(o,n))){if(i.rank===13){i.eliminated=!0,i.stop(),i.ai||(this.state=1);return}i.drop(e,n),this.playWithVolumeByDistance(Ni,i.y),i===this.player&&this.camera.follow(i)}}drawCross(e,i,s,n="red"){a.strokeStyle=n,a.lineWidth=s/4,a.beginPath(),a.moveTo(e-s/2,i-s/2),a.lineTo(e+s/2,i+s/2),a.moveTo(e+s/2,i-s/2),a.lineTo(e-s/2,i+s/2),a.stroke()}draw(e,i){a.save(),a.translate(u.width/2,u.height/2),a.scale(this.camera.zoom,this.camera.zoom),a.translate(-this.camera.x,-this.camera.y);const s=[...this.characters];this.drawTrack(s),this.drawObjects(e,i,s),a.restore(),this.drawGradient(),this.state===0&&(a.save(),a.translate(u.width/2,u.height/2),a.scale(this.camera.zoom,this.camera.zoom),a.translate(-this.camera.x,-this.camera.y),this.drawStatusOfCharacters(e),this.drawTopStatusTexts(),a.restore())}drawTrack(e){a.save();const i=this.camera.getViewArea(),{minI:s,maxI:n}=this.track.getBetween(i.y,i.y+i.height);for(let o=n;o>=s;o--){const r=this.track.get(o),l=r.surfaces;a.fillStyle=r.color,a.shadowColor=r.color.replace("rgb(","rgba(").replace(")",",0.3)"),a.shadowOffsetY=r.height*(r.type===ht.Raft?2:6),r.type===ht.Raft&&(a.globalAlpha=.5);for(let h=0;h<l.length;h++){const f=l[h];this.drawSurface(r,f)}a.globalAlpha=1,e.push(...r.objects)}a.restore()}drawSurface(e,i){if(a.strokeStyle="rgba(255,255,255,0.4)",a.lineWidth=.1,e.type!==ht.Raft&&a.strokeRect(i.x,i.y+.1,i.width,i.height),a.save(),ve(i)){const s=i.force;a.fillStyle=`rgba(${220+s*50}, ${80+s*50}, ${60+s*50}, ${1-s})`}if(a.fillRect(i.x,i.y,i.width,i.height),a.restore(),e.type===ht.Raft)a.strokeRect(i.x,i.y,i.width,i.height);else if(ve(i)){a.shadowOffsetY=0,a.font="9px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/(e.width/10);for(let n=1;n<=i.width/9-1;n++)a.fillText("⇪",i.x+n*s,i.y+i.height/2)}else if(e.type===ht.CheckPoint||e.type===ht.Finish){a.fillStyle="rgba(255, 255, 255, 0.2)",a.fillRect(i.x,i.y+i.height-4,i.width,4),a.shadowOffsetY=0,a.font="9px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/10;for(let n=1;n<=i.width/9-1;n++)a.fillText(e.type===ht.Finish?"✪":"✓",i.x+n*s,i.y+i.height/2.4)}this.platePattern&&(a.fillStyle=this.platePattern,a.fillRect(i.x,i.y,i.width,i.height),a.fillStyle=e.color)}drawObjects(e,i,s){s.sort((n,o)=>n.y+n.height/2-(o.y+o.height/2));for(let n=0;n<s.length;n++)s[n].draw(e,i)}drawGradient(){const e=a.createRadialGradient(u.width/2,u.height/2,0,u.width/2,u.height/2,u.width/1.5);e.addColorStop(1,"rgba(0, 0, 0, 0)"),e.addColorStop(.8,"rgba(0, 0, 0, 0)"),e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),a.fillStyle=e,a.fillRect(0,0,u.width,u.height);const i=a.createLinearGradient(0,0,0,u.height);i.addColorStop(0,"rgba(0, 0, 0, 1)"),i.addColorStop(.2,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),a.fillStyle=i,a.fillRect(0,0,u.width,u.height)}drawStatusOfCharacters(e){this.characters.forEach(i=>{if(i.isVisible(e)){const s=`${i.rank}`;a.fillStyle=i.rank===13?"red":i.eliminated?"crimson":i.rank>this.characters.length-13?"orange":i.rank===1?"lightgreen":i.ai?"white":"yellow",a.font=i.ai?i.eliminated||i.rank===13?"1.2px Sans-serif":"1px Sans-serif":"1.4px Sans-serif",i.ai||(a.save(),a.font="4.0px Sans-serif",this.renderText("▲",i.x,i.y-i.height*3.25,i.width),a.restore()),i.eliminated&&this.drawCross(i.x-.25,i.y-i.height*2.7,1),this.renderText(i.eliminated?"13":s,i.x,i.y-i.height*2.5,i.width)}})}drawTopStatusTexts(){const e=this.characters.filter(s=>s.eliminated).length.toString(),i=this.characters.filter(s=>s.finished).length.toString();a.font="4px Impact",a.fillStyle=this.player.rank===13?"red":this.player.eliminated?"crimson":this.player.rank>this.characters.length-13?"orange":this.player.rank===1?"lightgreen":"yellow",a.fillText("▲ "+this.player.rank+" / "+this.characters.length,-42,this.camera.y-30),a.fillStyle="green",a.fillText("✪ "+i+" / "+(this.characters.length-13)+" QUALIFIED",-15,this.camera.y-30),a.fillStyle="red",this.drawCross(28,this.camera.y-31.5,3),a.fillText(e+" / 13",32,this.camera.y-30)}}const Ii=[c.FullWidthWithObstacles,c.FullWidth,c.FullWidth,c.FullWidth],ki=[c.Basic,c.SlopeEmptyPassage,c.SlopeEmptyPassage,c.DualPassage,c.Basic,c.RightPassage,c.RightPassage,c.Basic,c.Basic,c.Raft,c.Chasm,c.FullWidth],Qn=[c.BasicSteepSlope,c.BasicSlope,c.FullWidthWithObstacles,c.FullWidthWithMoreObstacles,c.FullWidthWithObstacles,c.DualPassage,c.DualPassage,c.DualPassage,c.FullWidth];function Zn(){const t=bt(1);return[c.Checkpoint,...t<.5?Ii:ki,c.Checkpoint,...t<.5?ki:Ii,c.Checkpoint,...Qn,c.Finish]}const xi=[c.FullWidth,c.BasicSteepSlope,c.BasicSlope,c.BasicSlope,c.Basic,c.Basic,c.Basic,c.Narrow,c.VeryNarrow,c.VeryNarrow,c.Basic,c.FullWidthWithObstacles,c.SlopeObstacleSlope,c.PassageEmptySlope,c.PassageEmptySlope,c.DualPassage,c.DualPassage,c.FullWidth,c.FullWidthWithObstaclesOnRight,c.FullWidthWithObstaclesOnRight2,c.FullWidthWithObstaclesOnRight,c.FullWidth,c.Raft,c.Chasm],Mi=[c.FullWidth,c.VeryNarrow,c.FullWidth,c.BasicSteepSlope,c.BasicSlope,c.BasicSlope,c.Basic,c.Basic,c.Basic,c.Basic,c.TwoRafts,c.Chasm];function Jn(){const t=bt(1);return[c.Checkpoint,...t<.5?xi:Mi,c.Checkpoint,...t<.5?Mi:xi,c.Finish]}const Ei=[c.FullWidth,c.Basic,c.Narrow,c.VeryNarrow,c.Basic,c.SlopeEmptySlope,c.SlopeEmptySlope,c.SlopeEmptySlope,c.DualPassage,c.DualPassage,c.Basic,c.FullWidthWithObstacles,c.VeryNarrow,c.Basic],Ci=[c.FullWidth,c.SlopeEmptySlope,c.PassageEmptySlope,c.PassageEmptySlope,c.DualPassage,c.SlopeEmptyPassage,c.DualPassageExt,c.TriplePassage,c.TriplePassage,c.TriplePassage,c.FullWidth],Pi=[c.FullWidthWithObstacles,c.FullWidthWithMoreObstacles,c.FullWidth,c.TwoRafts,c.Chasm,c.Basic,c.FullWidth],Ri=[c.BasicSteepSlope,c.BasicSlope,c.BasicSlope,c.Basic,c.Basic,c.Basic,c.DualPassage,c.DualPassageExt,c.TriplePassage,c.TriplePassage,c.DualPassageExt,c.PassageEmptySlope,c.PassageEmptySlope,c.Basic,c.Basic,c.Narrow,c.VeryNarrow,c.FullWidth,c.RightPassage,c.FullWidth,c.TwoRafts,c.Chasm];function ta(){const t=bt(1);return[c.Checkpoint,...t<.5?Ei:Ci,c.Checkpoint,...t<.5?Ci:Ei,c.Checkpoint,...t<.5?Pi:Ri,c.Checkpoint,...t<.5?Ri:Pi,c.Finish]}const ea="2025-05-10";async function ia(){let t=!1;const e=document.getElementById("ios-fullscreen-video");if(e&&e.webkitDisplayingFullscreen&&(t=!0),t)try{return e&&typeof e.webkitExitFullscreen=="function"&&e.webkitExitFullscreen(),e&&(e.pause(),e.currentTime=0),document.exitFullscreen&&await document.exitFullscreen(),!0}catch(s){return console.warn("iOS fullscreen exit failed:",s),!1}const i=document.getElementById("ios-fullscreen-video")||document.createElement("video");i.id||(i.id="ios-fullscreen-video",i.playsInline=!0,i.setAttribute("playsinline","playsinline"),i.muted=!0,i.setAttribute("muted","muted"),i.autoplay=!1,i.loop=!0,i.style.width="1px",i.style.height="1px",i.style.position="absolute",i.style.opacity="0.01",i.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAAAAG1wNDJtcDQxaXNvbWlzbzIAAAACbWV0YQAAAAAAAAAoaGRscgAAAAxBVkMgQ29kaW5nAAAAQ2NvbHJzAAAAG3VpbnQCAAAAGFFSRwKCPQAAAEAAAAJNAAAAAP9tZGF0AAAAEgEH//4PMkXKj////jA9FbmQ=",document.body.appendChild(i));try{if(await i.play(),await new Promise(n=>setTimeout(n,100)),typeof i.webkitEnterFullscreen=="function")return i.webkitEnterFullscreen(),console.log("Requested iOS fullscreen mode"),!0}catch(s){console.warn("iOS fullscreen attempt failed:",s)}return!1}async function Ti(){if(Rt&&await ia())return;const t=document.documentElement;if(document.fullscreenElement)try{await document.exitFullscreen(),console.log("Exited fullscreen mode")}catch(e){e instanceof Error&&console.error(`Error exiting fullscreen: ${e.message} (${e.name})`);return}else try{t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.mozRequestFullScreen?await t.mozRequestFullScreen():t.msRequestFullscreen&&await t.msRequestFullscreen(),console.log("Entered fullscreen mode")}catch(e){console.warn("Standard fullscreen failed, falling back to canvas positioning",e instanceof Error?e.message:e);const i=document.querySelector("canvas");i&&(i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.zIndex="1000");return}}const sa="Director's cut ("+ea+")",je=1e3/60,na=je*5;let Qe=performance.now(),Mt=0,Ct=1+Math.random()*.6,Pt=1+Math.random()*.3,fe=1,P,V=0,Ee=0,ns=0;const aa=5e3;let E=0,as=0;const Ie=Is(),Fi=ks();let xt=0;const it=async t=>{Ee=t,ni(t===6||t===5);const e=document.getElementById("restartButton");e&&(e.style.display=t!==1?"block":"none");const i=document.getElementById("fullscreenButton");switch(i&&(i.style.display=t!==1||!vt?"block":"none"),V=1280*2,t){case 2:await Zs(0),await _t(),it(3);break;case 3:await _t(Xe),it(4);break;case 4:it(5);break;case 5:if(xt=0,Mt>1&&P&&!P.player.eliminated){const s=Mt===3?ta():Jn();P=new Si(s,Ct,Pt,P.characters,Fi)}else P=new Si(Zn(),Ct,Pt,void 0,Fi);E=V,as=ns,Wi();break;case 7:E=1,st(Xi),Ct=1+Math.random()*.6,Pt=1+Math.random()*.3,await _t(zi),Mt=1,it(2);break;case 8:ni(!1),bs(),E=1,st(Gi),P&&P.characters.length>14?(await _t(Xe),Mt++,it(5)):(await _t(pe),Mt=1,Ln(),it(2));break;case 6:is();break;case 1:Ks();break}},os=t=>{requestAnimationFrame(os);const e=t-Qe;if(e>=je){const i=Math.min(e,na);Qe=t-e%je,oa(t,i),ys(t)&&la(t,i)}},oa=(t,e)=>{switch(Ee){case 6:{Xn(),P==null||P.update(t,e),(P==null?void 0:P.state)===qe.GAME_OVER?it(7):(P==null?void 0:P.state)===qe.FINISHED&&it(8);break}case 5:{xt===2&&E<V/4?(st(Yi),xt++):(xt===1&&E<V/2||xt===0&&E<V)&&(st(ze),xt++);break}}};let me=0;const Oi="LOADING...",ra=()=>{const t=me<10?Oi.substring(0,me):"LOADING...";B(t+(me++%60===0?"":"█"),L.Small,"Courier New",1,7.7,!0,0,Oi)},la=(t,e)=>{switch(ns=t,a.save(),a.fillStyle="rgb(0, 0, 20)",a.fillRect(0,0,u.width,u.height),P==null||P.draw(t,e),a.restore(),a.save(),Ee){case 0:{ra(),me++,Li(),ct(!1);break}case 1:{if(ca(!0),vt){const i=document.getElementById(ye);i&&i.style.display==="none"&&(i.style.display="block")}else se("start");break}case 2:{Ge(t++,!1,0),kt(),ct(!0);break}case 3:{Ge(t++,!0,fe=fe+.01),kt(),ct(!0);break}case 4:{Ge(t++,!0,fe=fe+.01);const i=u.width/2,s=u.height/2;a.beginPath(),a.arc(i,s,E,0,Math.PI*2),a.fillStyle="#802010",a.fill(),E<V&&(E+=e),kt(),ct(!0);break}case 5:{const i=u.width/2,s=u.height/2;E<=0?it(6):(E>0&&(a.beginPath(),a.arc(i,s,E,0,Math.PI*2),a.fillStyle=E<V/4?"#105000":E<V/2?"#CCCC40":"#802010",a.fill()),E<V/4?B("▲ GO! ▲",L.Xl,"Impact",E/V*4):E<V/2?B("Set...",L.Xl,"Impact",1):B("Ready...",L.Xl,"Impact",1),E>0&&(E=(1-(t-as)/aa)*V)),kt(),ct(!0);break}case 7:{const i=u.width/2,s=u.height/2;a.beginPath(),a.arc(i,s,E,0,Math.PI*2),a.fillStyle="#802010",a.fill(),B("❌ ELIMINATED!",L.Large,"Impact",1,-4.5),(P==null?void 0:P.player.rank)===13?B("Don't be the 13TH GUY",L.Small,"Sans-serif"):(B("Don't be one of the last 13TH GUYs",L.Small,"Sans-serif"),B("The final rank is "+(P==null?void 0:P.player.rank)+".",L.Normal,"Impact",1,3.1)),E>=V&&se("continue",9),E<V&&(a.save(),a.globalAlpha=.7,a.translate(u.width/8,E*2-u.height),oe(a,"eliminated",u.height/6*Ct,u.height/2*Pt,t,K.Backward,gt.Fall,Ie),a.globalAlpha=0,a.restore()),E<V&&(E+=e),kt(),ct(!0);break}case 8:{const i=u.width/2,s=u.height/2;a.beginPath(),a.arc(i,s,E,0,Math.PI*2),a.fillStyle="#105000",a.fill(),E>=V/4&&(P&&P.characters.length>14?(B("✪ QUALIFIED!",L.Large,"Impact",1,-5),B("☻",L.Huge,"Impact"),B("Ready for next round "+(Mt+1)+" / 3",L.Normal,"Sans-serif",1,3.8)):(B("GAME FINISHED!",L.Large,"Impact",1,-5),B("☻",L.Huge,"Impact"),B("Congratulations to the winner!",L.Normal,"Impact",1,3.8)),E>=V&&se(),a.save(),a.translate(E<u.width/6?E:u.width/6,u.height/3),oe(a,ti,u.height/6*Ct,u.height/2*Pt,t,E<u.width/6?K.Right:P&&P.characters.length<=14||t%3600>1800?K.Backward:K.BackwardRight,P&&P.characters.length>14?gt.Walk:gt.Celebrate,Ie),a.restore()),E<V&&(E+=e),kt(),ct(!0);break}default:{const i=document.getElementById(ye);i&&i.style.display!=="none"&&(i.style.display="none"),ct(!1),is();break}}a.restore()},rs=()=>{B(sa,L.Tiny,"Impact",.5,2.3,!1),B("Don't be the",L.Small,"Impact",1,-1.8,!0,-.9),B("❌ 13TH GUY",L.Xl,"Impact",1,1.8)},Ge=(t,e,i)=>{a.save(),a.fillStyle="rgb(20, 20, 50)",a.rect(0,0,u.width,u.height),a.fill(),a.save(),a.translate(u.width/8+i,u.height/3),oe(a,ti,(e?u.height/6/i:u.height/6)*Ct,(e?u.height/2/i:u.height/2)*Pt,t,e?K.Forward:t%3600<1800?K.BackwardRight:K.Backward,gt.Walk,Ie,e),a.restore(),e?(B("Avoid being the 13th or among the last 13",L.Small,"Sans-serif",1,-1.2),B("or you will be eventually ❌ eliminated!",L.Small,"Sans-serif",1,1.3),B("MOVE WITH",L.Xs,"Sans-serif",.8,-7.5),B("▲ / W - ▼ / S - ◄ / A - ► / D",L.Xs,"Sans-serif",.8,-5.6),Ee===3&&se("start the race!")):(rs(),se()),a.restore()},ca=t=>{a.save(),a.fillStyle="rgb(20, 20, 50)",a.rect(0,0,u.width,u.height),a.fill(),a.save(),a.translate(u.width/8,u.height/3),oe(a,ti,u.height/6*Ct,u.height/2*Pt,0,K.Backward,gt.Stand,Ie),a.restore(),rs(),a.filter="",Li(),kt(),ct(t)};async function Di(){const t=document.getElementById(ye);t&&(t.style.display="none");const e=Cs();document.body.appendChild(e),Mt=1,it(2)}const ha=async()=>{u.tabIndex=0,u.style.outline="none",As(),zn(),Qe=performance.now(),window.requestAnimationFrame(os);const t=xs(vt),e=Ms(),i=Es();document.body.appendChild(e),document.body.appendChild(t),document.body.appendChild(i),t.addEventListener("click",s=>{s.stopPropagation(),Ti(),u.focus()}),e.addEventListener("click",s=>{s.stopPropagation(),window.location.reload()}),await Us(),it(1),vt?i.addEventListener("click",async s=>{s.stopPropagation(),i.style.display="none",st(pe),await new Promise(n=>setTimeout(n,100)),await Ti(),u.focus(),await Di()},{passive:!1,once:!0}):(await _t(pe),await Di())},ls=1280,cs=720;window.addEventListener("resize",()=>Qi(ls,cs),!1);Qi(ls,cs);ha();
