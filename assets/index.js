var gi=Object.defineProperty;var ui=(t,e,i)=>e in t?gi(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var u=(t,e,i)=>ui(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();const yi=/iPad/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,de=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),pi=/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&navigator.maxTouchPoints>1,mi=!de&&!yi;var B=(t=>(t.AUTO="auto",t.HIGH="high",t.MEDIUM="medium",t.LOW="low",t))(B||{});let Y="low",fe="low",Et=!1,Gt=!1,ut=null;const wi=60;let pe=0;function me(t){Gt=t,console.log(`Race mode set to: ${t?"ACTIVE":"INACTIVE"}`)}function _t(){return Y==="auto"?fe:Y}function bi(t){if(!Gt||_t()!=="low")return!0;const e=1e3/wi;return t-pe>=e?(pe=t,!0):!1}function ge(){if(ut){let t;Y==="auto"?t=`auto (${Si(fe)})`:t=Y,de?ut.textContent=`GFX: ${t}`:ut.innerHTML=`<u>G</u>FX: ${t}`}}function Si(t){switch(t){case"high":return"H";case"medium":return"M";case"low":return"L";default:return t}}function ki(t){ut=t,ge()}function vi(){console.log("Initializing graphics with performance detection..."),Ei(),Et=!0,console.log("Performance mode set to:",Y)}function $e(){Et||Y!=="auto"||(console.log("Scheduling performance check..."),setTimeout(()=>{console.log("Starting performance check for AUTO mode..."),Et=!0,Ii()},3e3))}function Ai(){Et=!1}function Ii(){console.log("Running performance check for LOW tier device..."),fe="low",ge(),console.log("Set to LOW performance mode for low-tier device")}function Ve(){const t=["auto","high","medium","low"],i=(t.indexOf(Y)+1)%t.length;Y=t[i],Y==="auto"&&Gt&&(Et=!1,$e()),ge(),ut&&ut.blur(),console.log("Performance mode toggled to:",Y)}function Ei(){de||document.addEventListener("keydown",t=>{(t.code==="KeyG"||t.code==="F1")&&Ve()})}function ue(){return Gt}const O={zIndex:"10",size:"40px",color:"rgba(255, 255, 255, 0.4)",background:"black",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",fontSize:"24px",lineHeight:"0"},Xt=(t,e)=>{const i=document.createElement("button");return i.id=t,i.style.position="absolute",i.style.zIndex=O.zIndex,i.textContent=e,i.style.fontFamily="Impact",i.style.minWidth=O.size,i.style.minHeight=O.size,i.style.color=O.color,i.style.background=O.background,i.style.border=O.border,i.style.borderRadius=O.borderRadius,i.style.fontSize=O.fontSize,i.style.lineHeight=O.lineHeight,i.style.display="block",i},f=document.querySelector("canvas"),r=f.getContext("2d",{willReadFrequently:!0});let U=null,vt=null,At;const Dt="startButton",xi=(t,e,i)=>{if(U=document.createElement("canvas"),U.width=t,U.height=e,vt=U.getContext("2d"),vt){vt.fillStyle=`rgba(0, 0, 0, ${1-i})`;for(let s=0;s<e;s+=2)vt.fillRect(0,s,t,1)}},Ri=()=>{const t=f.width,e=f.height;At=r.createRadialGradient(t/2,e/2,0,t/2,e/2,t/2),At.addColorStop(0,"rgba(255, 255, 255, 0.3)"),At.addColorStop(1,"rgba(0, 0, 0, 0.5)")},V=(t=!0)=>{const e=f.width,i=f.height;let s;const n=_t();ue()?s=n:s=n===B.LOW?B.MEDIUM:n;const o=t?.7:.8;let a=o,h=t?10:0;switch(s){case B.LOW:{r.fillStyle="rgba(0, 0, 0, 0.2)",r.fillRect(0,0,e,i),r.globalAlpha=.05,r.fillStyle="#000";for(let y=0;y<i;y+=2)r.fillRect(0,y,e,1);r.globalAlpha=1;return}case B.MEDIUM:a=o*.7,h=0;break;case B.HIGH:}const c=r.getImageData(0,0,e,i),d=c.data,b=t&&h>0?new Float32Array(e*i):null;if(t&&b&&h>0)for(let y=0;y<b.length;y++)b[y]=(Math.random()-.5)*h;if(t&&b&&h>0)for(let y=0;y<i;y++){const p=y*e;for(let S=0;S<e;S++){const I=(p+S)*4,C=b[p+S];d[I]+=C,d[I+1]+=C,d[I+2]+=C}}r.putImageData(c,0,0),s!==B.LOW&&((!U||U.width!==e||U.height!==i)&&xi(e,i,a),vt&&U&&(r.globalAlpha=a,r.drawImage(U,0,0),r.globalAlpha=1))},nt=()=>{(ue()?_t():B.HIGH)!==B.LOW&&(At||Ri(),r.fillStyle=At,r.fillRect(0,0,f.width,f.height))},Ke=()=>{if((ue()?_t():B.HIGH)===B.LOW){r.globalAlpha=.5,r.fillStyle="rgba(0, 0, 0, 0.5)",r.fillRect(0,0,f.width,f.height),r.globalAlpha=1;return}const e=r.getImageData(0,0,f.width,f.height),i=e.data;for(let s=0;s<i.length;s+=4){const n=i[s],o=i[s+1],a=i[s+2],h=n*.3+o*.59+a*.11;i[s]=i[s+1]=i[s+2]=h*.7}r.putImageData(e,0,0)},Ci=()=>{const t=document.createElement("canvas");t.width=4,t.height=4;const e=t.getContext("2d");if(!e)return;function i(n,o,a,h,c){e&&(e.strokeStyle=c,e.beginPath(),e.moveTo(n,o),e.lineTo(a,h),e.stroke())}const s="#00000010";e.fillStyle=s,e.fillRect(0,0,t.width,t.height);for(let n=0;n<=t.width;n+=4)i(n,0,n,t.height,s),i(0,n,t.width,n,s);return e.createPattern(t,"repeat")},Mi=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(!e)return;const i=e.getImageData(0,0,t.width,t.height),s=i.data,n=4;for(let o=0;o<t.height;o+=n)for(let a=0;a<t.width;a+=n){const h=Math.random()*64,c=Math.floor(Math.random()*24);for(let d=0;d<n;d++)for(let b=0;b<n;b++){const y=((o+d)*t.width+(a+b))*4;s[y]=Math.min(255,Math.max(0,s[y]+h)),s[y+1]=Math.min(255,Math.max(0,s[y+1]+h)),s[y+2]=Math.min(255,Math.max(0,s[y+2]+h)),s[y+3]=c}}return e.putImageData(i,0,0),e.createPattern(t,"repeat")};function Pi(t){const e=Xt("fullscreenButton","⛶");return e.style.top="10px",e.style.right="10px",e.style.display=t?"none":"block",e}function Ti(){const t=Xt("restartButton","↺");return t.style.top="10px",t.style.right="60px",t.style.display="none",t}function Oi(){const t=document.createElement("button");return t.id=Dt,t.style.position="absolute",t.style.background="transparent",t.style.border="none",t.style.fontSize="2vw",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.zIndex=O.zIndex,t.style.color=O.color,t.style.display="none",t.style.padding="20vw 0 0 0",t.style.fontFamily="Courier New",t.style.zIndex=O.zIndex,t.textContent="Tap the screen to continue█",t}const Fi=()=>{const t=Xt("performanceToggleButton","");return mi?(t.style.top="10px",t.style.left="10px"):(t.style.top="60px",t.style.right="10px",t.style.height=`${parseInt(O.size)/2}px`,t.style.padding="20px 0",t.style.fontSize=`${parseInt(O.fontSize)/2}px`,t.style.background="rgba(0, 0, 0, 0.2)",t.style.border="none"),t.addEventListener("click",e=>{e.preventDefault(),Ve(),t.blur()}),ki(t),t};var x=(t=>(t[t.Tiny=16]="Tiny",t[t.Xs=20]="Xs",t[t.Small=24]="Small",t[t.Normal=32]="Normal",t[t.Large=48]="Large",t[t.Xl=64]="Xl",t[t.Huge=80]="Huge",t))(x||{});const we=t=>{const e=f.width/1e3;return Math.floor(t*e)},R=(t,e,i,s=1,n=0,o=!0,a=0,h)=>{r.save();const c=we(e),d=we(16);r.globalAlpha=s>0?s:0,r.fillStyle="white",r.font=c+"px "+i;const b=r.measureText(h??t).width,y=n*d,p=a*d;r.fillText(t,(f.width-b)/2+p,(o?f.height/2:0)+y),r.restore()};new(window.AudioContext||window.webkitAudioContext);const Wi="start",be="race",Di="bounce",Hi="hit",Bi="teleport",Li="restart",Ni=document.createElement("audio"),Gi=document.createElement("audio"),_i=document.createElement("audio"),z=async(t,e)=>{},Xi=t=>{const e=[];e.push(Ni,Gi,_i),e.forEach(i=>{i._fadeInterval&&(clearInterval(i._fadeInterval),i._fadeInterval=null),i._fadeOutInTimeout&&(clearTimeout(i._fadeOutInTimeout),i._fadeOutInTimeout=null),i.pause(),i.currentTime=0})},Ue=()=>({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1});let pt=Ue();const Yi=t=>{t.code in pt&&(pt[t.code]=!0)},zi=t=>{t.code in pt&&(pt[t.code]=!1)},$i=()=>{window.addEventListener("keydown",Yi),window.addEventListener("keyup",zi),window.addEventListener("blur",()=>{pt=Ue()})},Vi=t=>new Promise(e=>setTimeout(e,t)),Ki=t=>new Promise(e=>{const i=s=>{s.code==="Enter"&&(z(),t&&z(),window.removeEventListener("keydown",i),e())};window.addEventListener("keydown",i)}),Ui=()=>pt;function qi(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function Ht(t,e){const i=e.x<=t.x+t.width&&t.x<=e.x+e.width,s=e.y<=t.y+t.height&&t.y<=e.y+e.height;return i&&s}function ji(t,e){const i=t.x<=e.x&&e.x+e.width<=t.x+t.width,s=t.y<=e.y&&e.y+e.height<=t.y+t.height;return i&&s}function Kt(t){return-(Math.cos(Math.PI*t)-1)/2}function G(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}function Ut(t){return t*t}function Qi(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}class Ji{constructor(e,i){u(this,"x",0);u(this,"y",0);u(this,"zoom",1);u(this,"visibleAreaHeight");u(this,"yAdjust",0);u(this,"target",null);u(this,"transition",null);this.level=e,this.view=i}getViewArea(){const e=this.view.width/this.zoom,i=this.view.height/this.zoom;return{x:this.x-e/2,y:this.y-i/2,width:e,height:i}}follow(e){this.target=e}setTransition(e){const i=this.view.height/this.zoom;this.transition={...e,endY:e.endY+i*this.yAdjust},this.target=null}update(e){if(this.visibleAreaHeight!=null&&(this.zoom=this.view.height/this.visibleAreaHeight),this.transition!=null){const{startY:i,endY:s,startTime:n,duration:o}=this.transition;if(e<n+o){const h=(e-this.transition.startTime)/this.transition.duration;this.y=i+Qi(h)*(s-i)}else this.transition=null}else this.target&&this.followFrame(this.target)}followFrame(e){const i=this.view.width/this.zoom,s=this.view.height/this.zoom;if(i<this.level.width){let n=e.x+e.width;n-i/2<this.level.x?n=this.level.x+i/2:n+i/2>this.level.x+this.level.width&&(n=this.level.x+this.level.width-i/2),this.x=n}else this.x=0;this.y=e.y+s*this.yAdjust}}const F={x:0,y:0};function Ft(t){return t.x===0&&t.y===0}function Zi(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function ts(t,e){return Math.abs(t.x-e.x)}function es(t,e){return Math.abs(t.y-e.y)}function mt(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function q(t,e){return{x:t.x+e.x,y:t.y+e.y}}function qe(t,e){return{x:t.x-e.x,y:t.y-e.y}}function X(t,e){return{x:t.x*e,y:t.y*e}}function is(t,e){return{x:t.x/e,y:t.y/e}}function j(t){return is(t,mt(t))}function xt(t,e){return t.x*e.x+t.y*e.y}const dt=.5,ss=.01,ns=5e-4,Se=6e-4,os=3;function rs(t,e,i){if(Ft(e)){const S=mt(t.velocity),I=Se*i,C=S>I?S-I:0;return C>0?X(j(t.velocity),C):F}const s=xt(t.velocity,e),n={x:-e.y,y:e.x},o=xt(t.velocity,n);let a=ns*i;s>ss*i&&(a=0);const h=Se*i,c=Math.abs(o)>h?-h:0,d=Math.sign(o)*c,b=X(e,a),y=X(n,d);return q(t.velocity,q(b,y))}function as(t,e){const i=t.width/2,s=t.height/2,n=e.width/2,o=e.height/3.5,a={x:t.x+t.width/2,y:t.y+t.height/2},h=q(a,t.velocity),c={x:e.x+e.width/2,y:e.y+e.height/2};if(ts(h,c)<i+n&&es(h,c)<s+o){const d=j(qe(c,a)),b=xt(t.velocity,d),y=X(d,-Math.abs(b)*os);let p=q(t.velocity,y);return mt(p)>dt&&(p=X(j(p),dt)),t.velocity=p,!0}return!1}function ls(t,e){const i=t.width*.4,s=e.width*.4,n={x:t.x+t.width/2,y:t.y+t.height/2},o={x:e.x+e.width/2,y:e.y+e.height/2},a=q(n,t.velocity),h=q(o,e.velocity);if(Zi(a,h)<i+s){const c=j(qe(o,n)),d=X(c,-1),b=xt(t.velocity,c),y=xt(e.velocity,d),p=X(c,Math.abs(b)),S=X(d,Math.abs(y));let I=q(t.velocity,S);mt(I)>dt&&(I=X(j(I),dt)),t.velocity=I;let C=q(e.velocity,p);return mt(C)>dt&&(C=X(j(C),dt)),e.velocity=C,!0}return!1}const it=(t=1)=>Math.random()*t,hs=(t,e)=>Math.random()*(e-t)+t,gt=class gt{constructor(e){u(this,"x");u(this,"y");u(this,"width",gt.WIDTH);u(this,"height",gt.HEIGHT);u(this,"velocity",F);this.x=e.x,this.y=e.y}draw(e,i){r.save(),r.translate(this.x,this.y);const s=r.createLinearGradient(0,0,this.width,this.height);s.addColorStop(0,"rgb(255, 110, 110)"),s.addColorStop(1,"rgb(255, 60, 60)"),r.beginPath(),r.fillStyle="rgba(0, 0, 0, 0.1)",r.ellipse(this.width/2,this.height/1.5,this.width/2,this.height,0,0,2*Math.PI),r.fill(),r.fillStyle=s,r.beginPath(),r.ellipse(this.width/2,this.height/2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.fillStyle=s,r.fillRect(0,-this.height*2,this.width,this.height*2.5);const n=r.createLinearGradient(0,0,this.width,this.height);n.addColorStop(0,"rgb(255, 140, 140)"),n.addColorStop(1,"rgb(255, 80, 80)"),r.fillStyle=n,r.beginPath(),r.ellipse(this.width/2,-this.height*2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.strokeStyle="rgb(200, 70, 70)",r.lineWidth=this.width/100,r.stroke(),r.restore()}};u(gt,"WIDTH",10),u(gt,"HEIGHT",4);let k=gt;const m=16,g=10,cs=m,yt=9,Z=g*yt,qt=g*7,ds=g*5,ke=g*3,w=-90/2,ve=Z/2;var l=(t=>(t[t.FullWidth=0]="FullWidth",t[t.Basic=1]="Basic",t[t.BasicSlope=2]="BasicSlope",t[t.BasicSteepSlope=3]="BasicSteepSlope",t[t.Narrow=4]="Narrow",t[t.VeryNarrow=5]="VeryNarrow",t[t.DualPassage=6]="DualPassage",t[t.DualPassageExt=7]="DualPassageExt",t[t.TriplePassage=8]="TriplePassage",t[t.RightPassage=9]="RightPassage",t[t.SlopeEmptySlope=10]="SlopeEmptySlope",t[t.SlopeEmptyPassage=11]="SlopeEmptyPassage",t[t.PassageEmptySlope=12]="PassageEmptySlope",t[t.SlopeObstacleSlope=13]="SlopeObstacleSlope",t[t.FullWidthWithObstaclesOnRight=14]="FullWidthWithObstaclesOnRight",t[t.FullWidthWithObstaclesOnRight2=15]="FullWidthWithObstaclesOnRight2",t[t.FullWidthWithMoreObstacles=16]="FullWidthWithMoreObstacles",t[t.FullWidthWithObstacles=17]="FullWidthWithObstacles",t[t.Chasm=18]="Chasm",t[t.Raft=19]="Raft",t[t.TwoRafts=20]="TwoRafts",t[t.Checkpoint=21]="Checkpoint",t[t.Finish=22]="Finish",t))(l||{}),K=(t=>(t[t.Normal=0]="Normal",t[t.CheckPoint=1]="CheckPoint",t[t.Finish=2]="Finish",t[t.Raft=3]="Raft",t))(K||{}),E=(t=>(t[t.Empty=0]="Empty",t[t.Free=1]="Free",t[t.Obstacle=2]="Obstacle",t[t.Raft=3]="Raft",t))(E||{});function je(t,e,i){return{type:0,row:t,col:e,x:w+e*g,y:i,width:g,height:m}}function ee(t){return"yDirection"in t}function Bt(t){return"force"in t}class fs{constructor(e,i,s,n,o){u(this,"row");u(this,"y");u(this,"type");u(this,"surfaces");u(this,"objects");u(this,"width");u(this,"height");u(this,"minX");u(this,"maxX");u(this,"blocks",new Array(yt));this.row=e,this.y=i,this.type=s,this.surfaces=n,this.objects=o,this.minX=Math.min(...this.surfaces.map(a=>a.x)),this.maxX=Math.max(...this.surfaces.map(a=>a.x+a.width)),this.width=this.maxX-this.minX,this.height=m;for(let a=0;a<yt;a++)this.blocks[a]={type:this.getBlockType(a),row:e,col:a,x:w+a*g,y:this.y,width:g,height:m}}get color(){switch(this.type){case 1:return"rgb(50, 80, 50)";case 2:return"rgb(0, 200, 0)";case 3:return"rgb(50,60,120)";default:return"rgb(80, 50, 80)"}}getBlock(e){return e<0||yt<=e?je(this.row,e,this.y):this.blocks[e]}isFree(e,i){const s=g*.1,n=w+e*g,o=i??this.y,a={x:n+s,y:o+s,width:g-2*s,height:cs-2*s};return this.surfaces.some(h=>ji(h,a))&&!this.objects.some(h=>Ht(h,a))}getBlockType(e){const i=g*.1,s=w+e*g+i,n=g-2*i;return this.surfaces.some(h=>ee(h)&&h.x<=s&&s+n<=h.x+h.width)?3:this.objects.some(h=>h.x<=s&&s+n<=h.x+h.width)?2:this.isFree(e)?1:0}}function gs(t,e){const i=t.map((s,n)=>us(s,n,e));return ys(i),i}function us(t,e,i){const s=i-m*(e+1),n=s+m/2;let o=0,a=[],h=[];switch(t){case 0:a=[{x:w,y:s,width:Z,height:m}];break;case 1:a=[{x:w+g*1,y:s,width:qt,height:m}];break;case 2:{a=[{force:.3,x:w+g*1,y:s,width:qt,height:m}];break}case 3:{a=[{force:.5,x:w+g*1,y:s,width:qt,height:m}];break}case 4:a=[{x:w+g*2,y:s,width:ds,height:m}];break;case 5:a=[{x:w+g*3,y:s,width:ke,height:m}];break;case 6:a=[{x:w+g,y:s,width:g*2,height:m},{x:ve-g*3,y:s,width:g*2,height:m}];break;case 7:a=[{x:w+g,y:s,width:g*2,height:m},{x:w+g*4,y:s,width:g*5,height:m}];break;case 8:a=[{x:w+g*1,y:s,width:g*2,height:m},{x:w+g*4,y:s,width:g*2,height:m},{x:w+g*7,y:s,width:g*2,height:m}];break;case 9:{a=[{x:w+g*6,y:s,width:g*2,height:m}];break}case 10:{const c={force:.3,x:w+g*1,y:s,width:g*2,height:m},d={force:.3,x:w+g*6,y:s,width:g*2,height:m};a=[c,d];break}case 11:{const c={force:.3,x:w+g*1,y:s,width:g*2,height:m},d={x:w+g*6,y:s,width:g*2,height:m};a=[c,d];break}case 12:{const c={x:w+g*1,y:s,width:g*2,height:m},d={force:.3,x:w+g*6,y:s,width:g*2,height:m};a=[c,d];break}case 13:{const c={force:.3,x:w+g*1,y:s,width:g*2,height:m},d={force:.3,x:w+g*6,y:s,width:g*2,height:m};a=[c,{x:w+g*3,y:s,width:g*3,height:m},d],h=[new k({x:w+g*4,y:n-k.HEIGHT/2})];break}case 14:{a=[{x:-90/2,y:s,width:Z,height:m}],h=[new k({x:w+g*4,y:n-k.HEIGHT/2}),new k({x:w+g*6,y:n-k.HEIGHT/2}),new k({x:w+g*8,y:n-k.HEIGHT/2})];break}case 15:{a=[{x:-90/2,y:s,width:Z,height:m}],h=[new k({x:w+g*3,y:n-k.HEIGHT/2}),new k({x:w+g*5,y:n-k.HEIGHT/2}),new k({x:w+g*7,y:n-k.HEIGHT/2})];break}case 16:a=[{x:-90/2,y:s,width:Z,height:m}],h=[new k({x:w+g*0,y:n-k.HEIGHT/2}),new k({x:w+g*2,y:n-k.HEIGHT/2}),new k({x:w+g*4,y:n-k.HEIGHT/2}),new k({x:w+g*6,y:n-k.HEIGHT/2}),new k({x:w+g*8,y:n-k.HEIGHT/2})];break;case 17:a=[{x:-90/2,y:s,width:Z,height:m}],h=[new k({x:w+g,y:n-k.HEIGHT/2}),new k({x:w+g*3,y:n-k.HEIGHT/2}),new k({x:w+g*5,y:n-k.HEIGHT/2}),new k({x:w+g*7,y:n-k.HEIGHT/2})];break;case 18:break;case 19:{o=3,a=[{yDirection:-1,dockStartTime:0,x:w+g*3,y:s,width:ke,height:m}];break}case 20:{o=3;const c={yDirection:-1,dockStartTime:0,x:w+g*1,y:s-it()*m,width:g*2,height:m},d={yDirection:-1,dockStartTime:0,x:ve-g*3,y:s-it()*m,width:g*2,height:m};a=[c,d];break}case 21:o=1,a=[{x:-90/2,y:s,width:Z,height:m}];break;case 22:o=2,a=[{x:-90/2,y:s,width:Z,height:m}];break}return new fs(e,s,o,a,h)}function ys(t){for(let e=1;e<t.length;e++){const i=t[e-1],s=t[e];for(let n=0;n<yt;n++)i.blocks[n].type===3&&s.blocks[n].type===0&&(s.blocks[n].type=3)}}const Yt=-1,Ae=1,ps={x:0,y:Yt},ms={x:-1,y:0},ws={x:1,y:0},bs=j({x:-1,y:Yt}),Ss=j({x:1,y:Yt}),ks=3,jt=1e3;class vs{constructor(e,i){u(this,"host");u(this,"track");u(this,"horizontalMargin",0);u(this,"lastSlowdownTime",-1e3);u(this,"target",null);this.host=e,this.track=i}reset(){this.target=null}getMovement(e){const i=this.getCurrentBlock(),s=this.track.getBlock(i.row+1,i.col),n=this.goByRaft(i,s,e);return n||((this.target==null||this.hasReached(this.target))&&(this.target=this.findNextTarget(i)),this.goRoundObstacles(i,s,e)||this.moveOnTrack(i,s,e))}goByRaft(e,i,s){if(e.type!==E.Raft&&i.type===E.Raft&&(this.host.y>e.y+1.5*this.host.height||this.track.isFree(e.row+1,e.col)))return{x:0,y:this.moveAhead(e,i,s)};if(i.type===E.Raft&&this.host.y<=e.y+1.5*this.host.height&&!this.track.isFree(e.row+1,e.col))return F;if(e.type===E.Raft&&!this.track.isFree(e.row+1,e.col)){let n=0;return this.host.x<e.x+this.host.width?n=1:e.x+e.width-2*this.host.width<this.host.x&&(n=-1),{x:n,y:0}}return e.type===E.Raft&&this.track.isFree(e.row,e.col)&&this.track.isFree(e.row+1,e.col)?ps:null}goRoundObstacles(e,i,s){if(this.target==null)return F;if(e.type===E.Obstacle){if(e.y+e.height/2<this.host.y+this.host.height/2)return this.target.col<e.col?bs:Ss}else{if(this.target.col<e.col&&this.track.getBlock(e.row,e.col-1).type===E.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===E.Empty?ms:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:-1,y:this.moveAhead(e,i,s)};if(e.col<this.target.col&&this.track.getBlock(e.row,e.col+1).type===E.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===E.Empty?ws:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:1,y:this.moveAhead(e,i,s)}}return null}moveOnTrack(e,i,s){if(this.target==null)return F;let n=0;i.type===E.Empty&&this.host.y+this.host.height/2<e.y?n=Ae:n=this.moveAhead(e,i,s),n<0&&i.type===E.Empty&&this.host.y+this.host.height/2<e.y+e.height/2&&(n=0);let o=0;const a=this.host.x<this.target.x+this.horizontalMargin,h=this.target.x+this.target.width-this.horizontalMargin<=this.host.x+this.host.width;return a&&this.track.getBlock(e.row,e.col+1).type===E.Free?o=1:h&&this.track.getBlock(e.row,e.col-1).type===E.Free&&(o=-1),{x:o,y:n}}moveAhead(e,i,s){return i.type!==E.Free&&this.host.velocity.y<-.25*1.5?(jt<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),Ae):this.host.velocity.y<-.25*3.5&&!this.isClearAhead(e)?(jt<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),0):jt<s-this.lastSlowdownTime?Yt:0}getCurrentBlock(){const e=qi(this.host);let i=this.track.getBlockAt(e);return(i.type===E.Empty||i.type===E.Raft)&&i.y+i.height-this.host.height<e.y&&(i=this.track.getBlock(i.row-1,i.col)),i.type===E.Empty&&(i.x+i.width-this.host.width<e.x?i=this.track.getBlock(i.row,i.col+1):e.x<i.x+this.host.width&&(i=this.track.getBlock(i.row,i.col-1))),i}hasReached(e){return this.host.y+this.host.height<e.y+e.height}findNextTarget(e){const i=this.findNearestBlock(e.row+1,e.col);if(i==null||i.col!==e.col)return i;const s=this.findNearestBlock(i.row+1,i.col);if(s==null)return i;if(s.col<i.col){const n=this.track.getBlock(i.row,i.col-1);if(n.type===E.Free)return n}if(i.col<s.col){const n=this.track.getBlock(i.row,i.col+1);if(n.type===E.Free)return n}return i}isClearAhead(e){for(let i=e.row+1;i<=e.row+ks;i++)if(this.track.getBlock(i,e.col).type!==E.Free)return!1;return!0}findNearestBlock(e,i){for(let s=0;s<yt-1;s++){const n=(it()<.5?-1:1)*s,o=i+n,a=this.track.getBlock(e,o);if(a.type===E.Free||a.type===E.Raft)return this.horizontalMargin=it(.2)*g,this.track.getBlock(e,o)}return null}}const _=(t,e)=>2*Math.abs(e/t-Math.floor(e/t+.5));var Q=(t=>(t[t.Stand=0]="Stand",t[t.Walk=1]="Walk",t[t.Fall=2]="Fall",t[t.Celebrate=3]="Celebrate",t))(Q||{}),P=(t=>(t[t.Right=0]="Right",t[t.Forward=1]="Forward",t[t.Backward=2]="Backward",t[t.ForwardRight=3]="ForwardRight",t[t.BackwardRight=4]="BackwardRight",t))(P||{});const As="rgb(200,150,150)",Is="rgb(230,230,230)",Es="rgb(30,0,0)",xs="rgb(170,120,120)",bt="rgb(140,140,140)",Qt="rgb(120,120,120)",St="rgb(140,140,220)",Jt="rgb(120,120,200)",Rs="rgba(0, 0, 0, 0.2";function Rt(t,e,i,s,n,o,a,h,c){let d=0,b=0,y=0,p=0,S=0,I=0;const C=o===3||o===4,$=o===0;switch(a){case 1:d=$?600:C?400:300,I=Kt(_(d/2,n/2))*.02*s,b=S=-Math.PI/6+G(_(d,n))*(Math.PI/3),y=p=-Math.PI/6+G(_(d,n+d/2))*(Math.PI/3);break;case 3:{d=1500,I=Kt(_(d/2,n/2))*.15*s;const N=_(d,n);b=G(N)*Math.PI*(1/8),y=-G(N)*Math.PI*(3/8),S=Math.PI*(1/8)-G(N)*Math.PI*(9/8),p=Math.PI*(1/8)-G(N)*Math.PI*(10/8);break}case 2:d=3200,I=Kt(_(d/2,n))*.02*s,b=-Math.PI*(3/8)+G(_(d,n))*(Math.PI*(3/4)),y=-Math.PI*(3/8)+G(_(d,n+d/2))*(Math.PI*(3/4)),p=-Math.PI*(8/8)+G(_(d,n+d/2))*(Math.PI/4),S=-Math.PI*(8/8)+G(_(d,n))*(Math.PI/4);break}t.save(),Cs(t,.5*i,s,i*.4-I/2),t.translate(0,-I);const W=.3*s,D=.25*s,T=.2*i,H=.1*i;switch(t.fillStyle=e,t.lineWidth=T,t.lineJoin="round",t.lineCap="round",e==="eliminated"&&(t.globalAlpha=.7),o){case 0:{const N=.5*i,wt=.4*s,at=.5*i,lt=.7*s;xe(t,Jt,N,wt,H,W,p),Re(t,Qt,at,lt,T,D,b),Re(t,bt,at,lt,T,D,y),Ct(o,t,i,s,e,h,c),Mt(o,t,i,s,e,h,c),xe(t,St,N,wt,H,W,S)}break;case 1:case 2:{ct(t,bt,.35*i,.7*s,T,D,-1,b,0),ct(t,bt,.7*i,.7*s,T,D,1,y,0),Ct(o,t,i,s,e,h,c),ht(t,St,.25*i,.35*s,H,W,-1,p),ht(t,St,.75*i,.35*s,H,W,1,S),Mt(o,t,i,s,e,h,c);break}case 3:{ct(t,Qt,.35*i,.7*s,T,D,-1,b,y/4),ct(t,bt,.65*i,.7*s,T,D,1,y,y/4),ht(t,Jt,.25*i,.35*s,H,W,-1,S,S/2),Ct(o,t,i,s,e,h,c),Mt(o,t,i,s,e,h,c),ht(t,St,.75*i,.35*s,H,W,1,p,S/2);break}case 4:{ct(t,Qt,.65*i,.7*s,T,D,1,y,y/4),ct(t,bt,.35*i,.7*s,T,D,-1,b,y/4),ht(t,Jt,.75*i,.35*s,H,W,1,S,S/2),Ct(o,t,i,s,e,h,c),Mt(o,t,i,s,e,h,c),ht(t,St,.25*i,.35*s,H,W,-1,p,S/2);break}}t.restore()}function Cs(t,e,i,s){t.save(),t.fillStyle=Rs,t.translate(e,i),t.beginPath(),t.arc(0,0,Math.max(0,s),0,2*Math.PI),t.fill(),t.restore()}const ft={};function J(t,e,i){const s=Ie(t),n=Ie(e),o=Math.round((1-i)*s.r+i*n.r),a=Math.round((1-i)*s.g+i*n.g),h=Math.round((1-i)*s.b+i*n.b);return`rgb(${o}, ${a}, ${h})`}function Ie(t){if(t==="eliminated")return{r:128,g:128,b:128};const e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t);return e?{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}:{r:0,g:0,b:0}}const Ms=navigator.userAgent.toLowerCase().includes("firefox");function Qe(t,e,i,s,n,o){const a=`${i}-${e}-${s}-${n}`;if(o||!ft[a]){const h=t.createRadialGradient(s,n,n/8,s,n,s);if(i==="TORSO"?(h.addColorStop(0,J(e,"rgb(255, 255, 255)",.1)),h.addColorStop(.2,J(e,"rgb(255, 255, 255)",.1)),h.addColorStop(.5,J(e,"rgb(0, 0, 0)",.1)),h.addColorStop(1,J(e,"rgb(0, 0, 0)",.3))):i==="HEAD"&&(h.addColorStop(0,J(e,"rgb(0, 0, 0)",.3)),h.addColorStop(.5,J(e,"rgb(0, 0, 0)",.1)),h.addColorStop(.8,J(e,"rgb(255, 255, 255)",.1)),h.addColorStop(1,J(e,"rgb(255, 255, 255)",.1))),Ms){if(o)return Ee(t,h,s*2,n*2);ft[a]=Ee(t,h,s*2,n*4)}else{if(o)return h;ft[a]=h}}return ft[a]}function Ps(){for(const t in ft)delete ft[t]}function Ee(t,e,i,s){const n=document.createElement("canvas");n.width=i,n.height=s;const o=n.getContext("2d");if(o)return o.fillStyle=e,o.fillRect(0,0,i,s),t.createPattern(n,"no-repeat")}function Je(t,e,i,s,n,o){e&&(t.save(),t.translate(i,s),t.scale(n/80,o/80),t.fillStyle=e,t.fill(),t.restore())}function Ct(t,e,i,s,n,o,a=!1){const h=.2*i,c=t===0?.5*i:.45*i,d=.25*s,b=t===0?.28*i:.5*(i-c),y=.06*s;e.beginPath(),e.roundRect(b,y,c,d,h);const p=Qe(e,n,"HEAD",c,d,a);e.fillStyle=p||"black",e.fill(),Je(e,o,b,y,c,d),Ts(e,t,i,c,d,h)}function Mt(t,e,i,s,n,o,a=!1){const h=.4*s,c=.2*i,d=t===0?.5*i:.6*i,b=t===1||t===2?.2*i:.5*(i-d),y=.3*s;e.beginPath(),e.roundRect(b,y,d,h,c);const p=Qe(e,n,"TORSO",d,h,a);e.fillStyle=p||"black",e.fill(),Je(e,o,b,y,d,h)}function xe(t,e,i,s,n,o,a){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(a),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-o/4,o/2,0,o),t.stroke(),t.restore()}function Re(t,e,i,s,n,o,a){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(a),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-o/8,o/2,0,o),t.stroke(),t.restore()}function ht(t,e,i,s,n,o,a,h,c=0){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(-a*.07*Math.PI),t.rotate(c),t.scale(1,Math.cos(h+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(a*o/4,o/2,0,o),t.stroke(),t.restore()}function ct(t,e,i,s,n,o,a,h,c){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(c),t.scale(1,Math.cos(h+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(a*o/8,o/2,0,o),t.stroke(),t.restore()}function Ts(t,e,i,s,n,o){if(e!==2&&e!==4)return;const a=.15*i,h=.6*o,c=s-a,d=n-a*1.75,b=n-d,y=e===2?(i-c)/2:(i-c)/2+(s-c)/2;t.save(),t.translate(y,b),t.shadowColor="rgba(0, 0, 0, 0.5)",t.fillStyle=As,t.shadowOffsetY=-d/10;const p=0,S=0;t.beginPath(),t.roundRect(p,S,c,d,h),t.fill(),t.closePath(),t.shadowOffsetY=0;const I=.06*c,C=c/4,$=d/3,W=p+C,D=p+c-C,T=S+$;t.fillStyle=Is,t.beginPath(),t.arc(W,T,I,0,Math.PI*2),t.arc(D,T,I,0,Math.PI*2),t.fill(),t.closePath();const H=.025*c,N=.01*c,wt=.01*d;t.fillStyle=Es,t.beginPath(),t.arc(W+N,T+wt,H,0,Math.PI*2),t.arc(D+N,T+wt,H,0,Math.PI*2),t.fill(),t.closePath();const at=.15*c,lt=.2*d,$t=p+(c-at)/1.75,Vt=S+(d-lt)/1.5;t.fillStyle=xs,t.beginPath(),t.moveTo($t,Vt),t.lineTo($t+at/2,Vt+lt),t.lineTo($t-at/2,Vt+lt),t.closePath(),t.fill(),t.restore()}let ie=1;const Ze=(t,e)=>{const i=t/e;let s=window.innerWidth,n=window.innerHeight;s/n>i?s=n*i:n=s/i,s>t&&(s=t,n=t/i),n>e&&(n=e,s=e*i),f.width=s,f.height=n;const o=window.innerWidth/s,a=window.innerHeight/n,h=Math.min(o,a);ie=h,f.style.position="absolute",f.style.left=`${(window.innerWidth-s*h)/2}px`,f.style.top=`${(window.innerHeight-n*h)/2}px`,f.style.transform=`scale(${h})`,f.style.transformOrigin="top left"},Os=(t,e)=>{const i=f.getBoundingClientRect();t.x=(e.clientX-i.left)/ie,t.y=(e.clientY-i.top)/ie},st="ontouchstart"in window,Fs=()=>{st&&(window.oncontextmenu=t=>{t.preventDefault()})},Pt=(t,e)=>{const i=n=>{n.preventDefault();const o=n.targetTouches[0];e(o!=null)},s=n=>{n.preventDefault(),e(!1)};t.addEventListener("touchstart",i),t.addEventListener("touchmove",i),t.addEventListener("touchend",s)},ti=(t,e)=>new Promise(i=>{const s=n=>{n.preventDefault();const o=n.changedTouches[0];if(!o)return;z(),Os({x:0,y:0},o);{if(f.removeEventListener("touchstart",s),e!==void 0)try{console.log(`Playing sound ID: ${e}`),z(e)}catch(h){console.error("Error playing sound:",h)}i()}};f.addEventListener("touchstart",s,{passive:!1})}),Ws=(t,e)=>ti(e,t),Tt=(t,e)=>{const i=Xt(t,e);return i.style.background="rgba(50, 50, 50, 0.05)",i.style.display="none",i};let Ds=0,se,ei,ii,si,ni;const ne={movement:{x:0,y:0}},Hs=t=>{if(!se)return;const{left:e,right:i,up:s,down:n}=se,o=t?"block":"none";e.style.display=o,i.style.display=o,s.style.display=o,n.style.display=o},Bs=()=>{const t=Ui(),e=t.ArrowLeft||t.KeyA||ei,i=t.ArrowRight||t.KeyD||ii,s=t.ArrowUp||t.KeyW||si,n=t.ArrowDown||t.KeyS||ni,o=e?-1:i?1:0,a=s?-1:n?1:0;o===0&&a===0?ne.movement=F:ne.movement=j({x:o,y:a})},Ls=()=>{$i(),Fs(),Ns()},Ns=()=>{if(!st)return;const t={left:Tt("left","◁"),right:Tt("right","▷"),up:Tt("up","△"),down:Tt("down","▽")},{left:e,right:i,up:s,down:n}=t;document.body.appendChild(e),document.body.appendChild(i),document.body.appendChild(s),document.body.appendChild(n),Pt(e,o=>ei=o),Pt(i,o=>ii=o),Pt(s,o=>si=o),Pt(n,o=>ni=o),window.addEventListener("resize",()=>Ce(t),!1),Ce(t),se=t},Ce=t=>{const{left:e,right:i,up:s,down:n}=t,o=f.width*.1,a=o,h=o,c=a,d=o,b=a,y=f.height*.18,p=f.height*.14,S=f.width*.03,I=f.width*.06,C=f.width*.01,$=f.height*.02;e.style.left=`${S}px`,e.style.bottom=`${y}px`,e.style.width=`${h}px`,e.style.height=`${c}px`,i.style.left=`${S+h+C}px`,i.style.bottom=`${y}px`,i.style.width=`${h}px`,i.style.height=`${c}px`,s.style.right=`${I}px`,s.style.bottom=`${p+b+$}px`,s.style.width=`${d}px`,s.style.height=`${b}px`,n.style.right=`${I}px`,n.style.bottom=`${p}px`,n.style.width=`${d}px`,n.style.height=`${b}px`},kt=async t=>{await(st?t?Ws(t):ti():Ki(t))},It=(t="continue",e=7.7)=>{const i=(st?"Tap the screen to ":"Press ENTER to ")+t;R(i+(Ds++%60===0?"":"█"),x.Small,"Courier New",1,e,!0,0,i)},Gs=()=>ne;function _s(t,e){t.translate(e/2,0),t.scale(-1,1),t.translate(-e/2,0)}const Lt=500,Me=1e3,oi=["rgb(255, 255, 0)","rgb(255, 0, 0)","rgb(0, 128, 0)","rgb(0, 0, 255)","rgb(255, 165, 0)","rgb(255, 99, 71)","rgb(255, 192, 203)","rgb(106, 90, 205)","rgb(238, 130, 238)","rgb(30, 144, 255)","rgb(0, 255, 255)","rgb(255, 0, 255)","rgb(144, 238, 144)","rgb(211, 211, 211)","rgb(64, 224, 208)","rgb(0, 191, 255)","rgb(173, 216, 230)","rgb(240, 128, 128)","rgb(0, 255, 127)","rgb(255, 0, 255)","rgb(220, 20, 60)","rgb(230, 230, 250)","rgb(255, 127, 80)","rgb(0, 128, 128)","rgb(75, 0, 130)","rgb(250, 128, 114)","rgb(127, 255, 0)","rgb(218, 165, 32)","rgb(255, 182, 193)","rgb(210, 105, 30)","rgb(205, 92, 92)","rgb(128, 128, 0)","rgb(255, 69, 0)","rgb(135, 206, 235)","rgb(72, 209, 204)","rgb(160, 82, 45)","rgb(0, 255, 0)","rgb(0, 0, 128)","rgb(245, 222, 179)","rgb(70, 130, 180)","rgb(255, 255, 255)"],ye=oi[0],oe={width:2,height:2};class Zt{constructor(e,i,s=1+Math.random()*.6,n=1+Math.random()*.4){u(this,"ai");u(this,"rank",0);u(this,"finished",!1);u(this,"eliminated",!1);u(this,"timeOffset",it(2e3));u(this,"direction",F);u(this,"latestDirection",{x:0,y:-1});u(this,"color");u(this,"x",0);u(this,"y",0);u(this,"width");u(this,"height");u(this,"velocity",F);u(this,"fallStartTime");u(this,"dropStartTime");u(this,"latestCheckpointIndex",0);this.ai=e===0||!i?null:new vs(this,i),this.color=oi[e],this.width=oe.width*s,this.height=oe.height*n}get doesNotCollide(){return this.finished||this.eliminated||this.fallStartTime!=null}isVisible(e){return!(this.fallStartTime!=null&&Lt<e-this.fallStartTime)}setDirection(e){this.direction=e,Ft(e)||(this.latestDirection=e)}getMovement(e){return this.ai?this.ai.getMovement(e):Gs().movement}move(){this.eliminated||this.finished?(this.direction=F,this.velocity=F):(this.x+=this.velocity.x,this.y+=this.velocity.y)}stop(){this.y+=this.velocity.y*8}drop(e,i){var s;this.x=i.x,this.y=i.y,this.direction=F,this.latestDirection={x:0,y:-1},this.velocity=F,this.fallStartTime=void 0,this.dropStartTime=e,(s=this.ai)==null||s.reset()}draw(e,i,s){const n=this.latestDirection.y!==0?this.latestDirection.x===0?this.latestDirection.y<0?P.Forward:P.Backward:this.latestDirection.y>0?P.BackwardRight:P.ForwardRight:P.Right;r.save();const o=this.height*3,a=o-this.height;if(r.translate(this.x,this.y-a),this.latestDirection.x<0&&_s(r,this.width),this.fallStartTime!=null){const c=Math.max(1-Ut((e-this.fallStartTime)/Lt),0);r.translate(this.width/2,o/2),r.scale(c,c),r.translate(-this.width/2,-o/2),r.globalAlpha=Ut(c)}else this.dropStartTime&&e-this.dropStartTime<Me&&(r.globalAlpha=Ut((e-this.dropStartTime)/Me));const h=Ft(this.direction)&&this.fallStartTime==null?0:e+this.timeOffset;Rt(r,this.eliminated?"eliminated":this.color,this.width,o,h,this.finished?e%3600<1800?P.Backward:P.BackwardRight:n,this.getAnimation(),s),r.restore()}getAnimation(){return this.fallStartTime!=null?Q.Fall:Ft(this.direction)?Q.Stand:Q.Walk}}const Xs=.005,Pe=2e3;class Ys{constructor(e,i){u(this,"elements");u(this,"startY");u(this,"checkpoints");u(this,"specialElements");u(this,"finishY");u(this,"elementCount");u(this,"width");u(this,"height");this.elements=gs(e,i),this.elementCount=this.elements.length,this.specialElements=this.elements.filter(o=>o.surfaces.some(a=>Bt(a)||ee(a))),this.startY=i,this.finishY=this.startY-(this.elements.length-1)*m;const s=Math.min(...this.elements.map(o=>o.minX)),n=Math.max(...this.elements.map(o=>o.maxX));this.width=n-s,this.height=this.elements.length*m,this.checkpoints=this.elements.filter((o,a)=>o.type===K.CheckPoint||a===0).map(o=>({y:o.y+o.height,element:o}))}update(e,i,s){for(let n=0;n<this.specialElements.length;n++){const o=this.specialElements[n];for(let a=0;a<o.surfaces.length;a++){const h=o.surfaces[a];if(Bt(h))for(let c=0;c<s.length;c++){const d=s[c];h.y<=d.y&&d.y+d.height<h.y+h.height&&h.x<=d.x&&d.x+d.width<=h.x+h.width&&(d.velocity=q(d.velocity,{x:0,y:-.002*h.force*i}))}if(ee(h)){const c=h,d=o.y,b=o.y-m;c.yDirection===-1&&c.y<=b?(c.yDirection=0,c.dockStartTime=e):c.y<=b&&e-c.dockStartTime>Pe?c.yDirection=1:c.yDirection===1&&d<=c.y?(c.yDirection=0,c.dockStartTime=e):d<=c.y&&e-c.dockStartTime>Pe&&(c.yDirection=-1);const y=c.yDirection*Xs*i;c.y+=y;for(let p=0;p<s.length;p++){const S=s[p];Ht(c,S)&&(S.y+=y)}}}}}get(e){return this.elements[e]}isFree(e,i){if(e<0||this.elements.length<=e)return!1;const s=this.elements[e];return s.surfaces.length===0?this.elements[Math.max(e-1,0)].isFree(i,s.y):s.isFree(i)}getBlock(e,i){return e<0||this.elements.length<=e?je(e,i,this.startY-e*m):this.elements[e].getBlock(i)}getBlockAt(e){const i=Math.floor(Math.max(this.startY-e.y,0)/m),s=Math.min(i,this.elements.length-1),n=Math.floor((e.x-w)/g);return this.getBlock(s,n)}getCheckpoint(e){return this.checkpoints[e].element}findLatestCheckpoint(e){for(let i=this.checkpoints.length-1;i>=0;i--){const s=this.checkpoints[i];if(e<s.y-s.element.height*.15)return i}return 0}getBetween(e,i){const s=Math.ceil(Math.max(this.startY-e,0)/m),n=Math.floor(Math.max(this.startY-i,0)/m);return{minI:Math.max(n-1,0),maxI:Math.min(s,this.elements.length)-1}}isOnPlatform(e,i){const{minI:s,maxI:n}=e;for(let o=n;o>=s;o--){const h=this.get(o).surfaces;for(let c=0;c<h.length;c++){const d=h[c];if(Ht(i,d))return!0}}return!1}}const zs=70,Te=400,Oe=5,Fe=40,We=1e3;var re=(t=>(t[t.RUNNING=0]="RUNNING",t[t.GAME_OVER=1]="GAME_OVER",t[t.FINISHED=2]="FINISHED",t))(re||{});function $s(t){for(let e=t.length-1;e>=0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}class ae{constructor(e,i,s,n,o){u(this,"camera",new Ji(this,f));u(this,"platePattern");u(this,"track");u(this,"characters",[]);u(this,"charactersCount",40);u(this,"player",new Zt(0,void 0,0,0));u(this,"x");u(this,"y");u(this,"width");u(this,"height");u(this,"state",0);this.platePattern=o,this.track=new Ys(e,Te),this.x=0-this.track.width/2-Oe,this.y=Te-this.track.height-Fe,this.width=this.track.width+2*Oe,this.height=this.track.height+2*Fe;const a=this.track.get(0),h=15,c=a.width/h,d=oe.height*1.9,b=c*.3;this.player=new Zt(0,this.track,i,s),this.characters.push(this.player);for(let p=1;p<(n?n.length:this.charactersCount);p++){if(n&&n[p].eliminated)continue;const S=new Zt(p,this.track);this.characters.push(S)}const y=[this.player,...this.characters];$s(y);for(let p=0;p<y.length;p++){const S=y[p],I=Math.floor(p/h),C=p%h,$={x:a.minX+b+C*c,y:a.y+I*d};S.x=$.x,S.y=$.y}this.camera.follow(this.player),this.camera.visibleAreaHeight=zs,this.camera.yAdjust=-.25,this.camera.update(0)}update(e,i){this.camera.update(e),this.track.update(e,i,this.characters),this.calculateMovement(e,i),this.checkCollisions();for(let s=0;s<this.characters.length;s++)this.characters[s].move();this.updateCharacterRanks(),this.checkGameState()}playWithVolumeByDistance(e,i){Math.abs(i-this.player.y),z()}calculateMovement(e,i){for(let s=0;s<this.characters.length;s++){const n=this.characters[s],o=this.track.getBetween(n.y,n.y+n.height);let a=F;n.fallStartTime!=null?e-n.fallStartTime>Lt+We&&this.dropToLatestCheckpoint(e,n):n.fallStartTime==null&&!this.track.isOnPlatform(o,n)?(n.fallStartTime=e,n===this.player&&setTimeout(()=>{const h=this.track.getCheckpoint(this.player.latestCheckpointIndex),c=h.y+h.height/2;this.camera.setTransition({startY:this.player.y,endY:c,startTime:e,duration:We+500})},Lt)):(a=n.getMovement(e),n.setDirection(a),n.velocity=rs(n,a,i))}}checkCollisions(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e];if(!i.doesNotCollide)for(let s=e+1;s<this.characters.length;s++){const n=this.characters[s];n.doesNotCollide||ls(i,n)&&(!i.ai||mt(i.velocity)>.3)&&this.playWithVolumeByDistance(Hi,i.y)}}for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.getBetween(i.y,i.y+i.height),{minI:n,maxI:o}=s;for(let a=n;a<=o;a++){const h=this.track.get(a);for(let c=0;c<h.objects.length;c++){const d=h.objects[c];as(i,d)&&this.playWithVolumeByDistance(Di,d.y)}}}}renderText(e,i,s,n){const o=r.measureText(e),a=i+(n-o.width)/2;r.fillText(e,a,s)}updateCharacterRanks(){const e=this.characters.filter(n=>n.finished),i=this.characters.filter(n=>!n.finished);e.sort((n,o)=>n.rank-o.rank),i.sort((n,o)=>n.y+n.height/2-(o.y+o.height/2)),[...e,...i].forEach((n,o)=>{n.rank=o+1})}checkGameState(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.findLatestCheckpoint(i.y),n=this.track.getBetween(i.y,i.y+i.height);if(!(i.fallStartTime!=null||!this.track.isOnPlatform(n,i))){if(s>i.latestCheckpointIndex&&(i.latestCheckpointIndex=s,i.rank===13)){i.eliminated=!0,i.stop(),i.ai||(this.state=1);continue}if(i.y+i.height<this.track.finishY&&(i.rank===13?(i.eliminated=!0,i.stop(),i.ai||(this.state=1)):(i.finished=!0,i.stop()),!i.ai||i.rank==this.characters.length-13)){let o=this.characters.filter(a=>a.eliminated).length;for(let a=0;a<this.characters.length;a++)if(this.characters[a].rank>this.characters.length-13)if(o<13)this.characters[a].eliminated||(this.characters[a].eliminated=!0,o++);else break;this.characters[0].eliminated?this.state=1:this.state=2}}}}dropToLatestCheckpoint(e,i){const s=this.track.getCheckpoint(i.latestCheckpointIndex),n={x:hs(s.minX+g,s.maxX-g),y:s.y+s.height/2,width:i.width,height:i.height};if(!this.characters.some(o=>Ht(o,n))){if(i.rank===13){i.eliminated=!0,i.stop(),i.ai||(this.state=1);return}i.drop(e,n),this.playWithVolumeByDistance(Bi,i.y),i===this.player&&this.camera.follow(i)}}drawCross(e,i,s,n="red"){r.strokeStyle=n,r.lineWidth=s/4,r.beginPath(),r.moveTo(e-s/2,i-s/2),r.lineTo(e+s/2,i+s/2),r.moveTo(e+s/2,i-s/2),r.lineTo(e-s/2,i+s/2),r.stroke()}draw(e,i){r.save(),r.translate(f.width/2,f.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y);const s=[...this.characters];this.drawTrack(s),this.drawObjects(e,i,s),r.restore(),this.drawGradient(),this.state===0&&(r.save(),r.translate(f.width/2,f.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y),this.drawStatusOfCharacters(e),this.drawTopStatusTexts(),r.restore())}drawTrack(e){r.save();const i=this.camera.getViewArea(),{minI:s,maxI:n}=this.track.getBetween(i.y,i.y+i.height);for(let o=n;o>=s;o--){const a=this.track.get(o),h=a.surfaces;r.fillStyle=a.color,r.shadowColor=a.color.replace("rgb(","rgba(").replace(")",",0.3)"),r.shadowOffsetY=a.height*(a.type===K.Raft?2:6),a.type===K.Raft&&(r.globalAlpha=.5);for(let c=0;c<h.length;c++){const d=h[c];this.drawSurface(a,d)}r.globalAlpha=1,e.push(...a.objects)}r.restore()}drawSurface(e,i){if(r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=.1,e.type!==K.Raft&&r.strokeRect(i.x,i.y+.1,i.width,i.height),r.save(),Bt(i)){const s=i.force;r.fillStyle=`rgba(${220+s*50}, ${80+s*50}, ${60+s*50}, ${1-s})`}if(r.fillRect(i.x,i.y,i.width,i.height),r.restore(),e.type===K.Raft)r.strokeRect(i.x,i.y,i.width,i.height);else if(Bt(i)){r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/(e.width/10);for(let n=1;n<=i.width/9-1;n++)r.fillText("⇪",i.x+n*s,i.y+i.height/2)}else if(e.type===K.CheckPoint||e.type===K.Finish){r.fillStyle="rgba(255, 255, 255, 0.2)",r.fillRect(i.x,i.y+i.height-4,i.width,4),r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/10;for(let n=1;n<=i.width/9-1;n++)r.fillText(e.type===K.Finish?"✪":"✓",i.x+n*s,i.y+i.height/2.4)}this.platePattern&&(r.fillStyle=this.platePattern,r.fillRect(i.x,i.y,i.width,i.height),r.fillStyle=e.color)}drawObjects(e,i,s){s.sort((n,o)=>n.y+n.height/2-(o.y+o.height/2));for(let n=0;n<s.length;n++)s[n].draw(e,i)}drawGradient(){const e=r.createRadialGradient(f.width/2,f.height/2,0,f.width/2,f.height/2,f.width/1.5);e.addColorStop(1,"rgba(0, 0, 0, 0)"),e.addColorStop(.8,"rgba(0, 0, 0, 0)"),e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),r.fillStyle=e,r.fillRect(0,0,f.width,f.height);const i=r.createLinearGradient(0,0,0,f.height);i.addColorStop(0,"rgba(0, 0, 0, 1)"),i.addColorStop(.2,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),r.fillStyle=i,r.fillRect(0,0,f.width,f.height)}drawStatusOfCharacters(e){this.characters.forEach(i=>{if(i.isVisible(e)){const s=`${i.rank}`;r.fillStyle=i.rank===13?"red":i.eliminated?"crimson":i.rank>this.characters.length-13?"orange":i.rank===1?"lightgreen":i.ai?"white":"yellow",r.font=i.ai?i.eliminated||i.rank===13?"1.2px Sans-serif":"1px Sans-serif":"1.4px Sans-serif",i.ai||(r.save(),r.font="4.0px Sans-serif",this.renderText("▲",i.x,i.y-i.height*3.25,i.width),r.restore()),i.eliminated&&this.drawCross(i.x-.25,i.y-i.height*2.7,1),this.renderText(i.eliminated?"13":s,i.x,i.y-i.height*2.5,i.width)}})}drawTopStatusTexts(){const e=this.characters.filter(s=>s.eliminated).length.toString(),i=this.characters.filter(s=>s.finished).length.toString();r.font="4px Impact",r.fillStyle=this.player.rank===13?"red":this.player.eliminated?"crimson":this.player.rank>this.characters.length-13?"orange":this.player.rank===1?"lightgreen":"yellow",r.fillText("▲ "+this.player.rank+" / "+this.characters.length,-42,this.camera.y-30),r.fillStyle="green",r.fillText("✪ "+i+" / "+(this.characters.length-13)+" QUALIFIED",-15,this.camera.y-30),r.fillStyle="red",this.drawCross(28,this.camera.y-31.5,3),r.fillText(e+" / 13",32,this.camera.y-30)}}const De=[l.FullWidthWithObstacles,l.FullWidth,l.FullWidth,l.FullWidth],He=[l.Basic,l.SlopeEmptyPassage,l.SlopeEmptyPassage,l.DualPassage,l.Basic,l.RightPassage,l.RightPassage,l.Basic,l.Basic,l.Raft,l.Chasm,l.FullWidth],Vs=[l.BasicSteepSlope,l.BasicSlope,l.FullWidthWithObstacles,l.FullWidthWithMoreObstacles,l.FullWidthWithObstacles,l.DualPassage,l.DualPassage,l.DualPassage,l.FullWidth];function ri(){const t=it(1);return[l.Checkpoint,...t<.5?De:He,l.Checkpoint,...t<.5?He:De,l.Checkpoint,...Vs,l.Finish]}const Be=[l.FullWidth,l.BasicSteepSlope,l.BasicSlope,l.BasicSlope,l.Basic,l.Basic,l.Basic,l.Narrow,l.VeryNarrow,l.VeryNarrow,l.Basic,l.FullWidthWithObstacles,l.SlopeObstacleSlope,l.PassageEmptySlope,l.PassageEmptySlope,l.DualPassage,l.DualPassage,l.FullWidth,l.FullWidthWithObstaclesOnRight,l.FullWidthWithObstaclesOnRight2,l.FullWidthWithObstaclesOnRight,l.FullWidth,l.Raft,l.Chasm],Le=[l.FullWidth,l.VeryNarrow,l.FullWidth,l.BasicSteepSlope,l.BasicSlope,l.BasicSlope,l.Basic,l.Basic,l.Basic,l.Basic,l.TwoRafts,l.Chasm];function Ks(){const t=it(1);return[l.Checkpoint,...t<.5?Be:Le,l.Checkpoint,...t<.5?Le:Be,l.Finish]}const Ne=[l.FullWidth,l.Basic,l.Narrow,l.VeryNarrow,l.Basic,l.SlopeEmptySlope,l.SlopeEmptySlope,l.SlopeEmptySlope,l.DualPassage,l.DualPassage,l.Basic,l.FullWidthWithObstacles,l.VeryNarrow,l.Basic],Ge=[l.FullWidth,l.SlopeEmptySlope,l.PassageEmptySlope,l.PassageEmptySlope,l.DualPassage,l.SlopeEmptyPassage,l.DualPassageExt,l.TriplePassage,l.TriplePassage,l.TriplePassage,l.FullWidth],_e=[l.FullWidthWithObstacles,l.FullWidthWithMoreObstacles,l.FullWidth,l.TwoRafts,l.Chasm,l.Basic,l.FullWidth],Xe=[l.BasicSteepSlope,l.BasicSlope,l.BasicSlope,l.Basic,l.Basic,l.Basic,l.DualPassage,l.DualPassageExt,l.TriplePassage,l.TriplePassage,l.DualPassageExt,l.PassageEmptySlope,l.PassageEmptySlope,l.Basic,l.Basic,l.Narrow,l.VeryNarrow,l.FullWidth,l.RightPassage,l.FullWidth,l.TwoRafts,l.Chasm];function Us(){const t=it(1);return[l.Checkpoint,...t<.5?Ne:Ge,l.Checkpoint,...t<.5?Ge:Ne,l.Checkpoint,...t<.5?_e:Xe,l.Checkpoint,...t<.5?Xe:_e,l.Finish]}const qs="2025-05-27 08:04";async function js(){let t=!1;const e=document.getElementById("ios-fullscreen-video");if(e&&e.webkitDisplayingFullscreen&&(t=!0),t)try{return e&&typeof e.webkitExitFullscreen=="function"&&e.webkitExitFullscreen(),e&&(e.pause(),e.currentTime=0),document.exitFullscreen&&await document.exitFullscreen(),!0}catch(s){return console.warn("iOS fullscreen exit failed:",s),!1}const i=document.getElementById("ios-fullscreen-video")||document.createElement("video");i.id||(i.id="ios-fullscreen-video",i.playsInline=!0,i.setAttribute("playsinline","playsinline"),i.muted=!0,i.setAttribute("muted","muted"),i.autoplay=!1,i.loop=!0,i.style.width="1px",i.style.height="1px",i.style.position="absolute",i.style.opacity="0.01",i.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAAAAG1wNDJtcDQxaXNvbWlzbzIAAAACbWV0YQAAAAAAAAAoaGRscgAAAAxBVkMgQ29kaW5nAAAAQ2NvbHJzAAAAG3VpbnQCAAAAGFFSRwKCPQAAAEAAAAJNAAAAAP9tZGF0AAAAEgEH//4PMkXKj////jA9FbmQ=",document.body.appendChild(i));try{if(await i.play(),await new Promise(n=>setTimeout(n,100)),typeof i.webkitEnterFullscreen=="function")return i.webkitEnterFullscreen(),console.log("Requested iOS fullscreen mode"),!0}catch(s){console.warn("iOS fullscreen attempt failed:",s)}return!1}async function Qs(){if(pi&&await js())return;const t=document.documentElement;if(document.fullscreenElement)try{await document.exitFullscreen(),console.log("Exited fullscreen mode")}catch(e){e instanceof Error&&console.error(`Error exiting fullscreen: ${e.message} (${e.name})`);return}else try{t.requestFullscreen?await t.requestFullscreen():t.webkitRequestFullscreen?await t.webkitRequestFullscreen():t.mozRequestFullScreen?await t.mozRequestFullScreen():t.msRequestFullscreen&&await t.msRequestFullscreen(),console.log("Entered fullscreen mode")}catch(e){console.warn("Standard fullscreen failed, falling back to canvas positioning",e instanceof Error?e.message:e);const i=document.querySelector("canvas");i&&(i.style.position="fixed",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.zIndex="1000");return}}const Js="Director's cut ("+qs+")",le=1e3/60,Zs=le*5;let he=performance.now(),rt=0,tt=1+Math.random()*.6,et=1+Math.random()*.3,Ot=1;const Nt=Ci(),ce=Mi();let A=new ae(ri(),tt,et,void 0,ce),M=0,zt=0,ai=0;const tn=5e3;let v=0,li=0,ot=0;const L=async t=>{zt=t,me(t===6||t===5);const e=document.getElementById("restartButton");e&&(e.style.display=t!==1?"block":"none");const i=document.getElementById("fullscreenButton");switch(i&&(i.style.display=t!==1||!st?"block":"none"),Hs(t===6),M=1280*2,t){case 2:await Vi(0),await kt(),L(3);break;case 3:await kt(be),L(4);break;case 4:L(5);break;case 5:if(ot=0,rt>1&&A&&!A.player.eliminated){const s=rt===3?Us():Ks();A=new ae(s,tt,et,A.characters,ce)}else A=new ae(ri(),tt,et,void 0,ce);v=M,li=ai,$e();break;case 7:v=1,z(),tt=1+Math.random()*.6,et=1+Math.random()*.3,await kt(Li),rt=1,L(2);break;case 8:me(!1),Ai(),v=1,z(),A&&A.characters.length>14?(await kt(be),rt++,L(5)):(await kt(Wi),rt=1,Ps(),L(2));break;case 6:break;case 1:Xi();break}},hi=t=>{requestAnimationFrame(hi);const e=t-he;if(e>=le){const i=Math.min(e,Zs);he=t-e%le,en(t,i),bi(t)&&nn(t,i)}},en=(t,e)=>{switch(zt){case 6:{Bs(),A==null||A.update(t,e),(A==null?void 0:A.state)===re.GAME_OVER?L(7):(A==null?void 0:A.state)===re.FINISHED&&L(8);break}case 5:{(ot===2&&v<M/4||ot===1&&v<M/2||ot===0&&v<M)&&(z(),ot++);break}}};let Wt=0;const Ye="LOADING...",sn=()=>{const t=Wt<10?Ye.substring(0,Wt):"LOADING...";R(t+(Wt++%60===0?"":"█"),x.Small,"Courier New",1,7.7,!0,0,Ye)},nn=(t,e)=>{switch(ai=t,r.save(),r.fillStyle="rgb(0, 0, 20)",r.fillRect(0,0,f.width,f.height),A==null||A.draw(t,e),r.restore(),r.save(),zt){case 0:{sn(),Wt++,Ke(),V(!1);break}case 1:{if(on(!0),st){const i=document.getElementById(Dt);i&&i.style.display==="none"&&(i.style.display="block")}else It("start");break}case 2:{te(t++,!1,0),nt(),V(!0);break}case 3:{te(t++,!0,Ot=Ot+.01),nt(),V(!0);break}case 4:{te(t++,!0,Ot=Ot+.01);const i=f.width/2,s=f.height/2;r.beginPath(),r.arc(i,s,v,0,Math.PI*2),r.fillStyle="#802010",r.fill(),v<M&&(v+=e),nt(),V(!0);break}case 5:{const i=f.width/2,s=f.height/2;v<=0?L(6):(v>0&&(r.beginPath(),r.arc(i,s,v,0,Math.PI*2),r.fillStyle=v<M/4?"#105000":v<M/2?"#CCCC40":"#802010",r.fill()),v<M/4?R("▲ GO! ▲",x.Xl,"Impact",v/M*4):v<M/2?R("Set...",x.Xl,"Impact",1):R("Ready...",x.Xl,"Impact",1),v>0&&(v=(1-(t-li)/tn)*M)),nt(),V(!0);break}case 7:{const i=f.width/2,s=f.height/2;r.beginPath(),r.arc(i,s,v,0,Math.PI*2),r.fillStyle="#802010",r.fill(),R("❌ ELIMINATED!",x.Large,"Impact",1,-4.5),(A==null?void 0:A.player.rank)===13?R("Don't be the 13TH GUY",x.Small,"Sans-serif"):(R("Don't be one of the last 13TH GUYs",x.Small,"Sans-serif"),R("The final rank is "+(A==null?void 0:A.player.rank)+".",x.Normal,"Impact",1,3.1)),v>=M&&It("continue",9),v<M&&(r.save(),r.globalAlpha=.7,r.translate(f.width/8,v*2-f.height),Rt(r,"eliminated",f.height/6*tt,f.height/2*et,t,P.Backward,Q.Fall,Nt),r.globalAlpha=0,r.restore()),v<M&&(v+=e),nt(),V(!0);break}case 8:{const i=f.width/2,s=f.height/2;r.beginPath(),r.arc(i,s,v,0,Math.PI*2),r.fillStyle="#105000",r.fill(),v>=M/4&&(A&&A.characters.length>14?(R("✪ QUALIFIED!",x.Large,"Impact",1,-5),R("☻",x.Huge,"Impact"),R("Ready for next round "+(rt+1)+" / 3",x.Normal,"Sans-serif",1,3.8)):(R("GAME FINISHED!",x.Large,"Impact",1,-5),R("☻",x.Huge,"Impact"),R("Congratulations to the winner!",x.Normal,"Impact",1,3.8)),v>=M&&It(),r.save(),r.translate(v<f.width/6?v:f.width/6,f.height/3),Rt(r,ye,f.height/6*tt,f.height/2*et,t,v<f.width/6?P.Right:A&&A.characters.length<=14||t%3600>1800?P.Backward:P.BackwardRight,A&&A.characters.length>14?Q.Walk:Q.Celebrate,Nt),r.restore()),v<M&&(v+=e),nt(),V(!0);break}default:{const i=document.getElementById(Dt);i&&i.style.display!=="none"&&(i.style.display="none"),V(!1);break}}r.restore()},ci=()=>{R(Js,x.Tiny,"Impact",.5,2.3,!1),R("Don't be the",x.Small,"Impact",1,-1.8,!0,-.9),R("❌ 13TH GUY",x.Xl,"Impact",1,1.8)},te=(t,e,i)=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,f.width,f.height),r.fill(),r.save(),r.translate(f.width/8+i,f.height/3),Rt(r,ye,(e?f.height/6/i:f.height/6)*tt,(e?f.height/2/i:f.height/2)*et,t,e?P.Forward:t%3600<1800?P.BackwardRight:P.Backward,Q.Walk,Nt,e),r.restore(),e?(R("Avoid being the 13th or among the last 13",x.Small,"Sans-serif",1,-1.2),R("or you will be eventually ❌ eliminated!",x.Small,"Sans-serif",1,1.3),R("MOVE WITH",x.Xs,"Sans-serif",.8,-7.5),R("▲ / W - ▼ / S - ◄ / A - ► / D",x.Xs,"Sans-serif",.8,-5.6),zt===3&&It("start the race!")):(ci(),It()),r.restore()},on=t=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,f.width,f.height),r.fill(),r.save(),r.translate(f.width/8,f.height/3),Rt(r,ye,f.height/6*tt,f.height/2*et,0,P.Backward,Q.Stand,Nt),r.restore(),ci(),r.filter="",Ke(),nt(),V(t)};async function ze(){const t=document.getElementById(Dt);t&&(t.style.display="none");const e=Fi();document.body.appendChild(e),rt=1,L(6)}const rn=async()=>{f.tabIndex=0,f.style.outline="none",vi(),Ls(),he=performance.now(),window.requestAnimationFrame(hi);const t=Pi(st),e=Ti(),i=Oi();document.body.appendChild(e),document.body.appendChild(t),document.body.appendChild(i),t.addEventListener("click",s=>{s.stopPropagation(),Qs(),f.focus()}),e.addEventListener("click",s=>{s.stopPropagation(),window.location.reload()}),L(1),st?await ze():await ze()},di=1280,fi=720;window.addEventListener("resize",()=>Ze(di,fi),!1);Ze(di,fi);rn();
