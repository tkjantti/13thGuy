var ns=Object.defineProperty;var as=(t,e,i)=>e in t?ns(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var m=(t,e,i)=>as(t,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const u=document.querySelector("canvas"),r=u.getContext("2d",{willReadFrequently:!0}),rs=60;let je=0,z=null;const _e=/iPad/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&"ontouchend"in document,Pi=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);let j="high";function os(){if(_e&&Pi)try{window.localStorage.setItem("test","test"),window.localStorage.removeItem("test"),console.log("iPad Safari normal mode detected")}catch{return!0}let t=!1;try{const n="test_private";localStorage.setItem(n,n),localStorage.removeItem(n)}catch{t=!0}const e=/iPad|iPhone|iPod/.test(navigator.userAgent),i=typeof navigator.hardwareConcurrency<"u"&&navigator.hardwareConcurrency<=2||typeof navigator.deviceMemory<"u"&&navigator.deviceMemory<2;return e&&t||i?(console.log("Limited resources or iOS private browsing - using low performance mode"),!0):(navigator.hardwareConcurrency<=4&&(!navigator.deviceMemory||navigator.deviceMemory<=4)&&!e&&!_e&&(console.log("Older desktop detected - using medium performance mode"),te("medium")),!1)}function ls(t){if(j!=="low")return!0;const e=1e3/rs;return t-je>=e?(je=t,!0):!1}function te(t){console.log(`Setting graphics performance mode to: ${t}`),j=t}function hs(){os()?te("low"):te("high")}function cs(){if(console.log("Initializing graphics with performance detection..."),hs(),_e&&Pi){let t=0,e=Date.now();const i=()=>{if(j!=="low"){const s=Date.now();s-e>5e3&&(t>20&&(console.log("Performance issues detected - switching to LOW mode"),te("low")),t=0,e=s)}requestAnimationFrame(i)};requestAnimationFrame(i)}console.log("Performance mode set to:",j)}function ds(){const t=["high","medium","low"],i=(t.indexOf(j)+1)%t.length;j=t[i],z&&(z.textContent=`GFX: ${j}`),u.focus()}let Rt=[];const fs=60;let ke=0;const Ci=t=>{const e=Rt.length?Rt[Rt.length-1]:0,i=t-e;e&&(i>33&&ke++,Rt.length>=fs&&(ke>10&&j!=="low"&&(console.log("Performance issues detected - switching to lower mode"),te(j==="high"?"medium":"low")),Rt=[],ke=0)),Rt.push(t),requestAnimationFrame(Ci)};requestAnimationFrame(Ci);let ct=null,Qt=null;const us=(t,e,i)=>{if(ct=document.createElement("canvas"),ct.width=t,ct.height=e,Qt=ct.getContext("2d"),Qt){Qt.fillStyle=`rgba(0, 0, 0, ${1-i})`;for(let s=0;s<e;s+=2)Qt.fillRect(0,s,t,1)}},lt=(t=!0)=>{const e=u.width,i=u.height,s=t?.7:.8;let n=s,a=t?10:0;switch(j){case"low":{const d=r.createRadialGradient(e/2,i/2,i/3,e/2,i/2,i);d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,0.3)"),r.fillStyle=d,r.fillRect(0,0,e,i),r.globalAlpha=.15,r.fillStyle="#000";for(let w=0;w<i;w+=8)r.fillRect(0,w,e,1);r.globalAlpha=1;return}case"medium":n=s*.7,a=0;break}const o=r.getImageData(0,0,e,i),l=o.data,c=t&&a>0?new Float32Array(e*i):null;if(t&&c&&a>0)for(let d=0;d<c.length;d++)c[d]=(Math.random()-.5)*a;if(t&&c&&a>0)for(let d=0;d<i;d++){const w=d*e;for(let p=0;p<e;p++){const f=(w+p)*4,y=c[w+p];l[f]+=y,l[f+1]+=y,l[f+2]+=y}}r.putImageData(o,0,0),j!=="low"&&((!ct||ct.width!==e||ct.height!==i)&&us(e,i,n),Qt&&ct&&(r.globalAlpha=n,r.drawImage(ct,0,0),r.globalAlpha=1))};let Zt;const gs=()=>{const t=u.width,e=u.height;Zt=r.createRadialGradient(t/2,e/2,0,t/2,e/2,t/2),Zt.addColorStop(0,"rgba(255, 255, 255, 0.3)"),Zt.addColorStop(1,"rgba(0, 0, 0, 0.5)")},vt=()=>{j!=="low"&&(Zt||gs(),r.fillStyle=Zt,r.fillRect(0,0,u.width,u.height))},Ri=()=>{if(j==="low"){r.globalAlpha=.5,r.fillStyle="rgba(0, 0, 0, 0.5)",r.fillRect(0,0,u.width,u.height),r.globalAlpha=1;return}const t=r.getImageData(0,0,u.width,u.height),e=t.data;for(let i=0;i<e.length;i+=4){const s=e[i],n=e[i+1],a=e[i+2],o=s*.3+n*.59+a*.11;e[i]=e[i+1]=e[i+2]=o*.7}r.putImageData(t,0,0)},ys=()=>{const t=document.createElement("canvas");t.width=4,t.height=4;const e=t.getContext("2d");if(!e)return;function i(n,a,o,l,c){e&&(e.strokeStyle=c,e.beginPath(),e.moveTo(n,a),e.lineTo(o,l),e.stroke())}const s="#00000010";e.fillStyle=s,e.fillRect(0,0,t.width,t.height);for(let n=0;n<=t.width;n+=4)i(n,0,n,t.height,s),i(0,n,t.width,n,s);return e.createPattern(t,"repeat")},ms=()=>{const t=document.createElement("canvas");t.width=64,t.height=64;const e=t.getContext("2d");if(!e)return;const i=e.getImageData(0,0,t.width,t.height),s=i.data,n=4;for(let a=0;a<t.height;a+=n)for(let o=0;o<t.width;o+=n){const l=Math.random()*64,c=Math.floor(Math.random()*24);for(let d=0;d<n;d++)for(let w=0;w<n;w++){const p=((a+d)*t.width+(o+w))*4;s[p]=Math.min(255,Math.max(0,s[p]+l)),s[p+1]=Math.min(255,Math.max(0,s[p+1]+l)),s[p+2]=Math.min(255,Math.max(0,s[p+2]+l)),s[p+3]=c}}return e.putImageData(i,0,0),e.createPattern(t,"repeat")},de="startButton",F={top:"10px",zIndex:"10",size:"40px",color:"rgba(255, 255, 255, 0.4)",background:"black",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"4px",fontSize:"24px",lineHeight:"0"};function ps(t){const e=document.createElement("button");return e.id="fullscreenButton",e.style.position="absolute",e.style.top=F.top,e.style.right="10px",e.style.zIndex=F.zIndex,e.textContent="⛶",e.style.fontFamily="Impact",e.style.width=F.size,e.style.height=F.size,e.style.color=F.color,e.style.background=F.background,e.style.border=F.border,e.style.borderRadius=F.borderRadius,e.style.fontSize=F.fontSize,e.style.lineHeight=F.lineHeight,e.style.display=t?"none":"block",e}function ws(){const t=document.createElement("button");return t.id="restartButton",t.style.position="absolute",t.style.top=F.top,t.style.right="60px",t.style.zIndex=F.zIndex,t.textContent="↺",t.style.fontFamily="Impact",t.style.width=F.size,t.style.height=F.size,t.style.color=F.color,t.style.background=F.background,t.style.border=F.border,t.style.borderRadius=F.borderRadius,t.style.fontSize=F.fontSize,t.style.lineHeight=F.lineHeight,t.style.display="none",t}function As(){const t=document.createElement("button");return t.id=de,t.style.position="absolute",t.textContent="Tap the screen to continue█",t.style.padding="20vw 0 0 0",t.style.fontFamily="Courier New",t.style.background="transparent",t.style.border="none",t.style.fontSize="2vw",t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.zIndex=F.zIndex,t.style.color=F.color,t.style.display="none",t}const bs=()=>(z=document.createElement("button"),z.textContent=`GFX: ${j}`,z.style.position="absolute",z.style.bottom="10px",z.style.right="10px",z.style.fontFamily="Impact",z.style.height=F.size,z.style.color=F.color,z.style.background=F.background,z.style.border=F.border,z.style.borderRadius=F.borderRadius,z.style.fontSize="1.5vw",z.style.lineHeight=F.lineHeight,z.style.zIndex=F.zIndex,z.addEventListener("click",ds),z);var _=(t=>(t[t.Tiny=16]="Tiny",t[t.Xs=20]="Xs",t[t.Small=24]="Small",t[t.Normal=32]="Normal",t[t.Large=48]="Large",t[t.Xl=64]="Xl",t[t.Huge=80]="Huge",t))(_||{});const Qe=t=>{const e=u.width/1e3;return Math.floor(t*e)},H=(t,e,i,s=1,n=0,a=!0,o=0,l)=>{r.save();const c=Qe(e),d=Qe(16);r.globalAlpha=s>0?s:0,r.fillStyle="white",r.font=c+"px "+i;const w=r.measureText(l??t).width,p=n*d,f=o*d;r.fillText(t,(u.width-w)/2+f,(a?u.height/2:0)+p),r.restore()},vs=[1,,82,.01,.08,.2,,2.6,,,,,,.1,,,,.61,.02,,-1686],Ss=[2,,12,,,.008,,1.2,23,-7,,,.05,.4,,,.15,.82,.03,.28],Is=[1,,85,.08,.1,.01,1,4,,-11,1,.07,,.1,101,,.05,.68,.4,.12,1],ks=[.01,,523.2511,.1,3,3,4,0,,,2250,,.04,,10,.01,,.82,1,,30],xs=[2,,185,,,,3,1.6,-7,,,,,,,.2,.19,.1,,.38,985],Es=[1.5,,688,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.03,.11,-818],Ms=[1.5,,1376,.02,.01,.007,1,2.6,,,,,.01,,85,,.01,.85,.8,.11,-818],Ps={songData:[{i:[0,0,180,0,0,0,180,0,0,160,158,158,158,0,0,0,0,51,2,1,2,54,239,1,32,88,1,157,2],p:[1,2],c:[{n:[111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137],f:[]},{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:1},Cs={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[4,1,2,3,2,1,2,3],c:[{n:[134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134,137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]},{n:[137,137,139,137,139,139,137,141,142,144,144,137,149,137,149,137,134,134,136,134,136,136,134,138,139,141,141,134,146,134,146,134],f:[]},{n:[141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141,141,141,143,141,143,143,141,145,146,148,148,141,129,141,129,141],f:[]}]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[27,1,27,2,27,1,27,2],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1,1,1,1,1,1,1,2],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[],c:[]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[],c:[]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,,,,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:7,numChannels:8},Rs={songData:[{i:[1,127,128,0,1,127,116,9,0,0,6,22,34,0,96,2,0,69,3,1,1,0,167,0,20,125,6,25,6],p:[],c:[]},{i:[3,255,128,0,2,255,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[25,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,2,27,1,27,3,26,26,26],c:[{n:[98,,98,,98,,98,,98,,98,,98,,98,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,98,,98,,98,,98,,98,,98,,98],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101,,101],f:[]},{n:[105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105,,105],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,135,135],f:[]},{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[3,0,128,0,3,68,128,0,64,85,4,4,53,68,0,0,1,55,4,0,2,67,115,124,190,67,6,39,1],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,135],f:[]}]},{i:[1,128,128,0,1,130,116,9,0,0,128,22,159,0,203,2,0,69,3,1,1,23,167,0,32,192,6,25,3],p:[5,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,1,2,4,3,5,,5],c:[{n:[129],f:[]},{n:[134,,,,,,,,,,,,,,,,137],f:[]},{n:[137,,,,,,,,,,,,,,,,134],f:[]},{n:[141],f:[]},{n:[113],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,56,7,40,93,51,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[,1,,,,1,,,,1,,,,1,,,,1,,,,1],c:[{n:[147],f:[]}]},{i:[0,0,128,0,0,0,128,0,0,63,0,1,59,0,0,0,0,0,0,0,1,193,171,0,29,39,3,88,3],p:[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,1,1,1],c:[{n:[,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149,,,,149],f:[]}]},{i:[0,214,104,64,0,204,104,0,64,124,96,40,0,0,0,0,0,231,6,0,3,143,15,0,16,0,4,0,6],p:[1,,,,1,,,,1,,,,1,,,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]}]}],rowLen:4725,patternLen:32,endPattern:23,numChannels:8},yt=(t,...e)=>Ts(t,Os(t,...e)),q=44100,Fs=new(window.AudioContext||window.webkitAudioContext),xe=Fs,Ts=(t,...e)=>{let i=xe.createBuffer(e.length,e[0].length,q),s=xe.createBufferSource();return e.forEach((n,a)=>i.getChannelData(a).set(n)),s.buffer=i,s.connect(xe.destination),s.start(),s},Os=(t,e=.1,i=.05,s=220,n=0,a=0,o=.1,l=0,c=1,d=0,w=0,p=0,f=0,y=0,v=0,S=0,R=0,k=0,P=1,x=0,B=0,I=0)=>{let O=Math.PI*2,L=ss=>ss<0?-1:1,G=d*=500*O/q/q,T=s*=(1+i*2*Math.random()-i)*O/q,U=[],X=0,At=0,W=0,tt=1,st=0,Q=0,N=0,V,Z,Mt=2,bt=O*Math.abs(I)*2/q,Yt=Math.cos(bt),Vt=Math.sin(bt)/2/Mt,Pt=1+Vt,ve=-2*Yt/Pt,Ut=(1-Vt)/Pt,se=(1+L(I)*Yt)/2/Pt,Se=-(L(I)+Yt)/Pt,Ie=se,Kt=0,Ct=0,qt=0,$e=0;for(n=n*q+9,x*=q,a*=q,o*=q,k*=q,w*=500*O/q**3,S*=O/q,p*=O/q,f*=q,y=y*q|0,e*=t<0?0:t,Z=n+x+a+o+k|0;W<Z;U[W++]=N*(t<0?0:t))++Q%(R*100|0)||(N=l?l>1?l>2?l>3?Math.sin(X**3):Math.max(Math.min(Math.tan(X),1),-1):1-(2*X/O%2+2)%2:1-4*Math.abs(Math.round(X/O)-X/O):Math.sin(X),N=(y?1-B+B*Math.sin(O*W/y):1)*L(N)*Math.abs(N)**c*(W<n?W/n:W<n+x?1-(W-n)/x*(1-P):W<n+x+a?P:W<Z-k?(Z-W-k)/o*P:0),N=k?N/2+(k>W?0:(W<Z-k?1:(Z-W)/k)*U[W-k|0]/2/e):N,I&&(N=$e=Ie*Kt+Se*(Kt=Ct)+se*(Ct=N)-Ut*qt-ve*(qt=$e))),V=(s+=d+=w)*Math.cos(S*At++),X+=V+V*v*Math.sin(W**5),tt&&++tt>f&&(s+=p,T+=p,tt=0),y&&!(++st%y)&&(s=T,d=G,tt=tt||1);return U};function Ds(){var t=function(f){return Math.sin(f*6.283184)},e=function(f){return 2*(f%1)-1},i=function(f){return f%1<.5?1:-1},s=function(f){var y=f%1*4;return y<2?y-1:3-y},n=function(f){return .003959503758*2**((f-128)/12)},a=function(f,y,v){var S=o[f.i[0]],R=f.i[1],k=f.i[3]/32,P=o[f.i[4]],x=f.i[5],B=f.i[8]/32,I=f.i[9],O=f.i[10]*f.i[10]*4,L=f.i[11]*f.i[11]*4,G=f.i[12]*f.i[12]*4,T=1/G,U=-f.i[13]/16,X=f.i[14],At=v*2**(2-f.i[15]),W=new Int32Array(O+L+G),tt=0,st=0,Q,N,V,Z,Mt,bt;for(Q=0,N=0;Q<O+L+G;Q++,N++)N>=0&&(X=X>>8|(X&255)<<4,N-=At,Mt=n(y+(X&15)+f.i[2]-128),bt=n(y+(X&15)+f.i[6]-128)*(1+8e-4*f.i[7])),V=1,Q<O?V=Q/O:Q>=O+L&&(V=(Q-O-L)*T,V=(1-V)*3**(U*V)),tt+=Mt*V**k,Z=S(tt)*R,st+=bt*V**B,Z+=P(st)*x,I&&(Z+=(2*Math.random()-1)*I),W[Q]=80*Z*V|0;return W},o=[t,i,e,s],l,c,d,w,p;this.init=function(f){l=f,c=f.endPattern,d=0,w=f.rowLen*f.patternLen*(c+1)*2,p=new Int32Array(w)},this.generate=function(){var f,y,v,S,R,k,P,x,B,I,O,L,G=new Int32Array(w),T=l.songData[d],U=l.rowLen,X=l.patternLen,At=0,W=0,tt,st,Q=!1,N=[];for(v=0;v<=c;++v)for(P=T.p[v],S=0;S<X;++S){var V=P?T.c[P-1].f[S]:0;V&&(T.i[V-1]=T.c[P-1].f[S+X]||0,V<17&&(N=[]));var Z=o[T.i[16]],Mt=T.i[17]/512,bt=2**(T.i[18]-9)/U,Yt=T.i[19],Vt=T.i[20],Pt=T.i[21]*43.23529*3.141592/44100,ve=1-T.i[22]/255,Ut=T.i[23]*1e-5,se=T.i[24]/32,Se=T.i[25]/512,Ie=6.283184*2**(T.i[26]-9)/U,Kt=T.i[27]/255,Ct=T.i[28]*U&-2;for(O=(v*X+S)*U,R=0;R<4;++R)if(k=P?T.c[P-1].n[S+R*X]:0,k){N[k]||(N[k]=a(T,k,U));var qt=N[k];for(y=0,f=O*2;y<qt.length;y++,f+=2)G[f]+=qt[y]}for(y=0;y<U;y++)x=(O+y)*2,I=G[x],I||Q?(L=Pt,Yt&&(L*=Z(bt*x)*Mt+.5),L=1.5*Math.sin(L),At+=L*W,tt=ve*(I-W)-At,W+=L*tt,I=Vt==3?W:Vt==1?tt:At,Ut&&(I*=Ut,I=I<1?I>-1?t(I*.25):-1:1,I/=Ut),I*=se,Q=I*I>1e-5,B=Math.sin(Ie*x)*Se+.5,st=I*(1-B),I*=B):st=0,x>=Ct&&(st+=G[x-Ct+1]*Kt,I+=G[x-Ct]*Kt),G[x]=st|0,G[x+1]=I|0,p[x]+=st|0,p[x+1]+=I|0}return d++,d/l.numChannels},this.createAudioBuffer=function(f){for(var y=f.createBuffer(2,w/2,44100),v=0;v<2;v++)for(var S=y.getChannelData(v),R=v;R<w;R+=2)S[R>>1]=p[R]/65536;return y},this.createWave=function(){var f=44,y=f+w*2-8,v=y-36,S=new Uint8Array(f+w*2);S.set([82,73,70,70,y&255,y>>8&255,y>>16&255,y>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,v&255,v>>8&255,v>>16&255,v>>24&255]);for(var R=0,k=f;R<w;++R){var P=p[R];P=P<-32767?-32767:P>32767?32767:P,S[k++]=P&255,S[k++]=P>>8&255}return S},this.getData=function(f,y){for(var v=2*Math.floor(f*44100),S=new Array(y),R=0;R<2*y;R+=1){var k=v+R;S[R]=f>0&&k<p.length?p[k]/32768:0}return S}}const fe="start",Le="race",Fi="bounce",Ti="hit",Oi="teleport",Ke="keyboard",Di="finished",Wi="gameover",_i="restart",He="count",Li="go",$=document.createElement("audio"),Dt=document.createElement("audio"),ue=document.createElement("audio");let rt,Ze=!1;const Ws=async()=>{if(console.log("Attempting to unlock audio systems..."),Ze)return!0;try{$.volume=.1,await $.play().catch(t=>console.log("First unlock attempt:",t)),$.pause(),$.currentTime=0,console.log("HTML Audio unlocked successfully")}catch(t){console.warn("HTML Audio unlock attempt failed:",t)}try{rt=yt.getAudioContext(),rt&&rt.state!=="running"&&await rt.resume(),console.log("Web Audio API context state:",rt==null?void 0:rt.state)}catch(t){console.warn("Web Audio API context resume failed:",t)}return Ze=!0,!0},_s=()=>{console.log("Setting up audio unlock for all mobile devices");const t=document.createElement("audio");t.setAttribute("src","data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//tUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABGwD///////////////////////////////////////////8AAAA8TEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAARvMPHBz//////////////////////////////////////////////////////////////////8AAAA"),t.setAttribute("playsinline","playsinline"),t.volume=.1;const e=async()=>{console.log("Attempting to unlock audio systems from event handler");try{t.play().catch(i=>console.log("Silent audio error:",i))}catch(i){console.log("Silent audio exception:",i)}try{await Ws()}catch(i){console.log("sfx unlockAudio error:",i)}document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0)};document.addEventListener("touchstart",e,{once:!0,capture:!0}),document.addEventListener("touchend",e,{once:!0,capture:!0}),document.addEventListener("click",e,{once:!0,capture:!0})},Ee=(t,e,i)=>new Promise(s=>{var n=new Ds;n.init(e);var a=!1;setInterval(function(){if(!a&&(a=n.generate()>=1,a)){var o=n.createWave();t.src=URL.createObjectURL(new Blob([o],{type:"audio/wav"})),t.loop=i,s()}},0)}),Ls=()=>(_s(),Promise.all([Ee($,Cs,!0),Ee(Dt,Rs,!0),Ee(ue,Ps,!1)])),Hs=(t,e=0)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null);var i=t.volume;i>e?t._fadeInterval=setInterval(function(){i=Math.max(e,parseFloat(i)-.1).toFixed(1),t.volume=i,i<=e&&(e===0&&t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=null)},100):e===0&&!t.paused&&(t.pause(),t.volume=0)},Bs=/iPad|iPhone|iPod/.test(navigator.userAgent),ge=(t,e=1)=>{t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null);let i=Promise.resolve();t.paused&&(t.volume=Bs?.1:0,t.setAttribute("playsinline","playsinline"),i=t.play()),i.then(()=>{var s=parseFloat(t.volume);s<e?(t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeInterval=setInterval(function(){s=Math.min(e,parseFloat(s)+.1).toFixed(1),t.volume=s,parseFloat(s)>=e&&(t.volume=e,clearInterval(t._fadeInterval),t._fadeInterval=null)},100)):t.volume=e}).catch(s=>{console.warn("FadeIn play() failed:",s),t.paused&&(t.volume=1,t.play().catch(n=>console.error("Second play attempt failed:",n))),t._fadeInterval&&(clearInterval(t._fadeInterval),t._fadeInterval=null)})},Je=(t,e)=>{t._fadeInterval&&clearInterval(t._fadeInterval),t._fadeOutInTimeout&&clearTimeout(t._fadeOutInTimeout),e._fadeInterval&&clearInterval(e._fadeInterval),e._fadeOutInTimeout&&clearTimeout(e._fadeOutInTimeout),t._fadeInterval=null,t._fadeOutInTimeout=null,e._fadeInterval=null,e._fadeOutInTimeout=null;var i=t.volume;i>0?t._fadeInterval=setInterval(function(){i=Math.max(0,parseFloat(i)-.1).toFixed(1),t.volume=i,i<=.1&&(t.pause(),clearInterval(t._fadeInterval),t._fadeInterval=null,t._fadeOutInTimeout=setTimeout(()=>{ge(e,1),t._fadeOutInTimeout=null},500))},100):(t.pause(),t.volume=0,t._fadeOutInTimeout=setTimeout(()=>{ge(e,1),t._fadeOutInTimeout=null},500))},it=async(t,e)=>{if(e!==0){if(rt&&rt.state!=="running")try{await rt.resume()}catch(i){console.warn("AudioContext resume failed in playTune:",i)}switch(t){case Le:{Dt.currentTime=0,Je($,Dt);break}case Di:{yt(.04,...ks),$.currentTime=0,Je(Dt,$);break}case Wi:{ue.volume=1,ue.play().catch(i=>console.warn("gameoverFx play failed:",i)),Hs(Dt);break}case _i:{$.currentTime=0,ge($);break}case fe:{($.paused||$.volume!=1)&&($.currentTime=0,ge($));break}case Fi:{yt(e,...vs);break}case Ti:{yt(e,...xs);break}case Ke:{yt(.5,...Ss);break}case Oi:{yt(e,...Is);break}case He:{yt(.5,...Es);break}case Li:{yt(.5,...Ms);break}}}},Ns=t=>{const e=[];e.push($,Dt,ue),e.forEach(i=>{i._fadeInterval&&(clearInterval(i._fadeInterval),i._fadeInterval=null),i._fadeOutInTimeout&&(clearTimeout(i._fadeOutInTimeout),i._fadeOutInTimeout=null),i.pause(),i.currentTime=0})},Hi=()=>({ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1});let Xt=Hi();const Gs=t=>{t.code in Xt&&(Xt[t.code]=!0)},Xs=t=>{t.code in Xt&&(Xt[t.code]=!1)},zs=()=>{window.addEventListener("keydown",Gs),window.addEventListener("keyup",Xs),window.addEventListener("blur",()=>{Xt=Hi()})},Ys=t=>new Promise(e=>setTimeout(e,t)),Vs=t=>new Promise(e=>{const i=s=>{s.code==="Enter"&&(it(Ke),t&&it(t),window.removeEventListener("keydown",i),e())};window.addEventListener("keydown",i)}),Us=()=>Xt;function Ks(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function ye(t,e){const i=e.x<=t.x+t.width&&t.x<=e.x+e.width,s=e.y<=t.y+t.height&&t.y<=e.y+e.height;return i&&s}function qs(t,e){return t.x<=e.x&&e.x<t.x+t.width&&t.y<=e.y&&e.y<t.y+t.height}function $s(t,e){const i=t.x<=e.x&&e.x+e.width<=t.x+t.width,s=t.y<=e.y&&e.y+e.height<=t.y+t.height;return i&&s}function Me(t){return-(Math.cos(Math.PI*t)-1)/2}function nt(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}function Pe(t){return t*t}function js(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}class Qs{constructor(e,i){m(this,"x",0);m(this,"y",0);m(this,"zoom",1);m(this,"visibleAreaHeight");m(this,"yAdjust",0);m(this,"target",null);m(this,"transition",null);this.level=e,this.view=i}getViewArea(){const e=this.view.width/this.zoom,i=this.view.height/this.zoom;return{x:this.x-e/2,y:this.y-i/2,width:e,height:i}}follow(e){this.target=e}setTransition(e){const i=this.view.height/this.zoom;this.transition={...e,endY:e.endY+i*this.yAdjust},this.target=null}update(e){if(this.visibleAreaHeight!=null&&(this.zoom=this.view.height/this.visibleAreaHeight),this.transition!=null){const{startY:i,endY:s,startTime:n,duration:a}=this.transition;if(e<n+a){const l=(e-this.transition.startTime)/this.transition.duration;this.y=i+js(l)*(s-i)}else this.transition=null}else this.target&&this.followFrame(this.target)}followFrame(e){const i=this.view.width/this.zoom,s=this.view.height/this.zoom;if(i<this.level.width){let n=e.x+e.width;n-i/2<this.level.x?n=this.level.x+i/2:n+i/2>this.level.x+this.level.width&&(n=this.level.x+this.level.width-i/2),this.x=n}else this.x=0;this.y=e.y+s*this.yAdjust}}const J={x:0,y:0};function he(t){return t.x===0&&t.y===0}function Zs(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function Js(t,e){return Math.abs(t.x-e.x)}function tn(t,e){return Math.abs(t.y-e.y)}function zt(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function dt(t,e){return{x:t.x+e.x,y:t.y+e.y}}function Bi(t,e){return{x:t.x-e.x,y:t.y-e.y}}function ot(t,e){return{x:t.x*e,y:t.y*e}}function en(t,e){return{x:t.x/e,y:t.y/e}}function ft(t){return en(t,zt(t))}function ee(t,e){return t.x*e.x+t.y*e.y}const Wt=.5,sn=.01,nn=5e-4,ti=6e-4,an=3;function rn(t,e,i){if(he(e)){const y=zt(t.velocity),v=ti*i,S=y>v?y-v:0;return S>0?ot(ft(t.velocity),S):J}const s=ee(t.velocity,e),n={x:-e.y,y:e.x},a=ee(t.velocity,n);let o=nn*i;s>sn*i&&(o=0);const l=ti*i,c=Math.abs(a)>l?-l:0,d=Math.sign(a)*c,w=ot(e,o),p=ot(n,d);return dt(t.velocity,dt(w,p))}function on(t,e){const i=t.width/2,s=t.height/2,n=e.width/2,a=e.height/3.5,o={x:t.x+t.width/2,y:t.y+t.height/2},l=dt(o,t.velocity),c={x:e.x+e.width/2,y:e.y+e.height/2};if(Js(l,c)<i+n&&tn(l,c)<s+a){const d=ft(Bi(c,o)),w=ee(t.velocity,d),p=ot(d,-Math.abs(w)*an);let f=dt(t.velocity,p);return zt(f)>Wt&&(f=ot(ft(f),Wt)),t.velocity=f,!0}return!1}function ln(t,e){const i=t.width*.4,s=e.width*.4,n={x:t.x+t.width/2,y:t.y+t.height/2},a={x:e.x+e.width/2,y:e.y+e.height/2},o=dt(n,t.velocity),l=dt(a,e.velocity);if(Zs(o,l)<i+s){const c=ft(Bi(a,n)),d=ot(c,-1),w=ee(t.velocity,c),p=ee(e.velocity,d),f=ot(c,Math.abs(w)),y=ot(d,Math.abs(p));let v=dt(t.velocity,y);zt(v)>Wt&&(v=ot(ft(v),Wt)),t.velocity=v;let S=dt(e.velocity,f);return zt(S)>Wt&&(S=ot(ft(S),Wt)),e.velocity=S,!0}return!1}const pt=(t=1)=>Math.random()*t,hn=(t,e)=>Math.random()*(e-t)+t,Nt=class Nt{constructor(e){m(this,"x");m(this,"y");m(this,"width",Nt.WIDTH);m(this,"height",Nt.HEIGHT);m(this,"velocity",J);this.x=e.x,this.y=e.y}draw(e,i){r.save(),r.translate(this.x,this.y);const s=r.createLinearGradient(0,0,this.width,this.height);s.addColorStop(0,"rgb(255, 110, 110)"),s.addColorStop(1,"rgb(255, 60, 60)"),r.beginPath(),r.fillStyle="rgba(0, 0, 0, 0.1)",r.ellipse(this.width/2,this.height/1.5,this.width/2,this.height,0,0,2*Math.PI),r.fill(),r.fillStyle=s,r.beginPath(),r.ellipse(this.width/2,this.height/2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.fillStyle=s,r.fillRect(0,-this.height*2,this.width,this.height*2.5);const n=r.createLinearGradient(0,0,this.width,this.height);n.addColorStop(0,"rgb(255, 140, 140)"),n.addColorStop(1,"rgb(255, 80, 80)"),r.fillStyle=n,r.beginPath(),r.ellipse(this.width/2,-this.height*2,this.width/2,this.height/2,0,0,2*Math.PI),r.fill(),r.strokeStyle="rgb(200, 70, 70)",r.lineWidth=this.width/100,r.stroke(),r.restore()}};m(Nt,"WIDTH",10),m(Nt,"HEIGHT",4);let E=Nt;const A=16,g=10,Ni=A,Gt=9,mt=g*Gt,Ce=g*7,cn=g*5,ei=g*3,b=-90/2,ii=mt/2;var h=(t=>(t[t.FullWidth=0]="FullWidth",t[t.Basic=1]="Basic",t[t.BasicSlope=2]="BasicSlope",t[t.BasicSteepSlope=3]="BasicSteepSlope",t[t.Narrow=4]="Narrow",t[t.VeryNarrow=5]="VeryNarrow",t[t.DualPassage=6]="DualPassage",t[t.DualPassageExt=7]="DualPassageExt",t[t.TriplePassage=8]="TriplePassage",t[t.RightPassage=9]="RightPassage",t[t.SlopeEmptySlope=10]="SlopeEmptySlope",t[t.SlopeEmptyPassage=11]="SlopeEmptyPassage",t[t.PassageEmptySlope=12]="PassageEmptySlope",t[t.SlopeObstacleSlope=13]="SlopeObstacleSlope",t[t.FullWidthWithObstaclesOnRight=14]="FullWidthWithObstaclesOnRight",t[t.FullWidthWithObstaclesOnRight2=15]="FullWidthWithObstaclesOnRight2",t[t.FullWidthWithMoreObstacles=16]="FullWidthWithMoreObstacles",t[t.FullWidthWithObstacles=17]="FullWidthWithObstacles",t[t.Chasm=18]="Chasm",t[t.Raft=19]="Raft",t[t.TwoRafts=20]="TwoRafts",t[t.Checkpoint=21]="Checkpoint",t[t.Finish=22]="Finish",t))(h||{}),ht=(t=>(t[t.Normal=0]="Normal",t[t.CheckPoint=1]="CheckPoint",t[t.Finish=2]="Finish",t[t.Raft=3]="Raft",t))(ht||{}),D=(t=>(t[t.Empty=0]="Empty",t[t.Free=1]="Free",t[t.Obstacle=2]="Obstacle",t[t.Raft=3]="Raft",t))(D||{});function Gi(t,e,i){return{type:0,row:t,col:e,x:b+e*g,y:i,width:g,height:A}}function Be(t){return"yDirection"in t}function me(t){return"force"in t}class dn{constructor(e,i,s,n,a){m(this,"row");m(this,"y");m(this,"type");m(this,"surfaces");m(this,"objects");m(this,"width");m(this,"height");m(this,"minX");m(this,"maxX");m(this,"blocks",new Array(Gt));this.row=e,this.y=i,this.type=s,this.surfaces=n,this.objects=a,this.minX=Math.min(...this.surfaces.map(o=>o.x)),this.maxX=Math.max(...this.surfaces.map(o=>o.x+o.width)),this.width=this.maxX-this.minX,this.height=A;for(let o=0;o<Gt;o++)this.blocks[o]={type:this.getBlockType(o),row:e,col:o,x:b+o*g,y:this.y,width:g,height:A}}get color(){switch(this.type){case 1:return"rgb(50, 80, 50)";case 2:return"rgb(0, 200, 0)";case 3:return"rgb(50,60,120)";default:return"rgb(80, 50, 80)"}}getBlock(e){return e<0||Gt<=e?Gi(this.row,e,this.y):this.blocks[e]}isFree(e,i){const s=g*.1,n=b+e*g,a=i??this.y,o={x:n+s,y:a+s,width:g-2*s,height:Ni-2*s};return this.surfaces.some(l=>$s(l,o))&&!this.objects.some(l=>ye(l,o))}getBlockType(e){const i=g*.1,s=b+e*g+i,n=g-2*i;return this.surfaces.some(l=>Be(l)&&l.x<=s&&s+n<=l.x+l.width)?3:this.objects.some(l=>l.x<=s&&s+n<=l.x+l.width)?2:this.isFree(e)?1:0}}function fn(t,e){const i=t.map((s,n)=>un(s,n,e));return gn(i),i}function un(t,e,i){const s=i-A*(e+1),n=s+A/2;let a=0,o=[],l=[];switch(t){case 0:o=[{x:b,y:s,width:mt,height:A}];break;case 1:o=[{x:b+g*1,y:s,width:Ce,height:A}];break;case 2:{o=[{force:.3,x:b+g*1,y:s,width:Ce,height:A}];break}case 3:{o=[{force:.5,x:b+g*1,y:s,width:Ce,height:A}];break}case 4:o=[{x:b+g*2,y:s,width:cn,height:A}];break;case 5:o=[{x:b+g*3,y:s,width:ei,height:A}];break;case 6:o=[{x:b+g,y:s,width:g*2,height:A},{x:ii-g*3,y:s,width:g*2,height:A}];break;case 7:o=[{x:b+g,y:s,width:g*2,height:A},{x:b+g*4,y:s,width:g*5,height:A}];break;case 8:o=[{x:b+g*1,y:s,width:g*2,height:A},{x:b+g*4,y:s,width:g*2,height:A},{x:b+g*7,y:s,width:g*2,height:A}];break;case 9:{o=[{x:b+g*6,y:s,width:g*2,height:A}];break}case 10:{const c={force:.3,x:b+g*1,y:s,width:g*2,height:A},d={force:.3,x:b+g*6,y:s,width:g*2,height:A};o=[c,d];break}case 11:{const c={force:.3,x:b+g*1,y:s,width:g*2,height:A},d={x:b+g*6,y:s,width:g*2,height:A};o=[c,d];break}case 12:{const c={x:b+g*1,y:s,width:g*2,height:A},d={force:.3,x:b+g*6,y:s,width:g*2,height:A};o=[c,d];break}case 13:{const c={force:.3,x:b+g*1,y:s,width:g*2,height:A},d={force:.3,x:b+g*6,y:s,width:g*2,height:A};o=[c,{x:b+g*3,y:s,width:g*3,height:A},d],l=[new E({x:b+g*4,y:n-E.HEIGHT/2})];break}case 14:{o=[{x:-90/2,y:s,width:mt,height:A}],l=[new E({x:b+g*4,y:n-E.HEIGHT/2}),new E({x:b+g*6,y:n-E.HEIGHT/2}),new E({x:b+g*8,y:n-E.HEIGHT/2})];break}case 15:{o=[{x:-90/2,y:s,width:mt,height:A}],l=[new E({x:b+g*3,y:n-E.HEIGHT/2}),new E({x:b+g*5,y:n-E.HEIGHT/2}),new E({x:b+g*7,y:n-E.HEIGHT/2})];break}case 16:o=[{x:-90/2,y:s,width:mt,height:A}],l=[new E({x:b+g*0,y:n-E.HEIGHT/2}),new E({x:b+g*2,y:n-E.HEIGHT/2}),new E({x:b+g*4,y:n-E.HEIGHT/2}),new E({x:b+g*6,y:n-E.HEIGHT/2}),new E({x:b+g*8,y:n-E.HEIGHT/2})];break;case 17:o=[{x:-90/2,y:s,width:mt,height:A}],l=[new E({x:b+g,y:n-E.HEIGHT/2}),new E({x:b+g*3,y:n-E.HEIGHT/2}),new E({x:b+g*5,y:n-E.HEIGHT/2}),new E({x:b+g*7,y:n-E.HEIGHT/2})];break;case 18:break;case 19:{a=3,o=[{yDirection:-1,dockStartTime:0,x:b+g*3,y:s,width:ei,height:A}];break}case 20:{a=3;const c={yDirection:-1,dockStartTime:0,x:b+g*1,y:s-pt()*A,width:g*2,height:A},d={yDirection:-1,dockStartTime:0,x:ii-g*3,y:s-pt()*A,width:g*2,height:A};o=[c,d];break}case 21:a=1,o=[{x:-90/2,y:s,width:mt,height:A}];break;case 22:a=2,o=[{x:-90/2,y:s,width:mt,height:A}];break}return new dn(e,s,a,o,l)}function gn(t){for(let e=1;e<t.length;e++){const i=t[e-1],s=t[e];for(let n=0;n<Gt;n++)i.blocks[n].type===3&&s.blocks[n].type===0&&(s.blocks[n].type=3)}}const Ae=-1,si=1,yn={x:0,y:Ae},mn={x:-1,y:0},pn={x:1,y:0},wn=ft({x:-1,y:Ae}),An=ft({x:1,y:Ae}),bn=3,Re=1e3;class vn{constructor(e,i){m(this,"host");m(this,"track");m(this,"horizontalMargin",0);m(this,"lastSlowdownTime",-1e3);m(this,"target",null);this.host=e,this.track=i}reset(){this.target=null}getMovement(e){const i=this.getCurrentBlock(),s=this.track.getBlock(i.row+1,i.col),n=this.goByRaft(i,s,e);return n||((this.target==null||this.hasReached(this.target))&&(this.target=this.findNextTarget(i)),this.goRoundObstacles(i,s,e)||this.moveOnTrack(i,s,e))}goByRaft(e,i,s){if(e.type!==D.Raft&&i.type===D.Raft&&(this.host.y>e.y+1.5*this.host.height||this.track.isFree(e.row+1,e.col)))return{x:0,y:this.moveAhead(e,i,s)};if(i.type===D.Raft&&this.host.y<=e.y+1.5*this.host.height&&!this.track.isFree(e.row+1,e.col))return J;if(e.type===D.Raft&&!this.track.isFree(e.row+1,e.col)){let n=0;return this.host.x<e.x+this.host.width?n=1:e.x+e.width-2*this.host.width<this.host.x&&(n=-1),{x:n,y:0}}return e.type===D.Raft&&this.track.isFree(e.row,e.col)&&this.track.isFree(e.row+1,e.col)?yn:null}goRoundObstacles(e,i,s){if(this.target==null)return J;if(e.type===D.Obstacle){if(e.y+e.height/2<this.host.y+this.host.height/2)return this.target.col<e.col?wn:An}else{if(this.target.col<e.col&&this.track.getBlock(e.row,e.col-1).type===D.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===D.Empty?mn:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:-1,y:this.moveAhead(e,i,s)};if(e.col<this.target.col&&this.track.getBlock(e.row,e.col+1).type===D.Obstacle)return this.host.y>e.y+3*this.host.height&&i.type===D.Empty?pn:this.host.y>e.y+3*this.host.height?{x:0,y:this.moveAhead(e,i,s)}:{x:1,y:this.moveAhead(e,i,s)}}return null}moveOnTrack(e,i,s){if(this.target==null)return J;let n=0;i.type===D.Empty&&this.host.y+this.host.height/2<e.y?n=si:n=this.moveAhead(e,i,s),n<0&&i.type===D.Empty&&this.host.y+this.host.height/2<e.y+e.height/2&&(n=0);let a=0;const o=this.host.x<this.target.x+this.horizontalMargin,l=this.target.x+this.target.width-this.horizontalMargin<=this.host.x+this.host.width;return o&&this.track.getBlock(e.row,e.col+1).type===D.Free?a=1:l&&this.track.getBlock(e.row,e.col-1).type===D.Free&&(a=-1),{x:a,y:n}}moveAhead(e,i,s){return i.type!==D.Free&&this.host.velocity.y<-.25*1.5?(Re<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),si):this.host.velocity.y<-.25*3.5&&!this.isClearAhead(e)?(Re<s-this.lastSlowdownTime&&(this.lastSlowdownTime=s),0):Re<s-this.lastSlowdownTime?Ae:0}getCurrentBlock(){const e=Ks(this.host);let i=this.track.getBlockAt(e);return(i.type===D.Empty||i.type===D.Raft)&&i.y+i.height-this.host.height<e.y&&(i=this.track.getBlock(i.row-1,i.col)),i.type===D.Empty&&(i.x+i.width-this.host.width<e.x?i=this.track.getBlock(i.row,i.col+1):e.x<i.x+this.host.width&&(i=this.track.getBlock(i.row,i.col-1))),i}hasReached(e){return this.host.y+this.host.height<e.y+e.height}findNextTarget(e){const i=this.findNearestBlock(e.row+1,e.col);if(i==null||i.col!==e.col)return i;const s=this.findNearestBlock(i.row+1,i.col);if(s==null)return i;if(s.col<i.col){const n=this.track.getBlock(i.row,i.col-1);if(n.type===D.Free)return n}if(i.col<s.col){const n=this.track.getBlock(i.row,i.col+1);if(n.type===D.Free)return n}return i}isClearAhead(e){for(let i=e.row+1;i<=e.row+bn;i++)if(this.track.getBlock(i,e.col).type!==D.Free)return!1;return!0}findNearestBlock(e,i){for(let s=0;s<Gt-1;s++){const n=(pt()<.5?-1:1)*s,a=i+n,o=this.track.getBlock(e,a);if(o.type===D.Free||o.type===D.Raft)return this.horizontalMargin=pt(.2)*g,this.track.getBlock(e,a)}return null}}const at=(t,e)=>2*Math.abs(e/t-Math.floor(e/t+.5));var ut=(t=>(t[t.Stand=0]="Stand",t[t.Walk=1]="Walk",t[t.Fall=2]="Fall",t[t.Celebrate=3]="Celebrate",t))(ut||{}),K=(t=>(t[t.Right=0]="Right",t[t.Forward=1]="Forward",t[t.Backward=2]="Backward",t[t.ForwardRight=3]="ForwardRight",t[t.BackwardRight=4]="BackwardRight",t))(K||{});const Sn="rgb(200,150,150)",In="rgb(230,230,230)",kn="rgb(30,0,0)",xn="rgb(170,120,120)",$t="rgb(140,140,140)",Fe="rgb(120,120,120)",jt="rgb(140,140,220)",Te="rgb(120,120,200)",En="rgba(0, 0, 0, 0.2";function ie(t,e,i,s,n,a,o,l,c){let d=0,w=0,p=0,f=0,y=0,v=0;const S=a===3||a===4,R=a===0;switch(o){case 1:d=R?600:S?400:300,v=Me(at(d/2,n/2))*.02*s,w=y=-Math.PI/6+nt(at(d,n))*(Math.PI/3),p=f=-Math.PI/6+nt(at(d,n+d/2))*(Math.PI/3);break;case 3:{d=1500,v=Me(at(d/2,n/2))*.15*s;const I=at(d,n);w=nt(I)*Math.PI*(1/8),p=-nt(I)*Math.PI*(3/8),y=Math.PI*(1/8)-nt(I)*Math.PI*(9/8),f=Math.PI*(1/8)-nt(I)*Math.PI*(10/8);break}case 2:d=3200,v=Me(at(d/2,n))*.02*s,w=-Math.PI*(3/8)+nt(at(d,n))*(Math.PI*(3/4)),p=-Math.PI*(3/8)+nt(at(d,n+d/2))*(Math.PI*(3/4)),f=-Math.PI*(8/8)+nt(at(d,n+d/2))*(Math.PI/4),y=-Math.PI*(8/8)+nt(at(d,n))*(Math.PI/4);break}t.save(),Mn(t,.5*i,s,i*.4-v/2),t.translate(0,-v);const k=.3*s,P=.25*s,x=.2*i,B=.1*i;switch(t.fillStyle=e,t.lineWidth=x,t.lineJoin="round",t.lineCap="round",e==="eliminated"&&(t.globalAlpha=.7),a){case 0:{const I=.5*i,O=.4*s,L=.5*i,G=.7*s;ri(t,Te,I,O,B,k,f),oi(t,Fe,L,G,x,P,w),oi(t,$t,L,G,x,P,p),ne(a,t,i,s,e,l,c),ae(a,t,i,s,e,l,c),ri(t,jt,I,O,B,k,y)}break;case 1:case 2:{Tt(t,$t,.35*i,.7*s,x,P,-1,w,0),Tt(t,$t,.7*i,.7*s,x,P,1,p,0),ne(a,t,i,s,e,l,c),Ft(t,jt,.25*i,.35*s,B,k,-1,f),Ft(t,jt,.75*i,.35*s,B,k,1,y),ae(a,t,i,s,e,l,c);break}case 3:{Tt(t,Fe,.35*i,.7*s,x,P,-1,w,p/4),Tt(t,$t,.65*i,.7*s,x,P,1,p,p/4),Ft(t,Te,.25*i,.35*s,B,k,-1,y,y/2),ne(a,t,i,s,e,l,c),ae(a,t,i,s,e,l,c),Ft(t,jt,.75*i,.35*s,B,k,1,f,y/2);break}case 4:{Tt(t,Fe,.65*i,.7*s,x,P,1,p,p/4),Tt(t,$t,.35*i,.7*s,x,P,-1,w,p/4),Ft(t,Te,.75*i,.35*s,B,k,1,y,y/2),ne(a,t,i,s,e,l,c),ae(a,t,i,s,e,l,c),Ft(t,jt,.25*i,.35*s,B,k,-1,f,y/2);break}}t.restore()}function Mn(t,e,i,s){t.save(),t.fillStyle=En,t.translate(e,i),t.beginPath(),t.arc(0,0,Math.max(0,s),0,2*Math.PI),t.fill(),t.restore()}const _t={};function gt(t,e,i){const s=ni(t),n=ni(e),a=Math.round((1-i)*s.r+i*n.r),o=Math.round((1-i)*s.g+i*n.g),l=Math.round((1-i)*s.b+i*n.b);return`rgb(${a}, ${o}, ${l})`}function ni(t){if(t==="eliminated")return{r:128,g:128,b:128};const e=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(t);return e?{r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])}:{r:0,g:0,b:0}}const Pn=navigator.userAgent.toLowerCase().includes("firefox");function Xi(t,e,i,s,n,a){const o=`${i}-${e}-${s}-${n}`;if(a||!_t[o]){const l=t.createRadialGradient(s,n,n/8,s,n,s);if(i==="TORSO"?(l.addColorStop(0,gt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.2,gt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(.5,gt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(1,gt(e,"rgb(0, 0, 0)",.3))):i==="HEAD"&&(l.addColorStop(0,gt(e,"rgb(0, 0, 0)",.3)),l.addColorStop(.5,gt(e,"rgb(0, 0, 0)",.1)),l.addColorStop(.8,gt(e,"rgb(255, 255, 255)",.1)),l.addColorStop(1,gt(e,"rgb(255, 255, 255)",.1))),Pn){if(a)return ai(t,l,s*2,n*2);_t[o]=ai(t,l,s*2,n*4)}else{if(a)return l;_t[o]=l}}return _t[o]}function Cn(){for(const t in _t)delete _t[t]}function ai(t,e,i,s){const n=document.createElement("canvas");n.width=i,n.height=s;const a=n.getContext("2d");if(a)return a.fillStyle=e,a.fillRect(0,0,i,s),t.createPattern(n,"no-repeat")}function zi(t,e,i,s,n,a){e&&(t.save(),t.translate(i,s),t.scale(n/80,a/80),t.fillStyle=e,t.fill(),t.restore())}function ne(t,e,i,s,n,a,o=!1){const l=.2*i,c=t===0?.5*i:.45*i,d=.25*s,w=t===0?.28*i:.5*(i-c),p=.06*s;e.beginPath(),e.roundRect(w,p,c,d,l);const f=Xi(e,n,"HEAD",c,d,o);e.fillStyle=f||"black",e.fill(),zi(e,a,w,p,c,d),Rn(e,t,i,c,d,l)}function ae(t,e,i,s,n,a,o=!1){const l=.4*s,c=.2*i,d=t===0?.5*i:.6*i,w=t===1||t===2?.2*i:.5*(i-d),p=.3*s;e.beginPath(),e.roundRect(w,p,d,l,c);const f=Xi(e,n,"TORSO",d,l,o);e.fillStyle=f||"black",e.fill(),zi(e,a,w,p,d,l)}function ri(t,e,i,s,n,a,o){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(o),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-a/4,a/2,0,a),t.stroke(),t.restore()}function oi(t,e,i,s,n,a,o){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(o),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(-a/8,a/2,0,a),t.stroke(),t.restore()}function Ft(t,e,i,s,n,a,o,l,c=0){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(-o*.07*Math.PI),t.rotate(c),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(o*a/4,a/2,0,a),t.stroke(),t.restore()}function Tt(t,e,i,s,n,a,o,l,c){t.save(),t.strokeStyle=e,t.lineWidth=n,t.translate(i,s),t.rotate(c),t.scale(1,Math.cos(l+Math.PI/8)),t.beginPath(),t.moveTo(0,0),t.quadraticCurveTo(o*a/8,a/2,0,a),t.stroke(),t.restore()}function Rn(t,e,i,s,n,a){if(e!==2&&e!==4)return;const o=.15*i,l=.6*a,c=s-o,d=n-o*1.75,w=n-d,p=e===2?(i-c)/2:(i-c)/2+(s-c)/2;t.save(),t.translate(p,w),t.shadowColor="rgba(0, 0, 0, 0.5)",t.fillStyle=Sn,t.shadowOffsetY=-d/10;const f=0,y=0;t.beginPath(),t.roundRect(f,y,c,d,l),t.fill(),t.closePath(),t.shadowOffsetY=0;const v=.06*c,S=c/4,R=d/3,k=f+S,P=f+c-S,x=y+R;t.fillStyle=In,t.beginPath(),t.arc(k,x,v,0,Math.PI*2),t.arc(P,x,v,0,Math.PI*2),t.fill(),t.closePath();const B=.025*c,I=.01*c,O=.01*d;t.fillStyle=kn,t.beginPath(),t.arc(k+I,x+O,B,0,Math.PI*2),t.arc(P+I,x+O,B,0,Math.PI*2),t.fill(),t.closePath();const L=.15*c,G=.2*d,T=f+(c-L)/1.75,U=y+(d-G)/1.5;t.fillStyle=xn,t.beginPath(),t.moveTo(T,U),t.lineTo(T+L/2,U+G),t.lineTo(T-L/2,U+G),t.closePath(),t.fill(),t.restore()}let Ne=1;const Yi=(t,e)=>{const i=t/e;let s=window.innerWidth,n=window.innerHeight;s/n>i?s=n*i:n=s/i,s>t&&(s=t,n=t/i),n>e&&(n=e,s=e*i),u.width=s,u.height=n;const a=window.innerWidth/s,o=window.innerHeight/n,l=Math.min(a,o);Ne=l,u.style.position="absolute",u.style.left=`${(window.innerWidth-s*l)/2}px`,u.style.top=`${(window.innerHeight-n*l)/2}px`,u.style.transform=`scale(${l})`,u.style.transformOrigin="top left"},Vi=(t,e)=>{const i=u.getBoundingClientRect();t.x=(e.clientX-i.left)/Ne,t.y=(e.clientY-i.top)/Ne},Ui=4;let Ge=0;const Ki=[...Array(Ui)].map(()=>({x:0,y:0})),wt="ontouchstart"in window,Fn=()=>{wt&&(window.oncontextmenu=t=>{t.preventDefault()},u.ontouchstart=t=>{t.preventDefault(),Oe(t)},u.ontouchmove=t=>{t.preventDefault(),Oe(t)},u.ontouchend=t=>{t.preventDefault(),Oe(t)})},Oe=t=>{Ge=Math.min(t.touches.length,Ui);for(let e=0;e<Ge;e++)Vi(Ki[e],t.touches[e])},qi=(t,e)=>new Promise(i=>{const s=n=>{n.preventDefault();const a=n.changedTouches[0];if(!a)return;it(Ke),Vi({x:0,y:0},a);{if(u.removeEventListener("touchstart",s),e!==void 0)try{console.log(`Playing sound ID: ${e}`),it(e)}catch(l){console.error("Error playing sound:",l)}i()}};u.addEventListener("touchstart",s,{passive:!1})}),Tn=(t,e)=>qi(e,t),re=t=>{for(let e=0;e<Ge;e++)if(qs(t,Ki[e]))return!0;return!1};let On=0;const kt={symbol:"◁",x:0,y:0,width:0,height:0},Lt={symbol:"▷",x:0,y:0,width:0,height:0},Ht={symbol:"△",x:0,y:0,width:0,height:0},Bt={symbol:"▽",x:0,y:0,width:0,height:0},Xe={movement:{x:0,y:0}},Dn=()=>{const t=Us(),e=t.ArrowLeft||t.KeyA||re(kt),i=t.ArrowRight||t.KeyD||re(Lt),s=t.ArrowUp||t.KeyW||re(Ht),n=t.ArrowDown||t.KeyS||re(Bt),a=e?-1:i?1:0,o=s?-1:n?1:0;a===0&&o===0?Xe.movement=J:Xe.movement=ft({x:a,y:o})},Wn=()=>{zs(),Fn(),li(),window.addEventListener("resize",li,!1)},li=()=>{const t=u.width*.01,e=u.height*.02,i=u.width*.1,s=u.height*.6,n=u.height-s*.65-2*e,a=i,o=s/3;kt.x=t,kt.y=n+o+e,kt.width=i,kt.height=s/3,Lt.x=i+2*t,Lt.y=n+o+e,Lt.width=i,Lt.height=s/3,Ht.x=u.width-a-t,Ht.y=n,Ht.width=a,Ht.height=o,Bt.x=u.width-a-t,Bt.y=n+o+e,Bt.width=a,Bt.height=o},Ot=async t=>{await(wt?t?Tn(t):qi():Vs(t))},Jt=(t="continue",e=7.7)=>{const i=(wt?"Tap the screen to ":"Press ENTER to ")+t;H(i+(On++%60===0?"":"█"),_.Small,"Courier New",1,e,!0,0,i)},$i=()=>{if(!wt)return;r.save();const t=kt.width/2;r.font=t+"px Impact",r.fillStyle="rgba(200, 200, 200, 0.2)",oe(kt,t),oe(Lt,t),oe(Ht,t),oe(Bt,t),r.restore()},oe=(t,e)=>{r.strokeStyle="rgba(255, 255, 255, 0.2)",r.lineWidth=2,r.strokeRect(t.x,t.y,t.width,t.height),r.fillStyle="rgba(255, 255, 255, 0.4)",r.fillText(t.symbol,t.x+t.width/2-e/2,t.y+t.height/2+e*.45,e)},_n=()=>Xe;function Ln(t,e){t.translate(e/2,0),t.scale(-1,1),t.translate(-e/2,0)}const pe=500,hi=1e3,ji=["rgb(255, 255, 0)","rgb(255, 0, 0)","rgb(0, 128, 0)","rgb(0, 0, 255)","rgb(255, 165, 0)","rgb(255, 99, 71)","rgb(255, 192, 203)","rgb(106, 90, 205)","rgb(238, 130, 238)","rgb(30, 144, 255)","rgb(0, 255, 255)","rgb(255, 0, 255)","rgb(144, 238, 144)","rgb(211, 211, 211)","rgb(64, 224, 208)","rgb(0, 191, 255)","rgb(173, 216, 230)","rgb(240, 128, 128)","rgb(0, 255, 127)","rgb(255, 0, 255)","rgb(220, 20, 60)","rgb(230, 230, 250)","rgb(255, 127, 80)","rgb(0, 128, 128)","rgb(75, 0, 130)","rgb(250, 128, 114)","rgb(127, 255, 0)","rgb(218, 165, 32)","rgb(255, 182, 193)","rgb(210, 105, 30)","rgb(205, 92, 92)","rgb(128, 128, 0)","rgb(255, 69, 0)","rgb(135, 206, 235)","rgb(72, 209, 204)","rgb(160, 82, 45)","rgb(0, 255, 0)","rgb(0, 0, 128)","rgb(245, 222, 179)","rgb(70, 130, 180)","rgb(255, 255, 255)"],qe=ji[0],ze={width:2,height:2};class De{constructor(e,i,s=1+Math.random()*.6,n=1+Math.random()*.4){m(this,"ai");m(this,"rank",0);m(this,"finished",!1);m(this,"eliminated",!1);m(this,"timeOffset",pt(2e3));m(this,"direction",J);m(this,"latestDirection",{x:0,y:-1});m(this,"color");m(this,"x",0);m(this,"y",0);m(this,"width");m(this,"height");m(this,"velocity",J);m(this,"fallStartTime");m(this,"dropStartTime");m(this,"latestCheckpointIndex",0);this.ai=e===0||!i?null:new vn(this,i),this.color=ji[e],this.width=ze.width*s,this.height=ze.height*n}get doesNotCollide(){return this.finished||this.eliminated||this.fallStartTime!=null}isVisible(e){return!(this.fallStartTime!=null&&pe<e-this.fallStartTime)}setDirection(e){this.direction=e,he(e)||(this.latestDirection=e)}getMovement(e){return this.ai?this.ai.getMovement(e):_n().movement}move(){this.eliminated||this.finished?(this.direction=J,this.velocity=J):(this.x+=this.velocity.x,this.y+=this.velocity.y)}stop(){this.y+=this.velocity.y*8}drop(e,i){var s;this.x=i.x,this.y=i.y,this.direction=J,this.latestDirection={x:0,y:-1},this.velocity=J,this.fallStartTime=void 0,this.dropStartTime=e,(s=this.ai)==null||s.reset()}draw(e,i,s){const n=this.latestDirection.y!==0?this.latestDirection.x===0?this.latestDirection.y<0?K.Forward:K.Backward:this.latestDirection.y>0?K.BackwardRight:K.ForwardRight:K.Right;r.save();const a=this.height*3,o=a-this.height;if(r.translate(this.x,this.y-o),this.latestDirection.x<0&&Ln(r,this.width),this.fallStartTime!=null){const c=Math.max(1-Pe((e-this.fallStartTime)/pe),0);r.translate(this.width/2,a/2),r.scale(c,c),r.translate(-this.width/2,-a/2),r.globalAlpha=Pe(c)}else this.dropStartTime&&e-this.dropStartTime<hi&&(r.globalAlpha=Pe((e-this.dropStartTime)/hi));const l=he(this.direction)&&this.fallStartTime==null?0:e+this.timeOffset;ie(r,this.eliminated?"eliminated":this.color,this.width,a,l,this.finished?e%3600<1800?K.Backward:K.BackwardRight:n,this.getAnimation(),s),r.restore()}getAnimation(){return this.fallStartTime!=null?ut.Fall:he(this.direction)?ut.Stand:ut.Walk}}const Hn=.005,ci=2e3;class Bn{constructor(e,i){m(this,"elements");m(this,"startY");m(this,"checkpoints");m(this,"specialElements");m(this,"finishY");m(this,"elementCount");m(this,"width");m(this,"height");this.elements=fn(e,i),this.elementCount=this.elements.length,this.specialElements=this.elements.filter(a=>a.surfaces.some(o=>me(o)||Be(o))),this.startY=i,this.finishY=this.startY-(this.elements.length-1)*A;const s=Math.min(...this.elements.map(a=>a.minX)),n=Math.max(...this.elements.map(a=>a.maxX));this.width=n-s,this.height=this.elements.length*A,this.checkpoints=this.elements.filter((a,o)=>a.type===ht.CheckPoint||o===0).map(a=>({y:a.y+a.height,element:a}))}update(e,i,s){for(let n=0;n<this.specialElements.length;n++){const a=this.specialElements[n];for(let o=0;o<a.surfaces.length;o++){const l=a.surfaces[o];if(me(l))for(let c=0;c<s.length;c++){const d=s[c];l.y<=d.y&&d.y+d.height<l.y+l.height&&l.x<=d.x&&d.x+d.width<=l.x+l.width&&(d.velocity=dt(d.velocity,{x:0,y:-.002*l.force*i}))}if(Be(l)){const c=l,d=a.y,w=a.y-A;c.yDirection===-1&&c.y<=w?(c.yDirection=0,c.dockStartTime=e):c.y<=w&&e-c.dockStartTime>ci?c.yDirection=1:c.yDirection===1&&d<=c.y?(c.yDirection=0,c.dockStartTime=e):d<=c.y&&e-c.dockStartTime>ci&&(c.yDirection=-1);const p=c.yDirection*Hn*i;c.y+=p;for(let f=0;f<s.length;f++){const y=s[f];ye(c,y)&&(y.y+=p)}}}}}get(e){return this.elements[e]}isFree(e,i){if(e<0||this.elements.length<=e)return!1;const s=this.elements[e];return s.surfaces.length===0?this.elements[Math.max(e-1,0)].isFree(i,s.y):s.isFree(i)}getBlock(e,i){return e<0||this.elements.length<=e?Gi(e,i,this.startY-e*A):this.elements[e].getBlock(i)}getBlockAt(e){const i=Math.floor(Math.max(this.startY-e.y,0)/A),s=Math.min(i,this.elements.length-1),n=Math.floor((e.x-b)/g);return this.getBlock(s,n)}getCheckpoint(e){return this.checkpoints[e].element}findLatestCheckpoint(e){for(let i=this.checkpoints.length-1;i>=0;i--){const s=this.checkpoints[i];if(e<s.y-s.element.height*.15)return i}return 0}getBetween(e,i){const s=Math.ceil(Math.max(this.startY-e,0)/A),n=Math.floor(Math.max(this.startY-i,0)/A);return{minI:Math.max(n-1,0),maxI:Math.min(s,this.elements.length)-1}}isOnPlatform(e,i){const{minI:s,maxI:n}=e;for(let a=n;a>=s;a--){const l=this.get(a).surfaces;for(let c=0;c<l.length;c++){const d=l[c];if(ye(i,d))return!0}}return!1}}const Nn=70,di=400,fi=5,ui=40,Gn=3*Ni,gi=1e3;var Ye=(t=>(t[t.RUNNING=0]="RUNNING",t[t.GAME_OVER=1]="GAME_OVER",t[t.FINISHED=2]="FINISHED",t))(Ye||{});function Xn(t){for(let e=t.length-1;e>=0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}}class yi{constructor(e,i,s,n,a){m(this,"camera",new Qs(this,u));m(this,"platePattern");m(this,"track");m(this,"characters",[]);m(this,"charactersCount",40);m(this,"player",new De(0,void 0,0,0));m(this,"x");m(this,"y");m(this,"width");m(this,"height");m(this,"state",0);this.platePattern=a,this.track=new Bn(e,di),this.x=0-this.track.width/2-fi,this.y=di-this.track.height-ui,this.width=this.track.width+2*fi,this.height=this.track.height+2*ui;const o=this.track.get(0),l=15,c=o.width/l,d=ze.height*1.9,w=c*.3;this.player=new De(0,this.track,i,s),this.characters.push(this.player);for(let f=1;f<(n?n.length:this.charactersCount);f++){if(n&&n[f].eliminated)continue;const y=new De(f,this.track);this.characters.push(y)}const p=[this.player,...this.characters];Xn(p);for(let f=0;f<p.length;f++){const y=p[f],v=Math.floor(f/l),S=f%l,R={x:o.minX+w+S*c,y:o.y+v*d};y.x=R.x,y.y=R.y}this.camera.follow(this.player),this.camera.visibleAreaHeight=Nn,this.camera.yAdjust=-.25,this.camera.update(0)}update(e,i){this.camera.update(e),this.track.update(e,i,this.characters),this.calculateMovement(e,i),this.checkCollisions();for(let s=0;s<this.characters.length;s++)this.characters[s].move();this.updateCharacterRanks(),this.checkGameState()}playWithVolumeByDistance(e,i){const s=Math.abs(i-this.player.y);it(e,Math.max(0,Math.min(1,1-s/Gn)))}calculateMovement(e,i){for(let s=0;s<this.characters.length;s++){const n=this.characters[s],a=this.track.getBetween(n.y,n.y+n.height);let o=J;n.fallStartTime!=null?e-n.fallStartTime>pe+gi&&this.dropToLatestCheckpoint(e,n):n.fallStartTime==null&&!this.track.isOnPlatform(a,n)?(n.fallStartTime=e,n===this.player&&setTimeout(()=>{const l=this.track.getCheckpoint(this.player.latestCheckpointIndex),c=l.y+l.height/2;this.camera.setTransition({startY:this.player.y,endY:c,startTime:e,duration:gi+500})},pe)):(o=n.getMovement(e),n.setDirection(o),n.velocity=rn(n,o,i))}}checkCollisions(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e];if(!i.doesNotCollide)for(let s=e+1;s<this.characters.length;s++){const n=this.characters[s];n.doesNotCollide||ln(i,n)&&(!i.ai||zt(i.velocity)>.3)&&this.playWithVolumeByDistance(Ti,i.y)}}for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.getBetween(i.y,i.y+i.height),{minI:n,maxI:a}=s;for(let o=n;o<=a;o++){const l=this.track.get(o);for(let c=0;c<l.objects.length;c++){const d=l.objects[c];on(i,d)&&this.playWithVolumeByDistance(Fi,d.y)}}}}renderText(e,i,s,n){const a=r.measureText(e),o=i+(n-a.width)/2;r.fillText(e,o,s)}updateCharacterRanks(){const e=this.characters.filter(n=>n.finished),i=this.characters.filter(n=>!n.finished);e.sort((n,a)=>n.rank-a.rank),i.sort((n,a)=>n.y+n.height/2-(a.y+a.height/2)),[...e,...i].forEach((n,a)=>{n.rank=a+1})}checkGameState(){for(let e=0;e<this.characters.length;e++){const i=this.characters[e],s=this.track.findLatestCheckpoint(i.y),n=this.track.getBetween(i.y,i.y+i.height);if(!(i.fallStartTime!=null||!this.track.isOnPlatform(n,i))){if(s>i.latestCheckpointIndex&&(i.latestCheckpointIndex=s,i.rank===13)){i.eliminated=!0,i.stop(),i.ai||(this.state=1);continue}if(i.y+i.height<this.track.finishY&&(i.rank===13?(i.eliminated=!0,i.stop(),i.ai||(this.state=1)):(i.finished=!0,i.stop()),!i.ai||i.rank==this.characters.length-13)){let a=this.characters.filter(o=>o.eliminated).length;for(let o=0;o<this.characters.length;o++)if(this.characters[o].rank>this.characters.length-13)if(a<13)this.characters[o].eliminated||(this.characters[o].eliminated=!0,a++);else break;this.characters[0].eliminated?this.state=1:this.state=2}}}}dropToLatestCheckpoint(e,i){const s=this.track.getCheckpoint(i.latestCheckpointIndex),n={x:hn(s.minX+g,s.maxX-g),y:s.y+s.height/2,width:i.width,height:i.height};if(!this.characters.some(a=>ye(a,n))){if(i.rank===13){i.eliminated=!0,i.stop(),i.ai||(this.state=1);return}i.drop(e,n),this.playWithVolumeByDistance(Oi,i.y),i===this.player&&this.camera.follow(i)}}drawCross(e,i,s,n="red"){r.strokeStyle=n,r.lineWidth=s/4,r.beginPath(),r.moveTo(e-s/2,i-s/2),r.lineTo(e+s/2,i+s/2),r.moveTo(e+s/2,i-s/2),r.lineTo(e-s/2,i+s/2),r.stroke()}draw(e,i){r.save(),r.translate(u.width/2,u.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y);const s=[...this.characters];this.drawTrack(s),this.drawObjects(e,i,s),r.restore(),this.drawGradient(),this.state===0&&(r.save(),r.translate(u.width/2,u.height/2),r.scale(this.camera.zoom,this.camera.zoom),r.translate(-this.camera.x,-this.camera.y),this.drawStatusOfCharacters(e),this.drawTopStatusTexts(),r.restore())}drawTrack(e){r.save();const i=this.camera.getViewArea(),{minI:s,maxI:n}=this.track.getBetween(i.y,i.y+i.height);for(let a=n;a>=s;a--){const o=this.track.get(a),l=o.surfaces;r.fillStyle=o.color,r.shadowColor=o.color.replace("rgb(","rgba(").replace(")",",0.3)"),r.shadowOffsetY=o.height*(o.type===ht.Raft?2:6),o.type===ht.Raft&&(r.globalAlpha=.5);for(let c=0;c<l.length;c++){const d=l[c];this.drawSurface(o,d)}r.globalAlpha=1,e.push(...o.objects)}r.restore()}drawSurface(e,i){if(r.strokeStyle="rgba(255,255,255,0.4)",r.lineWidth=.1,e.type!==ht.Raft&&r.strokeRect(i.x,i.y+.1,i.width,i.height),r.save(),me(i)){const s=i.force;r.fillStyle=`rgba(${220+s*50}, ${80+s*50}, ${60+s*50}, ${1-s})`}if(r.fillRect(i.x,i.y,i.width,i.height),r.restore(),e.type===ht.Raft)r.strokeRect(i.x,i.y,i.width,i.height);else if(me(i)){r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/(e.width/10);for(let n=1;n<=i.width/9-1;n++)r.fillText("⇪",i.x+n*s,i.y+i.height/2)}else if(e.type===ht.CheckPoint||e.type===ht.Finish){r.fillStyle="rgba(255, 255, 255, 0.2)",r.fillRect(i.x,i.y+i.height-4,i.width,4),r.shadowOffsetY=0,r.font="9px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="rgba(255, 255, 255, 0.1)";const s=e.width/10;for(let n=1;n<=i.width/9-1;n++)r.fillText(e.type===ht.Finish?"✪":"✓",i.x+n*s,i.y+i.height/2.4)}this.platePattern&&(r.fillStyle=this.platePattern,r.fillRect(i.x,i.y,i.width,i.height),r.fillStyle=e.color)}drawObjects(e,i,s){s.sort((n,a)=>n.y+n.height/2-(a.y+a.height/2));for(let n=0;n<s.length;n++)s[n].draw(e,i)}drawGradient(){const e=r.createRadialGradient(u.width/2,u.height/2,0,u.width/2,u.height/2,u.width/1.5);e.addColorStop(1,"rgba(0, 0, 0, 0)"),e.addColorStop(.8,"rgba(0, 0, 0, 0)"),e.addColorStop(0,"rgba(255, 255, 255, 0.3)"),r.fillStyle=e,r.fillRect(0,0,u.width,u.height);const i=r.createLinearGradient(0,0,0,u.height);i.addColorStop(0,"rgba(0, 0, 0, 1)"),i.addColorStop(.2,"rgba(0, 0, 0, 0.5)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),r.fillStyle=i,r.fillRect(0,0,u.width,u.height)}drawStatusOfCharacters(e){this.characters.forEach(i=>{if(i.isVisible(e)){const s=`${i.rank}`;r.fillStyle=i.rank===13?"red":i.eliminated?"crimson":i.rank>this.characters.length-13?"orange":i.rank===1?"lightgreen":i.ai?"white":"yellow",r.font=i.ai?i.eliminated||i.rank===13?"1.2px Sans-serif":"1px Sans-serif":"1.4px Sans-serif",i.ai||(r.save(),r.font="4.0px Sans-serif",this.renderText("▲",i.x,i.y-i.height*3.25,i.width),r.restore()),i.eliminated&&this.drawCross(i.x-.25,i.y-i.height*2.7,1),this.renderText(i.eliminated?"13":s,i.x,i.y-i.height*2.5,i.width)}})}drawTopStatusTexts(){const e=this.characters.filter(s=>s.eliminated).length.toString(),i=this.characters.filter(s=>s.finished).length.toString();r.font="4px Impact",r.fillStyle=this.player.rank===13?"red":this.player.eliminated?"crimson":this.player.rank>this.characters.length-13?"orange":this.player.rank===1?"lightgreen":"yellow",r.fillText("▲ "+this.player.rank+" / "+this.characters.length,-42,this.camera.y-30),r.fillStyle="green",r.fillText("✪ "+i+" / "+(this.characters.length-13)+" QUALIFIED",-15,this.camera.y-30),r.fillStyle="red",this.drawCross(28,this.camera.y-31.5,3),r.fillText(e+" / 13",32,this.camera.y-30)}}const mi=[h.FullWidthWithObstacles,h.FullWidth,h.FullWidth,h.FullWidth],pi=[h.Basic,h.SlopeEmptyPassage,h.SlopeEmptyPassage,h.DualPassage,h.Basic,h.RightPassage,h.RightPassage,h.Basic,h.Basic,h.Raft,h.Chasm,h.FullWidth],zn=[h.BasicSteepSlope,h.BasicSlope,h.FullWidthWithObstacles,h.FullWidthWithMoreObstacles,h.FullWidthWithObstacles,h.DualPassage,h.DualPassage,h.DualPassage,h.FullWidth];function Yn(){const t=pt(1);return[h.Checkpoint,...t<.5?mi:pi,h.Checkpoint,...t<.5?pi:mi,h.Checkpoint,...zn,h.Finish]}const wi=[h.FullWidth,h.BasicSteepSlope,h.BasicSlope,h.BasicSlope,h.Basic,h.Basic,h.Basic,h.Narrow,h.VeryNarrow,h.VeryNarrow,h.Basic,h.FullWidthWithObstacles,h.SlopeObstacleSlope,h.PassageEmptySlope,h.PassageEmptySlope,h.DualPassage,h.DualPassage,h.FullWidth,h.FullWidthWithObstaclesOnRight,h.FullWidthWithObstaclesOnRight2,h.FullWidthWithObstaclesOnRight,h.FullWidth,h.Raft,h.Chasm],Ai=[h.FullWidth,h.VeryNarrow,h.FullWidth,h.BasicSteepSlope,h.BasicSlope,h.BasicSlope,h.Basic,h.Basic,h.Basic,h.Basic,h.TwoRafts,h.Chasm];function Vn(){const t=pt(1);return[h.Checkpoint,...t<.5?wi:Ai,h.Checkpoint,...t<.5?Ai:wi,h.Finish]}const bi=[h.FullWidth,h.Basic,h.Narrow,h.VeryNarrow,h.Basic,h.SlopeEmptySlope,h.SlopeEmptySlope,h.SlopeEmptySlope,h.DualPassage,h.DualPassage,h.Basic,h.FullWidthWithObstacles,h.VeryNarrow,h.Basic],vi=[h.FullWidth,h.SlopeEmptySlope,h.PassageEmptySlope,h.PassageEmptySlope,h.DualPassage,h.SlopeEmptyPassage,h.DualPassageExt,h.TriplePassage,h.TriplePassage,h.TriplePassage,h.FullWidth],Si=[h.FullWidthWithObstacles,h.FullWidthWithMoreObstacles,h.FullWidth,h.TwoRafts,h.Chasm,h.Basic,h.FullWidth],Ii=[h.BasicSteepSlope,h.BasicSlope,h.BasicSlope,h.Basic,h.Basic,h.Basic,h.DualPassage,h.DualPassageExt,h.TriplePassage,h.TriplePassage,h.DualPassageExt,h.PassageEmptySlope,h.PassageEmptySlope,h.Basic,h.Basic,h.Narrow,h.VeryNarrow,h.FullWidth,h.RightPassage,h.FullWidth,h.TwoRafts,h.Chasm];function Un(){const t=pt(1);return[h.Checkpoint,...t<.5?bi:vi,h.Checkpoint,...t<.5?vi:bi,h.Checkpoint,...t<.5?Si:Ii,h.Checkpoint,...t<.5?Ii:Si,h.Finish]}const Kn="2025-05-10";async function ki(){const t=/iPad|iPhone|iPod/.test(navigator.userAgent);let e=!1;const i=document.getElementById("ios-fullscreen-video");if(i&&i.webkitDisplayingFullscreen&&(e=!0),t){if(e)try{i&&typeof i.webkitExitFullscreen=="function"&&i.webkitExitFullscreen(),i&&(i.pause(),i.currentTime=0),document.exitFullscreen&&await document.exitFullscreen();return}catch(a){console.warn("iOS fullscreen exit failed:",a)}const n=document.getElementById("ios-fullscreen-video")||document.createElement("video");n.id||(n.id="ios-fullscreen-video",n.playsInline=!0,n.setAttribute("playsinline","playsinline"),n.muted=!0,n.setAttribute("muted","muted"),n.autoplay=!1,n.loop=!0,n.style.width="1px",n.style.height="1px",n.style.position="absolute",n.style.opacity="0.01",n.src="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAAAAG1wNDJtcDQxaXNvbWlzbzIAAAACbWV0YQAAAAAAAAAoaGRscgAAAAxBVkMgQ29kaW5nAAAAQ2NvbHJzAAAAG3VpbnQCAAAAGFFSRwKCPQAAAEAAAAJNAAAAAP9tZGF0AAAAEgEH//4PMkXKj////jA9FbmQ=",document.body.appendChild(n));try{if(await n.play(),await new Promise(o=>setTimeout(o,100)),typeof n.webkitEnterFullscreen=="function"){n.webkitEnterFullscreen(),console.log("Requested iOS fullscreen mode");return}}catch(a){console.warn("iOS fullscreen attempt failed:",a)}}const s=document.documentElement;if(document.fullscreenElement)try{await document.exitFullscreen(),console.log("Exited fullscreen mode")}catch(n){n instanceof Error&&console.error(`Error exiting fullscreen: ${n.message} (${n.name})`);return}else try{s.requestFullscreen?await s.requestFullscreen():s.webkitRequestFullscreen?await s.webkitRequestFullscreen():s.mozRequestFullScreen?await s.mozRequestFullScreen():s.msRequestFullscreen&&await s.msRequestFullscreen(),console.log("Entered fullscreen mode")}catch(n){console.warn("Standard fullscreen failed, falling back to canvas positioning",n instanceof Error?n.message:n);const a=document.querySelector("canvas");a&&(a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100%",a.style.height="100%",a.style.zIndex="1000");return}}const qn="Director's cut ("+Kn+")",Ve=1e3/60,$n=Ve*5;let Ue=performance.now(),It=0,xt=1+Math.random()*.6,Et=1+Math.random()*.3,le=1,C,Y=0,be=0,Qi=0;const jn=5e3;let M=0,Zi=0;const we=ys(),xi=ms();let St=0;const et=async t=>{be=t;const e=document.getElementById("restartButton");e&&(e.style.display=t!==1?"block":"none");const i=document.getElementById("fullscreenButton");switch(i&&(i.style.display=t!==1||!wt?"block":"none"),Y=1280*2,t){case 2:await Ys(0),await Ot(),et(3);break;case 3:await Ot(Le),et(4);break;case 4:et(5);break;case 5:if(St=0,It>1&&C&&!C.player.eliminated){const s=It===3?Un():Vn();C=new yi(s,xt,Et,C.characters,xi)}else C=new yi(Yn(),xt,Et,void 0,xi);M=Y,Zi=Qi;break;case 7:M=1,it(Wi),xt=1+Math.random()*.6,Et=1+Math.random()*.3,await Ot(_i),It=1,et(2);break;case 8:M=1,it(Di),C&&C.characters.length>14?(await Ot(Le),It++,et(5)):(await Ot(fe),It=1,Cn(),et(2));break;case 6:$i();break;case 1:Ns();break}},Ji=t=>{requestAnimationFrame(Ji);const e=t-Ue;if(e>=Ve){const i=Math.min(e,$n);Ue=t-e%Ve,Qn(t,i),ls(t)&&Jn(t,i)}},Qn=(t,e)=>{switch(be){case 6:{Dn(),C==null||C.update(t,e),(C==null?void 0:C.state)===Ye.GAME_OVER?et(7):(C==null?void 0:C.state)===Ye.FINISHED&&et(8);break}case 5:{St===2&&M<Y/4?(it(Li),St++):(St===1&&M<Y/2||St===0&&M<Y)&&(it(He),St++);break}}};let ce=0;const Ei="LOADING...",Zn=()=>{const t=ce<10?Ei.substring(0,ce):"LOADING...";H(t+(ce++%60===0?"":"█"),_.Small,"Courier New",1,7.7,!0,0,Ei)},Jn=(t,e)=>{switch(Qi=t,r.save(),r.fillStyle="rgb(0, 0, 20)",r.fillRect(0,0,u.width,u.height),C==null||C.draw(t,e),r.restore(),r.save(),be){case 0:{Zn(),ce++,Ri(),lt(!1);break}case 1:{if(ta(!0),wt){const i=document.getElementById(de);i&&i.style.display==="none"&&(i.style.display="block")}else Jt("start");break}case 2:{We(t++,!1,0),vt(),lt(!0);break}case 3:{We(t++,!0,le=le+.01),vt(),lt(!0);break}case 4:{We(t++,!0,le=le+.01);const i=u.width/2,s=u.height/2;r.beginPath(),r.arc(i,s,M,0,Math.PI*2),r.fillStyle="#802010",r.fill(),M<Y&&(M+=e),vt(),lt(!0);break}case 5:{const i=u.width/2,s=u.height/2;M<=0?et(6):(M>0&&(r.beginPath(),r.arc(i,s,M,0,Math.PI*2),r.fillStyle=M<Y/4?"#105000":M<Y/2?"#CCCC40":"#802010",r.fill()),M<Y/4?H("▲ GO! ▲",_.Xl,"Impact",M/Y*4):M<Y/2?H("Set...",_.Xl,"Impact",1):H("Ready...",_.Xl,"Impact",1),M>0&&(M=(1-(t-Zi)/jn)*Y)),vt(),lt(!0);break}case 7:{const i=u.width/2,s=u.height/2;r.beginPath(),r.arc(i,s,M,0,Math.PI*2),r.fillStyle="#802010",r.fill(),H("❌ ELIMINATED!",_.Large,"Impact",1,-4.5),(C==null?void 0:C.player.rank)===13?H("Don't be the 13TH GUY",_.Small,"Sans-serif"):(H("Don't be one of the last 13TH GUYs",_.Small,"Sans-serif"),H("The final rank is "+(C==null?void 0:C.player.rank)+".",_.Normal,"Impact",1,3.1)),M>=Y&&Jt("continue",9),M<Y&&(r.save(),r.globalAlpha=.7,r.translate(u.width/8,M*2-u.height),ie(r,"eliminated",u.height/6*xt,u.height/2*Et,t,K.Backward,ut.Fall,we),r.globalAlpha=0,r.restore()),M<Y&&(M+=e),vt(),lt(!0);break}case 8:{const i=u.width/2,s=u.height/2;r.beginPath(),r.arc(i,s,M,0,Math.PI*2),r.fillStyle="#105000",r.fill(),M>=Y/4&&(C&&C.characters.length>14?(H("✪ QUALIFIED!",_.Large,"Impact",1,-5),H("☻",_.Huge,"Impact"),H("Ready for next round "+(It+1)+" / 3",_.Normal,"Sans-serif",1,3.8)):(H("GAME FINISHED!",_.Large,"Impact",1,-5),H("☻",_.Huge,"Impact"),H("Congratulations to the winner!",_.Normal,"Impact",1,3.8)),M>=Y&&Jt(),r.save(),r.translate(M<u.width/6?M:u.width/6,u.height/3),ie(r,qe,u.height/6*xt,u.height/2*Et,t,M<u.width/6?K.Right:C&&C.characters.length<=14||t%3600>1800?K.Backward:K.BackwardRight,C&&C.characters.length>14?ut.Walk:ut.Celebrate,we),r.restore()),M<Y&&(M+=e),vt(),lt(!0);break}default:{const i=document.getElementById(de);i&&i.style.display!=="none"&&(i.style.display="none"),lt(!1),$i();break}}r.restore()},ts=()=>{H(qn,_.Tiny,"Impact",.5,2.3,!1),H("Don't be the",_.Small,"Impact",1,-1.8,!0,-.9),H("❌ 13TH GUY",_.Xl,"Impact",1,1.8)},We=(t,e,i)=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,u.width,u.height),r.fill(),r.save(),r.translate(u.width/8+i,u.height/3),ie(r,qe,(e?u.height/6/i:u.height/6)*xt,(e?u.height/2/i:u.height/2)*Et,t,e?K.Forward:t%3600<1800?K.BackwardRight:K.Backward,ut.Walk,we,e),r.restore(),e?(H("Avoid being the 13th or among the last 13",_.Small,"Sans-serif",1,-1.2),H("or you will be eventually ❌ eliminated!",_.Small,"Sans-serif",1,1.3),H("MOVE WITH",_.Xs,"Sans-serif",.8,-7.5),H("▲ / W - ▼ / S - ◄ / A - ► / D",_.Xs,"Sans-serif",.8,-5.6),be===3&&Jt("start the race!")):(ts(),Jt()),r.restore()},ta=t=>{r.save(),r.fillStyle="rgb(20, 20, 50)",r.rect(0,0,u.width,u.height),r.fill(),r.save(),r.translate(u.width/8,u.height/3),ie(r,qe,u.height/6*xt,u.height/2*Et,0,K.Backward,ut.Stand,we),r.restore(),ts(),r.filter="",Ri(),vt(),lt(t)};async function Mi(){const t=document.getElementById(de);t&&(t.style.display="none");const e=bs();document.body.appendChild(e),It=1,et(2)}const ea=async()=>{u.tabIndex=0,u.style.outline="none",cs(),Wn(),Ue=performance.now(),window.requestAnimationFrame(Ji);const t=ps(wt),e=ws(),i=As();document.body.appendChild(e),document.body.appendChild(t),document.body.appendChild(i),t.addEventListener("click",s=>{s.stopPropagation(),ki(),u.focus()}),e.addEventListener("click",s=>{s.stopPropagation(),window.location.reload()}),await Ls(),et(1),wt?i.addEventListener("click",async s=>{s.stopPropagation(),i.style.display="none",it(fe),await new Promise(n=>setTimeout(n,100)),await ki(),u.focus(),await Mi()},{passive:!1,once:!0}):(await Ot(fe),await Mi())},es=1280,is=720;window.addEventListener("resize",()=>Yi(es,is),!1);Yi(es,is);ea();
